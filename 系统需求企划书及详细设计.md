# GBlog 需求起草书及详细设计书

# AetherBlog 智能博客系统

# 产品需求企划书与技术详细设计文档

---

## 📋 文档信息

| 项目  | 内容  |
| --- | --- |
| **产品名称** | AetherBlog（以太博客） |
| **文档版本** | V1.0.0 |
| **文档状态** | 正式版 |
| **编制日期** | 2025年1月 |
| **文档性质** | 产品需求规格说明书 + 技术详细设计 |
| **适用范围** | 产品、设计、开发、测试、运维团队 |

---

## 📑 目录

```text
第一部分：产品愿景与战略定位
  1.1 项目背景与愿景
  1.2 设计哲学：认知优雅
  1.3 用户画像与场景分析
  1.4 竞品分析与差异化定位
  1.5 商业模式与价值主张
  1.6 当前实现状态 (Gap Analysis)

第二部分：技术架构顶层设计
  2.1 系统架构全景图
  2.2 技术选型决策矩阵
  2.3 前端技术栈详解
  2.4 后端技术栈详解
  2.5 AI技术栈详解
  2.6 数据存储架构
  2.7 基础设施规划

第三部分：功能模块详细设计
  3.1 博客前台功能模块
  3.2 内容管理后台模块
  3.3 AI智能功能模块
  3.4 系统管理功能模块

第四部分：数据库详细设计
  4.1 数据模型概述
  4.2 核心表结构设计
  4.3 索引策略设计
  4.4 向量存储设计

第五部分：API接口详细设计
  5.1 接口设计规范
  5.2 认证授权接口
  5.3 博客内容接口
  5.4 AI能力接口
  5.5 系统管理接口

第六部分：安全架构设计
  6.1 安全架构总览
  6.2 认证授权机制
  6.3 数据安全策略
  6.4 接口安全防护

第七部分：前端详细设计
  7.1 前端架构设计
  7.2 组件体系设计
  7.3 页面交互设计
  7.4 视觉规范与动效

第八部分：后端详细设计
  8.1 服务架构设计
  8.2 核心业务实现
  8.3 AI服务集成
  8.4 性能优化策略

第九部分：DevOps与运维设计
  9.1 部署架构设计
  9.2 CI/CD流水线
  9.3 监控告警体系
  9.4 日志管理方案

第十部分：项目实施计划
  10.1 开发阶段规划
  10.2 里程碑定义
  10.3 质量保证策略
  10.4 风险评估与应对
```

---

## 1.6 当前实现状态 (Gap Analysis)

> [!NOTE]
> 本节记录当前代码实现与详细设计文档之间的差异，用于指导后续迭代。

### 1.6.1 已实现模块
- **核心架构**: 后端模块化单体架构 (Modular Monolith)，现已全面升级至 **JDK 25** 与 **Spring Boot 4.0**。
- **博客核心**: 文章 (Post)、分类 (Category)、标签 (Tag)、评论 (Comment)、友链 (FriendLink) 的全功能集成。
- **管理后台**: 完整的 Dashboard 数据看板、媒体库管理 (支持批量操作/预览/下载)、文章编辑器 (支持图片拖拽/粘贴)、友链与分类管理。
- **AI 框架**: 采用独立 AI 服务（FastAPI + LiteLLM），主后端通过 API 对接，旧内嵌方案已弃用。
- **AI 能力**: 实现多种智能 Agent：`WritingAgent`, `AutoTaggerAgent`, `ContentSummarizerAgent`, `SeoOptimizerAgent`, `SearchAgent`。
- **数据统计**: 基于 `visit_records` 的全量统计，包括访客趋势、地域分布、热门文章排行。
- **安全与监控**: 虚拟线程健康监控、容器资源监控、基于 JWT 的双 Token 认证、基于 Redis 的智能限流。
- **云存储集成**: 已对接 **腾讯云 COS**，支持多策略存储切换。
- **高级搜索**: **Elasticsearch 8.x** 深度集成，支持全文检索与语义搜索混合路由。

### 1.6.2 待实现/完善模块
- **前台首屏动效**: 设计文档要求的 "电影级欢迎页" (FE-WELCOME-001) 动效及首次访问逻辑仍需进一步打磨。
- **技术栈优化**: 虽然设计初衷是使用 Tailwind CSS v4，但目前工程实践中为确保稳定性和兼容性，主要使用 **Tailwind CSS 3.4.x** 系列。
- **数据库深度分区**: 针对 `visit_records` 表的百万级数据分区策略待正式上线验证。
- **CI/CD 自动化全闭环**: GitHub Actions 的自动化发布流程需进一步完善用户确认环节。
- **AI 智能问答检索**: 深度 RAG 问答面板 (智能对话形式) 的前端交互体验待增强。

---

# 第二部分：技术架构顶层设计

## 1.1 项目背景与愿景

### 1.1.1 项目背景

在当今数字内容生态高速发展的时代，博客作为个人品牌建设和知识传播的重要载体，正在经历深刻的变革。传统的博客系统（如 WordPress、Hexo、Hugo 等）虽然功能成熟，但在以下方面存在明显不足：

**现有博客系统的痛点分析：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           现有博客系统痛点矩阵                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         设计美学层面                                     │   │
│  │  • WordPress: 模板老旧，难以实现现代化设计语言                             │   │
│  │  • Hexo/Hugo: 高度依赖主题，定制成本高                                    │   │
│  │  • Ghost: 设计尚可，但缺乏极致的交互动效                                  │   │
│  │  • 通病: 难以达到 Apple/Microsoft 级别的设计品质                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         技术架构层面                                     │   │
│  │  • WordPress: PHP技术栈老旧，性能瓶颈明显                                 │   │
│  │  • Hexo/Hugo: 静态生成，动态功能受限                                      │   │
│  │  • 通病: 缺乏对现代 Java 生态的支持                                       │   │
│  │  • 通病: 无法充分利用 JDK21 虚拟线程等新特性                              │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         AI集成层面                                       │   │
│  │  • 现有方案: 依赖第三方插件，集成度低                                      │   │
│  │  • 功能局限: 仅支持简单的文本生成                                         │   │
│  │  • 缺失能力: 无RAG检索、无智能标签、无语义搜索                             │   │
│  │  • 体验割裂: AI功能与写作流程分离                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         专业功能层面                                     │   │
│  │  • 数学公式: 需要额外插件，渲染效果参差不齐                                │   │
│  │  • 代码展示: 缺乏IDE级别的代码体验                                        │   │
│  │  • 图表支持: Mermaid等图表支持不完善                                      │   │
│  │  • 附件管理: 缺乏安全的文件分发机制                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.1.2 产品愿景

**AetherBlog** 的命名源自 "Aether"（以太），在古希腊哲学中代表着纯净、精致与无限可能。这个名字完美诠释了我们的产品愿景：

> **「让每一篇博客都成为艺术品，让每一次创作都有AI相伴」**

**愿景分解：**

| 维度  | 愿景描述 | 实现路径 |
| --- | --- | --- |
| **设计极致** | 达到 Apple/Microsoft 级别的视觉品质 | Glassmorphism + Framer Motion |
| **技术领先** | 采用 Java 生态最前沿技术栈 | **JDK 25 + Spring Boot 4.0 + 独立 AI 服务** |
| **AI原生** | AI 能力深度融入创作全流程 | 独立 AI 服务 + RAG + 智能 Agent |
| **体验流畅** | 无论写作还是阅读都如丝般顺滑 | React 19 + 虚拟线程 + 智能缓存 |
| **专业可靠** | 满足技术博主的所有专业需求 | LaTeX + 代码高亮 + Mermaid |

### 1.1.3 产品定位

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 产品定位                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                              目标用户群体                                        │
│                                   │                                             │
│                    ┌──────────────┼──────────────┐                              │
│                    │              │              │                              │
│                    ▼              ▼              ▼                              │
│              ┌──────────┐  ┌──────────┐  ┌──────────┐                           │
│              │ 技术博主  │  │ 独立开发者 │  │ 技术团队  │                           │
│              │          │  │          │  │          │                           │
│              │ 个人品牌  │  │ 项目展示  │  │ 技术博客  │                           │
│              │ 知识分享  │  │ 作品集   │  │ 团队文化  │                           │
│              └──────────┘  └──────────┘  └──────────┘                           │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│                              核心价值主张                                        │
│                                                                                 │
│      ┌────────────────────────────────────────────────────────────────┐        │
│      │                                                                │        │
│      │   「为追求极致的技术人，打造一款配得上其专业水准的博客系统」       │        │
│      │                                                                │        │
│      └────────────────────────────────────────────────────────────────┘        │
│                                                                                 │
│                              差异化竞争点                                        │
│                                                                                 │
│      ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│      │  🎨 设计美学 │ │  🤖 AI原生  │ │  ⚡ 极致性能 │ │  🔧 专业功能 │           │
│      │             │ │             │ │             │ │             │           │
│      │ 苹果级视觉  │ │ 智能创作    │ │ 毫秒响应    │ │ 技术写作    │           │
│      │ 流体动效    │ │ 语义搜索    │ │ 丝滑体验    │ │ 全面支持    │           │
│      └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.2 设计哲学：认知优雅

### 1.2.1 认知优雅的定义

**认知优雅（Cognitive Elegance）** 是 AetherBlog 的核心设计哲学。这一概念融合了认知心理学与设计美学，强调：

> 界面应当如空气般透明，通过精心设计的视觉层次和交互反馈，引导用户的注意力自然流动，而非通过繁杂的控件去抢夺注意力。

**认知优雅的三大支柱：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           认知优雅设计哲学                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                           ┌─────────────────┐                                   │
│                           │   认知优雅      │                                   │
│                           │ Cognitive       │                                   │
│                           │ Elegance        │                                   │
│                           └────────┬────────┘                                   │
│                                    │                                            │
│              ┌─────────────────────┼─────────────────────┐                      │
│              │                     │                     │                      │
│              ▼                     ▼                     ▼                      │
│     ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐            │
│     │   视觉透明      │   │   交互自然      │   │   内容优先      │            │
│     │   Visual        │   │   Natural       │   │   Content       │            │
│     │   Transparency  │   │   Interaction   │   │   First         │            │
│     ├─────────────────┤   ├─────────────────┤   ├─────────────────┤            │
│     │ • 毛玻璃效果    │   │ • 物理动效      │   │ • 留白设计      │            │
│     │ • 微妙阴影      │   │ • 手势响应      │   │ • 排版张力      │            │
│     │ • 渐变过渡      │   │ • 流体动画      │   │ • 视觉层次      │            │
│     │ • 光影流动      │   │ • 触觉反馈      │   │ • 焦点引导      │            │
│     └─────────────────┘   └─────────────────┘   └─────────────────┘            │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2.2 设计灵感来源

**Apple Design Language 启发：**

| 设计元素 | Apple 实现 | AetherBlog 应用 |
| --- | --- | --- |
| 毛玻璃效果 | macOS 窗口、iOS 控制中心 | 导航栏、卡片背景、模态框 |
| 阴影层次 | 多层阴影营造深度 | 悬浮卡片、按钮状态 |
| 动效曲线 | 弹簧物理动画 | 页面转场、列表加载 |
| 色彩运用 | 渐变与透明度 | 主题色系、强调色 |
| 排版规范 | SF Pro 字体系统 | 中文优化排版体系 |

**Microsoft Fluent Design 启发：**

| 设计元素 | Fluent 实现 | AetherBlog 应用 |
| --- | --- | --- |
| 深度系统 | Z轴层级管理 | 组件层叠规范 |
| 光照效果 | Reveal Highlight | 卡片悬浮光效 |
| 材质系统 | Acrylic 材质 | 背景材质处理 |
| 动作系统 | Connected Animations | 路由转场动画 |
| 缩放响应 | Responsive Breakpoints | 自适应布局 |

### 1.2.3 设计原则

**AetherBlog 十大设计原则：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 设计原则                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  1️⃣ 内容至上 (Content First)                                             │   │
│  │     所有设计决策都应服务于内容的呈现与阅读体验                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  2️⃣ 克制美学 (Restrained Aesthetics)                                     │   │
│  │     避免过度装饰，用最少的元素传达最多的信息                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  3️⃣ 一致性 (Consistency)                                                 │   │
│  │     全站保持统一的视觉语言、交互模式和动效风格                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  4️⃣ 呼吸感 (Breathing Space)                                             │   │
│  │     充足的留白让内容呼吸，让视觉层次自然呈现                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  5️⃣ 即时反馈 (Instant Feedback)                                          │   │
│  │     每一个用户操作都应获得及时、优雅的视觉反馈                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  6️⃣ 流畅动效 (Fluid Motion)                                              │   │
│  │     动效应当自然、流畅，符合物理直觉                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  7️⃣ 可达性 (Accessibility)                                               │   │
│  │     确保所有用户都能无障碍地使用系统                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  8️⃣ 性能优先 (Performance First)                                         │   │
│  │     视觉效果不应以牺牲性能为代价                                            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  9️⃣ 渐进增强 (Progressive Enhancement)                                   │   │
│  │     核心功能优先保证，高级特性作为增强                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  🔟 情感化设计 (Emotional Design)                                         │   │
│  │     通过微交互和细节处理，建立与用户的情感连接                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.3 用户画像与场景分析

### 1.3.1 核心用户画像

**用户角色一：技术博主（Primary Persona）**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           👨‍💻 用户画像：技术博主                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐                                                          │
│  │                  │   姓名：Alex Chen                                         │
│  │    [头像区域]     │   年龄：28岁                                              │
│  │                  │   职业：高级后端工程师                                      │
│  │                  │   技术栈：Java/Go/Kubernetes                              │
│  └──────────────────┘                                                          │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              用户背景                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 5年开发经验，目前在一线互联网公司担任技术专家                            │   │
│  │  • 热衷于技术分享，希望建立个人技术品牌                                     │   │
│  │  • 对设计有追求，不满足于普通博客模板的"程序员审美"                         │   │
│  │  • 追求效率，希望专注于内容创作而非系统维护                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心需求                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ✅ 专业的代码展示：语法高亮、代码折叠、一键复制                            │   │
│  │  ✅ 完善的 Markdown 支持：表格、公式、图表、脚注                            │   │
│  │  ✅ 高颜值设计：能够体现其技术品味和专业形象                                │   │
│  │  ✅ AI 辅助写作：帮助润色、生成摘要、自动打标签                             │   │
│  │  ✅ 流量分析：了解读者行为，优化内容策略                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              痛点问题                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ❌ WordPress 太臃肿，配置复杂，主题审美一般                               │   │
│  │  ❌ Hexo/Hugo 每次更新需要重新构建部署，效率低                              │   │
│  │  ❌ 掘金/CSDN 等平台广告多，无法体现个人品牌                                │   │
│  │  ❌ 写作时需要频繁切换工具：写作、AI润色、图床上传                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              期望价值                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  💡 一个能够代表"技术大佬"身份的数字化名片                                  │   │
│  │  💡 写作体验流畅，AI助手随叫随到                                           │   │
│  │  💡 读者能够沉浸式阅读，提升内容传播效果                                    │   │
│  │  💡 一键部署，专注内容而非运维                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**用户角色二：技术阅读者**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           👩‍💻 用户画像：技术阅读者                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心需求                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ✅ 快速加载：不愿意等待超过3秒                                           │   │
│  │  ✅ 清晰的内容结构：目录导航、章节跳转                                      │   │
│  │  ✅ 优秀的代码阅读体验：高亮、复制、折叠                                    │   │
│  │  ✅ 移动端适配：在通勤时也能舒适阅读                                        │   │
│  │  ✅ 相关推荐：发现更多感兴趣的内容                                          │   │
│  │  ✅ 搜索功能：快速定位需要的信息                                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              痛点问题                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ❌ 很多博客页面加载缓慢，充斥着广告                                        │   │
│  │  ❌ 代码无法一键复制，格式复制后错乱                                        │   │
│  │  ❌ 移动端阅读体验差，排版混乱                                             │   │
│  │  ❌ 搜索功能弱，无法找到想要的内容                                          │   │
│  │  ❌ 文章之间缺乏关联，阅读后不知道看什么                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              期望体验                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  💡 页面秒开，无广告干扰                                                  │   │
│  │  💡 阅读体验舒适，像翻阅精美杂志                                           │   │
│  │  💡 代码可以直接复制使用                                                  │   │
│  │  💡 能够用自然语言搜索问题                                                │   │
│  │  💡 发现优质相关内容，持续学习                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**用户角色三：AI代理（System Persona）**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           🤖 用户画像：AI代理                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐                                                          │
│  │                  │   名称：AetherMind                                        │
│  │    [AI图标]      │   类型：系统内置智能代理                                    │
│  │                  │   角色：创作助手 + 内容分析师                               │
│  │                  │   能力：理解、生成、分析、推荐                               │
│  └──────────────────┘                                                          │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              代理定位                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  AI代理不是一个可见的用户，而是一个隐形的系统协作者。                         │   │
│  │  它在后台持续运行，默默地为博主和读者提供智能化服务。                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心职责                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │  │  📝 写作助手 │  │  🏷️ 智能标签 │  │  📊 内容分析 │  │  🔍 语义搜索 │     │   │
│  │  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤     │   │
│  │  │• 文本清洗   │  │• 自动生成   │  │• 向量化存储 │  │• 问答检索   │     │   │
│  │  │• 内容重写   │  │• 关键词提取 │  │• 知识图谱   │  │• 相关推荐   │     │   │
│  │  │• 风格转换   │  │• 分类推荐   │  │• 阅读分析   │  │• 智能问答   │     │   │
│  │  │• 摘要生成   │  │• SEO优化    │  │• 趋势预测   │  │• 模糊匹配   │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              工作模式                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  【主动模式】                                                             │   │
│  │  • 新文章发布时自动生成摘要和标签                                          │   │
│  │  • 定期更新文章的语义向量                                                  │   │
│  │  • 分析访客行为优化推荐算法                                                │   │
│  │                                                                          │   │
│  │  【被动模式】                                                             │   │
│  │  • 响应博主的写作辅助请求                                                  │   │
│  │  • 处理读者的语义搜索查询                                                  │   │
│  │  • 根据上下文生成智能回复                                                  │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.3.2 用户场景分析

**场景一：博主创作场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        📝 场景一：技术博客创作流程                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Alex 刚完成一个复杂的技术方案，想要将实践经验整理成博客文章。               │   │
│  │  他有大量的笔记、代码片段和设计图，需要整理成一篇结构清晰的技术博客。         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  用户旅程                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  Step 1: 登录后台                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 打开管理后台，进入文章编辑页面                                          │   │
│  │  ↓ 系统展示简洁的Markdown编辑器界面                                        │   │
│  │                                                                          │   │
│  │  Step 2: 粘贴素材                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 将笔记软件中的内容直接粘贴                                              │   │
│  │  ↓ 系统自动检测到格式混乱                                                  │   │
│  │  ↓ AI助手提示：「检测到格式问题，是否自动清洗？」                           │   │
│  │  ↓ 点击确认，AI 自动修复格式、统一标点、优化排版                            │   │
│  │                                                                          │   │
│  │  Step 3: 插入代码                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 使用 ```java 语法插入代码块                                            │   │
│  │  ↓ 编辑器实时渲染语法高亮                                                  │   │
│  │  ↓ 超长代码自动显示「折叠」按钮                                            │   │
│  │                                                                          │   │
│  │  Step 4: 插入公式和图表                                                   │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 使用 $$ 语法插入 LaTeX 公式                                            │   │
│  │  ↓ 使用 ```mermaid 插入流程图                                             │   │
│  │  ↓ 编辑器实时预览渲染效果                                                  │   │
│  │                                                                          │   │
│  │  Step 5: 上传图片                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 直接粘贴截图或拖拽图片文件                                              │   │
│  │  ↓ 系统自动上传至配置的图床（本地/腾讯云COS）                               │   │
│  │  ↓ 自动生成居中的Markdown图片语法                                          │   │
│  │  ↓ 图片自动压缩优化                                                       │   │
│  │                                                                          │   │
│  │  Step 6: AI 辅助优化                                                     │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 选中一段文字，点击「AI润色」                                            │   │
│  │  ↓ 选择风格：更学术 / 更通俗 / 更简洁                                      │   │
│  │  ↓ AI 返回优化后的版本，可预览对比                                         │   │
│  │  ↓ 确认采用或继续微调                                                     │   │
│  │                                                                          │   │
│  │  Step 7: 生成摘要和标签                                                   │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 点击「智能摘要」按钮                                                    │   │
│  │  ↓ AI 分析全文，生成100字以内的精炼摘要                                    │   │
│  │  ↓ 同时推荐5个最相关的标签                                                 │   │
│  │  ↓ 博主可编辑调整后确认                                                    │   │
│  │                                                                          │   │
│  │  Step 8: 预览发布                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 切换到预览模式，查看最终效果                                            │   │
│  │  ↓ 查看字数统计、预估阅读时间                                              │   │
│  │  ↓ 选择立即发布或定时发布                                                  │   │
│  │  ↓ 文章发布后自动进行向量化索引                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  系统响应要求                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 编辑器响应：< 50ms（输入无延迟）                                        │   │
│  │  • 图片上传：< 3s（含压缩处理）                                            │   │
│  │  • AI 响应：首字 < 500ms（流式输出）                                       │   │
│  │  • 预览渲染：< 200ms                                                      │   │
│  │  • 发布操作：< 1s                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**场景二：读者阅读场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        📖 场景二：技术文章阅读流程                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Lisa 在调试 Java 应用时遇到内存溢出问题，通过搜索引擎找到了 Alex 的       │   │
│  │  博客文章。她需要快速定位解决方案并理解原理。                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  用户旅程                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  Step 1: 首次访问                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 通过 Google 搜索结果点击进入                                           │   │
│  │  ↓ 页面在 1 秒内完成加载                                                  │   │
│  │  ↓ 首次访问展示欢迎动画（可跳过）                                          │   │
│  │  ↓ 文章内容清晰呈现，无广告干扰                                            │   │
│  │                                                                          │   │
│  │  Step 2: 快速导航                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 右侧显示文章目录（Table of Contents）                                  │   │
│  │  ↓ 点击目录项平滑滚动到对应章节                                            │   │
│  │  ↓ 当前阅读位置在目录中高亮标识                                            │   │
│  │                                                                          │   │
│  │  Step 3: 代码交互                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 找到相关代码片段                                                       │   │
│  │  ↓ 点击「复制」按钮，代码复制到剪贴板                                      │   │
│  │  ↓ 按钮显示「已复制 ✓」反馈                                               │   │
│  │  ↓ 长代码块点击展开查看完整内容                                            │   │
│  │                                                                          │   │
│  │  Step 4: 深入阅读                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 阅读包含数学公式的性能分析部分                                          │   │
│  │  ↓ 公式渲染清晰，可点击放大查看                                            │   │
│  │  ↓ 流程图直观展示调优步骤                                                  │   │
│  │                                                                          │   │
│  │  Step 5: 智能搜索                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 想了解更多相关内容                                                     │   │
│  │  ↓ 使用搜索框输入「如何分析堆内存」                                        │   │
│  │  ↓ 系统返回语义相关的文章列表                                              │   │
│  │  ↓ 同时展示 AI 生成的直接回答摘要                                          │   │
│  │                                                                          │   │
│  │  Step 6: 继续探索                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 文章底部展示「相关推荐」卡片                                            │   │
│  │  ↓ 推荐内容基于语义相似度计算                                              │   │
│  │  ↓ 点击进入下一篇继续阅读                                                  │   │
│  │  ↓ 页面转场动画流畅自然                                                    │   │
│  │                                                                          │   │
│  │  Step 7: 时间树浏览                                                      │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 点击导航栏「归档」进入时间树                                            │   │
│  │  ↓ 以年份-月份层级展示历史文章                                             │   │
│  │  ↓ 点击年份平滑展开月份列表                                               │   │
│  │  ↓ 发现更多感兴趣的历史文章                                               │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  体验指标要求                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 首屏加载 (FCP)：< 1.0s                                                │   │
│  │  • 可交互时间 (TTI)：< 1.5s                                              │   │
│  │  • 页面转场：< 300ms                                                     │   │
│  │  • 搜索响应：< 500ms                                                     │   │
│  │  • 滚动帧率：稳定 60fps                                                  │   │
│  │  • 移动端适配：完美响应式                                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**场景三：博主管理场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        ⚙️ 场景三：后台管理与监控                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Alex 想要了解博客的运营状况，检查系统健康状态，并管理友链和配置。            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  核心管理场景                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  【仪表盘概览】                                                           │   │
│  │  • 今日/本周/本月访问量趋势图                                              │   │
│  │  • 热门文章 Top 10 排行                                                   │   │
│  │  • 访客地理分布热力图                                                     │   │
│  │  • 设备类型占比饼图                                                       │   │
│  │  • 系统资源实时监控（CPU/内存/JVM）                                        │   │
│  │                                                                          │   │
│  │  【文章管理】                                                             │   │
│  │  • 文章列表（草稿/已发布/定时发布）                                        │   │
│  │  • 批量操作（删除/归档/更改分类）                                          │   │
│  │  • 文章数据统计（阅读/点赞/评论）                                          │   │
│  │                                                                          │   │
│  │  【媒体库管理】                                                           │   │
│  │  • 图片/附件统一管理                                                      │   │
│  │  • 存储空间使用情况                                                       │   │
│  │  • 切换存储策略（本地/云存储）                                             │   │
│  │                                                                          │   │
│  │  【友链管理】                                                             │   │
│  │  • 添加/编辑/删除友链                                                     │   │
│  │  • 友链卡片样式预览                                                       │   │
│  │  • 友链状态检测（是否可访问）                                              │   │
│  │                                                                          │   │
│  │  【系统设置】                                                             │   │
│  │  • 站点基础信息配置                                                       │   │
│  │  • 博主个人信息编辑                                                       │   │
│  │  • 存储配置（图床切换）                                                    │   │
│  │  • AI 服务配置（API Key/Prompt管理）                                      │   │
│  │  • 主题与外观设置                                                         │   │
│  │                                                                          │   │
│  │  【日志与监控】                                                           │   │
│  │  • 系统运行日志查看                                                       │   │
│  │  • 错误日志筛选与告警                                                     │   │
│  │  • API 调用统计                                                          │   │
│  │  • 慢请求分析                                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.4 竞品分析与差异化定位

### 1.4.1 竞品全景分析

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              竞品分析矩阵                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Hexo / Hugo                                                             │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：静态站点生成器，适合技术博客                                        │   │
│  │  技术栈：Node.js (Hexo) / Go (Hugo)                                      │   │
│  │  优势：部署简单、性能极佳、无服务器成本                                     │   │
│  │  劣势：无动态功能、每次更新需重新构建、AI集成困难                           │   │
│  │  适用场景：纯静态内容展示、对动态功能无需求的场景                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Ghost                                                                   │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：专注于写作的现代化博客平台                                          │   │
│  │  技术栈：Node.js + Ember.js                                              │   │
│  │  优势：设计现代、专注写作体验、会员订阅功能                                 │   │
│  │  劣势：技术栈相对小众、定制成本高、AI功能基础                              │   │
│  │  商业模式：开源自托管 + 付费托管服务                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Notion / 语雀                                                           │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：知识管理与协作平台，可作为博客使用                                   │   │
│  │  优势：编辑体验优秀、协作功能强大、AI集成逐步完善                           │   │
│  │  劣势：SEO较弱、定制性有限、品牌展示不够独立                               │   │
│  │  适用场景：团队知识库、轻量级内容发布                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  掘金 / CSDN / 博客园                                                    │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：技术社区平台                                                       │   │
│  │  优势：自带流量、社区互动、无需维护                                        │   │
│  │  劣势：广告干扰、难以建立个人品牌、内容归属权问题                           │   │
│  │  适用场景：快速发布、社区推广                                              │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.4.2 竞品功能对比矩阵

| 功能维度 | WordPress | Hexo/Hugo | Ghost | Notion | **AetherBlog** |
| --- | --- | --- | --- | --- | --- |
| **部署方式** | 动态服务 | 静态生成 | 动态服务 | SaaS | 动态服务 |
| **技术栈** | PHP | Node/Go | Node.js | 闭源  | **Java 21** |
| **设计美感** | ⭐⭐  | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **⭐⭐⭐⭐⭐** |
| **性能表现** | ⭐⭐  | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | **⭐⭐⭐⭐⭐** |
| **Markdown** | 插件  | ✅ 原生 | ✅ 原生 | ✅ 原生 | **✅ 增强** |
| **数学公式** | 插件  | 插件  | 有限  | ✅   | **✅ 原生** |
| **代码高亮** | 插件  | 主题  | ✅   | ✅   | **✅ IDE级** |
| **Mermaid图表** | 插件  | 插件  | ❌   | ❌   | **✅ 原生** |
| **AI写作** | ❌   | ❌   | 基础  | ✅   | **✅ 深度** |
| **AI标签** | ❌   | ❌   | ❌   | ❌   | **✅** |
| **语义搜索** | ❌   | ❌   | ❌   | 有限  | **✅ RAG** |
| **流量统计** | 插件  | 第三方 | 内置  | 有限  | **✅ 自研** |
| **后台管理** | 复杂  | 无   | 简洁  | 简洁  | **✅ 专业** |
| **开源免费** | ✅   | ✅   | ✅   | ❌   | **✅** |

### 1.4.3 差异化竞争策略

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 差异化定位                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                              核心差异化优势                                      │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点一：      │   🎨 极致设计美学                                  │   │
│  │   │  设计层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • 参考 Apple/Microsoft 设计语言                   │   │
│  │   │                 │   • Glassmorphism 毛玻璃效果                        │   │
│  │   │                 │   • Framer Motion 物理动效                         │   │
│  │   │                 │   • 远超传统博客的视觉品质                           │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点二：      │   🤖 AI 原生集成                                   │   │
│  │   │  智能层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • 独立 AI 服务深度集成                           │   │
│  │   │                 │   • 智能写作助手（清洗/重写/润色）                    │   │
│  │   │                 │   • 自动标签与摘要生成                              │   │
│  │   │                 │   • RAG 语义搜索                                   │   │
│  │   │                 │   • 可自定义 Prompt 模板                            │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点三：      │   ⚡ 现代技术架构                                  │   │
│  │   │  技术层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • JDK 21 虚拟线程（高并发支持）                    │   │
│  │   │                 │   • Spring Boot 3.4+（最新特性）                    │   │
│  │   │                 │   • PostgreSQL 17 + pgvector                       │   │
│  │   │                 │   • React 19（并发渲染）                            │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点四：      │   🔧 专业技术写作支持                               │   │
│  │   │  功能层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • LaTeX 数学公式原生支持                          │   │
│  │   │                 │   • IDE 级代码展示体验                              │   │
│  │   │                 │   • Mermaid 图表原生渲染                            │   │
│  │   │                 │   • 附件加密安全分发                                │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           目标市场定位                                   │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  目标用户：追求极致的技术人                                                │   │
│  │  ──────────────────────────────────────────────────────────────────────  │   │
│  │                                                                          │   │
│  │  他们是：                                                                 │   │
│  │  • 对代码有洁癖的完美主义者                                               │   │
│  │  • 追求效率的工具控                                                       │   │
│  │  • 重视个人品牌的技术领袖                                                 │   │
│  │  • 愿意为优质体验付费的专业人士                                            │   │
│  │                                                                          │   │
│  │  他们不满足于：                                                           │   │
│  │  • WordPress 的臃肿和老旧                                                 │   │
│  │  • Hexo 的静态限制                                                       │   │
│  │  • 第三方平台的广告和品牌稀释                                              │   │
│  │                                                                          │   │
│  │  他们渴望：                                                               │   │
│  │  • 一个能够代表其专业水准的数字化名片                                       │   │
│  │  • AI 赋能的高效创作体验                                                  │   │
│  │  • 极致的阅读与视觉体验                                                   │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.5 商业模式与价值主张

### 1.5.1 商业模式画布

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 商业模式画布                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌───────────────────┬───────────────────┬───────────────────────────────────┐ │
│  │    关键合作伙伴    │     关键活动      │           价值主张                │ │
│  ├───────────────────┼───────────────────┼───────────────────────────────────┤ │
│  │                   │                   │                                   │ │
│  │  • OpenAI/Claude  │  • 产品研发       │  「为追求极致的技术人，打造       │ │
│  │  • 云服务商       │  • 社区运营       │    配得上其专业水准的博客系统」   │ │
│  │  • CDN 服务商     │  • 技术支持       │                                   │ │
│  │  • 开源社区       │  • 内容营销       │  核心价值：                       │ │
│  │                   │                   │  • 极致设计美学                   │ │
│  │                   │                   │  • AI 原生创作体验                │ │
│  │                   │                   │  • 专业技术写作支持               │ │
│  │                   │                   │  • 高性能架构                     │ │
│  │                   │                   │                                   │ │
│  ├───────────────────┼───────────────────┼─────────────────┬─────────────────┤ │
│  │     关键资源      │                   │    客户关系     │    渠道通路     │ │
│  ├───────────────────┤                   ├─────────────────┼─────────────────┤ │
│  │                   │                   │                 │                 │ │
│  │  • 技术团队       │                   │  • 开源社区     │  • GitHub       │ │
│  │  • 开源代码库     │                   │  • 技术文档     │  • 技术博客     │ │
│  │  • 设计系统       │                   │  • Issue支持    │  • 技术社区     │ │
│  │  • AI 能力       │                   │  • Discord社群  │  • 口碑传播     │ │
│  │                   │                   │                 │  • SEO          │ │
│  │                   │                   │                 │                 │ │
│  ├───────────────────┴───────────────────┼─────────────────┴─────────────────┤ │
│  │              成本结构                  │             收入来源              │ │
│  ├────────────────────────────────────────┼───────────────────────────────────┤ │
│  │                                        │                                   │ │
│  │  • 研发人力成本                        │  • 开源版本：免费                  │ │
│  │  • 云服务基础设施                      │  • Pro 订阅：¥99/年               │ │
│  │  • AI API 调用成本                    │  • Team 版本：¥499/年             │ │
│  │  • 运营推广成本                        │  • Enterprise：定制报价            │ │
│  │                                        │  • 托管服务 (SaaS)                │ │
│  │                                        │  • 主题/插件市场                  │ │
│  │                                        │  • 技术咨询服务                   │ │
│  │                                        │                                   │ │
│  └────────────────────────────────────────┴───────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5.2 版本定价策略

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 版本矩阵                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐│
│  │   Community     │  │      Pro        │  │      Team       │  │  Enterprise ││
│  │   社区版        │  │     专业版       │  │     团队版       │  │    企业版   ││
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────┤│
│  │                 │  │                 │  │                 │  │             ││
│  │     免费        │  │   ¥99/年       │  │   ¥499/年      │  │   定制报价  ││
│  │                 │  │                 │  │                 │  │             ││
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────┤│
│  │                 │  │                 │  │                 │  │             ││
│  │ ✅ 全部基础功能 │  │ ✅ 全部基础功能  │  │ ✅ 全部基础功能  │  │ ✅ 全部功能 ││
│  │ ✅ Markdown+   │  │ ✅ Markdown+    │  │ ✅ Markdown+    │  │ ✅ 私有部署 ││
│  │ ✅ 代码高亮     │  │ ✅ 代码高亮     │  │ ✅ 代码高亮      │  │ ✅ 定制开发 ││
│  │ ✅ 数学公式     │  │ ✅ 数学公式     │  │ ✅ 数学公式      │  │ ✅ SLA保障  ││
│  │ ✅ 基础AI功能   │  │ ✅ 完整AI功能   │  │ ✅ 完整AI功能    │  │ ✅ 专属支持 ││
│  │ ✅ 本地图床     │  │ ✅ 云存储集成   │  │ ✅ 云存储集成    │  │ ✅ 培训服务 ││
│  │ ❌ 高级AI功能   │  │ ✅ 优先客服     │  │ ✅ 多用户管理    │  │             ││
│  │ ❌ 云存储集成   │  │ ✅ 高级统计     │  │ ✅ 权限控制      │  │             ││
│  │                 │  │ ✅ 自定义Prompt │  │ ✅ 协作编辑      │  │             ││
│  │                 │  │                 │  │ ✅ 审核流程      │  │             ││
│  │                 │  │                 │  │                 │  │             ││
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────┘│
│                                                                                 │
│       适合：                适合：              适合：              适合：       │
│    个人开发者           专业技术博主         技术团队/公司       大型企业      │
│    学习体验             个人品牌建设         团队技术博客        合规要求高    │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5.3 价值主张声明

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 价值主张                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                          │   │
│  │   「 AetherBlog 不只是一个博客系统，                                      │   │
│  │                                                                          │   │
│  │      它是您技术实力的数字化名片，                                          │   │
│  │                                                                          │   │
│  │      是您创作思想的优雅容器，                                              │   │
│  │                                                                          │   │
│  │      是与 AI 协作的智能工作台。」                                          │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           核心价值承诺                                   │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │   对博主的承诺：                                                          │   │
│  │   ─────────────────────────────────────────────────────────────────────  │   │
│  │   📝 让您专注于创作，而非与工具搏斗                                        │   │
│  │   🤖 AI 助手随时待命，让写作事半功倍                                       │   │
│  │   🎨 您的博客将成为品味与专业的象征                                        │   │
│  │   📊 深度洞察读者行为，优化内容策略                                        │   │
│  │                                                                          │   │
│  │   对读者的承诺：                                                          │   │
│  │   ─────────────────────────────────────────────────────────────────────  │   │
│  │   ⚡ 页面秒开，零等待阅读体验                                             │   │
│  │   📖 沉浸式阅读，如翻阅精美杂志                                            │   │
│  │   🔍 智能搜索，快速找到所需内容                                            │   │
│  │   💻 专业代码展示，一键复制即用                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

# 第二部分：技术架构顶层设计

## 2.1 系统架构全景图

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AetherBlog 系统架构全景图                                           │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        🌐 接入层                                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                 CDN + WAF + DDoS 防护                                      │ │  │
│    │   │                          Cloudflare / 腾讯云CDN / 阿里云CDN                                 │ │  │
│    │   │                     静态资源加速 | HTTPS终结 | 边缘缓存 | 攻击防护                          │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                    ┌───────────────┴───────────────┐                                     │
│                                    │                               │                                     │
│                                    ▼                               ▼                                     │
│    ┌────────────────────────────────────────────┐   ┌────────────────────────────────────────────┐      │
│    │              🖥️ 博客前台                    │   │              🔧 管理后台                    │      │
│    │          Blog Frontend (SSR/CSR)           │   │          Admin Dashboard (SPA)             │      │
│    ├────────────────────────────────────────────┤   ├────────────────────────────────────────────┤      │
│    │                                            │   │                                            │      │
│    │  框架: React 19 + Next.js 15               │   │  框架: React 19 + Vite 6                   │      │
│    │  样式: Tailwind CSS 3.4 + Shadcn/UI        │   │  样式: Tailwind CSS 3.4 + Shadcn/UI        │      │
│    │  动效: Framer Motion 11                    │   │  图表: Recharts + Apache ECharts           │      │
│    │  状态: Zustand + TanStack Query            │   │  状态: Zustand + TanStack Query            │      │
│    │                                            │   │                                            │      │
│    │  页面模块:                                  │   │  页面模块:                                  │      │
│    │  • 🏠 首页 (Hero + 文章列表)                │   │  • 📊 仪表盘 (数据概览)                     │      │
│    │  • 📄 文章详情 (Markdown渲染)              │   │  • 📝 文章管理 (CRUD + 编辑器)              │      │
│    │  • 📁 归档页 (时间树)                       │   │  • 🖼️ 媒体库 (图片/附件)                    │      │
│    │  • 🏷️ 分类/标签页                          │   │  • 📈 统计分析 (流量/行为)                  │      │
│    │  • 🔍 搜索页 (AI语义搜索)                  │   │  • 🤖 AI工具 (写作助手)                     │      │
│    │  • 🔗 友链页 (卡片展示)                    │   │  • ⚙️ 系统设置 (站点/存储)                  │      │
│    │  • 👤 关于页 (博主介绍)                    │   │  • 📋 日志监控 (系统日志)                   │      │
│    │                                            │   │                                            │      │
│    └────────────────────────────────────────────┘   └────────────────────────────────────────────┘      │
│                                    │                               │                                     │
│                                    └───────────────┬───────────────┘                                     │
│                                                    │ HTTPS / REST API / WebSocket                        │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        🚪 网关层                                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                              Nginx / Spring Cloud Gateway                                  │ │  │
│    │   │                                                                                            │ │  │
│    │   │    ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │ │  │
│    │   │    │ 路由转发  │ │ JWT验证  │ │ 限流熔断  │ │ 日志追踪  │ │ 跨域处理  │ │ 负载均衡  │          │ │  │
│    │   │    └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘          │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    ☕ 业务服务层 (Spring Boot 3.4+)                               │  │
│    │                                         JDK 21 + Virtual Threads                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │   📝 博客服务     │  │   👤 用户服务     │  │   🖼️ 媒体服务     │  │   📊 统计服务     │  │ │  │
│    │   │   │   Blog Service   │  │   User Service   │  │   Media Service  │  │ Analytics Service│  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ • 文章CRUD       │  │ • 用户认证       │  │ • 图片上传       │  │ • 访问统计       │  │ │  │
│    │   │   │ • 分类管理       │  │ • JWT签发        │  │ • 文件管理       │  │ • 行为分析       │  │ │  │
│    │   │   │ • 标签管理       │  │ • 权限校验       │  │ • 图床切换       │  │ • 热门排行       │  │ │  │
│    │   │   │ • 评论管理       │  │ • 会话管理       │  │ • 附件加密       │  │ • 地域分布       │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │   🔍 搜索服务     │  │   🔔 通知服务     │  │   ⚙️ 配置服务     │  │   🔗 友链服务     │  │ │  │
│    │   │   │  Search Service  │  │  Notify Service  │  │  Config Service  │  │  FriendLink Svc  │  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ • 全文检索       │  │ • 邮件通知       │  │ • 站点配置       │  │ • 友链管理       │  │ │  │
│    │   │   │ • 语义搜索       │  │ • Webhook推送    │  │ • 主题设置       │  │ • 状态检测       │  │ │  │
│    │   │   │ • 混合检索       │  │ • 异常告警       │  │ • 存储配置       │  │ • 卡片样式       │  │ │  │
│    │   │   │ • 相关推荐       │  │ • 定时任务       │  │ • AI配置         │  │ • 自动申请       │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    🤖 AI 能力层 (独立 AI 服务)                                   │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              AI Agent 编排引擎                                      │  │ │  │
│    │   │   │                       LiteLLM Router / LlamaIndex Pipeline                         │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                            │                                              │ │  │
│    │   │          ┌─────────────────┬───────────────┼───────────────┬─────────────────┐            │ │  │
│    │   │          │                 │               │               │                 │            │ │  │
│    │   │          ▼                 ▼               ▼               ▼                 ▼            │ │  │
│    │   │   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐     │ │  │
│    │   │   │ 📝 写作Agent│   │ 🏷️ 标签Agent│   │ 📋 摘要Agent│   │ 🔍 搜索Agent│   │ 🧹 清洗Agent│     │ │  │
│    │   │   ├────────────┤   ├────────────┤   ├────────────┤   ├────────────┤   ├────────────┤     │ │  │
│    │   │   │• 内容重写  │   │• 智能标签  │   │• 摘要生成  │   │• RAG检索   │   │• 格式清洗  │     │ │  │
│    │   │   │• 风格转换  │   │• 关键词    │   │• SEO描述   │   │• 语义问答  │   │• 排版优化  │     │ │  │
│    │   │   │• 续写建议  │   │• 分类推荐  │   │• 多语言    │   │• 相关推荐  │   │• 标点修正  │     │ │  │
│    │   │   └────────────┘   └────────────┘   └────────────┘   └────────────┘   └────────────┘     │ │  │
│    │   │                                            │                                              │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              Prompt 模板管理器                                      │  │ │  │
│    │   │   │                   内置模板 + 自定义模板 + 版本管理 + A/B测试                         │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                            │                                              │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              LLM 模型适配层                                         │  │ │  │
│    │   │   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐             │  │ │  │
│    │   │   │  │ OpenAI   │  │ Claude   │  │ 通义千问  │  │ DeepSeek │  │ Ollama   │             │  │ │  │
│    │   │   │  │ GPT-4o   │  │ Sonnet   │  │ Qwen-Max │  │ V3       │  │ 本地模型 │             │  │ │  │
│    │   │   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘             │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        💾 数据存储层                                              │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │  🐘 PostgreSQL   │  │   🔴 Redis       │  │  🔍 Elasticsearch │  │   📦 对象存储     │  │ │  │
│    │   │   │      17          │  │     7.2+         │  │       8.x        │  │   MinIO/COS      │  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ 主数据存储       │  │ 缓存层           │  │ 搜索引擎         │  │ 文件存储         │  │ │  │
│    │   │   │ • 用户数据       │  │ • Session缓存    │  │ • 全文检索       │  │ • 图片存储       │  │ │  │
│    │   │   │ • 文章内容       │  │ • 热点数据       │  │ • 向量检索       │  │ • 附件存储       │  │ │  │
│    │   │   │ • 配置信息       │  │ • 限流计数       │  │ • 日志索引       │  │ • 备份存储       │  │ │  │
│    │   │   │                  │  │ • 分布式锁       │  │ • 混合搜索       │  │ • CDN源站        │  │ │  │
│    │   │   │ ┌──────────────┐ │  │                  │  │                  │  │                  │  │ │  │
│    │   │   │ │  pgvector    │ │  │                  │  │ ┌──────────────┐ │  │ 存储策略:        │  │ │  │
│    │   │   │ │  向量扩展     │ │  │                  │  │ │ Dense Vector │ │  │ • 本地存储       │  │ │  │
│    │   │   │ │  • 文章嵌入   │ │  │                  │  │ │ 8.x 向量搜索 │ │  │ • 腾讯云COS      │  │ │  │
│    │   │   │ │  • HNSW索引   │ │  │                  │  │ └──────────────┘ │  │ • 阿里云OSS      │  │ │  │
│    │   │   │ └──────────────┘ │  │                  │  │                  │  │ • AWS S3         │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                       🔧 基础设施层                                               │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐          │ │  │
│    │   │   │  🐳 Docker     │  │  ⚙️ CI/CD      │  │  📈 监控告警    │  │  📋 日志系统    │          │ │  │
│    │   │   │  Compose/K8s   │  │  GitHub Actions│  │  Prometheus    │  │  ELK Stack     │          │ │  │
│    │   │   ├────────────────┤  ├────────────────┤  ├────────────────┤  ├────────────────┤          │ │  │
│    │   │   │ • 容器化部署   │  │ • 自动构建     │  │ • 指标采集     │  │ • 日志收集     │          │ │  │
│    │   │   │ • 服务编排     │  │ • 自动测试     │  │ • Grafana可视化│  │ • 日志分析     │          │ │  │
│    │   │   │ • 弹性伸缩     │  │ • 自动部署     │  │ • 告警通知     │  │ • 日志检索     │          │ │  │
│    │   │   │ • 健康检查     │  │ • 版本回滚     │  │ • 链路追踪     │  │ • 审计日志     │          │ │  │
│    │   │   └────────────────┘  └────────────────┘  └────────────────┘  └────────────────┘          │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 2.2 技术选型决策矩阵

### 2.2.1 技术选型总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        技术选型决策矩阵                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  层级          │  技术选型                    │  版本        │  选型理由                            │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  前端框架      │  React                       │  19.x        │  并发渲染、Hooks生态、社区活跃        │ │
│   │  构建工具      │  Vite / Next.js              │  6.x / 15.x  │  极速HMR、SSR支持                    │ │
│   │  类型系统      │  TypeScript                  │  5.4+        │  类型安全、重构友好                   │ │
│   │  状态管理      │  Zustand + TanStack Query    │  Latest      │  轻量、服务端状态管理优秀             │ │
│   │  UI组件库      │  Shadcn/UI + Radix UI        │  Latest      │  无障碍、高度可定制                   │ │
│   │  CSS框架       │  Tailwind CSS                │  3.4.x       │  原子化、JIT编译                     │ │
│   │  动画库        │  Framer Motion               │  11.x        │  声明式、物理动画                    │ │
│   │  Markdown      │  MDX + unified               │  Latest      │  组件嵌入、AST转换                   │ │
│   │  代码高亮      │  Shiki                       │  1.x         │  VS Code主题兼容                     │ │
│   │  数学公式      │  KaTeX                       │  0.16+       │  性能优于MathJax                     │ │
│   │  图表         │  Mermaid + Recharts          │  Latest      │  流程图、数据可视化                   │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  JDK          │  Eclipse Temurin             │  25 LTS      │  虚拟线程、模式匹配、虚拟线程监控       │ │
│   │  核心框架      │  Spring Boot                 │  4.0.0+      │  云原生、Jackson 3.x 兼容             │ │
│   │  构建工具      │  Maven                       │  3.9+        │  成熟稳定、插件丰富                   │ │
│   │  安全框架      │  Spring Security             │  6.4+        │  OAuth2.1、JWT支持                   │ │
│   │  数据访问      │  Spring Data JPA             │  3.4+        │  类型安全查询                        │ │
│   │  API文档       │  SpringDoc OpenAPI           │  2.3+        │  Swagger UI自动生成                  │ │
│   │  参数校验      │  Jakarta Validation          │  3.x         │  声明式校验                          │ │
│   │  对象映射      │  MapStruct                   │  1.5+        │  编译时生成、零反射                   │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  AI框架        │  独立 AI 服务 (FastAPI + LiteLLM) │  Latest     │  解耦后端、OpenAI 协议兼容           │ │
│   │  Agent编排     │  LlamaIndex (可选)           │  0.10+       │  RAG 编排与索引管线                  │ │
│   │  向量计算      │  pgvector                    │  0.7+        │  PostgreSQL原生集成                  │ │
│   │  Embedding     │  OpenAI / 兼容供应商         │  -           │  text-embedding-3-small             │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  主数据库      │  PostgreSQL                  │  17          │  ACID、JSON、向量支持                │ │
│   │  缓存         │  Redis                       │  7.2+        │  高性能、数据结构丰富                 │ │
│   │  搜索引擎      │  Elasticsearch               │  8.x         │  全文检索、向量搜索                   │ │
│   │  对象存储      │  MinIO / 腾讯云COS           │  -           │  S3兼容、多策略切换                  │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  容器化        │  Docker                      │  24+         │  标准化部署                          │ │
│   │  编排         │  Docker Compose / K8s        │  -           │  开发/生产环境                       │ │
│   │  CI/CD        │  GitHub Actions              │  -           │  自动化流水线                        │ │
│   │  监控         │  Prometheus + Grafana        │  -           │  指标可视化                          │ │
│   │  日志         │  ELK Stack                   │  8.x         │  日志聚合分析                        │ │
│   │  反向代理      │  Nginx                       │  1.25+       │  负载均衡、SSL                       │ │
│   │                │                              │              │                                      │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2.2 关键技术决策说明

**决策一：为什么选择 JDK 21 + 虚拟线程？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    JDK 21 虚拟线程技术决策                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      问题背景                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   在 AetherBlog 中，后端需要频繁处理以下 I/O 密集型操作：                                            │ │
│   │                                                                                                    │ │
│   │   • 数据库查询（PostgreSQL）                                                                        │ │
│   │   • 缓存读写（Redis）                                                                               │ │
│   │   • 文件上传下载（对象存储）                                                                         │ │
│   │   • AI 模型调用（OpenAI API，单次调用可能耗时 3-10 秒）                                              │ │
│   │   • 搜索引擎查询（Elasticsearch）                                                                   │ │
│   │                                                                                                    │ │
│   │   传统方案的问题：                                                                                  │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │   • 线程池模型：每个请求占用一个平台线程，AI调用期间线程被阻塞                                         │ │
│   │   • WebFlux响应式：学习曲线陡峭，代码可读性差，调试困难                                               │ │
│   │   • 线程池耗尽：高并发 AI 请求时，Tomcat 线程池（默认200）迅速耗尽                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      解决方案                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   JDK 21 虚拟线程（Project Loom）：                                                                 │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │     传统线程模型                          虚拟线程模型                                       │  │ │
│   │   │     ─────────────                         ─────────────                                     │  │ │
│   │   │                                                                                             │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                                       │  │ │
│   │   │     │ 请求 1  │ ──▶ 平台线程1 (阻塞等待)    │ 请求 1  │ ──▶ 虚拟线程1 ──┐                     │  │ │
│   │   │     └─────────┘                           └─────────┘                │                     │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                │   ┌─────────┐       │  │ │
│   │   │     │ 请求 2  │ ──▶ 平台线程2 (阻塞等待)    │ 请求 2  │ ──▶ 虚拟线程2 ──┼──▶│ 载体线程 │       │  │ │
│   │   │     └─────────┘                           └─────────┘                │   │ (少量)  │       │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                │   └─────────┘       │  │ │
│   │   │     │ 请求 N  │ ──▶ 线程池耗尽！           │ 请求 N  │ ──▶ 虚拟线程N ──┘     ↓               │  │ │
│   │   │     └─────────┘                           └─────────┘              自动挂起/恢复           │  │ │
│   │   │                                                                                             │  │ │
│   │   │     问题：200线程处理200并发               优势：百万级虚拟线程，极低开销                      │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   代码示例：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   // application.yml - 开启虚拟线程                                                                 │ │
│   │   spring:                                                                                          │ │
│   │     threads:                                                                                       │ │
│   │       virtual:                                                                                     │ │
│   │         enabled: true                                                                              │ │
│   │                                                                                                    │ │
│   │   // 同步代码风格，但底层自动使用虚拟线程                                                             │ │
│   │   @GetMapping("/api/posts/{id}/ai-summary")                                                        │ │
│   │   public AiSummaryResponse generateSummary(@PathVariable Long id) {                                │ │
│   │       Post post = postRepository.findById(id).orElseThrow();  // I/O 操作                          │ │
│   │       String summary = aiService.generateSummary(post.getContent());  // AI调用，可能耗时5秒        │ │
│   │       return new AiSummaryResponse(summary);  // 虚拟线程自动挂起/恢复，不阻塞平台线程               │ │
│   │   }                                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      性能对比                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   场景：1000 并发 AI 摘要生成请求（每次 AI 调用耗时约 3 秒）                                          │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────┬─────────────────────────┬─────────────────────────┐                  │ │
│   │   │        指标             │   传统线程池 (200)      │   虚拟线程 (JDK 21)     │                  │ │
│   │   ├─────────────────────────┼─────────────────────────┼─────────────────────────┤                  │ │
│   │   │  最大并发处理数         │        200              │        1000+            │                  │ │
│   │   │  平均响应时间           │       15秒 (排队)       │        3秒              │                  │ │
│   │   │  内存占用               │      ~200MB             │       ~50MB             │                  │ │
│   │   │  线程创建开销           │       ~1ms/线程         │      ~1μs/线程          │                  │ │
│   │   │  代码复杂度             │       简单              │        简单             │                  │ │
│   │   └─────────────────────────┴─────────────────────────┴─────────────────────────┘                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**决策二：为什么采用独立 AI 服务，而非内嵌 Spring AI / LangChain4j？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    AI 架构选型对比分析                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌─────────────────────┬──────────────────────────────────┬──────────────────────────────────┐          │
│   │       评估维度       │   独立 AI 服务 (FastAPI + LiteLLM) │   内嵌 AI 框架 (Spring AI / LC4j) │          │
│   ├─────────────────────┼──────────────────────────────────┼──────────────────────────────────┤          │
│   │  解耦程度           │  ✅ 与主后端完全解耦             │  ⚠️ 与 Java 生态强绑定             │          │
│   │  供应商兼容         │  ✅ OpenAI 协议统一接入           │  ⚠️ SDK 适配周期受限               │          │
│   │  生态成熟度         │  ✅ Python AI 生态最完善          │  ⚠️ Java 生态更新相对滞后          │          │
│   │  部署与扩缩容       │  ✅ 可独立部署与弹性扩容          │  ⚠️ 依赖主服务伸缩                 │          │
│   │  成本与限流         │  ✅ 集中化路由/配额/计费控制        │  ⚠️ 分散在业务层实现               │          │
│   │  观测与治理         │  ✅ 统一日志/指标/审计             │  ⚠️ 需按模块定制                   │          │
│   │  研发效率           │  ✅ 快速接入新模型/新工具          │  ⚠️ 受框架版本与依赖约束           │          │
│   └─────────────────────┴──────────────────────────────────┴──────────────────────────────────┘          │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      最终决策                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ✅ 选择独立 AI 服务作为主路径                                                                    │ │
│   │                                                                                                    │ │
│   │   决策理由：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   1. 主后端不引入 AI SDK，避免生态与依赖锁定                                                        │ │
│   │   2. LiteLLM 统一 OpenAI 协议接入，供应商切换成本最低                                                │ │
│   │   3. AI 服务可独立扩缩容与限流，成本治理更集中                                                      │ │
│   │   4. LlamaIndex 负责 RAG 管线，能力更贴近业界最佳实践                                                 │ │
│   │                                                                                                    │ │
│   │   备选方案：                                                                                        │ │
│   │   如需在 Java 内部执行轻量 AI 调用，仅保留 HTTP 客户端，不再引入 Spring AI 或 LangChain4j。          │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**决策三：为什么选择 PostgreSQL 17 + pgvector？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    向量数据库选型决策                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      候选方案对比                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐  │ │
│   │   │       方案          │  PostgreSQL     │    Milvus       │    Pinecone     │   Elasticsearch │  │ │
│   │   │                     │  + pgvector     │                 │                 │    8.x          │  │ │
│   │   ├─────────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  部署复杂度         │  ⭐ 最低        │  中等           │  ⭐ 托管服务    │  中等           │  │ │
│   │   │                     │  复用现有PG     │  独立集群       │  无需部署       │  独立集群       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  运维成本           │  ⭐ 最低        │  较高           │  按量付费       │  中等           │  │ │
│   │   │                     │  单一数据库     │  额外组件       │  成本不可控     │  额外组件       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  数据一致性         │  ⭐ ACID事务    │  最终一致       │  最终一致       │  最终一致       │  │ │
│   │   │                     │  强一致         │                 │                 │                 │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  混合查询           │  ⭐ 原生SQL     │  有限           │  有限           │  ✅ 强大        │  │ │
│   │   │                     │  关系+向量      │                 │                 │  全文+向量      │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  性能 (100万向量)   │  ✅ 优秀       │  ⭐ 最优        │  ⭐ 最优        │  ✅ 优秀        │  │ │
│   │   │                     │  HNSW索引      │  专业优化       │  专业优化       │  HNSW索引       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  AI 服务接入      │  ⭐ 原生支持    │  ✅ 支持        │  ✅ 支持        │  ✅ 支持        │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   └─────────────────────┴─────────────────┴─────────────────┴─────────────────┴─────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      决策结论                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ✅ 主选：PostgreSQL 17 + pgvector                                                                │ │
│   │   ✅ 补充：Elasticsearch 8.x（全文检索 + 可选向量搜索）                                              │ │
│   │                                                                                                    │ │
│   │   决策理由：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   1. 架构简化：无需维护独立的向量数据库集群                                                          │ │
│   │                                                                                                    │ │
│   │   2. 事务一致性：文章发布 + 向量索引可在同一事务中完成                                                │ │
│   │      BEGIN;                                                                                        │ │
│   │        INSERT INTO posts (title, content) VALUES (...);                                            │ │
│   │        INSERT INTO post_embeddings (post_id, embedding) VALUES (...);                              │ │
│   │      COMMIT;  -- 原子操作，数据永不不一致                                                           │ │
│   │                                                                                                    │ │
│   │   3. 混合查询能力：                                                                                 │ │
│   │      SELECT p.*, 1 - (e.embedding <=> query_vector) as similarity                                  │ │
│   │      FROM posts p                                                                                  │ │
│   │      JOIN post_embeddings e ON p.id = e.post_id                                                    │ │
│   │      WHERE p.status = 'PUBLISHED'                                                                  │ │
│   │        AND p.category_id = 5                                                                       │ │
│   │      ORDER BY e.embedding <=> query_vector                                                         │ │
│   │      LIMIT 10;                                                                                     │ │
│   │                                                                                                    │ │
│   │   4. 博客场景向量规模有限（通常 < 100万），pgvector HNSW 索引性能完全满足                             │ │
│   │                                                                                                    │ │
│   │   5. 成本最优：不增加额外基础设施                                                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 2.3 前端技术栈详解

### 2.3.1 前端架构设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端架构设计图（完整版）                                            │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                    前端 Monorepo 完整目录结构                                       │ │
│   │                                                                                                    │ │
│   │   aetherblog-frontend/                                                                             │ │
│   │   │                                                                                                │ │
│   │   ├── apps/                                         # 📱 应用层                                    │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── blog/                                     # 🖥️ 博客前台应用 (Next.js 15)                 │ │
│   │   │   │   ├── src/                                                                                 │ │
│   │   │   │   │   ├── app/                              # App Router 路由                              │ │
│   │   │   │   │   │   ├── (home)/                       # 首页路由组                                   │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 首页                                         │ │
│   │   │   │   │   │   │   └── loading.tsx               # 加载状态                                     │ │
│   │   │   │   │   │   ├── posts/                        # 文章模块                                     │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 文章列表                                     │ │
│   │   │   │   │   │   │   └── [slug]/                   # 动态路由                                     │ │
│   │   │   │   │   │   │       ├── page.tsx              # 文章详情                                     │ │
│   │   │   │   │   │   │       ├── loading.tsx           # 骨架屏                                       │ │
│   │   │   │   │   │   │       └── opengraph-image.tsx   # OG图片生成                                   │ │
│   │   │   │   │   │   ├── archives/                     # 归档页 (时间树)                              │ │
│   │   │   │   │   │   │   └── page.tsx                                                                 │ │
│   │   │   │   │   │   ├── categories/                   # 分类页                                       │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 分类列表                                     │ │
│   │   │   │   │   │   │   └── [slug]/page.tsx           # 分类详情                                     │ │
│   │   │   │   │   │   ├── tags/                         # 标签页                                       │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 标签云                                       │ │
│   │   │   │   │   │   │   └── [slug]/page.tsx           # 标签详情                                     │ │
│   │   │   │   │   │   ├── search/                       # 搜索页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # AI 语义搜索                                  │ │
│   │   │   │   │   │   ├── friends/                      # 友链页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # 友链卡片展示                                 │ │
│   │   │   │   │   │   ├── about/                        # 关于页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # 博主介绍                                     │ │
│   │   │   │   │   │   ├── layout.tsx                    # 根布局                                       │ │
│   │   │   │   │   │   ├── not-found.tsx                 # 404 页面                                     │ │
│   │   │   │   │   │   ├── error.tsx                     # 错误边界                                     │ │
│   │   │   │   │   │   └── globals.css                   # 全局样式                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   ├── components/                       # 页面专用组件                                 │ │
│   │   │   │   │   │   ├── home/                         # 首页组件                                     │ │
│   │   │   │   │   │   │   ├── HeroSection.tsx           # 欢迎区域                                     │ │
│   │   │   │   │   │   │   ├── FeaturedPosts.tsx         # 精选文章                                     │ │
│   │   │   │   │   │   │   ├── RecentPosts.tsx           # 最新文章                                     │ │
│   │   │   │   │   │   │   └── WelcomeModal.tsx          # 欢迎弹窗                                     │ │
│   │   │   │   │   │   ├── post/                         # 文章组件                                     │ │
│   │   │   │   │   │   │   ├── PostCard.tsx              # 文章卡片                                     │ │
│   │   │   │   │   │   │   ├── PostContent.tsx           # 文章内容                                     │ │
│   │   │   │   │   │   │   ├── PostToc.tsx               # 文章目录                                     │ │
│   │   │   │   │   │   │   ├── PostMeta.tsx              # 文章元信息                                   │ │
│   │   │   │   │   │   │   ├── PostNavigation.tsx        # 上下篇导航                                   │ │
│   │   │   │   │   │   │   ├── RelatedPosts.tsx          # 相关推荐                                     │ │
│   │   │   │   │   │   │   └── ShareButtons.tsx          # 分享按钮                                     │ │
│   │   │   │   │   │   ├── archives/                     # 归档组件                                     │ │
│   │   │   │   │   │   │   ├── TimeTree.tsx              # 时间树                                       │ │
│   │   │   │   │   │   │   ├── YearNode.tsx              # 年份节点                                     │ │
│   │   │   │   │   │   │   ├── MonthNode.tsx             # 月份节点                                     │ │
│   │   │   │   │   │   │   └── PostNode.tsx              # 文章节点                                     │ │
│   │   │   │   │   │   ├── search/                       # 搜索组件                                     │ │
│   │   │   │   │   │   │   ├── SearchInput.tsx           # 搜索输入框                                   │ │
│   │   │   │   │   │   │   ├── SearchResults.tsx         # 搜索结果                                     │ │
│   │   │   │   │   │   │   ├── AiAnswer.tsx              # AI 回答                                      │ │
│   │   │   │   │   │   │   └── SearchHistory.tsx         # 搜索历史                                     │ │
│   │   │   │   │   │   └── friends/                      # 友链组件                                     │ │
│   │   │   │   │   │       ├── FriendCard.tsx            # 友链卡片                                     │ │
│   │   │   │   │   │       └── FriendGrid.tsx            # 友链网格                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   ├── hooks/                            # 自定义 Hooks                                 │ │
│   │   │   │   │   │   ├── useScrollProgress.ts          # 滚动进度                                     │ │
│   │   │   │   │   │   ├── useReadingTime.ts             # 阅读时间                                     │ │
│   │   │   │   │   │   ├── useTheme.ts                   # 主题切换                                     │ │
│   │   │   │   │   │   └── useIntersection.ts            # 交叉观察                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   └── lib/                              # 工具库                                       │ │
│   │   │   │   │       ├── api.ts                        # API 客户端                                   │ │
│   │   │   │   │       ├── mdx.ts                        # MDX 处理                                     │ │
│   │   │   │   │       └── utils.ts                      # 通用工具                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── public/                               # 静态资源                                     │ │
│   │   │   │   │   ├── fonts/                            # 字体文件                                     │ │
│   │   │   │   │   ├── images/                           # 图片资源                                     │ │
│   │   │   │   │   └── favicon.ico                       # 站点图标                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── next.config.mjs                       # Next.js 配置                                 │ │
│   │   │   │   ├── tailwind.config.ts                    # Tailwind 配置                                │ │
│   │   │   │   ├── tsconfig.json                         # TypeScript 配置                              │ │
│   │   │   │   └── package.json                                                                         │ │
│   │   │   │                                                                                            │ │
│   │   │   │                                                                                            │ │
│   │   │   └── admin/                                    # 🔧 管理后台应用 (Vite + React)               │ │
│   │   │       ├── src/                                                                                 │ │
│   │   │       │   ├── main.tsx                          # 应用入口                                     │ │
│   │   │       │   ├── App.tsx                           # 根组件                                       │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── pages/                            # 页面目录                                     │ │
│   │   │       │   │   ├── dashboard/                    # 仪表盘                                       │ │
│   │   │       │   │   │   ├── index.tsx                 # 仪表盘首页                                   │ │
│   │   │       │   │   │   ├── StatsCards.tsx            # 统计卡片                                     │ │
│   │   │       │   │   │   ├── VisitorChart.tsx          # 访问趋势图                                   │ │
│   │   │       │   │   │   ├── TopPosts.tsx              # 热门文章                                     │ │
│   │   │       │   │   │   ├── GeoDistribution.tsx       # 地域分布                                     │ │
│   │   │       │   │   │   └── SystemStatus.tsx          # 系统状态                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── posts/                        # 文章管理                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 文章列表                                     │ │
│   │   │       │   │   │   ├── create.tsx                # 创建文章                                     │ │
│   │   │       │   │   │   ├── [id]/edit.tsx             # 编辑文章                                     │ │
│   │   │       │   │   │   └── components/                                                              │ │
│   │   │       │   │   │       ├── PostEditor.tsx        # 文章编辑器                                   │ │
│   │   │       │   │   │       ├── PostPreview.tsx       # 预览面板                                     │ │
│   │   │       │   │   │       ├── PostSettings.tsx      # 设置                                     │ │
│   │   │       │   │   │       ├── AiAssistant.tsx       # AI 助手面板                                  │ │
│   │   │       │   │   │       └── ImageUploader.tsx     # 图片上传                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── media/                        # 媒体管理                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 媒体库                                       │ │
│   │   │       │   │   │   ├── MediaGrid.tsx             # 媒体网格                                     │ │
│   │   │       │   │   │   ├── MediaUpload.tsx           # 上传组件                                     │ │
│   │   │       │   │   │   └── MediaDetail.tsx           # 详情弹窗                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── categories/                   # 分类管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── tags/                         # 标签管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── friends/                      # 友链管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── analytics/                    # 统计分析                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 统计首页                                     │ │
│   │   │       │   │   │   ├── VisitorAnalytics.tsx      # 访客分析                                     │ │
│   │   │       │   │   │   ├── ContentAnalytics.tsx      # 内容分析                                     │ │
│   │   │       │   │   │   └── DeviceAnalytics.tsx       # 设备分析                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── ai-tools/                     # AI 工具                                      │ │
│   │   │       │   │   │   ├── index.tsx                 # AI 工具首页                                  │ │
│   │   │       │   │   │   ├── TextCleaner.tsx           # 文本清洗                                     │ │
│   │   │       │   │   │   ├── ContentRewriter.tsx       # 内容重写                                     │ │
│   │   │       │   │   │   ├── PromptManager.tsx         # Prompt 管理                                  │ │
│   │   │       │   │   │   └── BatchProcessor.tsx        # 批量处理                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── settings/                     # 系统设置                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 设置首页                                     │ │
│   │   │       │   │   │   ├── SiteSettings.tsx          # 站点设置                                     │ │
│   │   │       │   │   │   ├── ProfileSettings.tsx       # 个人资料                                     │ │
│   │   │       │   │   │   ├── StorageSettings.tsx       # 存储配置                                     │ │
│   │   │       │   │   │   ├── AiSettings.tsx            # AI 配置                                      │ │
│   │   │       │   │   │   └── ThemeSettings.tsx         # 主题配置                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── logs/                         # 日志监控                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 日志首页                                     │ │
│   │   │       │   │   │   ├── SystemLogs.tsx            # 系统日志                                     │ │
│   │   │       │   │   │   ├── ErrorLogs.tsx             # 错误日志                                     │ │
│   │   │       │   │   │   └── AuditLogs.tsx             # 审计日志                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   └── auth/                         # 认证页面                                     │ │
│   │   │       │   │       ├── login.tsx                 # 登录页                                       │ │
│   │   │       │   │       └── forgot-password.tsx       # 忘记密码                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── components/                       # 后台专用组件                                 │ │
│   │   │       │   │   ├── layout/                       # 布局组件                                     │ │
│   │   │       │   │   │   ├── AdminLayout.tsx           # 后台布局                                     │ │
│   │   │       │   │   │   ├── Sidebar.tsx               # 侧边栏                                       │ │
│   │   │       │   │   │   ├── Header.tsx                # 顶部栏                                       │ │
│   │   │       │   │   │   ├── Breadcrumb.tsx            # 面包屑                                       │ │
│   │   │       │   │   │   └── Footer.tsx                # 底部栏                                       │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── common/                       # 通用组件                                     │ │
│   │   │       │   │   │   ├── DataTable.tsx             # 数据表格                                     │ │
│   │   │       │   │   │   ├── Pagination.tsx            # 分页组件                                     │ │
│   │   │       │   │   │   ├── ConfirmDialog.tsx         # 确认弹窗                                     │ │
│   │   │       │   │   │   ├── LoadingSpinner.tsx        # 加载动画                                     │ │
│   │   │       │   │   │   └── EmptyState.tsx            # 空状态                                       │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   └── charts/                       # 图表组件                                     │ │
│   │   │       │   │       ├── LineChart.tsx             # 折线图                                       │ │
│   │   │       │   │       ├── BarChart.tsx              # 柱状图                                       │ │
│   │   │       │   │       ├── PieChart.tsx              # 饼图                                         │ │
│   │   │       │   │       └── GeoMap.tsx                # 地理分布图                                   │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── stores/                           # Zustand 状态管理                             │ │
│   │   │       │   │   ├── authStore.ts                  # 认证状态                                     │ │
│   │   │       │   │   ├── postStore.ts                  # 文章状态                                     │ │
│   │   │       │   │   ├── uiStore.ts                    # UI 状态                                      │ │
│   │   │       │   │   └── settingsStore.ts              # 设置状态                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── services/                         # API 服务层                                   │ │
│   │   │       │   │   ├── api.ts                        # Axios 实例                                   │ │
│   │   │       │   │   ├── authService.ts                # 认证服务                                     │ │
│   │   │       │   │   ├── postService.ts                # 文章服务                                     │ │
│   │   │       │   │   ├── mediaService.ts               # 媒体服务                                     │ │
│   │   │       │   │   ├── analyticsService.ts           # 统计服务                                     │ │
│   │   │       │   │   └── aiService.ts                  # AI 服务                                      │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── hooks/                            # 自定义 Hooks                                 │ │
│   │   │       │   │   ├── useAuth.ts                    # 认证 Hook                                    │ │
│   │   │       │   │   ├── usePosts.ts                   # 文章 Hook                                    │ │
│   │   │       │   │   └── useDebounce.ts                # 防抖 Hook                                    │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── types/                            # 类型定义                                     │ │
│   │   │       │   │   ├── post.ts                       # 文章类型                                     │ │
│   │   │       │   │   ├── user.ts                       # 用户类型                                     │ │
│   │   │       │   │   ├── api.ts                        # API 类型                                     │ │
│   │   │       │   │   └── index.ts                      # 类型导出                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   └── utils/                            # 工具函数                                     │ │
│   │   │       │       ├── format.ts                     # 格式化                                       │ │
│   │   │       │       ├── validation.ts                 # 校验                                         │ │
│   │   │       │       └── storage.ts                    # 本地存储                                     │ │
│   │   │       │                                                                                        │ │
│   │   │       ├── index.html                            # HTML 入口                                    │ │
│   │   │       ├── vite.config.ts                        # Vite 配置                                    │ │
│   │   │       ├── tailwind.config.ts                    # Tailwind 配置                                │ │
│   │   │       ├── tsconfig.json                         # TypeScript 配置                              │ │
│   │   │       └── package.json                                                                         │ │
│   │   │                                                                                                │ │
│   │                                                                                                    │ │
│   ├── packages/                                         # 📦 共享包层                                  │ │
│   │   │                                                                                                │ │
│   │   ├── ui/                                           # 🎨 共享 UI 组件库                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── components/                           # 基础组件                                     │ │
│   │   │   │   │   ├── Button/                                                                          │ │
│   │   │   │   │   │   ├── Button.tsx                    # 按钮组件                                     │ │
│   │   │   │   │   │   ├── Button.styles.ts              # 按钮样式                                     │ │
│   │   │   │   │   │   └── index.ts                                                                     │ │
│   │   │   │   │   ├── Card/                             # 卡片组件                                     │ │
│   │   │   │   │   ├── Input/                            # 输入框组件                                   │ │
│   │   │   │   │   ├── Modal/                            # 模态框组件                                   │ │
│   │   │   │   │   ├── Dropdown/                         # 下拉菜单                                     │ │
│   │   │   │   │   ├── Toast/                            # 提示消息                                     │ │
│   │   │   │   │   ├── Tooltip/                          # 工具提示                                     │ │
│   │   │   │   │   ├── Avatar/                           # 头像组件                                     │ │
│   │   │   │   │   ├── Badge/                            # 徽章组件                                     │ │
│   │   │   │   │   ├── Tag/                              # 标签组件                                     │ │
│   │   │   │   │   ├── Skeleton/                         # 骨架屏                                       │ │
│   │   │   │   │   └── index.ts                          # 统一导出                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── primitives/                           # Radix UI 封装                                │ │
│   │   │   │   │   ├── Dialog.tsx                        # 对话框                                       │ │
│   │   │   │   │   ├── Popover.tsx                       # 弹出框                                       │ │
│   │   │   │   │   ├── Select.tsx                        # 选择器                                       │ │
│   │   │   │   │   ├── Tabs.tsx                          # 标签页                                       │ │
│   │   │   │   │   ├── Accordion.tsx                     # 手风琴                                       │ │
│   │   │   │   │   └── Switch.tsx                        # 开关                                         │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── themes/                               # 主题配置                                     │ │
│   │   │   │       ├── tokens.ts                         # 设计令牌                                     │ │
│   │   │   │       ├── lightTheme.ts                     # 亮色主题                                     │ │
│   │   │   │       └── darkTheme.ts                      # 暗色主题                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   ├── editor/                                       # 📝 Markdown 编辑器包                         │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── MarkdownEditor.tsx                    # 编辑器主组件                                 │ │
│   │   │   │   ├── Toolbar.tsx                           # 工具栏                                       │ │
│   │   │   │   ├── Preview.tsx                           # 预览面板                                     │ │
│   │   │   │   ├── StatusBar.tsx                         # 状态栏 (字数统计等)                          │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── plugins/                              # 编辑器插件                                   │ │
│   │   │   │   │   ├── codeBlock.ts                      # 代码块插件                                   │ │
│   │   │   │   │   ├── mathBlock.ts                      # 数学公式插件 (KaTeX)                         │ │
│   │   │   │   │   ├── mermaid.ts                        # Mermaid 图表插件                             │ │
│   │   │   │   │   ├── imageUpload.ts                    # 图片上传插件                                 │ │
│   │   │   │   │   ├── tablePlugin.ts                    # 表格增强插件                                 │ │
│   │   │   │   │   ├── linkPlugin.ts                     # 链接插件                                     │ │
│   │   │   │   │   ├── emojiPlugin.ts                    # Emoji 插件                                   │ │
│   │   │   │   │   ├── tocPlugin.ts                      # 目录生成插件                                 │ │
│   │   │   │   │   └── index.ts                          # 插件注册                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── extensions/                           # CodeMirror/Monaco 扩展                       │ │
│   │   │   │   │   ├── markdown.ts                       # Markdown 语法支持                            │ │
│   │   │   │   │   ├── syntaxHighlight.ts                # 语法高亮                                     │ │
│   │   │   │   │   ├── autoComplete.ts                   # 自动补全                                     │ │
│   │   │   │   │   ├── bracketMatch.ts                   # 括号匹配                                     │ │
│   │   │   │   │   └── lineNumbers.ts                    # 行号显示                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── renderers/                            # Markdown 渲染器                              │ │
│   │   │   │   │   ├── CodeBlockRenderer.tsx             # 代码块渲染                                   │ │
│   │   │   │   │   │   ├── SyntaxHighlighter.tsx         # 语法高亮 (Shiki)                             │ │
│   │   │   │   │   │   ├── CopyButton.tsx                # 复制按钮                                     │ │
│   │   │   │   │   │   ├── CollapseToggle.tsx            # 折叠切换                                     │ │
│   │   │   │   │   │   └── LanguageLabel.tsx             # 语言标签                                     │ │
│   │   │   │   │   ├── MathRenderer.tsx                  # 数学公式渲染 (KaTeX)                         │ │
│   │   │   │   │   ├── MermaidRenderer.tsx               # Mermaid 图表渲染                             │ │
│   │   │   │   │   ├── ImageRenderer.tsx                 # 图片渲染 (居中/缩放)                         │ │
│   │   │   │   │   ├── TableRenderer.tsx                 # 表格渲染                                     │ │
│   │   │   │   │   ├── BlockquoteRenderer.tsx            # 引用块渲染                                   │ │
│   │   │   │   │   ├── HeadingRenderer.tsx               # 标题渲染 (锚点)                              │ │
│   │   │   │   │   └── LinkRenderer.tsx                  # 链接渲染                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── utils/                                # 工具函数                                     │ │
│   │   │   │   │   ├── markdownParser.ts                 # Markdown 解析                                │ │
│   │   │   │   │   ├── htmlSanitizer.ts                  # HTML 净化                                    │ │
│   │   │   │   │   ├── wordCounter.ts                    # 字数统计                                     │ │
│   │   │   │   │   ├── readingTime.ts                    # 阅读时间估算                                 │ │
│   │   │   │   │   ├── imageHandler.ts                   # 图片处理                                     │ │
│   │   │   │   │   └── shortcutKeys.ts                   # 快捷键配置                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── hooks/                                # 编辑器 Hooks                                 │ │
│   │   │   │   │   ├── useEditor.ts                      # 编辑器核心 Hook                              │ │
│   │   │   │   │   ├── useMarkdown.ts                    # Markdown 处理 Hook                           │ │
│   │   │   │   │   ├── useAutoSave.ts                    # 自动保存 Hook                                │ │
│   │   │   │   │   ├── useImagePaste.ts                  # 图片粘贴 Hook                                │ │
│   │   │   │   │   └── useUndoRedo.ts                    # 撤销重做 Hook                                │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── types/                                # 类型定义                                     │ │
│   │   │   │   │   ├── editor.ts                         # 编辑器类型                                   │ │
│   │   │   │   │   ├── plugin.ts                         # 插件类型                                     │ │
│   │   │   │   │   └── renderer.ts                       # 渲染器类型                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── hooks/                                        # 🪝 共享 Hooks 包                             │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── useApi.ts                             # API 请求 Hook                                │ │
│   │   │   │   ├── useAuth.ts                            # 认证状态 Hook                                │ │
│   │   │   │   ├── useDebounce.ts                        # 防抖 Hook                                    │ │
│   │   │   │   ├── useThrottle.ts                        # 节流 Hook                                    │ │
│   │   │   │   ├── useLocalStorage.ts                    # 本地存储 Hook                                │ │
│   │   │   │   ├── useSessionStorage.ts                  # 会话存储 Hook                                │ │
│   │   │   │   ├── useMediaQuery.ts                      # 媒体查询 Hook                                │ │
│   │   │   │   ├── useClickOutside.ts                    # 点击外部 Hook                                │ │
│   │   │   │   ├── useScrollLock.ts                      # 滚动锁定 Hook                                │ │
│   │   │   │   ├── useIntersectionObserver.ts            # 交叉观察 Hook                                │ │
│   │   │   │   ├── useCopyToClipboard.ts                 # 复制剪贴板 Hook                              │ │
│   │   │   │   ├── useKeyPress.ts                        # 按键检测 Hook                                │ │
│   │   │   │   ├── useWindowSize.ts                      # 窗口尺寸 Hook                                │ │
│   │   │   │   ├── useScrollPosition.ts                  # 滚动位置 Hook                                │ │
│   │   │   │   ├── usePrevious.ts                        # 前值保存 Hook                                │ │
│   │   │   │   ├── useToggle.ts                          # 切换状态 Hook                                │ │
│   │   │   │   ├── useAsync.ts                           # 异步操作 Hook                                │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── utils/                                        # 🔧 共享工具函数包                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── format/                               # 格式化工具                                   │ │
│   │   │   │   │   ├── date.ts                           # 日期格式化                                   │ │
│   │   │   │   │   ├── number.ts                         # 数字格式化                                   │ │
│   │   │   │   │   ├── string.ts                         # 字符串格式化                                 │ │
│   │   │   │   │   ├── fileSize.ts                       # 文件大小格式化                               │ │
│   │   │   │   │   └── duration.ts                       # 时长格式化                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── validation/                           # 校验工具                                     │ │
│   │   │   │   │   ├── email.ts                          # 邮箱校验                                     │ │
│   │   │   │   │   ├── url.ts                            # URL 校验                                     │ │
│   │   │   │   │   ├── password.ts                       # 密码强度校验                                 │ │
│   │   │   │   │   └── form.ts                           # 表单校验                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── helpers/                              # 辅助函数                                     │ │
│   │   │   │   │   ├── classNames.ts                     # 类名合并 (clsx)                              │ │
│   │   │   │   │   ├── deepClone.ts                      # 深拷贝                                       │ │
│   │   │   │   │   ├── debounce.ts                       # 防抖函数                                     │ │
│   │   │   │   │   ├── throttle.ts                       # 节流函数                                     │ │
│   │   │   │   │   ├── sleep.ts                          # 延迟函数                                     │ │
│   │   │   │   │   ├── retry.ts                          # 重试函数                                     │ │
│   │   │   │   │   ├── omit.ts                           # 对象属性剔除                                 │ │
│   │   │   │   │   ├── pick.ts                           # 对象属性选取                                 │ │
│   │   │   │   │   └── uniqueId.ts                       # 唯一ID生成                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── storage/                              # 存储工具                                     │ │
│   │   │   │   │   ├── localStorage.ts                   # 本地存储封装                                 │ │
│   │   │   │   │   ├── sessionStorage.ts                 # 会话存储封装                                 │ │
│   │   │   │   │   └── indexedDB.ts                      # IndexedDB 封装                               │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── url/                                  # URL 工具                                     │ │
│   │   │   │   │   ├── queryString.ts                    # 查询字符串处理                               │ │
│   │   │   │   │   ├── slugify.ts                        # Slug 生成                                    │ │
│   │   │   │   │   └── urlBuilder.ts                     # URL 构建器                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── types/                                        # 📋 共享类型定义包                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── api/                                  # API 相关类型                                 │ │
│   │   │   │   │   ├── request.ts                        # 请求类型                                     │ │
│   │   │   │   │   ├── response.ts                       # 响应类型                                     │ │
│   │   │   │   │   ├── pagination.ts                     # 分页类型                                     │ │
│   │   │   │   │   └── error.ts                          # 错误类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── models/                               # 数据模型类型                                 │ │
│   │   │   │   │   ├── post.ts                           # 文章类型                                     │ │
│   │   │   │   │   ├── category.ts                       # 分类类型                                     │ │
│   │   │   │   │   ├── tag.ts                            # 标签类型                                     │ │
│   │   │   │   │   ├── user.ts                           # 用户类型                                     │ │
│   │   │   │   │   ├── comment.ts                        # 评论类型                                     │ │
│   │   │   │   │   ├── media.ts                          # 媒体类型                                     │ │
│   │   │   │   │   ├── friendLink.ts                     # 友链类型                                     │ │
│   │   │   │   │   └── settings.ts                       # 设置类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── ai/                                   # AI 相关类型                                  │ │
│   │   │   │   │   ├── prompt.ts                         # Prompt 类型                                  │ │
│   │   │   │   │   ├── completion.ts                     # 补全类型                                     │ │
│   │   │   │   │   └── embedding.ts                      # 嵌入类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── common/                               # 通用类型                                     │ │
│   │   │   │   │   ├── base.ts                           # 基础类型                                     │ │
│   │   │   │   │   └── utility.ts                        # 工具类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   └── config/                                       # ⚙️ 共享配置包                                │ │
│   │       ├── src/                                                                                     │ │
│   │       │   ├── tailwind/                             # Tailwind 预设                                │ │
│   │       │   │   ├── preset.ts                         # 主题预设                                     │ │
│   │       │   │   ├── colors.ts                         # 颜色配置                                     │ │
│   │       │   │   ├── typography.ts                     # 排版配置                                     │ │
│   │       │   │   ├── animation.ts                      # 动画配置                                     │ │
│   │       │   │   └── plugins.ts                        # 插件配置                                     │ │
│   │       │   │                                                                                        │ │
│   │       │   ├── eslint/                               # ESLint 配置                                  │ │
│   │       │   │   └── index.js                          # ESLint 预设                                  │ │
│   │       │   │                                                                                        │ │
│   │       │   ├── typescript/                           # TypeScript 配置                              │ │
│   │       │   │   ├── base.json                         # 基础配置                                     │ │
│   │       │   │   ├── react.json                        # React 配置                                   │ │
│   │       │   │   └── nextjs.json                       # Next.js 配置                                 │ │
│   │       │   │                                                                                        │ │
│   │       │   └── constants/                            # 常量配置                                     │ │
│   │       │       ├── api.ts                            # API 常量                                     │ │
│   │       │       ├── routes.ts                         # 路由常量                                     │ │
│   │       │       └── theme.ts                          # 主题常量                                     │ │
│   │       │                                                                                            │ │
│   │       ├── package.json                                                                             │ │
│   │       └── tsconfig.json                                                                            │ │
│   │                                                                                                    │ │
│   │                                                                                                    │ │
│   ├── pnpm-workspace.yaml                               # PNPM 工作区配置                              │ │
│   ├── package.json                                      # 根 package.json                              │ │
│   ├── turbo.json                                        # Turborepo 配置                               │ │
│   ├── .eslintrc.js                                      # ESLint 配置                                  │ │
│   ├── .prettierrc                                       # Prettier 配置                                │ │
│   ├── tsconfig.base.json                                # TypeScript 基础配置                          │ │
│   └── README.md                                         # 项目说明                                     │ │
│                                                                                                        │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.3.2 前端核心组件设计

#### 2.3.2.1 UI 组件层级设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端组件层级架构                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                         组件分层设计                                                │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  📄 页面层 (Pages)                                           │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：路由入口、数据获取、页面布局组装                                                       │  │ │
│   │   │   示例：HomePage, PostDetailPage, ArchivesPage, SearchPage                                  │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🧩 特性层 (Features)                                        │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：业务功能模块、包含业务逻辑、组合多个基础组件                                            │  │ │
│   │   │   示例：PostEditor, AiAssistant, TimeTree, SearchPanel, FriendCardGrid                      │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🔲 布局层 (Layouts)                                         │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：页面结构骨架、响应式布局、导航与内容区域划分                                            │  │ │
│   │   │   示例：MainLayout, AdminLayout, AuthLayout, FullscreenLayout                               │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🧱 基础层 (Primitives)                                      │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：无业务逻辑、高度复用、遵循设计系统                                                      │  │ │
│   │   │   示例：Button, Card, Input, Modal, Tooltip, Badge, Avatar, Tag                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🎨 设计令牌 (Design Tokens)                                 │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：颜色、字体、间距、阴影、动画曲线等设计变量                                              │  │ │
│   │   │   示例：colors, typography, spacing, shadows, animations, breakpoints                       │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.2.2 核心组件详细设计

**组件一：文章卡片组件 (PostCard)**

```tsx
// packages/ui/src/components/PostCard/PostCard.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { format } from 'date-fns';
import { zhCN } from 'date-fns/locale';
import { Clock, Eye, MessageCircle, Calendar } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Badge } from '../Badge';
import { Avatar } from '../Avatar';
import type { Post } from '@aetherblog/types';

/**
 * 文章卡片组件 Props
 */
interface PostCardProps {
  /** 文章数据 */
  post: Post;
  /** 卡片变体：default-默认, featured-精选, compact-紧凑, horizontal-水平 */
  variant?: 'default' | 'featured' | 'compact' | 'horizontal';
  /** 是否显示封面图 */
  showCover?: boolean;
  /** 是否显示标签 */
  showTags?: boolean;
  /** 是否显示摘要 */
  showSummary?: boolean;
  /** 是否显示作者信息 */
  showAuthor?: boolean;
  /** 点击事件 */
  onClick?: (post: Post) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * 文章卡片组件
 * 
 * 设计理念：
 * - 采用 Glassmorphism（毛玻璃）设计风格
 * - 使用 Framer Motion 实现流畅的交互动效
 * - 支持多种展示变体，适应不同场景
 * - 响应式设计，完美适配移动端
 */
export const PostCard: React.FC<PostCardProps> = ({
  post,
  variant = 'default',
  showCover = true,
  showTags = true,
  showSummary = true,
  showAuthor = false,
  onClick,
  className,
}) => {
  // 卡片容器动画变体
  const cardVariants = {
    initial: { opacity: 0, y: 20 },
    animate: { opacity: 1, y: 0 },
    hover: { y: -8, transition: { duration: 0.3, ease: 'easeOut' } },
    tap: { scale: 0.98 },
  };

  // 图片动画变体
  const imageVariants = {
    hover: { scale: 1.08, transition: { duration: 0.4, ease: 'easeOut' } },
  };

  // 光效动画变体
  const glowVariants = {
    initial: { opacity: 0, x: '-100%' },
    hover: { opacity: 1, x: '100%', transition: { duration: 0.6 } },
  };

  // 根据变体返回不同的布局
  if (variant === 'horizontal') {
    return (
      <HorizontalPostCard
        post={post}
        showCover={showCover}
        showTags={showTags}
        showSummary={showSummary}
        onClick={onClick}
        className={className}
      />
    );
  }

  if (variant === 'compact') {
    return (
      <CompactPostCard
        post={post}
        showTags={showTags}
        onClick={onClick}
        className={className}
      />
    );
  }

  return (
    <motion.article
      variants={cardVariants}
      initial="initial"
      animate="animate"
      whileHover="hover"
      whileTap="tap"
      onClick={() => onClick?.(post)}
      className={cn(
        // 基础样式
        'group relative cursor-pointer overflow-hidden rounded-2xl',
        // 毛玻璃效果
        'bg-white/5 backdrop-blur-xl',
        'dark:bg-white/5 dark:backdrop-blur-xl',
        // 边框
        'border border-white/10',
        'dark:border-white/10',
        // 阴影
        'shadow-lg shadow-black/5',
        'dark:shadow-lg dark:shadow-black/20',
        // 悬浮效果
        'hover:bg-white/10 hover:border-white/20',
        'hover:shadow-2xl hover:shadow-black/10',
        'dark:hover:bg-white/10 dark:hover:border-white/20',
        // 过渡
        'transition-all duration-300 ease-out',
        // 精选样式
        variant === 'featured' && [
          'md:col-span-2',
          'ring-2 ring-primary/20',
        ],
        className
      )}
    >
      {/* 悬浮光效层 */}
      <motion.div
        variants={glowVariants}
        className={cn(
          'pointer-events-none absolute inset-0 z-10',
          'bg-gradient-to-r from-transparent via-white/10 to-transparent',
          'opacity-0 group-hover:opacity-100'
        )}
      />

      {/* 封面图区域 */}
      {showCover && post.coverImage && (
        <div className="relative aspect-[16/9] overflow-hidden">
          <motion.img
            src={post.coverImage}
            alt={post.title}
            variants={imageVariants}
            className="h-full w-full object-cover"
            loading="lazy"
          />
          
          {/* 渐变遮罩 */}
          <div 
            className={cn(
              'absolute inset-0',
              'bg-gradient-to-t from-black/60 via-black/20 to-transparent'
            )} 
          />

          {/* 分类标签 - 左上角 */}
          {post.category && (
            <div className="absolute left-4 top-4">
              <Badge 
                variant="glass" 
                size="sm"
                className="backdrop-blur-md"
              >
                {post.category.name}
              </Badge>
            </div>
          )}

          {/* 精选标记 - 右上角 */}
          {variant === 'featured' && (
            <div className="absolute right-4 top-4">
              <Badge 
                variant="primary" 
                size="sm"
                className="animate-pulse"
              >
                ⭐ 精选
              </Badge>
            </div>
          )}

          {/* 阅读时间 - 右下角 */}
          <div className="absolute bottom-4 right-4">
            <Badge variant="glass" size="sm" className="backdrop-blur-md">
              <Clock className="mr-1 h-3 w-3" />
              {post.readingTime} 分钟
            </Badge>
          </div>
        </div>
      )}

      {/* 内容区域 */}
      <div className="relative p-5">
        {/* 标签列表 */}
        {showTags && post.tags && post.tags.length > 0 && (
          <div className="mb-3 flex flex-wrap gap-2">
            {post.tags.slice(0, 3).map((tag) => (
              <Badge
                key={tag.id}
                variant="outline"
                size="xs"
                className={cn(
                  'text-xs font-normal',
                  'text-gray-400 dark:text-gray-500',
                  'border-gray-200/50 dark:border-gray-700/50',
                  'hover:text-primary hover:border-primary/50',
                  'transition-colors duration-200'
                )}
              >
                #{tag.name}
              </Badge>
            ))}
            {post.tags.length > 3 && (
              <Badge variant="outline" size="xs" className="text-xs text-gray-400">
                +{post.tags.length - 3}
              </Badge>
            )}
          </div>
        )}

        {/* 文章标题 */}
        <h3
          className={cn(
            'mb-2 font-bold leading-tight',
            'text-gray-900 dark:text-white',
            'group-hover:text-primary dark:group-hover:text-primary',
            'transition-colors duration-200',
            variant === 'featured' ? 'text-xl md:text-2xl' : 'text-lg',
            'line-clamp-2'
          )}
        >
          {post.title}
        </h3>

        {/* 文章摘要 */}
        {showSummary && post.summary && (
          <p
            className={cn(
              'mb-4 text-sm leading-relaxed',
              'text-gray-600 dark:text-gray-400',
              'line-clamp-2'
            )}
          >
            {post.summary}
          </p>
        )}

        {/* 底部元信息 */}
        <div className="flex items-center justify-between">
          {/* 作者信息 */}
          {showAuthor && post.author ? (
            <div className="flex items-center space-x-2">
              <Avatar
                src={post.author.avatar}
                alt={post.author.name}
                size="sm"
              />
              <span className="text-sm text-gray-600 dark:text-gray-400">
                {post.author.name}
              </span>
            </div>
          ) : (
            <div className="flex items-center text-sm text-gray-500 dark:text-gray-500">
              <Calendar className="mr-1 h-3.5 w-3.5" />
              <time dateTime={post.publishedAt}>
                {format(new Date(post.publishedAt), 'yyyy年MM月dd日', { locale: zhCN })}
              </time>
            </div>
          )}

          {/* 统计数据 */}
          <div className="flex items-center space-x-3 text-sm text-gray-500 dark:text-gray-500">
            <span className="flex items-center">
              <Eye className="mr-1 h-3.5 w-3.5" />
              {formatNumber(post.viewCount)}
            </span>
            <span className="flex items-center">
              <MessageCircle className="mr-1 h-3.5 w-3.5" />
              {post.commentCount}
            </span>
          </div>
        </div>
      </div>
    </motion.article>
  );
};

/**
 * 水平布局文章卡片
 */
const HorizontalPostCard: React.FC<Omit<PostCardProps, 'variant'>> = ({
  post,
  showCover,
  showTags,
  showSummary,
  onClick,
  className,
}) => {
  return (
    <motion.article
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      whileHover={{ x: 4 }}
      onClick={() => onClick?.(post)}
      className={cn(
        'group flex cursor-pointer gap-4 rounded-xl p-4',
        'bg-white/5 backdrop-blur-lg',
        'border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300',
        className
      )}
    >
      {/* 封面图 */}
      {showCover && post.coverImage && (
        <div className="relative h-24 w-36 flex-shrink-0 overflow-hidden rounded-lg">
          <img
            src={post.coverImage}
            alt={post.title}
            className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          />
        </div>
      )}

      {/* 内容 */}
      <div className="flex flex-1 flex-col justify-between">
        <div>
          {/* 标签 */}
          {showTags && post.tags && post.tags.length > 0 && (
            <div className="mb-1 flex gap-1">
              {post.tags.slice(0, 2).map((tag) => (
                <Badge key={tag.id} variant="outline" size="xs">
                  #{tag.name}
                </Badge>
              ))}
            </div>
          )}

          {/* 标题 */}
          <h4 className="line-clamp-2 font-semibold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
            {post.title}
          </h4>

          {/* 摘要 */}
          {showSummary && post.summary && (
            <p className="mt-1 line-clamp-1 text-sm text-gray-500 dark:text-gray-400">
              {post.summary}
            </p>
          )}
        </div>

        {/* 元信息 */}
        <div className="mt-2 flex items-center text-xs text-gray-400">
          <Calendar className="mr-1 h-3 w-3" />
          <time>{format(new Date(post.publishedAt), 'MM-dd')}</time>
          <span className="mx-2">·</span>
          <Eye className="mr-1 h-3 w-3" />
          <span>{formatNumber(post.viewCount)}</span>
        </div>
      </div>
    </motion.article>
  );
};

/**
 * 紧凑布局文章卡片
 */
const CompactPostCard: React.FC<Omit<PostCardProps, 'variant' | 'showCover' | 'showSummary'>> = ({
  post,
  showTags,
  onClick,
  className,
}) => {
  return (
    <motion.article
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      whileHover={{ x: 4 }}
      onClick={() => onClick?.(post)}
      className={cn(
        'group flex cursor-pointer items-center justify-between py-3',
        'border-b border-white/5 last:border-b-0',
        'hover:bg-white/5',
        'transition-all duration-200',
        className
      )}
    >
      <div className="flex-1">
        <h5 className="line-clamp-1 font-medium text-gray-900 dark:text-white group-hover:text-primary transition-colors">
          {post.title}
        </h5>
        {showTags && post.tags && post.tags.length > 0 && (
          <div className="mt-1 flex gap-1">
            {post.tags.slice(0, 2).map((tag) => (
              <span key={tag.id} className="text-xs text-gray-400">
                #{tag.name}
              </span>
            ))}
          </div>
        )}
      </div>
      <time className="ml-4 flex-shrink-0 text-xs text-gray-400">
        {format(new Date(post.publishedAt), 'MM-dd')}
      </time>
    </motion.article>
  );
};

/**
 * 格式化数字显示
 */
function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + 'w';
  }
  if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'k';
  }
  return num.toString();
}

export default PostCard;
```

**组件一补充：PostCard 样式变体配置**

```tsx
// packages/ui/src/components/PostCard/PostCard.styles.ts

import { cva, type VariantProps } from 'class-variance-authority';

/**
 * PostCard 样式变体定义
 * 使用 CVA (Class Variance Authority) 管理组件变体
 */
export const postCardVariants = cva(
  // 基础样式
  [
    'group relative cursor-pointer overflow-hidden',
    'bg-white/5 backdrop-blur-xl',
    'border border-white/10',
    'shadow-lg',
    'transition-all duration-300 ease-out',
  ],
  {
    variants: {
      // 尺寸变体
      size: {
        sm: 'rounded-lg',
        md: 'rounded-xl',
        lg: 'rounded-2xl',
      },
      // 布局变体
      layout: {
        vertical: 'flex-col',
        horizontal: 'flex-row',
        compact: 'flex-row items-center',
      },
      // 状态变体
      state: {
        default: [
          'hover:bg-white/10',
          'hover:border-white/20',
          'hover:shadow-xl',
          'hover:-translate-y-1',
        ],
        featured: [
          'ring-2 ring-primary/30',
          'hover:ring-primary/50',
        ],
        disabled: [
          'opacity-50',
          'cursor-not-allowed',
          'pointer-events-none',
        ],
      },
    },
    defaultVariants: {
      size: 'md',
      layout: 'vertical',
      state: 'default',
    },
  }
);

export type PostCardVariants = VariantProps<typeof postCardVariants>;
```

---

**组件二：时间树组件 (TimeTree)**

```tsx
// apps/blog/src/components/archives/TimeTree.tsx

import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronRight, Calendar, FileText } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import type { Post } from '@aetherblog/types';

/**
 * 时间树数据结构
 */
interface TimeTreeData {
  year: number;
  months: {
    month: number;
    posts: Post[];
  }[];
  totalPosts: number;
}

interface TimeTreeProps {
  /** 按时间分组的文章数据 */
  data: TimeTreeData[];
  /** 点击文章回调 */
  onPostClick?: (post: Post) => void;
  /** 默认展开的年份 */
  defaultExpandedYears?: number[];
  /** 自定义类名 */
  className?: string;
}

/**
 * 时间树组件
 * 
 * 设计理念：
 * - 采用递归树形结构展示文章归档
 * - 年份 -> 月份 -> 文章三级层次
 * - 使用 Framer Motion 实现平滑的展开/收起动画
 * - SVG 绘制连接线，节点带脉冲动画
 */
export const TimeTree: React.FC<TimeTreeProps> = ({
  data,
  onPostClick,
  defaultExpandedYears = [],
  className,
}) => {
  // 展开状态管理
  const [expandedYears, setExpandedYears] = useState<Set<number>>(
    new Set(defaultExpandedYears)
  );
  const [expandedMonths, setExpandedMonths] = useState<Set<string>>(new Set());

  // 切换年份展开状态
  const toggleYear = (year: number) => {
    setExpandedYears((prev) => {
      const next = new Set(prev);
      if (next.has(year)) {
        next.delete(year);
      } else {
        next.add(year);
      }
      return next;
    });
  };

  // 切换月份展开状态
  const toggleMonth = (yearMonth: string) => {
    setExpandedMonths((prev) => {
      const next = new Set(prev);
      if (next.has(yearMonth)) {
        next.delete(yearMonth);
      } else {
        next.add(yearMonth);
      }
      return next;
    });
  };

  // 月份名称映射
  const monthNames = [
    '一月', '二月', '三月', '四月', '五月', '六月',
    '七月', '八月', '九月', '十月', '十一月', '十二月'
  ];

  return (
    <div className={cn('relative', className)}>
      {/* 主时间线 */}
      <div 
        className={cn(
          'absolute left-[19px] top-0 h-full w-[2px]',
          'bg-gradient-to-b from-primary/50 via-primary/20 to-transparent'
        )} 
      />

      {/* 年份列表 */}
      <div className="space-y-6">
        {data.map((yearData, yearIndex) => {
          const isYearExpanded = expandedYears.has(yearData.year);

          return (
            <div key={yearData.year} className="relative">
              {/* 年份节点 */}
              <motion.div
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: yearIndex * 0.1 }}
                className="relative"
              >
                {/* 节点圆点 */}
                <div className="absolute left-0 top-1/2 -translate-y-1/2">
                  <motion.div
                    animate={{
                      scale: isYearExpanded ? [1, 1.2, 1] : 1,
                    }}
                    transition={{
                      duration: 2,
                      repeat: isYearExpanded ? Infinity : 0,
                      ease: 'easeInOut',
                    }}
                    className={cn(
                      'relative h-10 w-10 rounded-full',
                      'flex items-center justify-center',
                      'bg-gradient-to-br from-primary to-primary/60',
                      'shadow-lg shadow-primary/30',
                      'cursor-pointer',
                      'transition-transform duration-300',
                      'hover:scale-110'
                    )}
                    onClick={() => toggleYear(yearData.year)}
                  >
                    {/* 脉冲动画环 */}
                    {isYearExpanded && (
                      <motion.div
                        initial={{ scale: 1, opacity: 0.5 }}
                        animate={{ scale: 1.5, opacity: 0 }}
                        transition={{
                          duration: 1.5,
                          repeat: Infinity,
                          ease: 'easeOut',
                        }}
                        className="absolute inset-0 rounded-full bg-primary"
                      />
                    )}
                    <Calendar className="h-5 w-5 text-white" />
                  </motion.div>
                </div>

                {/* 年份标题 */}
                <div
                  onClick={() => toggleYear(yearData.year)}
                  className={cn(
                    'ml-14 flex cursor-pointer items-center gap-3',
                    'py-2 px-4 rounded-lg',
                    'hover:bg-white/5',
                    'transition-colors duration-200'
                  )}
                >
                  <motion.div
                    animate={{ rotate: isYearExpanded ? 90 : 0 }}
                    transition={{ duration: 0.2 }}
                  >
                    <ChevronRight className="h-5 w-5 text-gray-400" />
                  </motion.div>
                  <h3 className="text-2xl font-bold text-white">
                    {yearData.year}
                  </h3>
                  <span className="text-sm text-gray-400">
                    ({yearData.totalPosts} 篇文章)
                  </span>
                </div>
              </motion.div>

              {/* 月份列表 */}
              <AnimatePresence>
                {isYearExpanded && (
                  <motion.div
                    initial={{ height: 0, opacity: 0 }}
                    animate={{ height: 'auto', opacity: 1 }}
                    exit={{ height: 0, opacity: 0 }}
                    transition={{ duration: 0.3, ease: 'easeInOut' }}
                    className="ml-14 mt-4 space-y-4 overflow-hidden"
                  >
                    {yearData.months.map((monthData, monthIndex) => {
                      const yearMonthKey = `${yearData.year}-${monthData.month}`;
                      const isMonthExpanded = expandedMonths.has(yearMonthKey);

                      return (
                        <div key={monthData.month} className="relative">
                          {/* 月份连接线 */}
                          <div
                            className={cn(
                              'absolute -left-9 top-3 h-[2px] w-8',
                              'bg-gradient-to-r from-primary/30 to-primary/10'
                            )}
                          />

                          {/* 月份节点 */}
                          <motion.div
                            initial={{ opacity: 0, x: -10 }}
                            animate={{ opacity: 1, x: 0 }}
                            transition={{ delay: monthIndex * 0.05 }}
                          >
                            {/* 月份标题 */}
                            <div
                              onClick={() => toggleMonth(yearMonthKey)}
                              className={cn(
                                'flex cursor-pointer items-center gap-2',
                                'py-1.5 px-3 rounded-md',
                                'hover:bg-white/5',
                                'transition-colors duration-200'
                              )}
                            >
                              {/* 月份圆点 */}
                              <div
                                className={cn(
                                  'h-3 w-3 rounded-full',
                                  'bg-primary/60',
                                  'ring-2 ring-primary/20'
                                )}
                              />
                              <motion.div
                                animate={{ rotate: isMonthExpanded ? 90 : 0 }}
                                transition={{ duration: 0.2 }}
                              >
                                <ChevronRight className="h-4 w-4 text-gray-500" />
                              </motion.div>
                              <span className="font-medium text-gray-300">
                                {monthNames[monthData.month - 1]}
                              </span>
                              <span className="text-xs text-gray-500">
                                ({monthData.posts.length})
                              </span>
                            </div>

                            {/* 文章列表 */}
                            <AnimatePresence>
                              {isMonthExpanded && (
                                <motion.ul
                                  initial={{ height: 0, opacity: 0 }}
                                  animate={{ height: 'auto', opacity: 1 }}
                                  exit={{ height: 0, opacity: 0 }}
                                  transition={{ duration: 0.2 }}
                                  className="ml-8 mt-2 space-y-2 overflow-hidden"
                                >
                                  {monthData.posts.map((post, postIndex) => (
                                    <motion.li
                                      key={post.id}
                                      initial={{ opacity: 0, x: -10 }}
                                      animate={{ opacity: 1, x: 0 }}
                                      transition={{ delay: postIndex * 0.03 }}
                                    >
                                      <TimeTreePostItem
                                        post={post}
                                        onClick={() => onPostClick?.(post)}
                                      />
                                    </motion.li>
                                  ))}
                                </motion.ul>
                              )}
                            </AnimatePresence>
                          </motion.div>
                        </div>
                      );
                    })}
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          );
        })}
      </div>
    </div>
  );
};

/**
 * 时间树文章项组件
 */
const TimeTreePostItem: React.FC<{
  post: Post;
  onClick?: () => void;
}> = ({ post, onClick }) => {
  return (
    <motion.div
      whileHover={{ x: 4 }}
      onClick={onClick}
      className={cn(
        'group flex cursor-pointer items-start gap-3',
        'py-2 px-3 rounded-lg',
        'hover:bg-white/5',
        'transition-all duration-200'
      )}
    >
      {/* 文章图标 */}
      <FileText 
        className={cn(
          'mt-0.5 h-4 w-4 flex-shrink-0',
          'text-gray-500 group-hover:text-primary',
          'transition-colors duration-200'
        )} 
      />

      {/* 文章信息 */}
      <div className="flex-1 min-w-0">
        <h4
          className={cn(
            'text-sm font-medium truncate',
            'text-gray-300 group-hover:text-white',
            'transition-colors duration-200'
          )}
        >
          {post.title}
        </h4>
        <div className="mt-1 flex items-center gap-2 text-xs text-gray-500">
          <span>
            {new Date(post.publishedAt).getDate()}日
          </span>
          <span>·</span>
          <span>{post.readingTime} 分钟</span>
          {post.tags && post.tags.length > 0 && (
            <>
              <span>·</span>
              <span className="text-primary/60">
                #{post.tags[0].name}
              </span>
            </>
          )}
        </div>
      </div>
    </motion.div>
  );
};

export default TimeTree;
```

---

**组件三：AI 助手面板组件 (AiAssistant)**

```tsx
// apps/admin/src/pages/posts/components/AiAssistant.tsx

import React, { useState, useCallback, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Sparkles,
  Wand2,
  Tag,
  FileText,
  RefreshCw,
  Settings,
  ChevronDown,
  ChevronUp,
  Copy,
  Check,
  AlertCircle,
  Loader2,
  Trash2,
  RotateCcw,
  Zap,
  BookOpen,
  MessageSquare,
  Palette,
  Search,
  X,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Button, Badge, Textarea, Select, Tooltip } from '@aetherblog/ui';
import { useAiService } from '@/hooks/useAiService';
import { usePromptStore } from '@/stores/promptStore';
import type { AiTask, PromptTemplate } from '@aetherblog/types';

/**
 * AI 助手面板 Props
 */
interface AiAssistantProps {
  /** 当前编辑器内容 */
  content: string;
  /** 选中的文本 */
  selectedText?: string;
  /** 应用AI结果回调 */
  onApplyResult: (result: string, type: 'replace' | 'insert' | 'append') => void;
  /** 应用标签回调 */
  onApplyTags: (tags: string[]) => void;
  /** 应用摘要回调 */
  onApplySummary: (summary: string) => void;
  /** 面板是否展开 */
  isExpanded?: boolean;
  /** 展开状态变更回调 */
  onExpandedChange?: (expanded: boolean) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * AI 任务类型
 */
type TaskType = 
  | 'clean'      // 文本清洗
  | 'rewrite'    // 内容重写
  | 'polish'     // 润色优化
  | 'summarize'  // 生成摘要
  | 'tags'       // 智能标签
  | 'continue'   // 续写内容
  | 'translate'  // 翻译
  | 'custom';    // 自定义

/**
 * 重写风格选项
 */
const REWRITE_STYLES = [
  { value: 'professional', label: '更专业', icon: BookOpen, description: '学术化、严谨的表达' },
  { value: 'casual', label: '更通俗', icon: MessageSquare, description: '口语化、易懂的表达' },
  { value: 'concise', label: '更简洁', icon: Zap, description: '精炼、去除冗余' },
  { value: 'detailed', label: '更详细', icon: FileText, description: '扩展、补充细节' },
  { value: 'creative', label: '更有趣', icon: Palette, description: '生动、有创意的表达' },
];

/**
 * AI 助手面板组件
 * 
 * 功能：
 * - 文本清洗：去除格式问题、统一标点
 * - 内容重写：多种风格转换
 * - 润色优化：提升文章质量
 * - 摘要生成：自动生成文章摘要
 * - 智能标签：AI推荐相关标签
 * - 续写内容：根据上下文续写
 * - Prompt管理：自定义提示词模板
 */
export const AiAssistant: React.FC<AiAssistantProps> = ({
  content,
  selectedText,
  onApplyResult,
  onApplyTags,
  onApplySummary,
  isExpanded = true,
  onExpandedChange,
  className,
}) => {
  // 状态管理
  const [activeTask, setActiveTask] = useState<TaskType | null>(null);
  const [rewriteStyle, setRewriteStyle] = useState<string>('professional');
  const [customPrompt, setCustomPrompt] = useState('');
  const [result, setResult] = useState<string>('');
  const [generatedTags, setGeneratedTags] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [copied, setCopied] = useState(false);
  const [showPromptManager, setShowPromptManager] = useState(false);
  const [streamingText, setStreamingText] = useState('');

  // Refs
  const resultRef = useRef<HTMLDivElement>(null);
  const abortControllerRef = useRef<AbortController | null>(null);

  // Hooks
  const aiService = useAiService();
  const { prompts, activePrompt, setActivePrompt } = usePromptStore();

  // 获取输入文本（优先使用选中文本）
  const inputText = selectedText || content;

  // 检查是否有可用输入
  const hasInput = inputText && inputText.trim().length > 0;

  /**
   * 执行AI任务
   */
  const executeTask = useCallback(async (task: TaskType) => {
    if (!hasInput && task !== 'tags' && task !== 'summarize') {
      setError('请先输入或选择文本内容');
      return;
    }

    // 取消之前的请求
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }
    abortControllerRef.current = new AbortController();

    setActiveTask(task);
    setIsLoading(true);
    setError(null);
    setResult('');
    setStreamingText('');
    setGeneratedTags([]);

    try {
      switch (task) {
        case 'clean':
          await executeCleanTask();
          break;
        case 'rewrite':
          await executeRewriteTask();
          break;
        case 'polish':
          await executePolishTask();
          break;
        case 'summarize':
          await executeSummarizeTask();
          break;
        case 'tags':
          await executeTagsTask();
          break;
        case 'continue':
          await executeContinueTask();
          break;
        case 'custom':
          await executeCustomTask();
          break;
        default:
          throw new Error('未知的任务类型');
      }
    } catch (err: any) {
      if (err.name !== 'AbortError') {
        setError(err.message || 'AI 处理失败，请重试');
      }
    } finally {
      setIsLoading(false);
    }
  }, [hasInput, inputText, rewriteStyle, customPrompt, content]);

  /**
   * 文本清洗任务
   */
  const executeCleanTask = async () => {
    const stream = await aiService.cleanText(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 内容重写任务
   */
  const executeRewriteTask = async () => {
    const stream = await aiService.rewriteText(inputText, rewriteStyle, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 润色优化任务
   */
  const executePolishTask = async () => {
    const stream = await aiService.polishText(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 摘要生成任务
   */
  const executeSummarizeTask = async () => {
    const textToSummarize = content || inputText;
    if (!textToSummarize) {
      throw new Error('请先输入文章内容');
    }

    const stream = await aiService.generateSummary(textToSummarize, {
      maxLength: 150,
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 智能标签任务
   */
  const executeTagsTask = async () => {
    const textForTags = content || inputText;
    if (!textForTags) {
      throw new Error('请先输入文章内容');
    }

    const tags = await aiService.generateTags(textForTags, {
      maxTags: 5,
      signal: abortControllerRef.current?.signal,
    });

    setGeneratedTags(tags);
  };

  /**
   * 续写任务
   */
  const executeContinueTask = async () => {
    const stream = await aiService.continueWriting(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 自定义Prompt任务
   */
  const executeCustomTask = async () => {
    if (!customPrompt.trim()) {
      throw new Error('请输入自定义提示词');
    }

    const stream = await aiService.customProcess(inputText, customPrompt, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 取消当前任务
   */
  const cancelTask = () => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
      setIsLoading(false);
      setActiveTask(null);
    }
  };

  /**
   * 复制结果到剪贴板
   */
  const copyResult = async () => {
    const textToCopy = result || streamingText;
    if (textToCopy) {
      await navigator.clipboard.writeText(textToCopy);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  };

  /**
   * 应用结果
   */
  const applyResult = (type: 'replace' | 'insert' | 'append') => {
    const textToApply = result || streamingText;
    if (textToApply) {
      onApplyResult(textToApply, type);
      setResult('');
      setStreamingText('');
      setActiveTask(null);
    }
  };

  /**
   * 应用标签
   */
  const applyTags = () => {
    if (generatedTags.length > 0) {
      onApplyTags(generatedTags);
      setGeneratedTags([]);
      setActiveTask(null);
    }
  };

  /**
   * 应用摘要
   */
  const applySummary = () => {
    const summaryText = result || streamingText;
    if (summaryText) {
      onApplySummary(summaryText);
      setResult('');
      setStreamingText('');
      setActiveTask(null);
    }
  };

  /**
   * 清空结果
   */
  const clearResult = () => {
    setResult('');
    setStreamingText('');
    setGeneratedTags([]);
    setError(null);
    setActiveTask(null);
  };

  // 滚动到结果底部（流式输出时）
  useEffect(() => {
    if (resultRef.current && streamingText) {
      resultRef.current.scrollTop = resultRef.current.scrollHeight;
    }
  }, [streamingText]);

  // 显示的文本（优先流式文本）
  const displayText = streamingText || result;

  return (
    <div
      className={cn(
        'flex flex-col rounded-2xl',
        'bg-gradient-to-br from-gray-900/95 to-gray-800/95',
        'backdrop-blur-xl',
        'border border-white/10',
        'shadow-2xl shadow-black/20',
        'overflow-hidden',
        className
      )}
    >
      {/* 头部 */}
      <div
        className={cn(
          'flex items-center justify-between px-4 py-3',
          'border-b border-white/10',
          'bg-gradient-to-r from-primary/10 to-purple-500/10'
        )}
      >
        <div className="flex items-center gap-2">
          <div className="relative">
            <Sparkles className="h-5 w-5 text-primary" />
            {isLoading && (
              <motion.div
                animate={{ rotate: 360 }}
                transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}
                className="absolute -inset-1 rounded-full border-2 border-primary/30 border-t-primary"
              />
            )}
          </div>
          <h3 className="font-semibold text-white">AI 助手</h3>
          {selectedText && (
            <Badge variant="outline" size="xs" className="text-primary border-primary/30">
              已选中文本
            </Badge>
          )}
        </div>

        <div className="flex items-center gap-2">
          {/* Prompt 管理按钮 */}
          <Tooltip content="Prompt 管理">
            <Button
              variant="ghost"
              size="icon-sm"
              onClick={() => setShowPromptManager(!showPromptManager)}
              className="text-gray-400 hover:text-white"
            >
              <Settings className="h-4 w-4" />
            </Button>
          </Tooltip>

          {/* 展开/收起按钮 */}
          <Button
            variant="ghost"
            size="icon-sm"
            onClick={() => onExpandedChange?.(!isExpanded)}
            className="text-gray-400 hover:text-white"
          >
            {isExpanded ? (
              <ChevronDown className="h-4 w-4" />
            ) : (
              <ChevronUp className="h-4 w-4" />
            )}
          </Button>
        </div>
      </div>

      {/* 主体内容 */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.3 }}
            className="overflow-hidden"
          >
            <div className="p-4 space-y-4">
              {/* 快捷操作按钮组 */}
              <div className="space-y-3">
                <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                  快捷操作
                </div>
                <div className="grid grid-cols-2 gap-2">
                  {/* 文本清洗 */}
                  <TaskButton
                    icon={Trash2}
                    label="文本清洗"
                    description="清理格式、统一标点"
                    isActive={activeTask === 'clean'}
                    isLoading={isLoading && activeTask === 'clean'}
                    onClick={() => executeTask('clean')}
                    disabled={!hasInput || isLoading}
                  />

                  {/* 润色优化 */}
                  <TaskButton
                    icon={Wand2}
                    label="润色优化"
                    description="提升文章质量"
                    isActive={activeTask === 'polish'}
                    isLoading={isLoading && activeTask === 'polish'}
                    onClick={() => executeTask('polish')}
                    disabled={!hasInput || isLoading}
                  />

                  {/* 生成摘要 */}
                  <TaskButton
                    icon={FileText}
                    label="生成摘要"
                    description="自动提取要点"
                    isActive={activeTask === 'summarize'}
                    isLoading={isLoading && activeTask === 'summarize'}
                    onClick={() => executeTask('summarize')}
                    disabled={!content || isLoading}
                  />

                  {/* 智能标签 */}
                  <TaskButton
                    icon={Tag}
                    label="智能标签"
                    description="AI推荐标签"
                    isActive={activeTask === 'tags'}
                    isLoading={isLoading && activeTask === 'tags'}
                    onClick={() => executeTask('tags')}
                    disabled={!content || isLoading}
                  />
                </div>
              </div>

              {/* 内容重写 */}
              <div className="space-y-3">
                <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                  内容重写
                </div>
                
                {/* 风格选择 */}
                <div className="flex flex-wrap gap-2">
                  {REWRITE_STYLES.map((style) => (
                    <Tooltip key={style.value} content={style.description}>
                      <button
                        onClick={() => setRewriteStyle(style.value)}
                        disabled={isLoading}
                        className={cn(
                          'flex items-center gap-1.5 px-3 py-1.5 rounded-lg',
                          'text-sm font-medium',
                          'border transition-all duration-200',
                          rewriteStyle === style.value
                            ? 'bg-primary/20 border-primary/50 text-primary'
                            : 'bg-white/5 border-white/10 text-gray-300 hover:bg-white/10',
                          isLoading && 'opacity-50 cursor-not-allowed'
                        )}
                      >
                        <style.icon className="h-3.5 w-3.5" />
                        {style.label}
                      </button>
                    </Tooltip>
                  ))}
                </div>

                {/* 重写按钮 */}
                <Button
                  onClick={() => executeTask('rewrite')}
                  disabled={!hasInput || isLoading}
                  className="w-full"
                  variant={activeTask === 'rewrite' ? 'primary' : 'secondary'}
                >
                  {isLoading && activeTask === 'rewrite' ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      正在重写...
                    </>
                  ) : (
                    <>
                      <RefreshCw className="mr-2 h-4 w-4" />
                      开始重写
                    </>
                  )}
                </Button>
              </div>

              {/* 自定义 Prompt */}
              <div className="space-y-3">
                <div className="flex items-center justify-between">
                  <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                    自定义指令
                  </div>
                  {prompts.length > 0 && (
                    <Select
                      value={activePrompt?.id || ''}
                      onChange={(value) => {
                        const prompt = prompts.find((p) => p.id === value);
                        if (prompt) {
                          setActivePrompt(prompt);
                          setCustomPrompt(prompt.content);
                        }
                      }}
                      placeholder="选择模板"
                      className="w-32"
                      size="sm"
                    >
                      {prompts.map((prompt) => (
                        <Select.Option key={prompt.id} value={prompt.id}>
                          {prompt.name}
                        </Select.Option>
                      ))}
                    </Select>
                  )}
                </div>

                <Textarea
                  value={customPrompt}
                  onChange={(e) => setCustomPrompt(e.target.value)}
                  placeholder="输入自定义指令，例如：将这段技术文档改写成适合初学者的教程..."
                  rows={3}
                  className="resize-none"
                />

                <Button
                  onClick={() => executeTask('custom')}
                  disabled={!hasInput || !customPrompt.trim() || isLoading}
                  className="w-full"
                  variant="outline"
                >
                  {isLoading && activeTask === 'custom' ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      处理中...
                    </>
                  ) : (
                    <>
                      <Sparkles className="mr-2 h-4 w-4" />
                      执行自定义指令
                    </>
                  )}
                </Button>
              </div>

              {/* 错误提示 */}
              <AnimatePresence>
                {error && (
                  <motion.div
                    initial={{ opacity: 0, y: -10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -10 }}
                    className={cn(
                      'flex items-center gap-2 p-3 rounded-lg',
                      'bg-red-500/10 border border-red-500/30',
                      'text-sm text-red-400'
                    )}
                  >
                    <AlertCircle className="h-4 w-4 flex-shrink-0" />
                    <span>{error}</span>
                    <button
                      onClick={() => setError(null)}
                      className="ml-auto hover:text-red-300"
                    >
                      <X className="h-4 w-4" />
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 生成的标签 */}
              <AnimatePresence>
                {generatedTags.length > 0 && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 10 }}
                    className="space-y-3"
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-xs font-medium text-gray-400">
                        AI 推荐标签
                      </div>
                      <Button
                        size="sm"
                        onClick={applyTags}
                        className="text-xs"
                      >
                        应用标签
                      </Button>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {generatedTags.map((tag, index) => (
                        <motion.div
                          key={tag}
                          initial={{ opacity: 0, scale: 0.8 }}
                          animate={{ opacity: 1, scale: 1 }}
                          transition={{ delay: index * 0.1 }}
                        >
                          <Badge
                            variant="secondary"
                            className="cursor-pointer hover:bg-primary/20"
                          >
                            #{tag}
                          </Badge>
                        </motion.div>
                      ))}
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 结果显示区域 */}
              <AnimatePresence>
                {(displayText || isLoading) && activeTask !== 'tags' && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 10 }}
                    className="space-y-3"
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <div className="text-xs font-medium text-gray-400">
                          生成结果
                        </div>
                        {isLoading && (
                          <motion.div
                            animate={{ opacity: [0.5, 1, 0.5] }}
                            transition={{ duration: 1.5, repeat: Infinity }}
                            className="flex items-center gap-1 text-xs text-primary"
                          >
                            <Loader2 className="h-3 w-3 animate-spin" />
                            生成中...
                          </motion.div>
                        )}
                      </div>

                      <div className="flex items-center gap-1">
                        {/* 复制按钮 */}
                        <Tooltip content={copied ? '已复制' : '复制'}>
                          <Button
                            variant="ghost"
                            size="icon-sm"
                            onClick={copyResult}
                            disabled={!displayText}
                            className="text-gray-400 hover:text-white"
                          >
                            {copied ? (
                              <Check className="h-4 w-4 text-green-400" />
                            ) : (
                              <Copy className="h-4 w-4" />
                            )}
                          </Button>
                        </Tooltip>

                        {/* 清空按钮 */}
                        <Tooltip content="清空">
                          <Button
                            variant="ghost"
                            size="icon-sm"
                            onClick={clearResult}
                            className="text-gray-400 hover:text-white"
                          >
                            <RotateCcw className="h-4 w-4" />
                          </Button>
                        </Tooltip>

                        {/* 取消按钮 */}
                        {isLoading && (
                          <Tooltip content="取消">
                            <Button
                              variant="ghost"
                              size="icon-sm"
                              onClick={cancelTask}
                              className="text-red-400 hover:text-red-300"
                            >
                              <X className="h-4 w-4" />
                            </Button>
                          </Tooltip>
                        )}
                      </div>
                    </div>

                    {/* 结果内容 */}
                    <div
                      ref={resultRef}
                      className={cn(
                        'max-h-64 overflow-y-auto rounded-lg p-4',
                        'bg-black/30 border border-white/5',
                        'text-sm text-gray-300 leading-relaxed',
                        'prose prose-invert prose-sm max-w-none'
                      )}
                    >
                      {displayText || (
                        <div className="flex items-center gap-2 text-gray-500">
                          <Loader2 className="h-4 w-4 animate-spin" />
                          正在生成...
                        </div>
                      )}
                      {/* 光标动画 */}
                      {isLoading && displayText && (
                        <motion.span
                          animate={{ opacity: [1, 0] }}
                          transition={{ duration: 0.8, repeat: Infinity }}
                          className="inline-block w-2 h-4 ml-0.5 bg-primary"
                        />
                      )}
                    </div>

                    {/* 应用按钮组 */}
                    {displayText && !isLoading && (
                      <div className="flex gap-2">
                        {activeTask === 'summarize' ? (
                          <Button
                            onClick={applySummary}
                            className="flex-1"
                            variant="primary"
                          >
                            <Check className="mr-2 h-4 w-4" />
                            应用为摘要
                          </Button>
                        ) : (
                          <>
                            {selectedText && (
                              <Button
                                onClick={() => applyResult('replace')}
                                className="flex-1"
                                variant="primary"
                              >
                                替换选中
                              </Button>
                            )}
                            <Button
                              onClick={() => applyResult('insert')}
                              className="flex-1"
                              variant={selectedText ? 'secondary' : 'primary'}
                            >
                              插入光标处
                            </Button>
                            <Button
                              onClick={() => applyResult('append')}
                              className="flex-1"
                              variant="outline"
                            >
                              追加到末尾
                            </Button>
                          </>
                        )}
                      </div>
                    )}
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Prompt 管理弹窗 */}
      <PromptManagerModal
        isOpen={showPromptManager}
        onClose={() => setShowPromptManager(false)}
      />
    </div>
  );
};

/**
 * 任务按钮组件 Props
 */
interface TaskButtonProps {
  /** 图标组件 */
  icon: React.FC<{ className?: string }>;
  /** 按钮标签 */
  label: string;
  /** 描述文字 */
  description: string;
  /** 是否激活状态 */
  isActive: boolean;
  /** 是否加载中 */
  isLoading: boolean;
  /** 点击事件 */
  onClick: () => void;
  /** 是否禁用 */
  disabled?: boolean;
}

/**
 * 任务按钮组件
 */
const TaskButton: React.FC<TaskButtonProps> = ({
  icon: Icon,
  label,
  description,
  isActive,
  isLoading,
  onClick,
  disabled = false,
}) => {
  return (
    <motion.button
      whileHover={{ scale: disabled ? 1 : 1.02 }}
      whileTap={{ scale: disabled ? 1 : 0.98 }}
      onClick={onClick}
      disabled={disabled}
      className={cn(
        'group relative flex flex-col items-start gap-1.5',
        'p-3 rounded-xl text-left',
        'border transition-all duration-200',
        // 默认状态
        'bg-white/5 border-white/10',
        // 激活状态
        isActive && 'bg-primary/10 border-primary/30 ring-1 ring-primary/20',
        // 悬浮状态
        !disabled && 'hover:bg-white/10 hover:border-white/20',
        // 禁用状态
        disabled && 'opacity-50 cursor-not-allowed'
      )}
    >
      {/* 加载指示器 */}
      {isLoading && (
        <div className="absolute inset-0 flex items-center justify-center rounded-xl bg-black/50 backdrop-blur-sm">
          <Loader2 className="h-5 w-5 animate-spin text-primary" />
        </div>
      )}

      {/* 图标和标签 */}
      <div className="flex items-center gap-2">
        <div
          className={cn(
            'p-1.5 rounded-lg transition-colors duration-200',
            isActive
              ? 'bg-primary/20 text-primary'
              : 'bg-white/10 text-gray-400 group-hover:text-white'
          )}
        >
          <Icon className="h-4 w-4" />
        </div>
        <span
          className={cn(
            'font-medium text-sm transition-colors duration-200',
            isActive ? 'text-primary' : 'text-white'
          )}
        >
          {label}
        </span>
      </div>

      {/* 描述 */}
      <span className="text-xs text-gray-500 pl-9">
        {description}
      </span>

      {/* 激活指示条 */}
      {isActive && (
        <motion.div
          layoutId="activeTaskIndicator"
          className="absolute bottom-0 left-3 right-3 h-0.5 bg-primary rounded-full"
          initial={false}
          transition={{ type: 'spring', stiffness: 500, damping: 30 }}
        />
      )}
    </motion.button>
  );
};

/**
 * Prompt 管理弹窗 Props
 */
interface PromptManagerModalProps {
  isOpen: boolean;
  onClose: () => void;
}

/**
 * Prompt 管理弹窗组件
 */
const PromptManagerModal: React.FC<PromptManagerModalProps> = ({
  isOpen,
  onClose,
}) => {
  const { prompts, addPrompt, updatePrompt, deletePrompt } = usePromptStore();
  const [editingPrompt, setEditingPrompt] = useState<PromptTemplate | null>(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    content: '',
    category: 'general',
  });

  // 重置表单
  const resetForm = () => {
    setFormData({
      name: '',
      description: '',
      content: '',
      category: 'general',
    });
    setEditingPrompt(null);
    setIsCreating(false);
  };

  // 打开编辑
  const handleEdit = (prompt: PromptTemplate) => {
    setEditingPrompt(prompt);
    setFormData({
      name: prompt.name,
      description: prompt.description || '',
      content: prompt.content,
      category: prompt.category || 'general',
    });
    setIsCreating(false);
  };

  // 保存 Prompt
  const handleSave = () => {
    if (!formData.name.trim() || !formData.content.trim()) {
      return;
    }

    if (editingPrompt) {
      updatePrompt(editingPrompt.id, formData);
    } else {
      addPrompt({
        id: crypto.randomUUID(),
        ...formData,
        createdAt: new Date().toISOString(),
      });
    }

    resetForm();
  };

  // 删除 Prompt
  const handleDelete = (id: string) => {
    if (confirm('确定要删除这个 Prompt 模板吗？')) {
      deletePrompt(id);
      if (editingPrompt?.id === id) {
        resetForm();
      }
    }
  };

  // Prompt 分类
  const categories = [
    { value: 'general', label: '通用' },
    { value: 'rewrite', label: '重写' },
    { value: 'translate', label: '翻译' },
    { value: 'code', label: '代码' },
    { value: 'seo', label: 'SEO' },
  ];

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* 遮罩层 */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
          />

          {/* 弹窗内容 */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            transition={{ type: 'spring', duration: 0.5 }}
            className={cn(
              'fixed left-1/2 top-1/2 z-50 -translate-x-1/2 -translate-y-1/2',
              'w-full max-w-4xl max-h-[80vh]',
              'bg-gray-900 rounded-2xl',
              'border border-white/10',
              'shadow-2xl shadow-black/50',
              'overflow-hidden'
            )}
          >
            {/* 头部 */}
            <div className="flex items-center justify-between px-6 py-4 border-b border-white/10">
              <div className="flex items-center gap-3">
                <Settings className="h-5 w-5 text-primary" />
                <h2 className="text-lg font-semibold text-white">Prompt 模板管理</h2>
                <Badge variant="outline" size="sm">
                  {prompts.length} 个模板
                </Badge>
              </div>
              <Button
                variant="ghost"
                size="icon-sm"
                onClick={onClose}
                className="text-gray-400 hover:text-white"
              >
                <X className="h-5 w-5" />
              </Button>
            </div>

            {/* 主体 */}
            <div className="flex h-[60vh]">
              {/* 左侧列表 */}
              <div className="w-1/3 border-r border-white/10 overflow-y-auto">
                {/* 新建按钮 */}
                <div className="p-4 border-b border-white/5">
                  <Button
                    onClick={() => {
                      resetForm();
                      setIsCreating(true);
                    }}
                    className="w-full"
                    variant="outline"
                  >
                    <Plus className="mr-2 h-4 w-4" />
                    新建模板
                  </Button>
                </div>

                {/* Prompt 列表 */}
                <div className="p-2 space-y-1">
                  {prompts.length === 0 ? (
                    <div className="py-8 text-center text-gray-500">
                      <FileText className="mx-auto h-8 w-8 mb-2 opacity-50" />
                      <p className="text-sm">暂无 Prompt 模板</p>
                      <p className="text-xs mt-1">点击上方按钮创建</p>
                    </div>
                  ) : (
                    prompts.map((prompt) => (
                      <motion.div
                        key={prompt.id}
                        whileHover={{ x: 4 }}
                        onClick={() => handleEdit(prompt)}
                        className={cn(
                          'flex items-center justify-between p-3 rounded-lg cursor-pointer',
                          'transition-colors duration-200',
                          editingPrompt?.id === prompt.id
                            ? 'bg-primary/10 border border-primary/30'
                            : 'hover:bg-white/5'
                        )}
                      >
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <span className="font-medium text-white truncate">
                              {prompt.name}
                            </span>
                            <Badge variant="outline" size="xs">
                              {categories.find((c) => c.value === prompt.category)?.label || '通用'}
                            </Badge>
                          </div>
                          {prompt.description && (
                            <p className="mt-0.5 text-xs text-gray-500 truncate">
                              {prompt.description}
                            </p>
                          )}
                        </div>
                        <Button
                          variant="ghost"
                          size="icon-xs"
                          onClick={(e) => {
                            e.stopPropagation();
                            handleDelete(prompt.id);
                          }}
                          className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-400"
                        >
                          <Trash2 className="h-3.5 w-3.5" />
                        </Button>
                      </motion.div>
                    ))
                  )}
                </div>
              </div>

              {/* 右侧编辑区 */}
              <div className="flex-1 p-6 overflow-y-auto">
                {editingPrompt || isCreating ? (
                  <div className="space-y-4">
                    <h3 className="text-lg font-medium text-white">
                      {editingPrompt ? '编辑模板' : '新建模板'}
                    </h3>

                    {/* 名称 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        模板名称 <span className="text-red-400">*</span>
                      </label>
                      <Input
                        value={formData.name}
                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                        placeholder="例如：技术文章润色"
                        className="w-full"
                      />
                    </div>

                    {/* 分类 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        分类
                      </label>
                      <Select
                        value={formData.category}
                        onChange={(value) => setFormData({ ...formData, category: value })}
                        className="w-full"
                      >
                        {categories.map((cat) => (
                          <Select.Option key={cat.value} value={cat.value}>
                            {cat.label}
                          </Select.Option>
                        ))}
                      </Select>
                    </div>

                    {/* 描述 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        描述
                      </label>
                      <Input
                        value={formData.description}
                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                        placeholder="简短描述这个模板的用途"
                        className="w-full"
                      />
                    </div>

                    {/* Prompt 内容 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        Prompt 内容 <span className="text-red-400">*</span>
                      </label>
                      <Textarea
                        value={formData.content}
                        onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                        placeholder={`输入 Prompt 模板内容...\n\n可用变量：\n{{content}} - 用户输入的文本\n{{language}} - 目标语言\n{{style}} - 写作风格`}
                        rows={10}
                        className="w-full font-mono text-sm"
                      />
                      <p className="text-xs text-gray-500">
                        支持使用 {'{{content}}'} 等变量，运行时会自动替换
                      </p>
                    </div>

                    {/* 操作按钮 */}
                    <div className="flex gap-3 pt-4">
                      <Button
                        onClick={handleSave}
                        disabled={!formData.name.trim() || !formData.content.trim()}
                        className="flex-1"
                      >
                        <Check className="mr-2 h-4 w-4" />
                        保存模板
                      </Button>
                      <Button
                        variant="outline"
                        onClick={resetForm}
                        className="flex-1"
                      >
                        取消
                      </Button>
                    </div>
                  </div>
                ) : (
                  <div className="h-full flex items-center justify-center text-gray-500">
                    <div className="text-center">
                      <MousePointer className="mx-auto h-12 w-12 mb-3 opacity-30" />
                      <p>选择左侧模板进行编辑</p>
                      <p className="text-sm mt-1">或点击"新建模板"创建</p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

// 补充缺少的图标导入
import { Plus, MousePointer } from 'lucide-react';
import { Input } from '@aetherblog/ui';

export default AiAssistant;
```

---

**组件四：智能搜索组件 (SearchPanel)**

```tsx
// apps/blog/src/components/search/SearchPanel.tsx

import React, { useState, useCallback, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Search,
  X,
  Loader2,
  Clock,
  TrendingUp,
  FileText,
  Sparkles,
  ArrowRight,
  Tag,
  Folder,
  History,
  Trash2,
} from 'lucide-react';
import { useRouter } from 'next/navigation';
import { cn } from '@aetherblog/utils';
import { useDebounce } from '@aetherblog/hooks';
import { Badge } from '@aetherblog/ui';
import { searchService } from '@/services/searchService';
import type { SearchResult, AiSearchAnswer } from '@aetherblog/types';

/**
 * 搜索面板 Props
 */
interface SearchPanelProps {
  /** 是否打开 */
  isOpen: boolean;
  /** 关闭回调 */
  onClose: () => void;
}

/**
 * 智能搜索面板组件
 * 
 * 功能特性：
 * - 全文检索 + 语义搜索混合模式
 * - AI 生成直接回答
 * - 搜索历史记录
 * - 热门搜索推荐
 * - 键盘快捷键支持
 * - 实时搜索建议
 */
export const SearchPanel: React.FC<SearchPanelProps> = ({
  isOpen,
  onClose,
}) => {
  // 状态
  const [query, setQuery] = useState('');
  const [results, setResults] = useState<SearchResult[]>([]);
  const [aiAnswer, setAiAnswer] = useState<AiSearchAnswer | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isAiLoading, setIsAiLoading] = useState(false);
  const [activeIndex, setActiveIndex] = useState(-1);
  const [searchHistory, setSearchHistory] = useState<string[]>([]);
  const [showHistory, setShowHistory] = useState(true);

  // Refs
  const inputRef = useRef<HTMLInputElement>(null);
  const resultsRef = useRef<HTMLDivElement>(null);

  // Hooks
  const router = useRouter();
  const debouncedQuery = useDebounce(query, 300);

  // 热门搜索词
  const trendingSearches = [
    'Spring Boot 3',
    'React 19 新特性',
    'JDK 21 虚拟线程',
    'TypeScript 技巧',
    'Docker 部署',
  ];

  // 加载搜索历史
  useEffect(() => {
    const history = localStorage.getItem('searchHistory');
    if (history) {
      setSearchHistory(JSON.parse(history));
    }
  }, []);

  // 保存搜索历史
  const saveToHistory = useCallback((searchQuery: string) => {
    const trimmed = searchQuery.trim();
    if (!trimmed) return;

    setSearchHistory((prev) => {
      const filtered = prev.filter((item) => item !== trimmed);
      const newHistory = [trimmed, ...filtered].slice(0, 10);
      localStorage.setItem('searchHistory', JSON.stringify(newHistory));
      return newHistory;
    });
  }, []);

  // 清空搜索历史
  const clearHistory = useCallback(() => {
    setSearchHistory([]);
    localStorage.removeItem('searchHistory');
  }, []);

  // 执行搜索
  const performSearch = useCallback(async (searchQuery: string) => {
    if (!searchQuery.trim()) {
      setResults([]);
      setAiAnswer(null);
      setShowHistory(true);
      return;
    }

    setIsLoading(true);
    setShowHistory(false);

    try {
      // 并行执行：普通搜索 + AI 搜索
      const searchPromise = searchService.search(searchQuery);
      
      // 先获取普通搜索结果
      const searchResults = await searchPromise;
      setResults(searchResults);
      setIsLoading(false);

      // 异步获取 AI 回答
      setIsAiLoading(true);
      const aiSearchAnswer = await searchService.getAiAnswer(searchQuery, searchResults);
      setAiAnswer(aiSearchAnswer);
      setIsAiLoading(false);
    } catch (error) {
      console.error('Search error:', error);
      setIsLoading(false);
      setIsAiLoading(false);
    }
  }, []);

  // 防抖搜索
  useEffect(() => {
    performSearch(debouncedQuery);
  }, [debouncedQuery, performSearch]);

  // 处理搜索提交
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (query.trim()) {
      saveToHistory(query);
      if (activeIndex >= 0 && results[activeIndex]) {
        router.push(`/posts/${results[activeIndex].slug}`);
        onClose();
      }
    }
  };

  // 处理结果点击
  const handleResultClick = (result: SearchResult) => {
    saveToHistory(query);
    router.push(`/posts/${result.slug}`);
    onClose();
  };

  // 处理历史/热门词点击
  const handleQuickSearch = (searchTerm: string) => {
    setQuery(searchTerm);
  };

  // 键盘导航
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (!isOpen) return;

      switch (e.key) {
        case 'Escape':
          onClose();
          break;
        case 'ArrowDown':
          e.preventDefault();
          setActiveIndex((prev) => 
            prev < results.length - 1 ? prev + 1 : prev
          );
          break;
        case 'ArrowUp':
          e.preventDefault();
          setActiveIndex((prev) => (prev > 0 ? prev - 1 : -1));
          break;
        case 'Enter':
          if (activeIndex >= 0 && results[activeIndex]) {
            handleResultClick(results[activeIndex]);
          }
          break;
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [isOpen, activeIndex, results, onClose]);

  // 自动聚焦
  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen]);

  // 滚动激活项到视图
  useEffect(() => {
    if (activeIndex >= 0 && resultsRef.current) {
      const activeElement = resultsRef.current.children[activeIndex] as HTMLElement;
      if (activeElement) {
        activeElement.scrollIntoView({ block: 'nearest' });
      }
    }
  }, [activeIndex]);

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* 遮罩层 */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 z-50 bg-black/80 backdrop-blur-md"
          />

          {/* 搜索面板 */}
          <motion.div
            initial={{ opacity: 0, y: -50, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -50, scale: 0.95 }}
            transition={{ type: 'spring', duration: 0.5 }}
            className={cn(
              'fixed left-1/2 top-[10%] z-50 -translate-x-1/2',
              'w-full max-w-2xl',
              'bg-gray-900/95 backdrop-blur-xl',
              'rounded-2xl border border-white/10',
              'shadow-2xl shadow-black/50',
              'overflow-hidden'
            )}
          >
            {/* 搜索输入框 */}
            <form onSubmit={handleSubmit} className="relative">
              <div className="flex items-center px-4 py-4 border-b border-white/10">
                <Search className="h-5 w-5 text-gray-400" />
                <input
                  ref={inputRef}
                  type="text"
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  placeholder="搜索文章、标签、分类... (支持自然语言)"
                  className={cn(
                    'flex-1 mx-3 bg-transparent',
                    'text-white placeholder-gray-500',
                    'outline-none text-lg'
                  )}
                />
                {query && (
                  <button
                    type="button"
                    onClick={() => setQuery('')}
                    className="p-1 text-gray-400 hover:text-white transition-colors"
                  >
                    <X className="h-5 w-5" />
                  </button>
                )}
                {isLoading && (
                  <Loader2 className="h-5 w-5 text-primary animate-spin" />
                )}
              </div>

              {/* 快捷键提示 */}
              <div className="absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2">
                <kbd className="hidden md:inline-flex items-center px-2 py-0.5 rounded bg-white/10 text-xs text-gray-400">
                  ESC
                </kbd>
              </div>
            </form>

            {/* 内容区域 */}
            <div className="max-h-[60vh] overflow-y-auto">
              {/* AI 回答区域 */}
              <AnimatePresence>
                {(aiAnswer || isAiLoading) && !showHistory && (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    exit={{ opacity: 0, height: 0 }}
                    className="border-b border-white/10"
                  >
                    <div className="p-4">
                      <div className="flex items-center gap-2 mb-3">
                        <div className="p-1.5 rounded-lg bg-primary/20">
                          <Sparkles className="h-4 w-4 text-primary" />
                        </div>
                        <span className="text-sm font-medium text-primary">
                          AI 智能回答
                        </span>
                        {isAiLoading && (
                          <Loader2 className="h-4 w-4 text-primary animate-spin" />
                        )}
                      </div>

                      {isAiLoading ? (
                        <div className="space-y-2">
                          <div className="h-4 bg-white/5 rounded animate-pulse" />
                          <div className="h-4 bg-white/5 rounded animate-pulse w-3/4" />
                          <div className="h-4 bg-white/5 rounded animate-pulse w-1/2" />
                        </div>
                      ) : aiAnswer && (
                        <div className="space-y-3">
                          <p className="text-gray-300 text-sm leading-relaxed">
                            {aiAnswer.answer}
                          </p>
                          {aiAnswer.sources && aiAnswer.sources.length > 0 && (
                            <div className="flex flex-wrap gap-2">
                              <span className="text-xs text-gray-500">来源:</span>
                              {aiAnswer.sources.map((source, index) => (
                                <button
                                  key={index}
                                  onClick={() => router.push(`/posts/${source.slug}`)}
                                  className="text-xs text-primary hover:underline"
                                >
                                  {source.title}
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 搜索历史和热门搜索 */}
              {showHistory && !query && (
                <div className="p-4 space-y-6">
                  {/* 搜索历史 */}
                  {searchHistory.length > 0 && (
                    <div>
                      <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-2 text-sm text-gray-400">
                          <History className="h-4 w-4" />
                          <span>搜索历史</span>
                        </div>
                        <button
                          onClick={clearHistory}
                          className={cn(
                            'flex items-center gap-1 px-2 py-1 rounded',
                            'text-xs text-gray-500',
                            'hover:text-red-400 hover:bg-red-400/10',
                            'transition-colors duration-200'
                          )}
                        >
                          <Trash2 className="h-3 w-3" />
                          清空
                        </button>
                      </div>
                      <div className="flex flex-wrap gap-2">
                        {searchHistory.map((item, index) => (
                          <motion.button
                            key={item}
                            initial={{ opacity: 0, scale: 0.9 }}
                            animate={{ opacity: 1, scale: 1 }}
                            transition={{ delay: index * 0.05 }}
                            onClick={() => handleQuickSearch(item)}
                            className={cn(
                              'flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm',
                              'bg-white/5 text-gray-300 border border-white/5',
                              'hover:bg-white/10 hover:text-white hover:border-white/10',
                              'transition-all duration-200'
                            )}
                          >
                            <Clock className="h-3 w-3 text-gray-500" />
                            {item}
                          </motion.button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* 热门搜索 */}
                  <div>
                    <div className="flex items-center gap-2 text-sm text-gray-400 mb-3">
                      <TrendingUp className="h-4 w-4" />
                      <span>热门搜索</span>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {trendingSearches.map((item, index) => (
                        <motion.button
                          key={item}
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ delay: index * 0.05 + 0.1 }}
                          onClick={() => handleQuickSearch(item)}
                          className={cn(
                            'flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm',
                            'bg-primary/10 text-primary border border-primary/20',
                            'hover:bg-primary/20 hover:border-primary/30',
                            'transition-all duration-200'
                          )}
                        >
                          <span className="text-xs font-bold text-primary/60">
                            {index + 1}
                          </span>
                          {item}
                        </motion.button>
                      ))}
                    </div>
                  </div>

                  {/* 搜索提示 */}
                  <div className="pt-4 border-t border-white/5">
                    <p className="text-xs text-gray-500 text-center">
                      💡 支持自然语言搜索，例如："如何优化 Spring Boot 性能"
                    </p>
                  </div>
                </div>
              )}

              {/* 搜索结果列表 */}
              {!showHistory && results.length > 0 && (
                <div ref={resultsRef} className="divide-y divide-white/5">
                  {results.map((result, index) => (
                    <SearchResultItem
                      key={result.id}
                      result={result}
                      isActive={index === activeIndex}
                      query={query}
                      onClick={() => handleResultClick(result)}
                      onMouseEnter={() => setActiveIndex(index)}
                    />
                  ))}
                </div>
              )}

              {/* 无结果状态 */}
              {!showHistory && !isLoading && query && results.length === 0 && (
                <div className="py-12 text-center">
                  <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/5 mb-4">
                    <Search className="h-8 w-8 text-gray-500" />
                  </div>
                  <p className="text-gray-400 mb-2">
                    未找到与 "<span className="text-white">{query}</span>" 相关的内容
                  </p>
                  <p className="text-sm text-gray-500">
                    试试其他关键词，或使用更具体的描述
                  </p>
                </div>
              )}

              {/* 加载状态 */}
              {isLoading && (
                <div className="py-8 space-y-3">
                  {[1, 2, 3].map((i) => (
                    <div key={i} className="px-4">
                      <div className="animate-pulse space-y-2">
                        <div className="h-5 bg-white/5 rounded w-3/4" />
                        <div className="h-4 bg-white/5 rounded w-full" />
                        <div className="h-4 bg-white/5 rounded w-1/2" />
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* 底部快捷键提示 */}
            <div className="px-4 py-3 border-t border-white/10 bg-black/30">
              <div className="flex items-center justify-between text-xs text-gray-500">
                <div className="flex items-center gap-4">
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">↑</kbd>
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">↓</kbd>
                    <span>导航</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">Enter</kbd>
                    <span>打开</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">ESC</kbd>
                    <span>关闭</span>
                  </span>
                </div>
                <div className="flex items-center gap-1">
                  <Sparkles className="h-3 w-3 text-primary" />
                  <span>AI 语义搜索已启用</span>
                </div>
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

/**
 * 搜索结果项组件 Props
 */
interface SearchResultItemProps {
  result: SearchResult;
  isActive: boolean;
  query: string;
  onClick: () => void;
  onMouseEnter: () => void;
}

/**
 * 搜索结果项组件
 */
const SearchResultItem: React.FC<SearchResultItemProps> = ({
  result,
  isActive,
  query,
  onClick,
  onMouseEnter,
}) => {
  // 高亮匹配文本
  const highlightText = (text: string, query: string) => {
    if (!query.trim()) return text;

    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[]]/g, '\\$&')})`, 'gi');
    const parts = text.split(regex);

    return parts.map((part, index) =>
      regex.test(part) ? (
        <mark key={index} className="bg-primary/30 text-white rounded px-0.5">
          {part}
        </mark>
      ) : (
        part
      )
    );
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: -10 }}
      animate={{ opacity: 1, x: 0 }}
      onClick={onClick}
      onMouseEnter={onMouseEnter}
      className={cn(
        'flex items-start gap-4 px-4 py-4 cursor-pointer',
        'transition-colors duration-150',
        isActive ? 'bg-white/10' : 'hover:bg-white/5'
      )}
    >
      {/* 图标 */}
      <div
        className={cn(
          'flex-shrink-0 p-2 rounded-lg',
          isActive ? 'bg-primary/20' : 'bg-white/5'
        )}
      >
        <FileText
          className={cn('h-5 w-5', isActive ? 'text-primary' : 'text-gray-400')}
        />
      </div>

      {/* 内容 */}
      <div className="flex-1 min-w-0">
        {/* 标题 */}
        <h4
          className={cn(
            'font-medium truncate mb-1',
            isActive ? 'text-white' : 'text-gray-200'
          )}
        >
          {highlightText(result.title, query)}
        </h4>

        {/* 摘要/匹配片段 */}
        {result.highlight && (
          <p className="text-sm text-gray-400 line-clamp-2 mb-2">
            {highlightText(result.highlight, query)}
          </p>
        )}

        {/* 元信息 */}
        <div className="flex items-center gap-3 text-xs text-gray-500">
          {/* 分类 */}
          {result.category && (
            <span className="flex items-center gap-1">
              <Folder className="h-3 w-3" />
              {result.category}
            </span>
          )}

          {/* 标签 */}
          {result.tags && result.tags.length > 0 && (
            <span className="flex items-center gap-1">
              <Tag className="h-3 w-3" />
              {result.tags.slice(0, 2).join(', ')}
            </span>
          )}

          {/* 日期 */}
          <span>{result.publishedAt}</span>

          {/* 相关度分数 */}
          {result.score && (
            <Badge variant="outline" size="xs" className="text-primary border-primary/30">
              匹配度 {Math.round(result.score * 100)}%
            </Badge>
          )}
        </div>
      </div>

      {/* 箭头 */}
      <ArrowRight
        className={cn(
          'flex-shrink-0 h-5 w-5 transition-transform duration-200',
          isActive ? 'text-primary translate-x-1' : 'text-gray-600'
        )}
      />
    </motion.div>
  );
};

export default SearchPanel;
```

---

**组件五：友链卡片组件 (FriendCard)**

```tsx
// apps/blog/src/components/friends/FriendCard.tsx

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { ExternalLink, Globe, Mail, Rss } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Avatar } from '@aetherblog/ui';
import type { FriendLink } from '@aetherblog/types';

/**
 * 友链卡片 Props
 */
interface FriendCardProps {
  /** 友链数据 */
  friend: FriendLink;
  /** 卡片索引（用于动画延迟） */
  index?: number;
  /** 自定义类名 */
  className?: string;
}

/**
 * 友链卡片组件
 * 
 * 设计特点：
 * - 精美的毛玻璃卡片效果
 * - 支持自定义主题色
 * - 悬浮时的光效和位移动画
 * - 头像加载失败时的优雅降级
 */
export const FriendCard: React.FC<FriendCardProps> = ({
  friend,
  index = 0,
  className,
}) => {
  const [imageError, setImageError] = useState(false);

  // 根据友链设置的颜色生成渐变
  const themeColor = friend.themeColor || '#6366f1';
  
  // 卡片动画变体
  const cardVariants = {
    initial: { opacity: 0, y: 30, scale: 0.95 },
    animate: {
      opacity: 1,
      y: 0,
      scale: 1,
      transition: {
        delay: index * 0.1,
        duration: 0.4,
        ease: [0.25, 0.46, 0.45, 0.94],
      },
    },
    hover: {
      y: -8,
      scale: 1.02,
      transition: { duration: 0.3 },
    },
  };

  // 光效动画变体
  const glowVariants = {
    initial: { opacity: 0 },
    hover: {
      opacity: 1,
      transition: { duration: 0.3 },
    },
  };

  return (
    <motion.a
      href={friend.url}
      target="_blank"
      rel="noopener noreferrer"
      variants={cardVariants}
      initial="initial"
      animate="animate"
      whileHover="hover"
      className={cn(
        'group relative block overflow-hidden rounded-2xl',
        'bg-white/5 backdrop-blur-xl',
        'border border-white/10',
        'shadow-lg shadow-black/10',
        'transition-shadow duration-300',
        'hover:shadow-2xl hover:shadow-black/20',
        className
      )}
    >
      {/* 背景装饰 - 主题色光晕 */}
      <motion.div
        variants={glowVariants}
        className="absolute -top-20 -right-20 h-40 w-40 rounded-full blur-3xl"
        style={{ backgroundColor: `${themeColor}30` }}
      />

      {/* 顶部装饰条 */}
      <div
        className="h-1.5 w-full"
        style={{
          background: `linear-gradient(90deg, ${themeColor}, ${themeColor}80)`,
        }}
      />

      {/* 卡片内容 */}
      <div className="relative p-5">
        <div className="flex items-start gap-4">
          {/* 头像 */}
          <motion.div
            whileHover={{ rotate: [0, -5, 5, 0] }}
            transition={{ duration: 0.5 }}
            className="relative flex-shrink-0"
          >
            {/* 头像光环 */}
            <div
              className="absolute -inset-1 rounded-full opacity-50 blur-sm"
              style={{ backgroundColor: themeColor }}
            />
            
            {/* 头像图片 */}
            <div className="relative h-16 w-16 rounded-full overflow-hidden ring-2 ring-white/20">
              {!imageError ? (
                <img
                  src={friend.avatar}
                  alt={friend.name}
                  onError={() => setImageError(true)}
                  className="h-full w-full object-cover"
                />
              ) : (
                <div
                  className="h-full w-full flex items-center justify-center text-white text-xl font-bold"
                  style={{ backgroundColor: themeColor }}
                >
                  {friend.name.charAt(0).toUpperCase()}
                </div>
              )}
            </div>

            {/* 在线状态指示器（可选） */}
            {friend.isOnline && (
              <div className="absolute bottom-0 right-0 h-4 w-4 rounded-full bg-green-500 ring-2 ring-gray-900" />
            )}
          </motion.div>

          {/* 信息区域 */}
          <div className="flex-1 min-w-0">
            {/* 名称 */}
            <h3 className="flex items-center gap-2 font-bold text-white truncate">
              {friend.name}
              <ExternalLink className="h-4 w-4 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity" />
            </h3>

            {/* 描述 */}
            <p className="mt-1 text-sm text-gray-400 line-clamp-2">
              {friend.description || '这个人很懒，什么都没写~'}
            </p>

            {/* 标签/额外信息 */}
            {friend.tags && friend.tags.length > 0 && (
              <div className="mt-3 flex flex-wrap gap-1.5">
                {friend.tags.slice(0, 3).map((tag) => (
                  <span
                    key={tag}
                    className="px-2 py-0.5 rounded-full text-xs bg-white/5 text-gray-400 border border-white/5"
                  >
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* 底部链接区域 */}
        <div className="mt-4 pt-4 border-t border-white/5 flex items-center justify-between">
          {/* 网站链接 */}
          <div className="flex items-center gap-1 text-xs text-gray-500 truncate">
            <Globe className="h-3.5 w-3.5 flex-shrink-0" />
            <span className="truncate">{new URL(friend.url).hostname}</span>
          </div>

          {/* 社交链接 */}
          <div className="flex items-center gap-2">
            {friend.email && (
              <motion.a
                href={`mailto:${friend.email}`}
                onClick={(e) => e.stopPropagation()}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                className="p-1.5 rounded-full bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 transition-colors"
              >
                <Mail className="h-4 w-4" />
              </motion.a>
            )}
            {friend.rss && (
              <motion.a
                href={friend.rss}
                target="_blank"
                rel="noopener noreferrer"
                onClick={(e) => e.stopPropagation()}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                className="p-1.5 rounded-full bg-white/5 text-gray-400 hover:text-orange-400 hover:bg-orange-400/10 transition-colors"
              >
                <Rss className="h-4 w-4" />
              </motion.a>
            )}
          </div>
        </div>
      </div>

      {/* 悬浮时的边框光效 */}
      <motion.div
        variants={glowVariants}
        className="absolute inset-0 rounded-2xl pointer-events-none"
        style={{
          boxShadow: `inset 0 0 0 1px ${themeColor}40`,
        }}
      />
    </motion.a>
  );
};

/**
 * 友链网格组件
 */
interface FriendGridProps {
  friends: FriendLink[];
  className?: string;
}

export const FriendGrid: React.FC<FriendGridProps> = ({
  friends,
  className,
}) => {
  return (
    <div
      className={cn(
        'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6',
        className
      )}
    >
      {friends.map((friend, index) => (
        <FriendCard key={friend.id} friend={friend} index={index} />
      ))}
    </div>
  );
};

export default FriendCard;
```

---

**组件六：代码块组件 (CodeBlock)**

```tsx
// packages/editor/src/renderers/CodeBlockRenderer.tsx

import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Copy, 
  Check, 
  ChevronDown, 
  ChevronUp, 
  Terminal,
  Maximize2,
  Minimize2,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useCopyToClipboard } from '@aetherblog/hooks';
import { codeToHtml } from 'shiki';

/**
 * 代码块 Props
 */
interface CodeBlockProps {
  /** 代码内容 */
  code: string;
  /** 编程语言 */
  language?: string;
  /** 文件名（可选） */
  filename?: string;
  /** 是否显示行号 */
  showLineNumbers?: boolean;
  /** 高亮行 */
  highlightLines?: number[];
  /** 最大高度（超出可折叠） */
  maxHeight?: number;
  /** 自定义类名 */
  className?: string;
}

/**
 * 语言图标映射
 */
const languageIcons: Record<string, string> = {
  javascript: '🟨',
  typescript: '🔷',
  python: '🐍',
  java: '☕',
  go: '🐹',
  rust: '🦀',
  cpp: '⚙️',
  c: '©️',
  html: '🌐',
  css: '🎨',
  json: '📋',
  yaml: '📄',
  markdown: '📝',
  bash: '💻',
  shell: '💻',
  sql: '🗃️',
  dockerfile: '🐳',
};

/**
 * 语言显示名称映射
 */
const languageNames: Record<string, string> = {
  js: 'JavaScript',
  ts: 'TypeScript',
  javascript: 'JavaScript',
  typescript: 'TypeScript',
  jsx: 'JSX',
  tsx: 'TSX',
  py: 'Python',
  python: 'Python',
  java: 'Java',
  go: 'Go',
  rust: 'Rust',
  cpp: 'C++',
  c: 'C',
  html: 'HTML',
  css: 'CSS',
  scss: 'SCSS',
  json: 'JSON',
  yaml: 'YAML',
  yml: 'YAML',
  md: 'Markdown',
  markdown: 'Markdown',
  bash: 'Bash',
  shell: 'Shell',
  sh: 'Shell',
  zsh: 'Zsh',
  sql: 'SQL',
  dockerfile: 'Dockerfile',
  docker: 'Docker',
  xml: 'XML',
  graphql: 'GraphQL',
  prisma: 'Prisma',
};

/**
 * 代码块组件
 * 
 * 设计特点：
 * - macOS 风格窗口设计
 * - Shiki 语法高亮（VS Code 主题）
 * - 一键复制功能
 * - 长代码自动折叠
 * - 行号显示
 * - 高亮特定行
 * - 全屏模式
 */
export const CodeBlock: React.FC<CodeBlockProps> = ({
  code,
  language = 'text',
  filename,
  showLineNumbers = true,
  highlightLines = [],
  maxHeight = 400,
  className,
}) => {
  // 状态
  const [highlightedHtml, setHighlightedHtml] = useState<string>('');
  const [isLoading, setIsLoading] = useState(true);
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [shouldCollapse, setShouldCollapse] = useState(false);
  
  // Hooks
  const [copied, copy] = useCopyToClipboard();
  const codeRef = useRef<HTMLDivElement>(null);

  // 获取语言显示名称
  const displayLanguage = languageNames[language.toLowerCase()] || language.toUpperCase();
  const languageIcon = languageIcons[language.toLowerCase()] || '📄';

  // 代码行数
  const lineCount = code.split('\n').length;

  // 使用 Shiki 进行语法高亮
  useEffect(() => {
    const highlightCode = async () => {
      setIsLoading(true);
      try {
        const html = await codeToHtml(code, {
          lang: language,
          theme: 'one-dark-pro',
          transformers: [
            {
              line(node, line) {
                // 添加行号
                if (showLineNumbers) {
                  node.properties['data-line'] = line;
                }
                // 高亮特定行
                if (highlightLines.includes(line)) {
                  node.properties['data-highlighted'] = '';
                }
              },
            },
          ],
        });
        setHighlightedHtml(html);
      } catch (error) {
        // 降级：不进行高亮
        setHighlightedHtml(`<pre><code>${escapeHtml(code)}</code></pre>`);
      } finally {
        setIsLoading(false);
      }
    };

    highlightCode();
  }, [code, language, showLineNumbers, highlightLines]);

  // 检查是否需要折叠
  useEffect(() => {
    if (codeRef.current) {
      const height = codeRef.current.scrollHeight;
      setShouldCollapse(height > maxHeight);
      if (height > maxHeight) {
        setIsCollapsed(true);
      }
    }
  }, [highlightedHtml, maxHeight]);

  // 复制代码
  const handleCopy = () => {
    copy(code);
  };

  // 切换折叠状态
  const toggleCollapse = () => {
    setIsCollapsed(!isCollapsed);
  };

  // 切换全屏
  const toggleFullscreen = () => {
    setIsFullscreen(!isFullscreen);
  };

  // HTML 转义
  const escapeHtml = (text: string) => {
    return text
      .replace(/&/g, '&')
      .replace(/</g, '<')
      .replace(/>/g, '>')
      .replace(/"/g, '"')
      .replace(/'/g, ''');
  };

  return (
    <>
      <motion.div
        layout
        className={cn(
          'relative my-6 rounded-xl overflow-hidden',
          'bg-[#282c34] border border-white/10',
          'shadow-xl shadow-black/20',
          isFullscreen && 'fixed inset-4 z-50 m-0',
          className
        )}
      >
        {/* macOS 风格窗口头部 */}
        <div className="flex items-center justify-between px-4 py-3 bg-[#21252b] border-b border-white/5">
          {/* 左侧：窗口控制点 + 语言/文件名 */}
          <div className="flex items-center gap-3">
            {/* macOS 控制点 */}
            <div className="flex items-center gap-1.5">
              <div className="w-3 h-3 rounded-full bg-[#ff5f56]" />
              <div className="w-3 h-3 rounded-full bg-[#ffbd2e]" />
              <div className="w-3 h-3 rounded-full bg-[#27c93f]" />
            </div>

            {/* 分隔线 */}
            <div className="h-4 w-px bg-white/10" />

            {/* 语言/文件名 */}
            <div className="flex items-center gap-2 text-sm">
              <span>{languageIcon}</span>
              <span className="text-gray-400">
                {filename || displayLanguage}
              </span>
              <span className="text-gray-600 text-xs">
                {lineCount} 行
              </span>
            </div>
          </div>
          
          {/* 右侧：操作按钮 */}
          <div className="flex items-center gap-1">
            {/* 全屏按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={toggleFullscreen}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200'
              )}
              title={isFullscreen ? '退出全屏' : '全屏'}
            >
              {isFullscreen ? (
                <Minimize2 className="h-4 w-4" />
              ) : (
                <Maximize2 className="h-4 w-4" />
              )}
            </motion.button>

            {/* 折叠按钮（仅在需要时显示） */}
            {shouldCollapse && (
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={toggleCollapse}
                className={cn(
                  'p-1.5 rounded-md',
                  'text-gray-500 hover:text-white',
                  'hover:bg-white/10',
                  'transition-colors duration-200'
                )}
                title={isCollapsed ? '展开代码' : '折叠代码'}
              >
                {isCollapsed ? (
                  <ChevronDown className="h-4 w-4" />
                ) : (
                  <ChevronUp className="h-4 w-4" />
                )}
              </motion.button>
            )}

            {/* 复制按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleCopy}
              className={cn(
                'flex items-center gap-1.5 px-2.5 py-1.5 rounded-md',
                'text-sm font-medium',
                'transition-all duration-200',
                copied
                  ? 'bg-green-500/20 text-green-400'
                  : 'text-gray-400 hover:text-white hover:bg-white/10'
              )}
            >
              <AnimatePresence mode="wait">
                {copied ? (
                  <motion.div
                    key="check"
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    exit={{ scale: 0 }}
                    className="flex items-center gap-1"
                  >
                    <Check className="h-4 w-4" />
                    <span>已复制</span>
                  </motion.div>
                ) : (
                  <motion.div
                    key="copy"
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    exit={{ scale: 0 }}
                    className="flex items-center gap-1"
                  >
                    <Copy className="h-4 w-4" />
                    <span>复制</span>
                  </motion.div>
                )}
              </AnimatePresence>
            </motion.button>
          </div>
        </div>

        {/* 代码内容区域 */}
        <div className="relative">
          {/* 加载状态 */}
          {isLoading && (
            <div className="absolute inset-0 flex items-center justify-center bg-[#282c34]">
              <div className="flex items-center gap-2 text-gray-400">
                <Terminal className="h-5 w-5 animate-pulse" />
                <span>加载中...</span>
              </div>
            </div>
          )}

          {/* 代码容器 */}
          <motion.div
            ref={codeRef}
            animate={{
              height: isCollapsed ? maxHeight : 'auto',
            }}
            transition={{ duration: 0.3, ease: 'easeInOut' }}
            className={cn(
              'overflow-hidden',
              isCollapsed && 'overflow-y-hidden'
            )}
          >
            {/* 行号 + 代码 */}
            <div className="flex">
              {/* 行号列 */}
              {showLineNumbers && (
                <div
                  className={cn(
                    'flex-shrink-0 py-4 px-3 text-right select-none',
                    'bg-[#21252b] border-r border-white/5',
                    'text-gray-600 text-sm font-mono'
                  )}
                >
                  {Array.from({ length: lineCount }, (_, i) => (
                    <div
                      key={i + 1}
                      className={cn(
                        'leading-6',
                        highlightLines.includes(i + 1) && 'text-primary'
                      )}
                    >
                      {i + 1}
                    </div>
                  ))}
                </div>
              )}

              {/* 代码内容 */}
              <div
                className={cn(
                  'flex-1 overflow-x-auto py-4 px-4',
                  'text-sm font-mono leading-6',
                  '[&_pre]:!bg-transparent [&_pre]:!m-0 [&_pre]:!p-0',
                  '[&_code]:!bg-transparent',
                  // 高亮行样式
                  '[&_[data-highlighted]]:bg-primary/10',
                  '[&_[data-highlighted]]:border-l-2',
                  '[&_[data-highlighted]]:border-primary',
                  '[&_[data-highlighted]]:ml-[-1rem]',
                  '[&_[data-highlighted]]:pl-[calc(1rem-2px)]'
                )}
                dangerouslySetInnerHTML={{ __html: highlightedHtml }}
              />
            </div>
          </motion.div>

          {/* 折叠渐变遮罩 */}
          <AnimatePresence>
            {isCollapsed && shouldCollapse && (
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                className={cn(
                  'absolute bottom-0 left-0 right-0 h-20',
                  'bg-gradient-to-t from-[#282c34] to-transparent',
                  'pointer-events-none'
                )}
              />
            )}
          </AnimatePresence>

          {/* 折叠时的展开提示 */}
          <AnimatePresence>
            {isCollapsed && shouldCollapse && (
              <motion.button
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: 10 }}
                onClick={toggleCollapse}
                className={cn(
                  'absolute bottom-2 left-1/2 -translate-x-1/2',
                  'flex items-center gap-1.5 px-4 py-2 rounded-full',
                  'bg-primary/20 text-primary text-sm font-medium',
                  'border border-primary/30',
                  'hover:bg-primary/30',
                  'transition-colors duration-200'
                )}
              >
                <ChevronDown className="h-4 w-4" />
                展开全部代码（{lineCount} 行）
              </motion.button>
            )}
          </AnimatePresence>
        </div>
      </motion.div>

      {/* 全屏模式遮罩 */}
      <AnimatePresence>
        {isFullscreen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={toggleFullscreen}
            className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm"
          />
        )}
      </AnimatePresence>
    </>
  );
};

export default CodeBlock;
```

---

**组件七：Markdown 渲染器主组件 (MarkdownRenderer)**

```tsx
// packages/editor/src/renderers/MarkdownRenderer.tsx

import React, { useMemo } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';
import rehypeSlug from 'rehype-slug';
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import { cn } from '@aetherblog/utils';

// 自定义渲染器
import { CodeBlock } from './CodeBlockRenderer';
import { MathRenderer } from './MathRenderer';
import { MermaidRenderer } from './MermaidRenderer';
import { ImageRenderer } from './ImageRenderer';
import { TableRenderer } from './TableRenderer';
import { BlockquoteRenderer } from './BlockquoteRenderer';
import { HeadingRenderer } from './HeadingRenderer';
import { LinkRenderer } from './LinkRenderer';

/**
 * Markdown 渲染器 Props
 */
interface MarkdownRendererProps {
  /** Markdown 内容 */
  content: string;
  /** 是否为文章页面（启用更多功能） */
  isArticle?: boolean;
  /** 标题点击回调 */
  onHeadingClick?: (id: string) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * Markdown 渲染器组件
 * 
 * 功能特性：
 * - GitHub Flavored Markdown (GFM) 支持
 * - 数学公式渲染 (KaTeX)
 * - 代码语法高亮 (Shiki)
 * - Mermaid 图表渲染
 * - 图片增强（居中、缩放、灯箱）
 * - 自动生成标题锚点
 * - 优化的排版样式
 */
export const MarkdownRenderer: React.FC<MarkdownRendererProps> = ({
  content,
  isArticle = false,
  onHeadingClick,
  className,
}) => {
  // 自定义组件映射
  const components = useMemo(() => ({
    // 代码块
    code: ({ node, inline, className: codeClassName, children, ...props }: any) => {
      const match = /language-(\w+)/.exec(codeClassName || '');
      const language = match ? match[1] : '';
      const code = String(children).replace(/\n$/, '');

      // 行内代码
      if (inline) {
        return (
          <code
            className={cn(
              'px-1.5 py-0.5 rounded-md',
              'bg-white/10 text-primary',
              'font-mono text-[0.9em]',
              'border border-white/5'
            )}
            {...props}
          >
            {children}
          </code>
        );
      }

      // Mermaid 图表
      if (language === 'mermaid') {
        return <MermaidRenderer chart={code} />;
      }

      // 代码块
      return (
        <CodeBlock
          code={code}
          language={language}
          showLineNumbers={code.split('\n').length > 1}
        />
      );
    },

    // 标题
    h1: (props: any) => (
      <HeadingRenderer level={1} onHeadingClick={onHeadingClick} {...props} />
    ),
    h2: (props: any) => (
      <HeadingRenderer level={2} onHeadingClick={onHeadingClick} {...props} />
    ),
    h3: (props: any) => (
      <HeadingRenderer level={3} onHeadingClick={onHeadingClick} {...props} />
    ),
    h4: (props: any) => (
      <HeadingRenderer level={4} onHeadingClick={onHeadingClick} {...props} />
    ),
    h5: (props: any) => (
      <HeadingRenderer level={5} onHeadingClick={onHeadingClick} {...props} />
    ),
    h6: (props: any) => (
      <HeadingRenderer level={6} onHeadingClick={onHeadingClick} {...props} />
    ),

    // 图片
    img: (props: any) => (
      <ImageRenderer
        src={props.src}
        alt={props.alt}
        title={props.title}
        enableLightbox={isArticle}
      />
    ),

    // 链接
    a: (props: any) => <LinkRenderer {...props} />,

    // 表格
    table: (props: any) => <TableRenderer {...props} />,

    // 引用块
    blockquote: (props: any) => <BlockquoteRenderer {...props} />,

    // 段落
    p: ({ children, ...props }: any) => (
      <p
        className={cn(
          'my-4 leading-7 text-gray-300',
          '[&:has(img)]:my-8'
        )}
        {...props}
      >
        {children}
      </p>
    ),

    // 列表
    ul: ({ children, ...props }: any) => (
      <ul
        className={cn(
          'my-4 ml-6 list-disc',
          'marker:text-primary/60',
          'space-y-2'
        )}
        {...props}
      >
        {children}
      </ul>
    ),

    ol: ({ children, ...props }: any) => (
      <ol
        className={cn(
          'my-4 ml-6 list-decimal',
          'marker:text-primary/60',
          'space-y-2'
        )}
        {...props}
      >
        {children}
      </ol>
    ),

    li: ({ children, ...props }: any) => (
      <li className="text-gray-300 leading-7" {...props}>
        {children}
      </li>
    ),

    // 分隔线
    hr: () => (
      <hr className="my-8 border-none h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
    ),

    // 粗体
    strong: ({ children, ...props }: any) => (
      <strong className="font-semibold text-white" {...props}>
        {children}
      </strong>
    ),

    // 斜体
    em: ({ children, ...props }: any) => (
      <em className="italic text-gray-200" {...props}>
        {children}
      </em>
    ),

    // 删除线
    del: ({ children, ...props }: any) => (
      <del className="line-through text-gray-500" {...props}>
        {children}
      </del>
    ),
  }), [isArticle, onHeadingClick]);

  return (
    <article
      className={cn(
        'prose prose-invert prose-lg max-w-none',
        // 自定义 Prose 样式覆盖
        'prose-headings:text-white prose-headings:font-bold',
        'prose-p:text-gray-300',
        'prose-a:text-primary prose-a:no-underline hover:prose-a:underline',
        'prose-strong:text-white',
        'prose-code:text-primary prose-code:bg-white/10',
        'prose-pre:bg-transparent prose-pre:p-0',
        'prose-img:rounded-xl prose-img:shadow-xl',
        'prose-hr:border-white/10',
        className
      )}
    >
      <ReactMarkdown
        remarkPlugins={[
          remarkGfm,
          remarkMath,
        ]}
        rehypePlugins={[
          rehypeKatex,
          rehypeSlug,
          [rehypeAutolinkHeadings, { behavior: 'wrap' }],
        ]}
        components={components}
      >
        {content}
      </ReactMarkdown>
    </article>
  );
};

export default MarkdownRenderer;
```

---

**组件八：数学公式渲染器 (MathRenderer)**

```tsx
// packages/editor/src/renderers/MathRenderer.tsx

import React from 'react';
import { InlineMath, BlockMath } from 'react-katex';
import { cn } from '@aetherblog/utils';
import 'katex/dist/katex.min.css';

/**
 * 数学公式渲染器 Props
 */
interface MathRendererProps {
  /** LaTeX 公式 */
  math: string;
  /** 是否为块级公式 */
  block?: boolean;
  /** 自定义类名 */
  className?: string;
}

/**
 * 数学公式渲染器组件
 * 
 * 使用 KaTeX 渲染 LaTeX 数学公式
 * 支持行内公式和块级公式
 */
export const MathRenderer: React.FC<MathRendererProps> = ({
  math,
  block = false,
  className,
}) => {
  // 错误处理
  const handleError = (error: Error) => {
    console.error('KaTeX Error:', error);
  };

  if (block) {
    return (
      <div
        className={cn(
          'my-6 py-4 overflow-x-auto',
          'bg-white/5 rounded-xl',
          'border border-white/10',
          className
        )}
      >
        <BlockMath
          math={math}
          errorColor="#ef4444"
          renderError={handleError}
        />
      </div>
    );
  }

  return (
    <span className={cn('mx-1', className)}>
      <InlineMath
        math={math}
        errorColor="#ef4444"
        renderError={handleError}
      />
    </span>
  );
};

export default MathRenderer;
```

---

**组件九：Mermaid 图表渲染器 (MermaidRenderer)**

```tsx
// packages/editor/src/renderers/MermaidRenderer.tsx

import React, { useEffect, useRef, useState, useId } from 'react';
import mermaid from 'mermaid';
import { motion } from 'framer-motion';
import { Maximize2, Download, RefreshCw, AlertCircle } from 'lucide-react';
import { cn } from '@aetherblog/utils';

/**
 * Mermaid 图表渲染器 Props
 */
interface MermaidRendererProps {
  /** Mermaid 图表代码 */
  chart: string;
  /** 自定义类名 */
  className?: string;
}

// 初始化 Mermaid 配置
mermaid.initialize({
  startOnLoad: false,
  theme: 'dark',
  themeVariables: {
    primaryColor: '#6366f1',
    primaryTextColor: '#ffffff',
    primaryBorderColor: '#6366f1',
    lineColor: '#6b7280',
    secondaryColor: '#374151',
    tertiaryColor: '#1f2937',
    background: '#111827',
    mainBkg: '#1f2937',
    nodeBorder: '#6366f1',
    clusterBkg: '#374151',
    titleColor: '#ffffff',
    edgeLabelBackground: '#374151',
  },
  fontFamily: 'Inter, sans-serif',
  fontSize: 14,
  flowchart: {
    htmlLabels: true,
    curve: 'basis',
    padding: 15,
  },
  sequence: {
    diagramMarginX: 50,
    diagramMarginY: 10,
    actorMargin: 50,
    width: 150,
    height: 65,
    boxMargin: 10,
    boxTextMargin: 5,
    noteMargin: 10,
    messageMargin: 35,
  },
});

/**
 * Mermaid 图表渲染器组件
 * 
 * 功能：
 * - 支持流程图、时序图、甘特图、类图等
 * - 暗色主题适配
 * - 错误处理与提示
 * - 全屏查看
 * - 导出为 SVG
 */
export const MermaidRenderer: React.FC<MermaidRendererProps> = ({
  chart,
  className,
}) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [svg, setSvg] = useState<string>('');
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const uniqueId = useId().replace(/:/g, '');

  // 渲染图表
  useEffect(() => {
    const renderChart = async () => {
      setIsLoading(true);
      setError(null);

      try {
        // 验证语法
        await mermaid.parse(chart);
        
        // 渲染 SVG
        const { svg: renderedSvg } = await mermaid.render(
          `mermaid-${uniqueId}`,
          chart
        );
        
        setSvg(renderedSvg);
      } catch (err: any) {
        console.error('Mermaid error:', err);
        setError(err.message || '图表渲染失败');
      } finally {
        setIsLoading(false);
      }
    };

    if (chart) {
      renderChart();
    }
  }, [chart, uniqueId]);

  // 导出 SVG
  const handleExport = () => {
    if (!svg) return;

    const blob = new Blob([svg], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `diagram-${Date.now()}.svg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  // 重新渲染
  const handleRefresh = () => {
    setSvg('');
    setError(null);
    setIsLoading(true);
    
    setTimeout(async () => {
      try {
        const { svg: renderedSvg } = await mermaid.render(
          `mermaid-refresh-${uniqueId}-${Date.now()}`,
          chart
        );
        setSvg(renderedSvg);
      } catch (err: any) {
        setError(err.message || '图表渲染失败');
      } finally {
        setIsLoading(false);
      }
    }, 100);
  };

  return (
    <>
      <div
        className={cn(
          'my-6 rounded-xl overflow-hidden',
          'bg-gray-900/50 border border-white/10',
          'shadow-lg',
          isFullscreen && 'fixed inset-4 z-50 m-0 flex flex-col',
          className
        )}
      >
        {/* 头部工具栏 */}
        <div className="flex items-center justify-between px-4 py-2 bg-black/30 border-b border-white/5">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <span>📊</span>
            <span>Mermaid 图表</span>
          </div>

          <div className="flex items-center gap-1">
            {/* 刷新按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleRefresh}
              disabled={isLoading}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200',
                'disabled:opacity-50'
              )}
              title="刷新"
            >
              <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />
            </motion.button>

            {/* 导出按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleExport}
              disabled={!svg || isLoading}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200',
                'disabled:opacity-50'
              )}
              title="导出 SVG"
            >
              <Download className="h-4 w-4" />
            </motion.button>

            {/* 全屏按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={() => setIsFullscreen(!isFullscreen)}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200'
              )}
              title={isFullscreen ? '退出全屏' : '全屏查看'}
            >
              <Maximize2 className="h-4 w-4" />
            </motion.button>
          </div>
        </div>

        {/* 图表内容 */}
        <div
          ref={containerRef}
          className={cn(
            'p-6 overflow-auto',
            'flex items-center justify-center',
            isFullscreen ? 'flex-1' : 'min-h-[200px]'
          )}
        >
          {/* 加载状态 */}
          {isLoading && (
            <div className="flex items-center gap-2 text-gray-400">
              <RefreshCw className="h-5 w-5 animate-spin" />
              <span>渲染中...</span>
            </div>
          )}

          {/* 错误状态 */}
          {error && !isLoading && (
            <div className="flex flex-col items-center gap-3 text-red-400">
              <AlertCircle className="h-8 w-8" />
              <p className="text-sm">图表渲染失败</p>
              <p className="text-xs text-gray-500 max-w-md text-center">{error}</p>
              <button
                onClick={handleRefresh}
                className="mt-2 px-4 py-2 rounded-lg bg-red-500/20 text-red-400 text-sm hover:bg-red-500/30 transition-colors"
              >
                重试
              </button>
            </div>
          )}

          {/* SVG 图表 */}
          {svg && !isLoading && !error && (
            <div
              className="[&_svg]:max-w-full [&_svg]:h-auto"
              dangerouslySetInnerHTML={{ __html: svg }}
            />
          )}
        </div>
      </div>

      {/* 全屏遮罩 */}
      {isFullscreen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          onClick={() => setIsFullscreen(false)}
          className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm"
        />
      )}
    </>
  );
};

export default MermaidRenderer;
```

---

**组件十：图片渲染器 (ImageRenderer)**

```tsx
// packages/editor/src/renderers/ImageRenderer.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, ZoomIn, Download, ExternalLink } from 'lucide-react';
import { cn } from '@aetherblog/utils';

/**
 * 图片渲染器 Props
 */
interface ImageRendererProps {
  /** 图片地址 */
  src: string;
  /** 替代文本 */
  alt?: string;
  /** 标题 */
  title?: string;
  /** 是否启用灯箱 */
  enableLightbox?: boolean;
  /** 自定义类名 */
  className?: string;
}

/**
 * 图片渲染器组件
 * 
 * 功能：
 * - 图片居中显示
 * - 自适应宽度
 * - 加载状态
 * - 错误处理
 * - 灯箱放大查看
 * - 下载功能
 */
export const ImageRenderer: React.FC<ImageRendererProps> = ({
  src,
  alt = '',
  title,
  enableLightbox = true,
  className,
}) => {
  const [isLoading, setIsLoading] = useState(true);
  const [hasError, setHasError] = useState(false);
  const [isLightboxOpen, setIsLightboxOpen] = useState(false);

  // 处理图片加载完成
  const handleLoad = () => {
    setIsLoading(false);
  };

  // 处理图片加载错误
  const handleError = () => {
    setIsLoading(false);
    setHasError(true);
  };

  // 下载图片
  const handleDownload = async () => {
    try {
      const response = await fetch(src);
      const blob = await response.blob();
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = alt || `image-${Date.now()}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('Download failed:', error);
    }
  };

  // 在新标签页打开
  const handleOpenInNewTab = () => {
    window.open(src, '_blank', 'noopener,noreferrer');
  };

  return (
    <>
      {/* 图片容器 */}
      <figure className={cn('my-8', className)}>
        <div
          className={cn(
            'relative mx-auto overflow-hidden rounded-xl',
            'bg-white/5 border border-white/10',
            'shadow-lg shadow-black/20',
            enableLightbox && 'cursor-zoom-in group'
          )}
          onClick={() => enableLightbox && !hasError && setIsLightboxOpen(true)}
        >
          {/* 加载状态骨架屏 */}
          {isLoading && (
            <div className="absolute inset-0 flex items-center justify-center">
              <div className="animate-pulse flex flex-col items-center gap-2">
                <div className="w-12 h-12 rounded-full bg-white/10" />
                <div className="w-24 h-3 rounded bg-white/10" />
              </div>
            </div>
          )}

          {/* 错误状态 */}
          {hasError && (
            <div className="flex flex-col items-center justify-center py-12 text-gray-500">
              <svg
                className="w-16 h-16 mb-3 opacity-50"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={1.5}
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <p className="text-sm">图片加载失败</p>
              <p className="text-xs mt-1 text-gray-600 max-w-xs truncate">{src}</p>
            </div>
          )}

          {/* 图片 */}
          <motion.img
            src={src}
            alt={alt}
            title={title}
            onLoad={handleLoad}
            onError={handleError}
            initial={{ opacity: 0, scale: 1.02 }}
            animate={{
              opacity: isLoading || hasError ? 0 : 1,
              scale: 1,
            }}
            transition={{ duration: 0.3 }}
            className={cn(
              'w-full h-auto',
              'transition-transform duration-300',
              enableLightbox && 'group-hover:scale-[1.02]'
            )}
          />

          {/* 悬浮放大提示 */}
          {enableLightbox && !hasError && !isLoading && (
            <motion.div
              initial={{ opacity: 0 }}
              whileHover={{ opacity: 1 }}
              className={cn(
                'absolute inset-0 flex items-center justify-center',
                'bg-black/40 opacity-0 group-hover:opacity-100',
                'transition-opacity duration-200'
              )}
            >
              <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-white">
                <ZoomIn className="w-5 h-5" />
                <span className="text-sm font-medium">点击放大</span>
              </div>
            </motion.div>
          )}
        </div>

        {/* 图片说明 */}
        {(alt || title) && (
          <figcaption className="mt-3 text-center text-sm text-gray-500">
            {title || alt}
          </figcaption>
        )}
      </figure>

      {/* 灯箱模态框 */}
      <AnimatePresence>
        {isLightboxOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 z-50 flex items-center justify-center"
            onClick={() => setIsLightboxOpen(false)}
          >
            {/* 背景遮罩 */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="absolute inset-0 bg-black/90 backdrop-blur-md"
            />

            {/* 工具栏 */}
            <div className="absolute top-4 right-4 z-10 flex items-center gap-2">
              {/* 下载按钮 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={(e) => {
                  e.stopPropagation();
                  handleDownload();
                }}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-white/20',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="下载图片"
              >
                <Download className="w-5 h-5" />
              </motion.button>

              {/* 新标签页打开 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={(e) => {
                  e.stopPropagation();
                  handleOpenInNewTab();
                }}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-white/20',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="在新标签页打开"
              >
                <ExternalLink className="w-5 h-5" />
              </motion.button>

              {/* 关闭按钮 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => setIsLightboxOpen(false)}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-red-500/50',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="关闭"
              >
                <X className="w-5 h-5" />
              </motion.button>
            </div>

            {/* 大图 */}
            <motion.img
              src={src}
              alt={alt}
              initial={{ scale: 0.9, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.9, opacity: 0 }}
              transition={{ type: 'spring', duration: 0.5 }}
              onClick={(e) => e.stopPropagation()}
              className={cn(
                'relative max-w-[90vw] max-h-[85vh]',
                'object-contain rounded-lg',
                'shadow-2xl shadow-black/50'
              )}
            />

            {/* 图片说明 */}
            {(alt || title) && (
              <motion.div
                initial={{ y: 20, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: 20, opacity: 0 }}
                className="absolute bottom-6 left-1/2 -translate-x-1/2"
              >
                <div className="px-6 py-3 rounded-full bg-black/60 backdrop-blur-sm text-white text-sm">
                  {title || alt}
                </div>
              </motion.div>
            )}

            {/* 键盘提示 */}
            <div className="absolute bottom-6 right-6 text-xs text-gray-500">
              按 ESC 关闭
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
};

export default ImageRenderer;
```

---

### 2.3.3 前端状态管理设计

#### 2.3.3.1 状态管理架构

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端状态管理架构                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                      状态分层设计                                                   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              服务端状态 (Server State)                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: TanStack Query (React Query)                                                    │  │ │
│   │   │   特点: 缓存、自动刷新、乐观更新、离线支持                                                    │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ 文章数据    │ │ 分类数据    │ │ 标签数据    │ │ 用户数据    │ │ 统计数据    │          │  │ │
│   │   │   │ posts       │ │ categories  │ │ tags        │ │ user        │ │ analytics   │          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              客户端状态 (Client State)                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: Zustand                                                                          │  │ │
│   │   │   特点: 轻量、简单、无样板代码、支持持久化                                                    │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ UI状态      │ │ 认证状态    │ │ 主题状态    │ │ 编辑器状态  │ │ 设置状态    │          │  │ │
│   │   │   │ uiStore     │ │ authStore   │ │ themeStore  │ │ editorStore │ │ settingsStore│         │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              URL状态 (URL State)                                             │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: Next.js Router / nuqs                                                            │  │ │
│   │   │   特点: 可分享、可书签、浏览器历史支持                                                        │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                                           │  │ │
│   │   │   │ 搜索参数    │ │ 分页参数    │ │ 筛选参数    │                                           │  │ │
│   │   │   │ ?q=xxx      │ │ ?page=1     │ │ ?category=x │                                           │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘                                           │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.3.2 Zustand Store 实现

```tsx
// apps/admin/src/stores/authStore.ts

import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';
import type { User } from '@aetherblog/types';

/**
 * 认证状态接口
 */
interface AuthState {
  // 状态
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;
  isLoading: boolean;

  // 操作
  setUser: (user: User | null) => void;
  setTokens: (accessToken: string, refreshToken: string) => void;
  login: (user: User, accessToken: string, refreshToken: string) => void;
  logout: () => void;
  updateUser: (updates: Partial<User>) => void;
  setLoading: (loading: boolean) => void;
}

/**
 * 认证状态 Store
 */
export const useAuthStore = create<AuthState>()(
  persist(
    immer((set) => ({
      // 初始状态
      user: null,
      accessToken: null,
      refreshToken: null,
      isAuthenticated: false,
      isLoading: true,

      // 设置用户
      setUser: (user) =>
        set((state) => {
          state.user = user;
          state.isAuthenticated = !!user;
        }),

      // 设置令牌
      setTokens: (accessToken, refreshToken) =>
        set((state) => {
          state.accessToken = accessToken;
          state.refreshToken = refreshToken;
        }),

      // 登录
      login: (user, accessToken, refreshToken) =>
        set((state) => {
          state.user = user;
          state.accessToken = accessToken;
          state.refreshToken = refreshToken;
          state.isAuthenticated = true;
          state.isLoading = false;
        }),

      // 登出
      logout: () =>
        set((state) => {
          state.user = null;
          state.accessToken = null;
          state.refreshToken = null;
          state.isAuthenticated = false;
        }),

      // 更新用户信息
      updateUser: (updates) =>
        set((state) => {
          if (state.user) {
            Object.assign(state.user, updates);
          }
        }),

      // 设置加载状态
      setLoading: (loading) =>
        set((state) => {
          state.isLoading = loading;
        }),
    })),
    {
      name: 'auth-storage',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({
        user: state.user,
        accessToken: state.accessToken,
        refreshToken: state.refreshToken,
        isAuthenticated: state.isAuthenticated,
      }),
    }
  )
);
```

```tsx
// apps/admin/src/stores/uiStore.ts

import { create } from 'zustand';
import { immer } from 'zustand/middleware/immer';

/**
 * UI 状态接口
 */
interface UIState {
  // 侧边栏
  sidebarOpen: boolean;
  sidebarCollapsed: boolean;

  // 搜索
  searchOpen: boolean;
  searchQuery: string;

  // 模态框
  activeModal: string | null;
  modalData: any;

  // 通知
  notifications: Notification[];

  // 全局加载
  globalLoading: boolean;
  loadingText: string;

  // 操作
  toggleSidebar: () => void;
  setSidebarOpen: (open: boolean) => void;
  setSidebarCollapsed: (collapsed: boolean) => void;
  toggleSearch: () => void;
  setSearchQuery: (query: string) => void;
  openModal: (modalId: string, data?: any) => void;
  closeModal: () => void;
  addNotification: (notification: Omit<Notification, 'id'>) => void;
  removeNotification: (id: string) => void;
  setGlobalLoading: (loading: boolean, text?: string) => void;
}

interface Notification {
  id: string;
  type: 'success' | 'error' | 'warning' | 'info';
  title: string;
  message?: string;
  duration?: number;
}

/**
 * UI 状态 Store
 */
export const useUIStore = create<UIState>()(
  immer((set) => ({
    // 初始状态
    sidebarOpen: true,
    sidebarCollapsed: false,
    searchOpen: false,
    searchQuery: '',
    activeModal: null,
    modalData: null,
    notifications: [],
    globalLoading: false,
    loadingText: '',

    // 侧边栏操作
    toggleSidebar: () =>
      set((state) => {
        state.sidebarOpen = !state.sidebarOpen;
      }),

    setSidebarOpen: (open) =>
      set((state) => {
        state.sidebarOpen = open;
      }),

    setSidebarCollapsed: (collapsed) =>
      set((state) => {
        state.sidebarCollapsed = collapsed;
      }),

    // 搜索操作
    toggleSearch: () =>
      set((state) => {
        state.searchOpen = !state.searchOpen;
        if (!state.searchOpen) {
          state.searchQuery = '';
        }
      }),

    setSearchQuery: (query) =>
      set((state) => {
        state.searchQuery = query;
      }),

    // 模态框操作
    openModal: (modalId, data) =>
      set((state) => {
        state.activeModal = modalId;
        state.modalData = data;
      }),

    closeModal: () =>
      set((state) => {
        state.activeModal = null;
        state.modalData = null;
      }),

    // 通知操作
    addNotification: (notification) =>
      set((state) => {
        const id = `notification-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        state.notifications.push({ ...notification, id });
      }),

    removeNotification: (id) =>
      set((state) => {
        state.notifications = state.notifications.filter((n) => n.id !== id);
      }),

    // 全局加载
    setGlobalLoading: (loading, text = '') =>
      set((state) => {
        state.globalLoading = loading;
        state.loadingText = text;
      }),
  }))
);
```

```tsx
// apps/admin/src/stores/editorStore.ts

import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

/**
 * 编辑器状态接口
 */
interface EditorState {
  // 内容
  content: string;
  title: string;
  summary: string;
  coverImage: string | null;

  // 元数据
  categoryId: number | null;
  tagIds: number[];
  slug: string;
  status: 'draft' | 'published' | 'scheduled';
  scheduledAt: string | null;

  // 编辑器设置
  previewMode: 'edit' | 'preview' | 'split';
  autoSave: boolean;
  wordWrap: boolean;
  showLineNumbers: boolean;
  fontSize: number;

  // 状态
  isDirty: boolean;
  lastSavedAt: string | null;
  isAiPanelOpen: boolean;

  // 操作
  setContent: (content: string) => void;
  setTitle: (title: string) => void;
  setSummary: (summary: string) => void;
  setCoverImage: (url: string | null) => void;
  setCategory: (categoryId: number | null) => void;
  setTags: (tagIds: number[]) => void;
  addTag: (tagId: number) => void;
  removeTag: (tagId: number) => void;
  setSlug: (slug: string) => void;
  setStatus: (status: 'draft' | 'published' | 'scheduled') => void;
  setScheduledAt: (date: string | null) => void;
  setPreviewMode: (mode: 'edit' | 'preview' | 'split') => void;
  toggleAiPanel: () => void;
  setEditorSettings: (settings: Partial<EditorSettings>) => void;
  markAsSaved: () => void;
  resetEditor: () => void;
  loadPost: (post: PostData) => void;
}

interface EditorSettings {
  autoSave: boolean;
  wordWrap: boolean;
  showLineNumbers: boolean;
  fontSize: number;
}

interface PostData {
  content: string;
  title: string;
  summary?: string;
  coverImage?: string;
  categoryId?: number;
  tagIds?: number[];
  slug?: string;
  status?: 'draft' | 'published' | 'scheduled';
  scheduledAt?: string;
}

/**
 * 编辑器状态 Store
 */
export const useEditorStore = create<EditorState>()(
  persist(
    immer((set, get) => ({
      // 初始状态
      content: '',
      title: '',
      summary: '',
      coverImage: null,
      categoryId: null,
      tagIds: [],
      slug: '',
      status: 'draft',
      scheduledAt: null,
      previewMode: 'split',
      autoSave: true,
      wordWrap: true,
      showLineNumbers: true,
      fontSize: 14,
      isDirty: false,
      lastSavedAt: null,
      isAiPanelOpen: true,

      // 内容操作
      setContent: (content) =>
        set((state) => {
          state.content = content;
          state.isDirty = true;
        }),

      setTitle: (title) =>
        set((state) => {
          state.title = title;
          state.isDirty = true;
          // 自动生成 slug
          if (!state.slug) {
            state.slug = generateSlug(title);
          }
        }),

      setSummary: (summary) =>
        set((state) => {
          state.summary = summary;
          state.isDirty = true;
        }),

      setCoverImage: (url) =>
        set((state) => {
          state.coverImage = url;
          state.isDirty = true;
        }),

      // 分类标签操作
      setCategory: (categoryId) =>
        set((state) => {
          state.categoryId = categoryId;
          state.isDirty = true;
        }),

      setTags: (tagIds) =>
        set((state) => {
          state.tagIds = tagIds;
          state.isDirty = true;
        }),

      addTag: (tagId) =>
        set((state) => {
          if (!state.tagIds.includes(tagId)) {
            state.tagIds.push(tagId);
            state.isDirty = true;
          }
        }),

      removeTag: (tagId) =>
        set((state) => {
          state.tagIds = state.tagIds.filter((id) => id !== tagId);
          state.isDirty = true;
        }),

      // 其他操作
      setSlug: (slug) =>
        set((state) => {
          state.slug = slug;
          state.isDirty = true;
        }),

      setStatus: (status) =>
        set((state) => {
          state.status = status;
          state.isDirty = true;
        }),

      setScheduledAt: (date) =>
        set((state) => {
          state.scheduledAt = date;
          state.isDirty = true;
        }),

      setPreviewMode: (mode) =>
        set((state) => {
          state.previewMode = mode;
        }),

      toggleAiPanel: () =>
        set((state) => {
          state.isAiPanelOpen = !state.isAiPanelOpen;
        }),

      setEditorSettings: (settings) =>
        set((state) => {
          Object.assign(state, settings);
        }),

      markAsSaved: () =>
        set((state) => {
          state.isDirty = false;
          state.lastSavedAt = new Date().toISOString();
        }),

      resetEditor: () =>
        set((state) => {
          state.content = '';
          state.title = '';
          state.summary = '';
          state.coverImage = null;
          state.categoryId = null;
          state.tagIds = [];
          state.slug = '';
          state.status = 'draft';
          state.scheduledAt = null;
          state.isDirty = false;
          state.lastSavedAt = null;
        }),

      loadPost: (post) =>
        set((state) => {
          state.content = post.content;
          state.title = post.title;
          state.summary = post.summary || '';
          state.coverImage = post.coverImage || null;
          state.categoryId = post.categoryId || null;
          state.tagIds = post.tagIds || [];
          state.slug = post.slug || '';
          state.status = post.status || 'draft';
          state.scheduledAt = post.scheduledAt || null;
          state.isDirty = false;
        }),
    })),
    {
      name: 'editor-storage',
      partialize: (state) => ({
        previewMode: state.previewMode,
        autoSave: state.autoSave,
        wordWrap: state.wordWrap,
        showLineNumbers: state.showLineNumbers,
        fontSize: state.fontSize,
        isAiPanelOpen: state.isAiPanelOpen,
      }),
    }
  )
);

/**
 * 生成 URL Slug
 */
function generateSlug(title: string): string {
  return title
    .toLowerCase()
    .replace(/[^\w\s\u4e00-\u9fa5-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
    .trim();
}
```

#### 2.3.3.3 TanStack Query 配置

```tsx
// apps/admin/src/lib/queryClient.ts

import { QueryClient } from '@tanstack/react-query';

/**
 * 创建 Query Client 实例
 */
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // 默认缓存时间：5分钟
      staleTime: 5 * 60 * 1000,
      // 缓存垃圾回收时间：30分钟
      gcTime: 30 * 60 * 1000,
      // 失败重试次数
      retry: (failureCount, error: any) => {
        // 4xx 错误不重试
        if (error?.response?.status >= 400 && error?.response?.status < 500) {
          return false;
        }
        return failureCount < 3;
      },
      // 重试延迟
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
      // 窗口聚焦时重新获取
      refetchOnWindowFocus: false,
      // 重连时重新获取
      refetchOnReconnect: true,
    },
    mutations: {
      // 失败重试
      retry: 1,
      // 全局错误处理
      onError: (error: any) => {
        const message = error?.response?.data?.message || error?.message || '操作失败';
        toast.error(message);
      },
    },
  },
});

/**
 * Query Keys 工厂函数
 * 统一管理所有查询键，确保缓存一致性
 */
export const queryKeys = {
  // 文章相关
  posts: {
    all: ['posts'] as const,
    lists: () => [...queryKeys.posts.all, 'list'] as const,
    list: (filters: PostFilters) => [...queryKeys.posts.lists(), filters] as const,
    details: () => [...queryKeys.posts.all, 'detail'] as const,
    detail: (idOrSlug: string | number) => [...queryKeys.posts.details(), idOrSlug] as const,
  },

  // 分类相关
  categories: {
    all: ['categories'] as const,
    lists: () => [...queryKeys.categories.all, 'list'] as const,
    list: (filters?: CategoryFilters) => [...queryKeys.categories.lists(), filters] as const,
    detail: (id: number) => [...queryKeys.categories.all, 'detail', id] as const,
  },

  // 标签相关
  tags: {
    all: ['tags'] as const,
    lists: () => [...queryKeys.tags.all, 'list'] as const,
    list: (filters?: TagFilters) => [...queryKeys.tags.lists(), filters] as const,
    popular: () => [...queryKeys.tags.all, 'popular'] as const,
  },

  // 媒体相关
  media: {
    all: ['media'] as const,
    lists: () => [...queryKeys.media.all, 'list'] as const,
    list: (filters?: MediaFilters) => [...queryKeys.media.lists(), filters] as const,
    detail: (id: number) => [...queryKeys.media.all, 'detail', id] as const,
  },

  // 统计相关
  analytics: {
    all: ['analytics'] as const,
    overview: (period?: string) => [...queryKeys.analytics.all, 'overview', period] as const,
    visitors: (params?: AnalyticsParams) => [...queryKeys.analytics.all, 'visitors', params] as const,
    posts: (params?: AnalyticsParams) => [...queryKeys.analytics.all, 'posts', params] as const,
    geo: () => [...queryKeys.analytics.all, 'geo'] as const,
  },

  // 友链相关
  friends: {
    all: ['friends'] as const,
    lists: () => [...queryKeys.friends.all, 'list'] as const,
    detail: (id: number) => [...queryKeys.friends.all, 'detail', id] as const,
  },

  // 设置相关
  settings: {
    all: ['settings'] as const,
    site: () => [...queryKeys.settings.all, 'site'] as const,
    storage: () => [...queryKeys.settings.all, 'storage'] as const,
    ai: () => [...queryKeys.settings.all, 'ai'] as const,
  },

  // 用户相关
  user: {
    all: ['user'] as const,
    profile: () => [...queryKeys.user.all, 'profile'] as const,
  },

  // AI 相关
  ai: {
    all: ['ai'] as const,
    prompts: () => [...queryKeys.ai.all, 'prompts'] as const,
  },
};

// 类型定义
interface PostFilters {
  page?: number;
  size?: number;
  status?: string;
  categoryId?: number;
  tagIds?: number[];
  search?: string;
}

interface CategoryFilters {
  includePostCount?: boolean;
}

interface TagFilters {
  includePostCount?: boolean;
}

interface MediaFilters {
  page?: number;
  size?: number;
  type?: string;
}

interface AnalyticsParams {
  startDate?: string;
  endDate?: string;
  granularity?: 'hour' | 'day' | 'week' | 'month';
}
```

```tsx
// apps/admin/src/hooks/usePosts.ts

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';
import { postService } from '@/services/postService';
import type { Post, CreatePostRequest, UpdatePostRequest } from '@aetherblog/types';

/**
 * 文章列表查询 Hook
 */
export function usePostList(filters: PostFilters = {}) {
  return useQuery({
    queryKey: queryKeys.posts.list(filters),
    queryFn: () => postService.getList(filters),
    placeholderData: (previousData) => previousData,
  });
}

/**
 * 文章详情查询 Hook
 */
export function usePostDetail(idOrSlug: string | number) {
  return useQuery({
    queryKey: queryKeys.posts.detail(idOrSlug),
    queryFn: () => postService.getDetail(idOrSlug),
    enabled: !!idOrSlug,
  });
}

/**
 * 创建文章 Mutation Hook
 */
export function useCreatePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: CreatePostRequest) => postService.create(data),
    onSuccess: (newPost) => {
      // 使文章列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
      
      // 预填充新文章详情缓存
      queryClient.setQueryData(queryKeys.posts.detail(newPost.id), newPost);
      queryClient.setQueryData(queryKeys.posts.detail(newPost.slug), newPost);
    },
  });
}

/**
 * 更新文章 Mutation Hook
 */
export function useUpdatePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: number; data: UpdatePostRequest }) =>
      postService.update(id, data),
    onSuccess: (updatedPost, { id }) => {
      // 更新详情缓存
      queryClient.setQueryData(queryKeys.posts.detail(id), updatedPost);
      queryClient.setQueryData(queryKeys.posts.detail(updatedPost.slug), updatedPost);
      
      // 使列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
    },
  });
}

/**
 * 删除文章 Mutation Hook
 */
export function useDeletePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: number) => postService.delete(id),
    onSuccess: (_, id) => {
      // 移除详情缓存
      queryClient.removeQueries({ queryKey: queryKeys.posts.detail(id) });
      
      // 使列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
    },
  });
}

/**
 * 批量操作文章 Mutation Hook
 */
export function useBatchPostAction() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ ids, action }: { ids: number[]; action: 'delete' | 'publish' | 'draft' }) =>
      postService.batchAction(ids, action),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.all });
    },
  });
}

interface PostFilters {
  page?: number;
  size?: number;
  status?: string;
  categoryId?: number;
  tagIds?: number[];
  search?: string;
}
```

```tsx
// apps/admin/src/hooks/useAi.ts

import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';
import { aiService } from '@/services/aiService';

/**
 * AI 文本清洗 Mutation Hook
 */
export function useAiClean() {
  return useMutation({
    mutationFn: (text: string) => aiService.cleanText(text),
  });
}

/**
 * AI 内容重写 Mutation Hook
 */
export function useAiRewrite() {
  return useMutation({
    mutationFn: ({ text, style }: { text: string; style: string }) =>
      aiService.rewriteText(text, style),
  });
}

/**
 * AI 生成摘要 Mutation Hook
 */
export function useAiSummarize() {
  return useMutation({
    mutationFn: (content: string) => aiService.generateSummary(content),
  });
}

/**
 * AI 生成标签 Mutation Hook
 */
export function useAiTags() {
  return useMutation({
    mutationFn: (content: string) => aiService.generateTags(content),
  });
}

/**
 * AI 语义搜索 Mutation Hook
 */
export function useAiSearch() {
  return useMutation({
    mutationFn: (query: string) => aiService.semanticSearch(query),
  });
}

/**
 * Prompt 模板列表查询 Hook
 */
export function usePromptList() {
  return useQuery({
    queryKey: queryKeys.ai.prompts(),
    queryFn: () => aiService.getPrompts(),
  });
}

/**
 * 创建 Prompt 模板 Mutation Hook
 */
export function useCreatePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: CreatePromptRequest) => aiService.createPrompt(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

/**
 * 更新 Prompt 模板 Mutation Hook
 */
export function useUpdatePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdatePromptRequest }) =>
      aiService.updatePrompt(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

/**
 * 删除 Prompt 模板 Mutation Hook
 */
export function useDeletePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: string) => aiService.deletePrompt(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

interface CreatePromptRequest {
  name: string;
  description?: string;
  content: string;
  category?: string;
}

interface UpdatePromptRequest extends Partial<CreatePromptRequest> {}
```

### 2.3.4 前端视觉规范设计

#### 2.3.4.1 设计令牌 (Design Tokens)

```tsx
// packages/config/src/tailwind/tokens.ts

/**
 * AetherBlog 设计令牌
 * 
 * 基于 Apple/Microsoft 设计语言定义的设计系统变量
 */

/**
 * 颜色系统
 */
export const colors = {
  // 主色调 - 靛蓝紫
  primary: {
    50: '#eef2ff',
    100: '#e0e7ff',
    200: '#c7d2fe',
    300: '#a5b4fc',
    400: '#818cf8',
    500: '#6366f1',  // 主色
    600: '#4f46e5',
    700: '#4338ca',
    800: '#3730a3',
    900: '#312e81',
    950: '#1e1b4b',
  },

  // 次要色 - 紫色
  secondary: {
    50: '#faf5ff',
    100: '#f3e8ff',
    200: '#e9d5ff',
    300: '#d8b4fe',
    400: '#c084fc',
    500: '#a855f7',
    600: '#9333ea',
    700: '#7e22ce',
    800: '#6b21a8',
    900: '#581c87',
    950: '#3b0764',
  },

  // 强调色 - 青色
  accent: {
    50: '#ecfeff',
    100: '#cffafe',
    200: '#a5f3fc',
    300: '#67e8f9',
    400: '#22d3ee',
    500: '#06b6d4',
    600: '#0891b2',
    700: '#0e7490',
    800: '#155e75',
    900: '#164e63',
    950: '#083344',
  },

  // 灰度 - 暗色主题优化
  gray: {
    50: '#f9fafb',
    100: '#f3f4f6',
    200: '#e5e7eb',
    300: '#d1d5db',
    400: '#9ca3af',
    500: '#6b7280',
    600: '#4b5563',
    700: '#374151',
    800: '#1f2937',
    900: '#111827',
    950: '#030712',
  },

  // 语义色
  success: {
    light: '#22c55e',
    DEFAULT: '#16a34a',
    dark: '#15803d',
  },
  warning: {
    light: '#fbbf24',
    DEFAULT: '#f59e0b',
    dark: '#d97706',
  },
  error: {
    light: '#f87171',
    DEFAULT: '#ef4444',
    dark: '#dc2626',
  },
  info: {
    light: '#60a5fa',
    DEFAULT: '#3b82f6',
    dark: '#2563eb',
  },
};

/**
 * 排版系统
 */
export const typography = {
  // 字体族
  fontFamily: {
    sans: [
      'Inter',
      '-apple-system',
      'BlinkMacSystemFont',
      '"Segoe UI"',
      'Roboto',
      '"Helvetica Neue"',
      'Arial',
      '"Noto Sans SC"',
      'sans-serif',
    ],
    mono: [
      'JetBrains Mono',
      'Fira Code',
      'Monaco',
      'Consolas',
      '"Liberation Mono"',
      '"Courier New"',
      'monospace',
    ],
    serif: [
      '"Noto Serif SC"',
      'Georgia',
      '"Times New Roman"',
      'serif',
    ],
  },

  // 字号
  fontSize: {
    xs: ['0.75rem', { lineHeight: '1rem' }],
    sm: ['0.875rem', { lineHeight: '1.25rem' }],
    base: ['1rem', { lineHeight: '1.5rem' }],
    lg: ['1.125rem', { lineHeight: '1.75rem' }],
    xl: ['1.25rem', { lineHeight: '1.75rem' }],
    '2xl': ['1.5rem', { lineHeight: '2rem' }],
    '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
    '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
    '5xl': ['3rem', { lineHeight: '1' }],
    '6xl': ['3.75rem', { lineHeight: '1' }],
    '7xl': ['4.5rem', { lineHeight: '1' }],
  },

  // 字重
  fontWeight: {
    thin: '100',
    light: '300',
    normal: '400',
    medium: '500',
    semibold: '600',
    bold: '700',
    extrabold: '800',
    black: '900',
  },

  // 行高
  lineHeight: {
    none: '1',
    tight: '1.25',
    snug: '1.375',
    normal: '1.5',
    relaxed: '1.625',
    loose: '2',
  },

  // 字间距
  letterSpacing: {
    tighter: '-0.05em',
    tight: '-0.025em',
    normal: '0em',
    wide: '0.025em',
    wider: '0.05em',
    widest: '0.1em',
  },
};

/**
 * 间距系统
 */
export const spacing = {
  px: '1px',
  0: '0px',
  0.5: '0.125rem',
  1: '0.25rem',
  1.5: '0.375rem',
  2: '0.5rem',
  2.5: '0.625rem',
  3: '0.75rem',
  3.5: '0.875rem',
  4: '1rem',
  5: '1.25rem',
  6: '1.5rem',
  7: '1.75rem',
  8: '2rem',
  9: '2.25rem',
  10: '2.5rem',
  11: '2.75rem',
  12: '3rem',
  14: '3.5rem',
  16: '4rem',
  20: '5rem',
  24: '6rem',
  28: '7rem',
  32: '8rem',
  36: '9rem',
  40: '10rem',
  44: '11rem',
  48: '12rem',
  52: '13rem',
  56: '14rem',
  60: '15rem',
  64: '16rem',
  72: '18rem',
  80: '20rem',
  96: '24rem',
};

/**
 * 阴影系统
 */
export const shadows = {
  sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
  DEFAULT: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
  md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
  lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
  xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',
  '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',
  inner: 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)',
  none: 'none',

  // 彩色阴影
  'primary-sm': '0 2px 8px -2px rgba(99, 102, 241, 0.3)',
  'primary-md': '0 4px 16px -4px rgba(99, 102, 241, 0.4)',
  'primary-lg': '0 8px 24px -6px rgba(99, 102, 241, 0.5)',

  // 毛玻璃阴影
  'glass-sm': '0 2px 8px 0 rgba(0, 0, 0, 0.1)',
  'glass-md': '0 4px 16px 0 rgba(0, 0, 0, 0.15)',
  'glass-lg': '0 8px 32px 0 rgba(0, 0, 0, 0.2)',
};

/**
 * 圆角系统
 */
export const borderRadius = {
  none: '0px',
  sm: '0.125rem',
  DEFAULT: '0.25rem',
  md: '0.375rem',
  lg: '0.5rem',
  xl: '0.75rem',
  '2xl': '1rem',
  '3xl': '1.5rem',
  full: '9999px',
};

/**
 * 动画系统
 */
export const animation = {
  // 动画时长
  duration: {
    75: '75ms',
    100: '100ms',
    150: '150ms',
    200: '200ms',
    300: '300ms',
    500: '500ms',
    700: '700ms',
    1000: '1000ms',
  },

  // 缓动函数
  easing: {
    linear: 'linear',
    in: 'cubic-bezier(0.4, 0, 1, 1)',
    out: 'cubic-bezier(0, 0, 0.2, 1)',
    'in-out': 'cubic-bezier(0.4, 0, 0.2, 1)',
    // Apple 风格缓动
    'apple-ease': 'cubic-bezier(0.25, 0.1, 0.25, 1)',
    'apple-spring': 'cubic-bezier(0.5, 1.5, 0.5, 1)',
    // 弹性缓动
    bounce: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
  },

  // 预设动画
  keyframes: {
    fadeIn: {
      from: { opacity: '0' },
      to: { opacity: '1' },
    },
    fadeOut: {
      from: { opacity: '1' },
      to: { opacity: '0' },
    },
    slideInUp: {
      from: { transform: 'translateY(10px)', opacity: '0' },
      to: { transform: 'translateY(0)', opacity: '1' },
    },
    slideInDown: {
      from: { transform: 'translateY(-10px)', opacity: '0' },
      to: { transform: 'translateY(0)', opacity: '1' },
    },
    scaleIn: {
      from: { transform: 'scale(0.95)', opacity: '0' },
      to: { transform: 'scale(1)', opacity: '1' },
    },
    pulse: {
      '0%, 100%': { opacity: '1' },
      '50%': { opacity: '0.5' },
    },
    shimmer: {
      from: { backgroundPosition: '-200% 0' },
      to: { backgroundPosition: '200% 0' },
    },
  },
};

/**
 * 断点系统
 */
export const breakpoints = {
  sm: '640px',
  md: '768px',
  lg: '1024px',
  xl: '1280px',
  '2xl': '1536px',
};

/**
 * Z-Index 层级系统
 */
export const zIndex = {
  hide: -1,
  auto: 'auto',
  base: 0,
  docked: 10,
  dropdown: 1000,
  sticky: 1100,
  banner: 1200,
  overlay: 1300,
  modal: 1400,
  popover: 1500,
  skipLink: 1600,
  toast: 1700,
  tooltip: 1800,
};
```

#### 2.3.4.2 Tailwind 配置预设

```tsx
// packages/config/src/tailwind/preset.ts

import type { Config } from 'tailwindcss';
import { colors, typography, spacing, shadows, borderRadius, animation, breakpoints, zIndex } from './tokens';

/**
 * AetherBlog Tailwind CSS 预设
 */
export const aetherblogPreset: Partial<Config> = {
  darkMode: 'class',
  theme: {
    extend: {
      // 颜色
      colors: {
        primary: colors.primary,
        secondary: colors.secondary,
        accent: colors.accent,
        gray: colors.gray,
        success: colors.success,
        warning: colors.warning,
        error: colors.error,
        info: colors.info,
      },

      // 字体
      fontFamily: typography.fontFamily,
      fontSize: typography.fontSize,
      fontWeight: typography.fontWeight,
      lineHeight: typography.lineHeight,
      letterSpacing: typography.letterSpacing,

      // 间距
      spacing,

      // 阴影
      boxShadow: shadows,

      // 圆角
      borderRadius,

      // 动画
      transitionDuration: animation.duration,
      transitionTimingFunction: animation.easing,
      keyframes: animation.keyframes,
      animation: {
        'fade-in': 'fadeIn 0.2s ease-out',
        'fade-out': 'fadeOut 0.2s ease-out',
        'slide-in-up': 'slideInUp 0.3s ease-out',
        'slide-in-down': 'slideInDown 0.3s ease-out',
        'scale-in': 'scaleIn 0.2s ease-out',
        pulse: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        shimmer: 'shimmer 2s linear infinite',
      },

      // 断点
      screens: breakpoints,

      // Z-Index
      zIndex,

      // 背景图片（用于毛玻璃效果）
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
        'glass-gradient': 'linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%)',
        'mesh-gradient': `
          radial-gradient(at 40% 20%, hsla(228,100%,74%,0.2) 0px, transparent 50%),
          radial-gradient(at 80% 0%, hsla(189,100%,56%,0.15) 0px, transparent 50%),
          radial-gradient(at 0% 50%, hsla(355,100%,93%,0.1) 0px, transparent 50%),
          radial-gradient(at 80% 50%, hsla(340,100%,76%,0.1) 0px, transparent 50%),
          radial-gradient(at 0% 100%, hsla(22,100%,77%,0.1) 0px, transparent 50%),
          radial-gradient(at 80% 100%, hsla(242,100%,70%,0.15) 0px, transparent 50%)
        `,
      },

      // 背景模糊（毛玻璃效果增强）
      backdropBlur: {
        xs: '2px',
        '3xl': '64px',
      },

      // 边框透明度
      borderOpacity: {
        10: '0.1',
        15: '0.15',
        20: '0.2',
      },
    },
  },
  plugins: [
    // 官方插件
    require('@tailwindcss/typography'),
    require('@tailwindcss/forms'),
    require('@tailwindcss/container-queries'),

    // 自定义插件
    require('./plugins/glass'),
    require('./plugins/animations'),
  ],
};

export default aetherblogPreset;
```

```tsx
// packages/config/src/tailwind/plugins/glass.ts

import plugin from 'tailwindcss/plugin';

/**
 * 毛玻璃效果插件
 */
export default plugin(function ({ addComponents, theme }) {
  addComponents({
    // 毛玻璃卡片
    '.glass': {
      backgroundColor: 'rgba(255, 255, 255, 0.05)',
      backdropFilter: 'blur(16px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
    },
    '.glass-sm': {
      backgroundColor: 'rgba(255, 255, 255, 0.03)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.05)',
    },
    '.glass-lg': {
      backgroundColor: 'rgba(255, 255, 255, 0.08)',
      backdropFilter: 'blur(24px)',
      border: '1px solid rgba(255, 255, 255, 0.15)',
    },
    '.glass-xl': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(32px)',
      border: '1px solid rgba(255, 255, 255, 0.2)',
    },

    // 毛玻璃导航栏
    '.glass-nav': {
      backgroundColor: 'rgba(17, 24, 39, 0.8)',
      backdropFilter: 'blur(12px) saturate(180%)',
      borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
    },

    // 毛玻璃模态框
    '.glass-modal': {
      backgroundColor: 'rgba(17, 24, 39, 0.95)',
      backdropFilter: 'blur(24px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
    },

    // 毛玻璃输入框
    '.glass-input': {
      backgroundColor: 'rgba(255, 255, 255, 0.05)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      '&:focus': {
        backgroundColor: 'rgba(255, 255, 255, 0.08)',
        borderColor: 'rgba(99, 102, 241, 0.5)',
        boxShadow: '0 0 0 3px rgba(99, 102, 241, 0.1)',
      },
    },

    // 毛玻璃按钮
    '.glass-button': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      transition: 'all 0.2s ease',
      '&:hover': {
        backgroundColor: 'rgba(255, 255, 255, 0.15)',
        borderColor: 'rgba(255, 255, 255, 0.2)',
      },
      '&:active': {
        backgroundColor: 'rgba(255, 255, 255, 0.2)',
      },
    },

    // 毛玻璃徽章
    '.glass-badge': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(4px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
    },

    // 光晕效果
    '.glow': {
      boxShadow: '0 0 20px rgba(99, 102, 241, 0.3)',
    },
    '.glow-sm': {
      boxShadow: '0 0 10px rgba(99, 102, 241, 0.2)',
    },
    '.glow-lg': {
      boxShadow: '0 0 40px rgba(99, 102, 241, 0.4)',
    },

    // 悬浮光效
    '.hover-glow': {
      transition: 'box-shadow 0.3s ease',
      '&:hover': {
        boxShadow: '0 0 30px rgba(99, 102, 241, 0.3)',
      },
    },

    // 渐变边框
    '.gradient-border': {
      position: 'relative',
      '&::before': {
        content: '""',
        position: 'absolute',
        inset: '0',
        padding: '1px',
        borderRadius: 'inherit',
        background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.5), rgba(168, 85, 247, 0.5))',
        mask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)',
        maskComposite: 'xor',
        '-webkit-mask-composite': 'xor',
        pointerEvents: 'none',
      },
    },
  });
});
```

```tsx
// packages/config/src/tailwind/plugins/animations.ts

import plugin from 'tailwindcss/plugin';

/**
 * 动画效果插件
 */
export default plugin(function ({ addUtilities, addComponents, matchUtilities, theme }) {
  // 添加动画工具类
  addUtilities({
    // 动画延迟
    '.animation-delay-100': { animationDelay: '100ms' },
    '.animation-delay-200': { animationDelay: '200ms' },
    '.animation-delay-300': { animationDelay: '300ms' },
    '.animation-delay-500': { animationDelay: '500ms' },
    '.animation-delay-700': { animationDelay: '700ms' },
    '.animation-delay-1000': { animationDelay: '1000ms' },

    // 动画填充模式
    '.animation-fill-forwards': { animationFillMode: 'forwards' },
    '.animation-fill-backwards': { animationFillMode: 'backwards' },
    '.animation-fill-both': { animationFillMode: 'both' },

    // 动画播放状态
    '.animation-paused': { animationPlayState: 'paused' },
    '.animation-running': { animationPlayState: 'running' },

    // 动画方向
    '.animation-reverse': { animationDirection: 'reverse' },
    '.animation-alternate': { animationDirection: 'alternate' },

    // 交互时暂停动画
    '.hover-pause': {
      '&:hover': { animationPlayState: 'paused' },
    },
  });

  // 添加预设动画组件
  addComponents({
    // 淡入上滑
    '.animate-fade-in-up': {
      animation: 'fadeInUp 0.5s ease-out forwards',
    },

    // 淡入下滑
    '.animate-fade-in-down': {
      animation: 'fadeInDown 0.5s ease-out forwards',
    },

    // 缩放淡入
    '.animate-scale-in': {
      animation: 'scaleIn 0.3s ease-out forwards',
    },

    // 弹性进入
    '.animate-bounce-in': {
      animation: 'bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards',
    },

    // 脉冲呼吸
    '.animate-pulse-slow': {
      animation: 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
    },

    // 浮动效果
    '.animate-float': {
      animation: 'float 3s ease-in-out infinite',
    },

    // 闪烁效果
    '.animate-shimmer': {
      animation: 'shimmer 2s linear infinite',
      backgroundImage: 'linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent)',
      backgroundSize: '200% 100%',
    },

    // 打字机效果占位
    '.animate-typing': {
      overflow: 'hidden',
      whiteSpace: 'nowrap',
      borderRight: '2px solid',
      animation: 'typing 3s steps(40, end), blink 0.75s step-end infinite',
    },

    // 骨架屏加载
    '.skeleton': {
      background: 'linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%)',
      backgroundSize: '200% 100%',
      animation: 'shimmer 1.5s infinite',
    },

    // 波纹效果
    '.ripple': {
      position: 'relative',
      overflow: 'hidden',
      '&::after': {
        content: '""',
        position: 'absolute',
        top: '50%',
        left: '50%',
        width: '0',
        height: '0',
        borderRadius: '50%',
        backgroundColor: 'rgba(255, 255, 255, 0.3)',
        transform: 'translate(-50%, -50%)',
        transition: 'width 0.6s ease, height 0.6s ease',
      },
      '&:active::after': {
        width: '200%',
        height: '200%',
      },
    },
  });

  // 添加额外的关键帧
  addUtilities({
    '@keyframes fadeInUp': {
      from: {
        opacity: '0',
        transform: 'translateY(20px)',
      },
      to: {
        opacity: '1',
        transform: 'translateY(0)',
      },
    },
    '@keyframes fadeInDown': {
      from: {
        opacity: '0',
        transform: 'translateY(-20px)',
      },
      to: {
        opacity: '1',
        transform: 'translateY(0)',
      },
    },
    '@keyframes bounceIn': {
      '0%': {
        opacity: '0',
        transform: 'scale(0.3)',
      },
      '50%': {
        transform: 'scale(1.05)',
      },
      '70%': {
        transform: 'scale(0.9)',
      },
      '100%': {
        opacity: '1',
        transform: 'scale(1)',
      },
    },
    '@keyframes float': {
      '0%, 100%': {
        transform: 'translateY(0)',
      },
      '50%': {
        transform: 'translateY(-10px)',
      },
    },
    '@keyframes typing': {
      from: { width: '0' },
      to: { width: '100%' },
    },
    '@keyframes blink': {
      '50%': { borderColor: 'transparent' },
    },
  });

  // 动态动画延迟
  matchUtilities(
    {
      'animate-delay': (value) => ({
        animationDelay: value,
      }),
    },
    { values: theme('transitionDelay') }
  );

  // 动态动画时长
  matchUtilities(
    {
      'animate-duration': (value) => ({
        animationDuration: value,
      }),
    },
    { values: theme('transitionDuration') }
  );
});
```

---

## 2.4 后端技术栈详解

### 2.4.1 后端项目结构

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        后端项目完整目录结构                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   server/                                              # 🚀 后端服务 (Spring Boot)                      │
│   │                                                                                                      │
│   ├── aetherblog-app/                                  # 🚀 应用启动模块（入口）                         │
│   │   ├── src/main/java/com/aetherblog/                │
│   │   │   └── AetherBlogApplication.java              #    └─ 唯一启动类                                │
│   │   └── pom.xml                                      #    └─ 可执行 JAR 打包配置                       │
│   │                                                                                                      │
│   ├── aetherblog-api/                                  # 📦 API 接口定义、DTO、VO                         │
│   │   ├── src/main/java/com/aetherblog/api/           │
│   │   └── pom.xml                                      #    └─ 库打包                                    │
│   │                                                                                                      │
│   ├── aetherblog-common/                               # 🔧 公共模块 (POM 聚合)                          │
│   │   ├── common-core/                                 #    ├─ 核心工具类                                │
│   │   ├── common-security/                             #    ├─ 安全认证                                  │
│   │   ├── common-redis/                                #    ├─ Redis 缓存                                │
│   │   └── common-log/                                  #    └─ 日志管理                                  │
│   │                                                                                                      │
│   ├── aetherblog-service/                              # 💼 业务服务模块 (POM 聚合)                      │
│   │   └── blog-service/                                #    └─ 博客核心服务                              │
│   │                                                                                                      │
│   ├── aetherblog-ai/                                   # 🤖 AI 模块（历史遗留，已弃用）                   │
│   │   └── ...                                          # 旧内嵌方案留存备查                              │
│   │                                                                                                      │
│   ├── ai-service/                                      # 🤖 独立 AI 服务 (FastAPI + LiteLLM)              │
│   │   ├── app/                                         # FastAPI 应用                                     │
│   │   ├── config/                                      # LLM 路由配置                                     │
│   │   ├── Dockerfile                                   # 服务镜像                                        │
│   │   └── pyproject.toml                               # Python 依赖                                     │
│   │                                                                                                      │
│   ├── aetherblog-gateway/                              # 🚪 API网关（可选）                              │
│   │   └── ...                                                                                            │
│   │                                                                                                      │
│   ├── deploy/                                          # 🐳 部署配置                                     │
│   │   ├── docker/                                      # Docker配置                                      │
│   │   │   ├── Dockerfile                               # 应用Dockerfile                                  │
│   │   │   ├── Dockerfile.dev                           # 开发Dockerfile                                  │
│   │   │   └── docker-compose.yml                       # Docker Compose                                  │
│   │   ├── k8s/                                         # Kubernetes配置                                  │
│   │   │   ├── deployment.yaml                          # 部署配置                                        │
│   │   │   ├── service.yaml                             # 服务配置                                        │
│   │   │   ├── configmap.yaml                           # 配置映射                                        │
│   │   │   ├── secret.yaml                              # 密钥配置                                        │
│   │   │   └── ingress.yaml                             # 入口配置                                        │
│   │   └── nginx/                                       # Nginx配置                                       │
│   │       └── nginx.conf                               # Nginx配置文件                                   │
│   │                                                                                                      │
│   └── docs/                                            # 📚 文档                                         │
│       ├── api/                                         # API文档                                         │
│       ├── architecture/                                # 架构文档                                        │
│       └── deployment/                                  # 部署文档                                        │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4.2 核心代码实现

#### 2.4.2.1 统一响应封装

```java
// aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/domain/R.java

package com.aetherblog.common.core.domain;

import com.aetherblog.common.core.enums.ResultCode;
import com.fasterxml.jackson.annotation.JsonInclude;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.experimental.Accessors;

import java.io.Serializable;
import java.time.Instant;

/**
 * 统一API响应结果封装
 *
 * @param <T> 数据类型
 */
@Data
@Accessors(chain = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
@Schema(description = "统一响应结果")
public class R<T> implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 状态码
     */
    @Schema(description = "状态码", example = "200")
    private int code;

    /**
     * 消息
     */
    @Schema(description = "消息", example = "操作成功")
    private String message;

    /**
     * 数据
     */
    @Schema(description = "响应数据")
    private T data;

    /**
     * 时间戳
     */
    @Schema(description = "时间戳")
    private long timestamp;

    /**
     * 链路追踪ID
     */
    @Schema(description = "链路追踪ID")
    private String traceId;

    /**
     * 分页信息
     */
    @Schema(description = "分页信息")
    private PageInfo page;

    public R() {
        this.timestamp = Instant.now().toEpochMilli();
    }

    // ==================== 成功响应 ====================

    public static <T> R<T> ok() {
        return ok(null);
    }

    public static <T> R<T> ok(T data) {
        return ok(data, ResultCode.SUCCESS.getMessage());
    }

    public static <T> R<T> ok(T data, String message) {
        return new R<T>()
                .setCode(ResultCode.SUCCESS.getCode())
                .setMessage(message)
                .setData(data);
    }

    public static <T> R<T> page(T data, PageInfo pageInfo) {
        return new R<T>()
                .setCode(ResultCode.SUCCESS.getCode())
                .setMessage(ResultCode.SUCCESS.getMessage())
                .setData(data)
                .setPage(pageInfo);
    }

    // ==================== 失败响应 ====================

    public static <T> R<T> fail() {
        return fail(ResultCode.INTERNAL_ERROR);
    }

    public static <T> R<T> fail(String message) {
        return fail(ResultCode.INTERNAL_ERROR.getCode(), message);
    }

    public static <T> R<T> fail(ResultCode resultCode) {
        return fail(resultCode.getCode(), resultCode.getMessage());
    }

    public static <T> R<T> fail(int code, String message) {
        return new R<T>()
                .setCode(code)
                .setMessage(message);
    }

    public static <T> R<T> fail(ResultCode resultCode, String message) {
        return fail(resultCode.getCode(), message);
    }

    // ==================== 判断方法 ====================

    public boolean isSuccess() {
        return this.code == ResultCode.SUCCESS.getCode();
    }

    public boolean isFail() {
        return !isSuccess();
    }

    // ==================== 分页信息内部类 ====================

    @Data
    @Schema(description = "分页信息")
    public static class PageInfo implements Serializable {
        
        @Schema(description = "当前页码", example = "1")
        private int page;
        
        @Schema(description = "每页大小", example = "10")
        private int size;
        
        @Schema(description = "总记录数", example = "100")
        private long total;
        
        @Schema(description = "总页数", example = "10")
        private int totalPages;
        
        @Schema(description = "是否有下一页")
        private boolean hasNext;
        
        @Schema(description = "是否有上一页")
        private boolean hasPrevious;

        public static PageInfo of(int page, int size, long total) {
            PageInfo pageInfo = new PageInfo();
            pageInfo.setPage(page);
            pageInfo.setSize(size);
            pageInfo.setTotal(total);
            pageInfo.setTotalPages((int) Math.ceil((double) total / size));
            pageInfo.setHasNext(page < pageInfo.getTotalPages());
            pageInfo.setHasPrevious(page > 1);
            return pageInfo;
        }
    }
}
```

#### 2.4.2.2 全局异常处理器

```java
// aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/exception/GlobalExceptionHandler.java

package com.aetherblog.common.core.exception;

import com.aetherblog.common.core.domain.R;
import com.aetherblog.common.core.enums.ResultCode;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.validation.ConstraintViolation;
import jakarta.validation.ConstraintViolationException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.converter.HttpMessageNotReadableException;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.core.AuthenticationException;
import org.springframework.validation.BindException;
import org.springframework.validation.FieldError;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.MissingServletRequestParameterException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;
import org.springframework.web.multipart.MaxUploadSizeExceededException;
import org.springframework.web.servlet.NoHandlerFoundException;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

/**
 * 全局异常处理器
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * 业务异常
     */
    @ExceptionHandler(BusinessException.class)
    @ResponseStatus(HttpStatus.OK)
    public R<Void> handleBusinessException(BusinessException e, HttpServletRequest request) {
        log.warn("业务异常: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(e.getCode(), e.getMessage());
    }

    /**
     * 认证异常
     */
    @ExceptionHandler(AuthException.class)
    @ResponseStatus(HttpStatus.UNAUTHORIZED)
    public R<Void> handleAuthException(AuthException e, HttpServletRequest request) {
        log.warn("认证异常: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(ResultCode.UNAUTHORIZED, e.getMessage());
    }

    /**
     * Spring Security 认证异常
     */
    @ExceptionHandler(AuthenticationException.class)
    @ResponseStatus(HttpStatus.UNAUTHORIZED)
    public R<Void> handleAuthenticationException(AuthenticationException e, HttpServletRequest request) {
        log.warn("认证失败: {} - {}", request.getRequestURI(), e.getMessage());
        String message = e instanceof BadCredentialsException ? "用户名或密码错误" : "认证失败";
        return R.fail(ResultCode.UNAUTHORIZED, message);
    }

    /**
     * 访问拒绝异常
     */
    @ExceptionHandler(AccessDeniedException.class)
    @ResponseStatus(HttpStatus.FORBIDDEN)
    public R<Void> handleAccessDeniedException(AccessDeniedException e, HttpServletRequest request) {
        log.warn("访问拒绝: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(ResultCode.FORBIDDEN, "没有权限访问该资源");
    }

    /**
     * 参数校验异常 - @Valid
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        List<FieldError> fieldErrors = e.getBindingResult().getFieldErrors();
        String message = fieldErrors.stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining("; "));
        log.warn("参数校验失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 参数校验异常 - @Validated
     */
    @ExceptionHandler(ConstraintViolationException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleConstraintViolationException(ConstraintViolationException e) {
        Set<ConstraintViolation<?>> violations = e.getConstraintViolations();
        String message = violations.stream()
                .map(ConstraintViolation::getMessage)
                .collect(Collectors.joining("; "));
        log.warn("约束校验失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 参数绑定异常
     */
    @ExceptionHandler(BindException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleBindException(BindException e) {
        String message = e.getFieldErrors().stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining("; "));
        log.warn("参数绑定失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 缺少请求参数
     */
    @ExceptionHandler(MissingServletRequestParameterException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMissingServletRequestParameterException(MissingServletRequestParameterException e) {
        log.warn("缺少请求参数: {}", e.getParameterName());
        return R.fail(ResultCode.BAD_REQUEST, "缺少必要参数: " + e.getParameterName());
    }

    /**
     * 参数类型不匹配
     */
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMethodArgumentTypeMismatchException(MethodArgumentTypeMismatchException e) {
        log.warn("参数类型不匹配: {} - {}", e.getName(), e.getValue());
        return R.fail(ResultCode.BAD_REQUEST, "参数类型错误: " + e.getName());
    }

    /**
     * 请求体解析异常
     */
    @ExceptionHandler(HttpMessageNotReadableException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleHttpMessageNotReadableException(HttpMessageNotReadableException e) {
        log.warn("请求体解析失败: {}", e.getMessage());
        return R.fail(ResultCode.BAD_REQUEST, "请求体格式错误");
    }

    /**
     * 不支持的请求方法
     */
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    @ResponseStatus(HttpStatus.METHOD_NOT_ALLOWED)
    public R<Void> handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException e) {
        log.warn("不支持的请求方法: {}", e.getMethod());
        return R.fail(405, "不支持的请求方法: " + e.getMethod());
    }

    /**
     * 不支持的媒体类型
     */
    @ExceptionHandler(HttpMediaTypeNotSupportedException.class)
    @ResponseStatus(HttpStatus.UNSUPPORTED_MEDIA_TYPE)
    public R<Void> handleHttpMediaTypeNotSupportedException(HttpMediaTypeNotSupportedException e) {
        log.warn("不支持的媒体类型: {}", e.getContentType());
        return R.fail(415, "不支持的媒体类型");
    }

    /**
     * 404 异常
     */
    @ExceptionHandler(NoHandlerFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public R<Void> handleNoHandlerFoundException(NoHandlerFoundException e) {
        log.warn("资源不存在: {}", e.getRequestURL());
        return R.fail(ResultCode.NOT_FOUND, "请求的资源不存在");
    }

    /**
     * 文件上传大小超限
     */
    @ExceptionHandler(MaxUploadSizeExceededException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMaxUploadSizeExceededException(MaxUploadSizeExceededException e) {
        log.warn("文件上传超限: {}", e.getMessage());
        return R.fail(ResultCode.FILE_SIZE_EXCEEDED, "上传文件大小超过限制");
    }

    /**
     * 其他未知异常
     */
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public R<Void> handleException(Exception e, HttpServletRequest request) {
        log.error("系统异常: {} - {}", request.getRequestURI(), e.getMessage(), e);
        return R.fail(ResultCode.INTERNAL_ERROR, "系统繁忙，请稍后再试");
    }
}
```

#### 2.4.2.3 JWT 服务实现

```java
// aetherblog-common/common-security/src/main/java/com/aetherblog/common/security/service/JwtService.java

package com.aetherblog.common.security.service;

import com.aetherblog.common.security.config.JwtConfig;
import com.aetherblog.common.security.domain.JwtPayload;
import com.aetherblog.common.security.domain.LoginUser;
import com.aetherblog.common.security.domain.TokenPair;
import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import io.jsonwebtoken.security.SignatureException;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.time.Instant;
import java.util.Date;
import java.util.UUID;

/**
 * JWT 服务
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class JwtService {

    private final JwtConfig jwtConfig;

    /**
     * 获取签名密钥
     */
    private SecretKey getSigningKey() {
        return Keys.hmacShaKeyFor(jwtConfig.getSecret().getBytes(StandardCharsets.UTF_8));
    }

    /**
     * 生成 Token 对（Access Token + Refresh Token）
     */
    public TokenPair generateTokenPair(LoginUser loginUser) {
        Instant now = Instant.now();
        
        // 生成 Access Token
        String accessToken = generateAccessToken(loginUser, now);
        
        // 生成 Refresh Token
        String refreshToken = generateRefreshToken(loginUser.getUserId(), now);
        
        return TokenPair.builder()
                .accessToken(accessToken)
                .refreshToken(refreshToken)
                .accessTokenExpireIn(jwtConfig.getAccessTokenExpiration())
                .refreshTokenExpireIn(jwtConfig.getRefreshTokenExpiration())
                .tokenType("Bearer")
                .build();
    }

    /**
     * 生成 Access Token
     */
    private String generateAccessToken(LoginUser loginUser, Instant now) {
        Instant expiration = now.plusSeconds(jwtConfig.getAccessTokenExpiration());
        
        return Jwts.builder()
                .header()
                    .type("JWT")
                    .and()
                .id(UUID.randomUUID().toString())
                .subject(loginUser.getUserId().toString())
                .claim("username", loginUser.getUsername())
                .claim("roles", loginUser.getRoles())
                .claim("type", "access")
                .issuer(jwtConfig.getIssuer())
                .issuedAt(Date.from(now))
                .expiration(Date.from(expiration))
                .signWith(getSigningKey(), Jwts.SIG.HS256)
                .compact();
    }

    /**
     * 生成 Refresh Token
     */
    private String generateRefreshToken(Long userId, Instant now) {
        Instant expiration = now.plusSeconds(jwtConfig.getRefreshTokenExpiration());
        
        return Jwts.builder()
                .id(UUID.randomUUID().toString())
                .subject(userId.toString())
                .claim("type", "refresh")
                .issuer(jwtConfig.getIssuer())
                .issuedAt(Date.from(now))
                .expiration(Date.from(expiration))
                .signWith(getSigningKey(), Jwts.SIG.HS256)
                .compact();
    }

    /**
     * 解析 Token
     */
    public JwtPayload parseToken(String token) {
        try {
            Claims claims = Jwts.parser()
                    .verifyWith(getSigningKey())
                    .requireIssuer(jwtConfig.getIssuer())
                    .build()
                    .parseSignedClaims(token)
                    .getPayload();

            return JwtPayload.builder()
                    .jti(claims.getId())
                    .userId(Long.parseLong(claims.getSubject()))
                    .username(claims.get("username", String.class))
                    .roles(claims.get("roles", java.util.List.class))
                    .type(claims.get("type", String.class))
                    .issuedAt(claims.getIssuedAt().toInstant())
                    .expiration(claims.getExpiration().toInstant())
                    .build();
        } catch (ExpiredJwtException e) {
            log.warn("Token已过期: {}", e.getMessage());
            throw new TokenExpiredException("Token已过期，请重新登录");
        } catch (SignatureException e) {
            log.warn("Token签名无效: {}", e.getMessage());
            throw new InvalidTokenException("无效的Token");
        } catch (MalformedJwtException e) {
            log.warn("Token格式错误: {}", e.getMessage());
            throw new InvalidTokenException("Token格式错误");
        } catch (Exception e) {
            log.error("Token解析失败: {}", e.getMessage());
            throw new InvalidTokenException("Token解析失败");
        }
    }

    /**
     * 验证 Token 是否有效
     */
    public boolean validateToken(String token) {
        try {
            parseToken(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 判断 Token 是否为 Access Token
     */
    public boolean isAccessToken(String token) {
        try {
            JwtPayload payload = parseToken(token);
            return "access".equals(payload.getType());
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 判断 Token 是否为 Refresh Token
     */
    public boolean isRefreshToken(String token) {
        try {
            JwtPayload payload = parseToken(token);
            return "refresh".equals(payload.getType());
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 从请求头中提取 Token
     */
    public String extractTokenFromHeader(String authorizationHeader) {
        if (authorizationHeader != null && authorizationHeader.startsWith("Bearer ")) {
            return authorizationHeader.substring(7);
        }
        return null;
    }

    /**
     * 获取 Token 剩余有效时间（秒）
     */
    public long getTokenRemainingTime(String token) {
        try {
            JwtPayload payload = parseToken(token);
            long remaining = payload.getExpiration().getEpochSecond() - Instant.now().getEpochSecond();
            return Math.max(0, remaining);
        } catch (Exception e) {
            return 0;
        }
    }

    /**
     * 刷新 Access Token
     */
    public TokenPair refreshAccessToken(String refreshToken, LoginUser loginUser) {
        // 验证 Refresh Token
        JwtPayload payload = parseToken(refreshToken);
        if (!"refresh".equals(payload.getType())) {
            throw new InvalidTokenException("无效的刷新令牌");
        }
        
        // 验证用户ID是否匹配
        if (!payload.getUserId().equals(loginUser.getUserId())) {
            throw new InvalidTokenException("令牌与用户不匹配");
        }
        
        // 生成新的 Token 对
        return generateTokenPair(loginUser);
    }
}
```

```java
// aetherblog-common/common-security/src/main/java/com/aetherblog/common/security/domain/TokenPair.java

package com.aetherblog.common.security.domain;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Builder;
import lombok.Data;

/**
 * Token 对
 */
@Data
@Builder
@Schema(description = "Token响应")
public class TokenPair {

    @Schema(description = "访问令牌")
    private String accessToken;

    @Schema(description = "刷新令牌")
    private String refreshToken;

    @Schema(description = "访问令牌过期时间（秒）", example = "900")
    private long accessTokenExpireIn;

    @Schema(description = "刷新令牌过期时间（秒）", example = "604800")
    private long refreshTokenExpireIn;

    @Schema(description = "令牌类型", example = "Bearer")
    private String tokenType;
}
```

#### 2.4.2.4 文章服务实现

```java
// aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/entity/Post.java

package com.aetherblog.blog.entity;

import com.aetherblog.common.core.domain.BaseEntity;
import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.hibernate.annotations.SQLDelete;
import org.hibernate.annotations.SQLRestriction;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;

/**
 * 文章实体
 */
@Data
@Entity
@Table(name = "posts")
@EqualsAndHashCode(callSuper = true)
@SQLDelete(sql = "UPDATE posts SET deleted = true WHERE id = ?")
@SQLRestriction("deleted = false")
public class Post extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * 文章标题
     */
    @Column(nullable = false, length = 200)
    private String title;

    /**
     * URL友好的唯一标识
     */
    @Column(nullable = false, unique = true, length = 200)
    private String slug;

    /**
     * Markdown 原始内容
     */
    @Column(columnDefinition = "TEXT")
    private String contentMarkdown;

    /**
     * 渲染后的 HTML 内容
     */
    @Column(columnDefinition = "TEXT")
    private String contentHtml;

    /**
     * 文章摘要
     */
    @Column(length = 500)
    private String summary;

    /**
     * 封面图片 URL
     */
    @Column(length = 500)
    private String coverImage;

    /**
     * 文章状态: DRAFT, PUBLISHED, SCHEDULED, ARCHIVED
     */
    @Enumerated(EnumType.STRING)
    @Column(nullable = false, length = 20)
    private PostStatus status = PostStatus.DRAFT;

    /**
     * 发布时间
     */
    private LocalDateTime publishedAt;

    /**
     * 定时发布时间
     */
    private LocalDateTime scheduledAt;

    /**
     * 字数统计
     */
    private Integer wordCount = 0;

    /**
     * 预估阅读时间（分钟）
     */
    private Integer readingTime = 0;

    /**
     * 浏览量
     */
    private Long viewCount = 0L;

    /**
     * 点赞数
     */
    private Long likeCount = 0L;

    /**
     * 评论数
     */
    private Integer commentCount = 0;

    /**
     * 是否置顶
     */
    private Boolean isPinned = false;

    /**
     * 是否允许评论
     */
    private Boolean allowComment = true;

    /**
     * SEO 标题
     */
    @Column(length = 200)
    private String seoTitle;

    /**
     * SEO 描述
     */
    @Column(length = 300)
    private String seoDescription;

    /**
     * SEO 关键词
     */
    @Column(length = 200)
    private String seoKeywords;

    /**
     * 向量化状态: PENDING, INDEXED, FAILED
     */
    @Enumerated(EnumType.STRING)
    @Column(length = 20)
    private EmbeddingStatus embeddingStatus = EmbeddingStatus.PENDING;

    /**
     * 是否已删除（软删除）
     */
    private Boolean deleted = false;

    /**
     * 分类
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "category_id")
    private Category category;

    /**
     * 作者
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "author_id", nullable = false)
    private User author;

    /**
     * 标签（多对多）
     */
    @ManyToMany(fetch = FetchType.LAZY)
    @JoinTable(
            name = "post_tags",
            joinColumns = @JoinColumn(name = "post_id"),
            inverseJoinColumns = @JoinColumn(name = "tag_id")
    )
    private Set<Tag> tags = new HashSet<>();

    // ==================== 枚举定义 ====================

    public enum PostStatus {
        DRAFT,      // 草稿
        PUBLISHED,  // 已发布
        SCHEDULED,  // 定时发布
        ARCHIVED    // 已归档
    }

    public enum EmbeddingStatus {
        PENDING,    // 待处理
        INDEXED,    // 已索引
        FAILED      // 处理失败
    }

    // ==================== 业务方法 ====================

    /**
     * 发布文章
     */
    public void publish() {
        this.status = PostStatus.PUBLISHED;
        this.publishedAt = LocalDateTime.now();
        this.scheduledAt = null;
    }

    /**
     * 定时发布
     */
    public void schedule(LocalDateTime scheduledAt) {
        this.status = PostStatus.SCHEDULED;
        this.scheduledAt = scheduledAt;
        this.publishedAt = null;
    }

    /**
     * 转为草稿
     */
    public void toDraft() {
        this.status = PostStatus.DRAFT;
        this.publishedAt = null;
        this.scheduledAt = null;
    }

    /**
     * 增加浏览量
     */
    public void incrementViewCount() {
        this.viewCount++;
    }

    /**
     * 添加标签
     */
    public void addTag(Tag tag) {
        this.tags.add(tag);
    }

    /**
     * 移除标签
     */
    public void removeTag(Tag tag) {
        this.tags.remove(tag);
    }
}
```

```java
// aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/impl/PostServiceImpl.java

package com.aetherblog.blog.service.impl;

import com.aetherblog.blog.converter.PostConverter;
import com.aetherblog.blog.dto.request.CreatePostRequest;
import com.aetherblog.blog.dto.request.UpdatePostRequest;
import com.aetherblog.blog.dto.response.PostDetailResponse;
import com.aetherblog.blog.dto.response.PostListResponse;
import com.aetherblog.blog.entity.Category;
import com.aetherblog.blog.entity.Post;
import com.aetherblog.blog.entity.Post.PostStatus;
import com.aetherblog.blog.entity.Tag;
import com.aetherblog.blog.entity.User;
import com.aetherblog.blog.repository.CategoryRepository;
import com.aetherblog.blog.repository.PostRepository;
import com.aetherblog.blog.repository.TagRepository;
import com.aetherblog.blog.service.PostService;
import com.aetherblog.common.core.domain.PageQuery;
import com.aetherblog.common.core.domain.PageResult;
import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.SlugUtils;
import com.aetherblog.common.redis.service.CacheService;
import com.aetherblog.common.security.service.SecurityService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.ApplicationEventPublisher;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.concurrent.TimeUnit;

/**
 * 文章服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class PostServiceImpl implements PostService {

    private final PostRepository postRepository;
    private final CategoryRepository categoryRepository;
    private final TagRepository tagRepository;
    private final PostConverter postConverter;
    private final SecurityService securityService;
    private final CacheService cacheService;
    private final MarkdownService markdownService;
    private final ApplicationEventPublisher eventPublisher;

    private static final String CACHE_KEY_POST = "post:detail:";
    private static final String CACHE_KEY_POST_LIST = "post:list:";
    private static final long CACHE_EXPIRE_HOURS = 2;

    @Override
    @Transactional(readOnly = true)
    public PageResult<PostListResponse> getPostList(PostQueryCriteria criteria, PageQuery pageQuery) {
        // 构建分页参数
        Sort sort = Sort.by(
                pageQuery.getSortDirection().equalsIgnoreCase("asc") ? Sort.Direction.ASC : Sort.Direction.DESC,
                pageQuery.getSortBy()
        );
        Pageable pageable = PageRequest.of(pageQuery.getPage() - 1, pageQuery.getSize(), sort);

        // 查询
        Page<Post> postPage = postRepository.findByConditions(
                criteria.getStatus(),
                criteria.getCategoryId(),
                criteria.getTagIds(),
                criteria.getKeyword(),
                pageable
        );

        // 转换为响应DTO
        List<PostListResponse> list = postPage.getContent().stream()
                .map(postConverter::toListResponse)
                .toList();

        return PageResult.of(list, postPage.getTotalElements(), pageQuery);
    }

    @Override
    @Transactional(readOnly = true)
    public PostDetailResponse getPostDetail(String idOrSlug) {
        // 尝试从缓存获取
        String cacheKey = CACHE_KEY_POST + idOrSlug;
        PostDetailResponse cached = cacheService.get(cacheKey, PostDetailResponse.class);
        if (cached != null) {
            return cached;
        }

        // 查询数据库
        Post post = findPostByIdOrSlug(idOrSlug);
        
        // 转换为响应DTO
        PostDetailResponse response = postConverter.toDetailResponse(post);

        // 获取上一篇/下一篇
        response.setPrev(getAdjacentPost(post, true));
        response.setNext(getAdjacentPost(post, false));

        // 获取相关文章
        response.setRelatedPosts(getRelatedPosts(post, 5));

        // 缓存
        cacheService.set(cacheKey, response, CACHE_EXPIRE_HOURS, TimeUnit.HOURS);

        return response;
    }

    @Override
    @Transactional(readOnly = true)
    public PostDetailResponse getPostBySlug(String slug) {
        return getPostDetail(slug);
    }

    @Override
    @Transactional
    public PostDetailResponse createPost(CreatePostRequest request) {
        User currentUser = securityService.getCurrentUser();

        // 生成 Slug
        String slug = StringUtils.hasText(request.getSlug()) 
                ? request.getSlug() 
                : SlugUtils.generate(request.getTitle());
        
        // 检查 Slug 唯一性
        if (postRepository.existsBySlug(slug)) {
            slug = slug + "-" + System.currentTimeMillis();
        }

        // 创建文章实体
        Post post = new Post();
        post.setTitle(request.getTitle());
        post.setSlug(slug);
        post.setContentMarkdown(request.getContentMarkdown());
        post.setSummary(request.getSummary());
        post.setCoverImage(request.getCoverImage());
        post.setAuthor(currentUser);

        // 渲染 HTML
        String html = markdownService.render(request.getContentMarkdown());
        post.setContentHtml(html);

        // 计算字数和阅读时间
        int wordCount = countWords(request.getContentMarkdown());
        post.setWordCount(wordCount);
        post.setReadingTime(calculateReadingTime(wordCount));

        // 设置分类
        if (request.getCategoryId() != null) {
            Category category = categoryRepository.findById(request.getCategoryId())
                    .orElseThrow(() -> new BusinessException("分类不存在"));
            post.setCategory(category);
        }

        // 设置标签
        if (request.getTagIds() != null && !request.getTagIds().isEmpty()) {
            Set<Tag> tags = new HashSet<>(tagRepository.findAllById(request.getTagIds()));
            post.setTags(tags);
        }

        // 处理发布状态
        handlePublishStatus(post, request.getStatus(), request.getScheduledAt());

        // 保存
        post = postRepository.save(post);
        log.info("创建文章成功: id={}, title={}", post.getId(), post.getTitle());

        // 发布事件（用于触发向量化等异步操作）
        eventPublisher.publishEvent(new PostCreatedEvent(this, post));

        // 清除列表缓存
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");

        return postConverter.toDetailResponse(post);
    }

    @Override
    @Transactional
    public PostDetailResponse updatePost(Long id, UpdatePostRequest request) {
        Post post = postRepository.findById(id)
                .orElseThrow(() -> new BusinessException("文章不存在"));

        // 检查权限
        securityService.checkPostPermission(post);

        // 更新基本信息
        if (StringUtils.hasText(request.getTitle())) {
            post.setTitle(request.getTitle());
        }
        if (StringUtils.hasText(request.getSlug())) {
            // 检查 Slug 唯一性（排除自身）
            if (postRepository.existsBySlugAndIdNot(request.getSlug(), id)) {
                throw new BusinessException("Slug 已被使用");
            }
            post.setSlug(request.getSlug());
        }
        if (request.getContentMarkdown() != null) {
            post.setContentMarkdown(request.getContentMarkdown());
            post.setContentHtml(markdownService.render(request.getContentMarkdown()));
            
            // 重新计算字数
            int wordCount = countWords(request.getContentMarkdown());
            post.setWordCount(wordCount);
            post.setReadingTime(calculateReadingTime(wordCount));
        }
        if (request.getSummary() != null) {
            post.setSummary(request.getSummary());
        }
        if (request.getCoverImage() != null) {
            post.setCoverImage(request.getCoverImage());
        }

        // 更新分类
        if (request.getCategoryId() != null) {
            Category category = categoryRepository.findById(request.getCategoryId())
                    .orElseThrow(() -> new BusinessException("分类不存在"));
            post.setCategory(category);
        }

        // 更新标签
        if (request.getTagIds() != null) {
            Set<Tag> tags = new HashSet<>(tagRepository.findAllById(request.getTagIds()));
            post.setTags(tags);
        }

        // 处理发布状态
        if (request.getStatus() != null) {
            handlePublishStatus(post, request.getStatus(), request.getScheduledAt());
        }

        // 保存
        post = postRepository.save(post);
        log.info("更新文章成功: id={}", id);

        // 发布事件
        eventPublisher.publishEvent(new PostUpdatedEvent(this, post));

        // 清除缓存
        cacheService.delete(CACHE_KEY_POST + id);
        cacheService.delete(CACHE_KEY_POST + post.getSlug());
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");

        return postConverter.toDetailResponse(post);
    }

    @Override
    @Transactional
    public void deletePost(Long id) {
        Post post = postRepository.findById(id)
                .orElseThrow(() -> new BusinessException("文章不存在"));

        // 检查权限
        securityService.checkPostPermission(post);

        // 软删除
        postRepository.delete(post);
        log.info("删除文章成功: id={}", id);

        // 发布事件
        eventPublisher.publishEvent(new PostDeletedEvent(this, post));

        // 清除缓存
        cacheService.delete(CACHE_KEY_POST + id);
        cacheService.delete(CACHE_KEY_POST + post.getSlug());
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");
    }

    @Override
    @Transactional
    public void incrementViewCount(Long postId) {
        // 使用 Redis 进行计数，定期同步到数据库
        String key = "post:views:" + postId;
        Long views = cacheService.increment(key, 1);
        
        // 每 100 次浏览同步一次到数据库
        if (views != null && views % 100 == 0) {
            postRepository.incrementViewCount(postId, 100);
            cacheService.delete(key);
        }
    }

    // ==================== 私有方法 ====================

    private Post findPostByIdOrSlug(String idOrSlug) {
        // 尝试作为 ID 查询
        try {
            Long id = Long.parseLong(idOrSlug);
            return postRepository.findById(id)
                    .orElseThrow(() -> new BusinessException("文章不存在"));
        } catch (NumberFormatException e) {
            // 作为 Slug 查询
            return postRepository.findBySlug(idOrSlug)
                    .orElseThrow(() -> new BusinessException("文章不存在"));
        }
    }

    private void handlePublishStatus(Post post, String status, LocalDateTime scheduledAt) {
        PostStatus postStatus = PostStatus.valueOf(status.toUpperCase());
        switch (postStatus) {
            case PUBLISHED -> post.publish();
            case SCHEDULED -> {
                if (scheduledAt == null) {
                    throw new BusinessException("定时发布需要指定发布时间");
                }
                post.schedule(scheduledAt);
            }
            case DRAFT -> post.toDraft();
            default -> post.setStatus(postStatus);
        }
    }

    private int countWords(String markdown) {
        if (markdown == null) return 0;
        // 简单的中英文字数统计
        String text = markdown.replaceAll("[\\s\\p{Punct}]", "");
        return text.length();
    }

    private int calculateReadingTime(int wordCount) {
        // 假设平均阅读速度：中文 300字/分钟
        return Math.max(1, wordCount / 300);
    }

    private PostNavigation getAdjacentPost(Post current, boolean isPrevious) {
        Post adjacent = isPrevious
                ? postRepository.findPreviousPost(current.getPublishedAt(), current.getId())
                : postRepository.findNextPost(current.getPublishedAt(), current.getId());
        
        if (adjacent == null) return null;
        
        return new PostNavigation(adjacent.getId(), adjacent.getTitle(), adjacent.getSlug());
    }

    private List<RelatedPost> getRelatedPosts(Post post, int limit) {
        // 基于标签相似度获取相关文章
        List<Long> tagIds = post.getTags().stream().map(Tag::getId).toList();
        if (tagIds.isEmpty()) {
            return List.of();
        }
        
        return postRepository.findRelatedPosts(post.getId(), tagIds, PageRequest.of(0, limit))
                .stream()
                .map(p -> new RelatedPost(p.getId(), p.getTitle(), p.getSlug(), p.getCoverImage()))
                .toList();
    }
}
```

#### 2.4.2.5 AI 服务实现

本项目将 AI 能力下沉为独立 AI 服务（FastAPI + LiteLLM），主后端仅通过 HTTP API 调用。
- 服务职责：模型路由、Prompt 模板管理、RAG 检索编排、限流与成本统计。
- 协议兼容：统一 OpenAI API 协议，便于接入多供应商与本地模型。
- 向量存储：继续使用 PostgreSQL + pgvector，检索管线由 LlamaIndex 负责。

```yaml
# apps/ai-service/config.yaml (示意)
providers:
  default: openai
  openai:
    base_url: https://api.openai.com
    api_key: ${OPENAI_API_KEY}
  compatible:
    base_url: ${OPENAI_COMPAT_BASE_URL}
    api_key: ${OPENAI_COMPAT_API_KEY}

models:
  summary: gpt-4o-mini
  tags: gpt-4o-mini
  outline: gpt-4o-mini
  embeddings: text-embedding-3-small
```

```python
# apps/ai-service/app/api/routes/summary.py
from fastapi import APIRouter
from app.schemas.ai import SummaryRequest, SummaryResponse
from app.services.llm_router import llm_router

router = APIRouter(prefix="/v1/ai", tags=["ai"])

@router.post("/summary", response_model=SummaryResponse)
async def summary(req: SummaryRequest) -> SummaryResponse:
    prompt = (
        f"请为以下文章生成简洁摘要（{req.max_length}字以内）：\n"
        f"{req.content}"
    )
    text = await llm_router.chat(prompt, model_alias="summary")
    return SummaryResponse(summary=text, character_count=len(text))
```

```java
// blog-service: 独立 AI 服务调用 (示意)
@Component
public class AiGatewayClient {
    private final WebClient webClient;

    public Mono<SummaryResponse> generateSummary(SummaryRequest request) {
        return webClient.post()
            .uri("/v1/ai/summary")
            .bodyValue(request)
            .retrieve()
            .bodyToMono(SummaryResponse.class);
    }
}
```

#### 2.4.2.6 存储策略实现

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/StorageService.java

package com.aetherblog.media.storage;

import java.io.InputStream;

/**
 * 存储服务接口
 */
public interface StorageService {

    /**
     * 上传文件
     * 
     * @param inputStream 文件输入流
     * @param filename 文件名
     * @param contentType 内容类型
     * @return 文件访问路径
     */
    String upload(InputStream inputStream, String filename, String contentType);

    /**
     * 上传文件到指定路径
     */
    String upload(InputStream inputStream, String path, String filename, String contentType);

    /**
     * 删除文件
     */
    void delete(String path);

    /**
     * 获取文件访问 URL
     */
    String getUrl(String path);

    /**
     * 获取带签名的临时访问 URL
     */
    String getSignedUrl(String path, long expireSeconds);

    /**
     * 判断文件是否存在
     */
    boolean exists(String path);

    /**
     * 获取存储类型
     */
    StorageType getType();
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/LocalStorageService.java

package com.aetherblog.media.storage;

import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.FileUtils;
import com.aetherblog.media.config.StorageProperties;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;

import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.UUID;

/**
 * 本地存储服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
@ConditionalOnProperty(name = "storage.type", havingValue = "local", matchIfMissing = true)
public class LocalStorageService implements StorageService {

    private final StorageProperties properties;

    @Override
    public String upload(InputStream inputStream, String filename, String contentType) {
        // 生成日期目录
        String datePath = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd"));
        return upload(inputStream, datePath, filename, contentType);
    }

    @Override
    public String upload(InputStream inputStream, String path, String filename, String contentType) {
        try {
            // 生成唯一文件名
            String extension = FileUtils.getExtension(filename);
            String newFilename = UUID.randomUUID().toString().replace("-", "") + "." + extension;
            
            // 构建完整路径
            Path uploadPath = Paths.get(properties.getLocal().getUploadPath(), path);
            Files.createDirectories(uploadPath);
            
            Path filePath = uploadPath.resolve(newFilename);
            
            // 复制文件
            Files.copy(inputStream, filePath, StandardCopyOption.REPLACE_EXISTING);
            
            log.info("文件上传成功: {}", filePath);
            
            // 返回相对路径
            return path + "/" + newFilename;
            
        } catch (IOException e) {
            log.error("文件上传失败", e);
            throw new BusinessException("文件上传失败: " + e.getMessage());
        }
    }

    @Override
    public void delete(String path) {
        try {
            Path filePath = Paths.get(properties.getLocal().getUploadPath(), path);
            Files.deleteIfExists(filePath);
            log.info("文件删除成功: {}", path);
        } catch (IOException e) {
            log.error("文件删除失败: {}", path, e);
        }
    }

    @Override
    public String getUrl(String path) {
        if (!StringUtils.hasText(path)) {
            return null;
        }
        // 返回访问 URL
        String baseUrl = properties.getLocal().getAccessUrl();
        return baseUrl.endsWith("/") ? baseUrl + path : baseUrl + "/" + path;
    }

    @Override
    public String getSignedUrl(String path, long expireSeconds) {
        // 本地存储暂不支持签名 URL，直接返回普通 URL
        return getUrl(path);
    }

    @Override
    public boolean exists(String path) {
        Path filePath = Paths.get(properties.getLocal().getUploadPath(), path);
        return Files.exists(filePath);
    }

    @Override
    public StorageType getType() {
        return StorageType.LOCAL;
    }
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/TencentCosStorageService.java

package com.aetherblog.media.storage;

import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.FileUtils;
import com.aetherblog.media.config.StorageProperties;
import com.qcloud.cos.COSClient;
import com.qcloud.cos.ClientConfig;
import com.qcloud.cos.auth.BasicCOSCredentials;
import com.qcloud.cos.auth.COSCredentials;
import com.qcloud.cos.http.HttpProtocol;
import com.qcloud.cos.model.ObjectMetadata;
import com.qcloud.cos.model.PutObjectRequest;
import com.qcloud.cos.region.Region;
import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.stereotype.Service;

import java.io.InputStream;
import java.net.URL;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import java.util.UUID;

/**
 * 腾讯云 COS 存储服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
@ConditionalOnProperty(name = "storage.type", havingValue = "tencent-cos")
public class TencentCosStorageService implements StorageService {

    private final StorageProperties properties;
    private COSClient cosClient;

    @PostConstruct
    public void init() {
        StorageProperties.TencentCos cos = properties.getTencentCos();
        
        COSCredentials credentials = new BasicCOSCredentials(cos.getSecretId(), cos.getSecretKey());
        
        ClientConfig clientConfig = new ClientConfig(new Region(cos.getRegion()));
        clientConfig.setHttpProtocol(HttpProtocol.https);
        
        this.cosClient = new COSClient(credentials, clientConfig);
        
        log.info("腾讯云 COS 客户端初始化成功, region={}, bucket={}", cos.getRegion(), cos.getBucket());
    }

    @PreDestroy
    public void destroy() {
        if (cosClient != null) {
            cosClient.shutdown();
        }
    }

    @Override
    public String upload(InputStream inputStream, String filename, String contentType) {
        String datePath = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd"));
        return upload(inputStream, datePath, filename, contentType);
    }

    @Override
    public String upload(InputStream inputStream, String path, String filename, String contentType) {
        try {
            String extension = FileUtils.getExtension(filename);
            String newFilename = UUID.randomUUID().toString().replace("-", "") + "." + extension;
            String key = path + "/" + newFilename;
            
            ObjectMetadata metadata = new ObjectMetadata();
            metadata.setContentType(contentType);
            
            PutObjectRequest putRequest = new PutObjectRequest(
                    properties.getTencentCos().getBucket(),
                    key,
                    inputStream,
                    metadata
            );
            
            cosClient.putObject(putRequest);
            
            log.info("文件上传到 COS 成功: {}", key);
            
            return key;
            
        } catch (Exception e) {
            log.error("文件上传到 COS 失败", e);
            throw new BusinessException("文件上传失败: " + e.getMessage());
        }
    }

    @Override
    public void delete(String path) {
        try {
            cosClient.deleteObject(properties.getTencentCos().getBucket(), path);
            log.info("COS 文件删除成功: {}", path);
        } catch (Exception e) {
            log.error("COS 文件删除失败: {}", path, e);
        }
    }

    @Override
    public String getUrl(String path) {
        if (path == null || path.isEmpty()) {
            return null;
        }
        
        StorageProperties.TencentCos cos = properties.getTencentCos();
        
        // 如果配置了自定义域名
        if (cos.getCustomDomain() != null && !cos.getCustomDomain().isEmpty()) {
            String domain = cos.getCustomDomain();
            return domain.endsWith("/") ? domain + path : domain + "/" + path;
        }
        
        // 使用默认域名
        return String.format("https://%s.cos.%s.myqcloud.com/%s",
                cos.getBucket(), cos.getRegion(), path);
    }

    @Override
    public String getSignedUrl(String path, long expireSeconds) {
        Date expiration = new Date(System.currentTimeMillis() + expireSeconds * 1000);
        
        URL url = cosClient.generatePresignedUrl(
                properties.getTencentCos().getBucket(),
                path,
                expiration
        );
        
        return url.toString();
    }

    @Override
    public boolean exists(String path) {
        return cosClient.doesObjectExist(properties.getTencentCos().getBucket(), path);
    }

    @Override
    public StorageType getType() {
        return StorageType.TENCENT_COS;
    }
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/StorageServiceFactory.java

package com.aetherblog.media.storage;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * 存储服务工厂
 * 
 * 用于动态获取不同类型的存储服务
 */
@Component
@RequiredArgsConstructor
public class StorageServiceFactory {

    private final List<StorageService> storageServices;
    private Map<StorageType, StorageService> serviceMap;

    /**
     * 获取存储服务
     */
    public StorageService getService(StorageType type) {
        if (serviceMap == null) {
            serviceMap = storageServices.stream()
                    .collect(Collectors.toMap(
                            StorageService::getType,
                            Function.identity()
                    ));
        }
        
        StorageService service = serviceMap.get(type);
        if (service == null) {
            throw new IllegalArgumentException("不支持的存储类型: " + type);
        }
        return service;
    }

    /**
     * 获取默认存储服务（第一个可用的）
     */
    public StorageService getDefaultService() {
        if (storageServices.isEmpty()) {
            throw new IllegalStateException("没有可用的存储服务");
        }
        return storageServices.get(0);
    }
}
```

---

## 2.5 数据库详细设计

### 2.5.1 数据模型概述

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        数据库 ER 图                                                       │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐                           │
│   │     users       │         │    categories   │         │      tags       │                           │
│   ├─────────────────┤         ├─────────────────┤         ├─────────────────┤                           │
│   │ id (PK)         │         │ id (PK)         │         │ id (PK)         │                           │
│   │ username        │         │ name            │         │ name            │                           │
│   │ email           │         │ slug            │         │ slug            │                           │
│   │ password_hash   │         │ description     │         │ description     │                           │
│   │ nickname        │         │ cover_image     │         │ color           │                           │
│   │ avatar          │         │ parent_id (FK)  │         │ post_count      │                           │
│   │ bio             │         │ sort_order      │         │ created_at      │                           │
│   │ role            │         │ post_count      │         │ updated_at      │                           │
│   │ ...             │         │ created_at      │         └────────┬────────┘                           │
│   └────────┬────────┘         │ updated_at      │                  │                                    │
│            │                  └────────┬────────┘                  │                                    │
│            │                           │                           │                                    │
│            │ 1                         │ 1                         │ M                                  │
│            │                           │                           │                                    │
│            ▼ M                         ▼ M                         ▼                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────┐                       │
│   │                                    posts                                     │                       │
│   ├─────────────────────────────────────────────────────────────────────────────┤                       │
│   │ id (PK)              │ slug              │ status            │ deleted      │                       │
│   │ title                │ content_markdown  │ published_at      │ created_at   │                       │
│   │ author_id (FK)       │ content_html      │ scheduled_at      │ updated_at   │                       │
│   │ category_id (FK)     │ summary           │ word_count        │              │                       │
│   │ cover_image          │ seo_title         │ reading_time      │              │                       │
│   │ is_pinned            │ seo_description   │ view_count        │              │                       │
│   │ allow_comment        │ seo_keywords      │ like_count        │              │                       │
│   │ embedding_status     │                   │ comment_count     │              │                       │
│   └─────────────────────────────────────────────────────────────────────────────┘                       │
│            │                                              │                                              │
│            │ 1                                            │ 1                                            │
│            │                                              │                                              │
│            ▼ M                                            ▼ M                                            │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│   │   post_tags     │    │    comments     │    │ post_embeddings │    │   attachments   │              │
│   ├─────────────────┤    ├─────────────────┤    ├─────────────────┤    ├─────────────────┤              │
│   │ post_id (FK)    │    │ id (PK)         │    │ id (PK)         │    │ id (PK)         │              │
│   │ tag_id (FK)     │    │ post_id (FK)    │    │ post_id (FK)    │    │ post_id (FK)    │              │
│   │                 │    │ parent_id (FK)  │    │ content_segment │    │ filename        │              │
│   │                 │    │ author_name     │    │ embedding       │    │ original_name   │              │
│   │                 │    │ author_email    │    │ created_at      │    │ storage_type    │              │
│   │                 │    │ content         │    │                 │    │ storage_path    │              │
│   │                 │    │ status          │    │                 │    │ file_size       │              │
│   │                 │    │ ...             │    │                 │    │ mime_type       │              │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘    │ download_count  │              │
│                                                                         │ encryption_key  │              │
│                                                                         │ created_at      │              │
│                                                                         └─────────────────┘              │
│                                                                                                          │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│   │  friend_links   │    │  site_settings  │    │  prompt_templates│   │  operation_logs │              │
│   ├─────────────────┤    ├─────────────────┤    ├─────────────────┤    ├─────────────────┤              │
│   │ id (PK)         │    │ id (PK)         │    │ id (PK)         │    │ id (PK)         │              │
│   │ name            │    │ key             │    │ name            │    │ user_id (FK)    │              │
│   │ url             │    │ value           │    │ description     │    │ module          │              │
│   │ avatar          │    │ type            │    │ content         │    │ action          │              │
│   │ description     │    │ description     │    │ category        │    │ method          │              │
│   │ email           │    │ created_at      │    │ is_system       │    │ request_url     │              │
│   │ rss_url         │    │ updated_at      │    │ created_at      │    │ request_params  │              │
│   │ theme_color     │    │                 │    │ updated_at      │    │ response_data   │              │
│   │ sort_order      │    │                 │    │                 │    │ ip_address      │              │
│   │ status          │    │                 │    │                 │    │ user_agent      │              │
│   │ created_at      │    │                 │    │                 │    │ execution_time  │              │
│   │ updated_at      │    │                 │    │                 │    │ status          │              │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘    │ error_message   │              │
│                                                                         │ created_at      │              │
│   ┌─────────────────┐    ┌─────────────────┐                           └─────────────────┘              │
│   │  visit_records  │    │  visit_stats    │                                                            │
│   ├─────────────────┤    ├─────────────────┤                                                            │
│   │ id (PK)         │    │ id (PK)         │                                                            │
│   │ post_id (FK)    │    │ date            │                                                            │
│   │ visitor_hash    │    │ pv              │                                                            │
│   │ ip_address      │    │ uv              │                                                            │
│   │ user_agent      │    │ new_visitors    │                                                            │
│   │ referer         │    │ post_views      │                                                            │
│   │ country         │    │ avg_duration    │                                                            │
│   │ city            │    │                 │                                                            │
│   │ device_type     │    │                 │                                                            │
│   │ browser         │    │                 │                                                            │
│   │ os              │    │                 │                                                            │
│   │ duration        │    │                 │                                                            │
│   │ created_at      │    │                 │                                                            │
│   └─────────────────┘    └─────────────────┘                                                            │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.5.2 核心表结构设计

```sql
-- ============================================================
-- AetherBlog 数据库表结构设计
-- 数据库: PostgreSQL 17
-- ============================================================

-- 启用扩展
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
CREATE EXTENSION IF NOT EXISTS "vector";  -- pgvector 向量扩展

-- ============================================================
-- 1. 用户表
-- ============================================================
CREATE TABLE users (
    id                  BIGSERIAL PRIMARY KEY,
    username            VARCHAR(50) NOT NULL UNIQUE,
    email               VARCHAR(100) NOT NULL UNIQUE,
    password_hash       VARCHAR(255) NOT NULL,
    nickname            VARCHAR(50),
    avatar              VARCHAR(500),
    bio                 TEXT,
    role                VARCHAR(20) NOT NULL DEFAULT 'USER',
    status              VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    last_login_at       TIMESTAMP,
    last_login_ip       VARCHAR(50),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_users_role CHECK (role IN ('ADMIN', 'AUTHOR', 'USER')),
    CONSTRAINT chk_users_status CHECK (status IN ('ACTIVE', 'INACTIVE', 'BANNED'))
);

-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);

-- 用户表注释
COMMENT ON TABLE users IS '用户表';
COMMENT ON COLUMN users.id IS '用户ID';
COMMENT ON COLUMN users.username IS '用户名';
COMMENT ON COLUMN users.email IS '邮箱';
COMMENT ON COLUMN users.password_hash IS '密码哈希';
COMMENT ON COLUMN users.nickname IS '昵称';
COMMENT ON COLUMN users.avatar IS '头像URL';
COMMENT ON COLUMN users.bio IS '个人简介';
COMMENT ON COLUMN users.role IS '角色: ADMIN-管理员, AUTHOR-作者, USER-普通用户';
COMMENT ON COLUMN users.status IS '状态: ACTIVE-正常, INACTIVE-未激活, BANNED-封禁';

-- ============================================================
-- 2. 分类表
-- ============================================================
CREATE TABLE categories (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(50) NOT NULL,
    slug                VARCHAR(100) NOT NULL UNIQUE,
    description         TEXT,
    cover_image         VARCHAR(500),
    parent_id           BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    sort_order          INT NOT NULL DEFAULT 0,
    post_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 分类表索引
CREATE INDEX idx_categories_slug ON categories(slug);
CREATE INDEX idx_categories_parent_id ON categories(parent_id);
CREATE INDEX idx_categories_sort_order ON categories(sort_order);

-- 分类表注释
COMMENT ON TABLE categories IS '文章分类表';
COMMENT ON COLUMN categories.slug IS 'URL友好的唯一标识';
COMMENT ON COLUMN categories.parent_id IS '父分类ID，支持多级分类';
COMMENT ON COLUMN categories.sort_order IS '排序序号，越小越靠前';
COMMENT ON COLUMN categories.post_count IS '文章数量（冗余字段，定期更新）';

-- ============================================================
-- 3. 标签表
-- ============================================================
CREATE TABLE tags (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(50) NOT NULL,
    slug                VARCHAR(100) NOT NULL UNIQUE,
    description         TEXT,
    color               VARCHAR(20) DEFAULT '#6366f1',
    post_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 标签表索引
CREATE INDEX idx_tags_slug ON tags(slug);
CREATE INDEX idx_tags_post_count ON tags(post_count DESC);

-- 标签表注释
COMMENT ON TABLE tags IS '文章标签表';
COMMENT ON COLUMN tags.color IS '标签颜色（十六进制）';
COMMENT ON COLUMN tags.post_count IS '文章数量';

-- ============================================================
-- 4. 文章表（核心表）
-- ============================================================
CREATE TABLE posts (
    id                  BIGSERIAL PRIMARY KEY,
    title               VARCHAR(200) NOT NULL,
    slug                VARCHAR(200) NOT NULL UNIQUE,
    content_markdown    TEXT,
    content_html        TEXT,
    summary             VARCHAR(500),
    cover_image         VARCHAR(500),
    author_id           BIGINT NOT NULL REFERENCES users(id),
    category_id         BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    status              VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    is_pinned           BOOLEAN NOT NULL DEFAULT FALSE,
    allow_comment       BOOLEAN NOT NULL DEFAULT TRUE,
    published_at        TIMESTAMP,
    scheduled_at        TIMESTAMP,
    word_count          INT NOT NULL DEFAULT 0,
    reading_time        INT NOT NULL DEFAULT 1,
    view_count          BIGINT NOT NULL DEFAULT 0,
    like_count          BIGINT NOT NULL DEFAULT 0,
    comment_count       INT NOT NULL DEFAULT 0,
    seo_title           VARCHAR(200),
    seo_description     VARCHAR(300),
    seo_keywords        VARCHAR(200),
    embedding_status    VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    deleted             BOOLEAN NOT NULL DEFAULT FALSE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_posts_status CHECK (status IN ('DRAFT', 'PUBLISHED', 'SCHEDULED', 'ARCHIVED')),
    CONSTRAINT chk_posts_embedding_status CHECK (embedding_status IN ('PENDING', 'INDEXED', 'FAILED'))
);

-- 文章表索引
CREATE INDEX idx_posts_slug ON posts(slug);
CREATE INDEX idx_posts_author_id ON posts(author_id);
CREATE INDEX idx_posts_category_id ON posts(category_id);
CREATE INDEX idx_posts_status ON posts(status);
CREATE INDEX idx_posts_published_at ON posts(published_at DESC);
CREATE INDEX idx_posts_scheduled_at ON posts(scheduled_at) WHERE scheduled_at IS NOT NULL;
CREATE INDEX idx_posts_is_pinned ON posts(is_pinned DESC, published_at DESC);
CREATE INDEX idx_posts_view_count ON posts(view_count DESC);
CREATE INDEX idx_posts_deleted ON posts(deleted);
-- 复合索引：已发布文章按时间排序
CREATE INDEX idx_posts_published ON posts(status, published_at DESC) WHERE deleted = FALSE;
-- 全文搜索索引
CREATE INDEX idx_posts_fulltext ON posts USING gin(to_tsvector('simple', title || ' ' || COALESCE(summary, '') || ' ' || COALESCE(content_markdown, '')));

-- 文章表注释
COMMENT ON TABLE posts IS '博客文章表';
COMMENT ON COLUMN posts.slug IS 'URL友好的唯一标识';
COMMENT ON COLUMN posts.content_markdown IS 'Markdown原始内容';
COMMENT ON COLUMN posts.content_html IS '渲染后的HTML内容';
COMMENT ON COLUMN posts.status IS '状态: DRAFT-草稿, PUBLISHED-已发布, SCHEDULED-定时发布, ARCHIVED-已归档';
COMMENT ON COLUMN posts.is_pinned IS '是否置顶';
COMMENT ON COLUMN posts.word_count IS '字数统计';
COMMENT ON COLUMN posts.reading_time IS '预估阅读时间（分钟）';
COMMENT ON COLUMN posts.embedding_status IS '向量化状态: PENDING-待处理, INDEXED-已索引, FAILED-失败';
COMMENT ON COLUMN posts.deleted IS '软删除标记';

-- ============================================================
-- 5. 文章标签关联表
-- ============================================================
CREATE TABLE post_tags (
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    tag_id              BIGINT NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (post_id, tag_id)
);

-- 关联表索引
CREATE INDEX idx_post_tags_tag_id ON post_tags(tag_id);

-- ============================================================
-- 6. 评论表
-- ============================================================
CREATE TABLE comments (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    parent_id           BIGINT REFERENCES comments(id) ON DELETE CASCADE,
    author_name         VARCHAR(50) NOT NULL,
    author_email        VARCHAR(100) NOT NULL,
    author_url          VARCHAR(200),
    author_avatar       VARCHAR(500),
    content             TEXT NOT NULL,
    status              VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    like_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_comments_status CHECK (status IN ('PENDING', 'APPROVED', 'SPAM', 'TRASH'))
);

-- 评论表索引
CREATE INDEX idx_comments_post_id ON comments(post_id);
CREATE INDEX idx_comments_parent_id ON comments(parent_id);
CREATE INDEX idx_comments_status ON comments(status);
CREATE INDEX idx_comments_created_at ON comments(created_at DESC);

-- 评论表注释
COMMENT ON TABLE comments IS '文章评论表';
COMMENT ON COLUMN comments.parent_id IS '父评论ID，支持嵌套评论';
COMMENT ON COLUMN comments.status IS '状态: PENDING-待审核, APPROVED-已通过, SPAM-垃圾评论, TRASH-已删除';

-- ============================================================
-- 7. 向量嵌入表（用于RAG检索）
-- ============================================================
CREATE TABLE post_embeddings (
    id                  UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    content_segment     TEXT NOT NULL,
    segment_index       INT NOT NULL DEFAULT 0,
    embedding           vector(1536) NOT NULL,  -- OpenAI text-embedding-3-small 维度
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 向量索引（HNSW算法，余弦相似度）
CREATE INDEX idx_post_embeddings_vector ON post_embeddings 
    USING hnsw (embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);

-- 普通索引
CREATE INDEX idx_post_embeddings_post_id ON post_embeddings(post_id);

-- 向量表注释
COMMENT ON TABLE post_embeddings IS '文章向量嵌入表，用于语义搜索';
COMMENT ON COLUMN post_embeddings.content_segment IS '文章内容片段';
COMMENT ON COLUMN post_embeddings.segment_index IS '片段在原文中的顺序';
COMMENT ON COLUMN post_embeddings.embedding IS '1536维向量嵌入';

-- ============================================================
-- 8. 附件表
-- ============================================================
CREATE TABLE attachments (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT REFERENCES posts(id) ON DELETE SET NULL,
    filename            VARCHAR(255) NOT NULL,
    original_name       VARCHAR(255) NOT NULL,
    storage_type        VARCHAR(20) NOT NULL DEFAULT 'LOCAL',
    storage_path        VARCHAR(500) NOT NULL,
    file_size           BIGINT NOT NULL,
    mime_type           VARCHAR(100) NOT NULL,
    download_count      INT NOT NULL DEFAULT 0,
    encryption_key      VARCHAR(100),
    uploader_id         BIGINT REFERENCES users(id),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_attachments_storage_type CHECK (storage_type IN ('LOCAL', 'TENCENT_COS', 'ALIYUN_OSS', 'AWS_S3'))
);

-- 附件表索引
CREATE INDEX idx_attachments_post_id ON attachments(post_id);
CREATE INDEX idx_attachments_storage_type ON attachments(storage_type);
CREATE INDEX idx_attachments_uploader_id ON attachments(uploader_id);

-- 附件表注释
COMMENT ON TABLE attachments IS '附件文件表';
COMMENT ON COLUMN attachments.storage_type IS '存储类型: LOCAL-本地, TENCENT_COS-腾讯云, ALIYUN_OSS-阿里云, AWS_S3-亚马逊';
COMMENT ON COLUMN attachments.encryption_key IS '下载链接加密密钥';

-- ============================================================
-- 9. 友链表
-- ============================================================
CREATE TABLE friend_links (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(100) NOT NULL,
    url                 VARCHAR(500) NOT NULL,
    avatar              VARCHAR(500),
    description         VARCHAR(500),
    email               VARCHAR(100),
    rss_url             VARCHAR(500),
    theme_color         VARCHAR(20) DEFAULT '#6366f1',
    sort_order          INT NOT NULL DEFAULT 0,
    status              VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    is_online           BOOLEAN DEFAULT TRUE,
    last_check_at       TIMESTAMP,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_friend_links_status CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED', 'HIDDEN'))
);

-- 友链表索引
CREATE INDEX idx_friend_links_status ON friend_links(status);
CREATE INDEX idx_friend_links_sort_order ON friend_links(sort_order);

-- 友链表注释
COMMENT ON TABLE friend_links IS '友情链接表';
COMMENT ON COLUMN friend_links.theme_color IS '主题颜色';
COMMENT ON COLUMN friend_links.is_online IS '是否在线（定期检测）';
COMMENT ON COLUMN friend_links.status IS '状态: PENDING-待审核, APPROVED-已通过, REJECTED-已拒绝, HIDDEN-已隐藏';

-- ============================================================
-- 10. 站点设置表
-- ============================================================
CREATE TABLE site_settings (
    id                  BIGSERIAL PRIMARY KEY,
    key                 VARCHAR(100) NOT NULL UNIQUE,
    value               TEXT,
    type                VARCHAR(20) NOT NULL DEFAULT 'STRING',
    group_name          VARCHAR(50) NOT NULL DEFAULT 'general',
    description         VARCHAR(500),
    is_public           BOOLEAN NOT NULL DEFAULT FALSE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_site_settings_type CHECK (type IN ('STRING', 'NUMBER', 'BOOLEAN', 'JSON', 'TEXT'))
);

-- 设置表索引
CREATE INDEX idx_site_settings_group ON site_settings(group_name);
CREATE INDEX idx_site_settings_public ON site_settings(is_public);

-- 初始化站点设置
INSERT INTO site_settings (key, value, type, group_name, description, is_public) VALUES
    ('site_name', 'AetherBlog', 'STRING', 'general', '站点名称', TRUE),
    ('site_description', '一个优雅的技术博客', 'STRING', 'general', '站点描述', TRUE),
    ('site_keywords', '技术博客,编程,开发', 'STRING', 'general', '站点关键词', TRUE),
    ('site_logo', '', 'STRING', 'general', '站点Logo', TRUE),
    ('site_favicon', '', 'STRING', 'general', '站点Favicon', TRUE),
    ('author_name', '', 'STRING', 'author', '博主名称', TRUE),
    ('author_avatar', '', 'STRING', 'author', '博主头像', TRUE),
    ('author_bio', '', 'TEXT', 'author', '博主简介', TRUE),
    ('author_github', '', 'STRING', 'author', 'GitHub地址', TRUE),
    ('author_twitter', '', 'STRING', 'author', 'Twitter地址', TRUE),
    ('author_email', '', 'STRING', 'author', '联系邮箱', TRUE),
    ('footer_text', '', 'TEXT', 'general', '页脚文字', TRUE),
    ('footer_signature', '', 'STRING', 'general', '个性签名', TRUE),
    ('icp_number', '', 'STRING', 'general', 'ICP备案号', TRUE),
    ('welcome_enabled', 'true', 'BOOLEAN', 'general', '是否启用欢迎页', TRUE),
    ('welcome_title', '欢迎来到我的博客', 'STRING', 'general', '欢迎页标题', TRUE),
    ('welcome_subtitle', '记录技术，分享生活', 'STRING', 'general', '欢迎页副标题', TRUE),
    ('comment_enabled', 'true', 'BOOLEAN', 'comment', '是否启用评论', FALSE),
    ('comment_audit', 'true', 'BOOLEAN', 'comment', '评论是否需要审核', FALSE),
    ('storage_type', 'LOCAL', 'STRING', 'storage', '存储类型', FALSE),
    ('ai_enabled', 'true', 'BOOLEAN', 'ai', '是否启用AI功能', FALSE),
    ('ai_provider', 'openai', 'STRING', 'ai', 'AI服务提供商', FALSE);

-- ============================================================
-- 11. Prompt模板表
-- ============================================================
CREATE TABLE prompt_templates (
    id                  UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name                VARCHAR(100) NOT NULL,
    description         VARCHAR(500),
    content             TEXT NOT NULL,
    category            VARCHAR(50) NOT NULL DEFAULT 'general',
    is_system           BOOLEAN NOT NULL DEFAULT FALSE,
    is_active           BOOLEAN NOT NULL DEFAULT TRUE,
    usage_count         INT NOT NULL DEFAULT 0,
    created_by          BIGINT REFERENCES users(id),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Prompt模板索引
CREATE INDEX idx_prompt_templates_category ON prompt_templates(category);
CREATE INDEX idx_prompt_templates_is_active ON prompt_templates(is_active);

-- 初始化系统Prompt
INSERT INTO prompt_templates (name, description, content, category, is_system) VALUES
    ('text-cleaner', '文本清洗', '你是一个专业的文本编辑助手。请清理用户提供的文本：
1. 去除多余的空行和空格
2. 统一中英文标点符号
3. 修复明显的断句问题
4. 保持代码块格式不变
5. 直接返回清理后的文本，不要有任何解释', 'writing', TRUE),
    
    ('summarizer', '摘要生成', '你是一个专业的技术文章摘要生成助手。
请根据文章内容生成简洁的摘要，要求：
1. 概括文章的核心观点
2. 使用第三人称
3. 语言简洁明了
4. 不要使用"本文"等开头
5. 控制在150字以内', 'writing', TRUE),
    
    ('tagger', '标签生成', '你是一个专业的技术博客标签生成助手。
根据文章内容生成准确、相关的标签：
1. 优先使用广泛认可的技术术语
2. 标签应该具有搜索价值
3. 避免过于宽泛或过于具体的标签
4. 最多生成5个标签
5. 用逗号分隔，直接返回标签列表', 'tagging', TRUE),
    
    ('qa-system', '问答系统', '你是一个专业的技术博客问答助手。
根据提供的参考资料回答用户问题：
1. 只根据参考资料中的内容回答
2. 如果没有相关信息，诚实告知用户
3. 引用具体内容时使用原文
4. 回答简洁明了，重点突出
5. 代码使用代码块格式展示', 'qa', TRUE);

-- ============================================================
-- 12. 操作日志表
-- ============================================================
CREATE TABLE operation_logs (
    id                  BIGSERIAL PRIMARY KEY,
    user_id             BIGINT REFERENCES users(id) ON DELETE SET NULL,
    username            VARCHAR(50),
    module              VARCHAR(50) NOT NULL,
    action              VARCHAR(50) NOT NULL,
    method              VARCHAR(10),
    request_url         VARCHAR(500),
    request_params      TEXT,
    response_data       TEXT,
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    execution_time      INT,
    status              VARCHAR(20) NOT NULL DEFAULT 'SUCCESS',
    error_message       TEXT,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_operation_logs_status CHECK (status IN ('SUCCESS', 'FAILED'))
);

-- 操作日志索引
CREATE INDEX idx_operation_logs_user_id ON operation_logs(user_id);
CREATE INDEX idx_operation_logs_module ON operation_logs(module);
CREATE INDEX idx_operation_logs_action ON operation_logs(action);
CREATE INDEX idx_operation_logs_created_at ON operation_logs(created_at DESC);
CREATE INDEX idx_operation_logs_status ON operation_logs(status);

-- 操作日志表分区（按月分区，提高查询性能）
-- 注：实际使用时可根据需要创建分区表

-- ============================================================
-- 13. 访问记录表
-- ============================================================
CREATE TABLE visit_records (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    visitor_hash        VARCHAR(64) NOT NULL,
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    referer             VARCHAR(500),
    country             VARCHAR(50),
    city                VARCHAR(100),
    device_type         VARCHAR(20),
    browser             VARCHAR(50),
    os                  VARCHAR(50),
    duration            INT DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 访问记录索引
CREATE INDEX idx_visit_records_post_id ON visit_records(post_id);
CREATE INDEX idx_visit_records_visitor_hash ON visit_records(visitor_hash);
CREATE INDEX idx_visit_records_created_at ON visit_records(created_at DESC);
CREATE INDEX idx_visit_records_date ON visit_records(DATE(created_at));

-- 访问记录表分区（可选，按日期分区）

-- ============================================================
-- 14. 访问统计表（日统计汇总）
-- ============================================================
CREATE TABLE visit_stats (
    id                  BIGSERIAL PRIMARY KEY,
    date                DATE NOT NULL UNIQUE,
    pv                  BIGINT NOT NULL DEFAULT 0,
    uv                  BIGINT NOT NULL DEFAULT 0,
    new_visitors        BIGINT NOT NULL DEFAULT 0,
    post_views          JSONB,
    country_stats       JSONB,
    device_stats        JSONB,
    browser_stats       JSONB,
    referer_stats       JSONB,
    avg_duration        INT DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 统计表索引
CREATE INDEX idx_visit_stats_date ON visit_stats(date DESC);

-- 统计表注释
COMMENT ON TABLE visit_stats IS '每日访问统计汇总表';
COMMENT ON COLUMN visit_stats.pv IS '页面浏览量';
COMMENT ON COLUMN visit_stats.uv IS '独立访客数';
COMMENT ON COLUMN visit_stats.post_views IS '文章访问量统计（JSON格式）';

-- ============================================================
-- 15. 触发器：自动更新 updated_at
-- ============================================================
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 为需要的表创建触发器
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_posts_updated_at BEFORE UPDATE ON posts
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_categories_updated_at BEFORE UPDATE ON categories
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_tags_updated_at BEFORE UPDATE ON tags
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_comments_updated_at BEFORE UPDATE ON comments
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_friend_links_updated_at BEFORE UPDATE ON friend_links
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_site_settings_updated_at BEFORE UPDATE ON site_settings
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_prompt_templates_updated_at BEFORE UPDATE ON prompt_templates
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ============================================================
-- 16. 触发器：文章发布时更新分类/标签计数
-- ============================================================
CREATE OR REPLACE FUNCTION update_post_counts()
RETURNS TRIGGER AS $$
BEGIN
    -- 更新分类文章数
    IF TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN
        IF NEW.status = 'PUBLISHED' AND NEW.deleted = FALSE THEN
            IF NEW.category_id IS NOT NULL THEN
                UPDATE categories SET post_count = (
                    SELECT COUNT(*) FROM posts 
                    WHERE category_id = NEW.category_id 
                    AND status = 'PUBLISHED' 
                    AND deleted = FALSE
                ) WHERE id = NEW.category_id;
            END IF;
        END IF;
    END IF;
    
    IF TG_OP = 'DELETE' OR (TG_OP = 'UPDATE' AND (OLD.status != NEW.status OR OLD.deleted != NEW.deleted)) THEN
        IF OLD.category_id IS NOT NULL THEN
            UPDATE categories SET post_count = (
                SELECT COUNT(*) FROM posts 
                WHERE category_id = OLD.category_id 
                AND status = 'PUBLISHED' 
                AND deleted = FALSE
            ) WHERE id = OLD.category_id;
        END IF;
    END IF;
    
    RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_post_counts
AFTER INSERT OR UPDATE OR DELETE ON posts
FOR EACH ROW EXECUTE FUNCTION update_post_counts();

-- ============================================================
-- 17. 常用查询视图
-- ============================================================

-- 已发布文章视图
CREATE VIEW v_published_posts AS
SELECT 
    p.*,
    u.username as author_username,
    u.nickname as author_nickname,
    u.avatar as author_avatar,
    c.name as category_name,
    c.slug as category_slug,
    ARRAY_AGG(DISTINCT t.name) FILTER (WHERE t.name IS NOT NULL) as tag_names,
    ARRAY_AGG(DISTINCT t.slug) FILTER (WHERE t.slug IS NOT NULL) as tag_slugs
FROM posts p
LEFT JOIN users u ON p.author_id = u.id
LEFT JOIN categories c ON p.category_id = c.id
LEFT JOIN post_tags pt ON p.id = pt.post_id
LEFT JOIN tags t ON pt.tag_id = t.id
WHERE p.status = 'PUBLISHED' AND p.deleted = FALSE
GROUP BY p.id, u.id, c.id;

-- 文章归档视图（时间树）
CREATE VIEW v_post_archives AS
SELECT 
    EXTRACT(YEAR FROM published_at)::INT as year,
    EXTRACT(MONTH FROM published_at)::INT as month,
    COUNT(*) as post_count,
    JSON_AGG(
        JSON_BUILD_OBJECT(
            'id', id,
            'title', title,
            'slug', slug,
            'published_at', published_at
        ) ORDER BY published_at DESC
    ) as posts
FROM posts
WHERE status = 'PUBLISHED' AND deleted = FALSE
GROUP BY year, month
ORDER BY year DESC, month DESC;

-- ============================================================
-- 18. 初始化管理员账户
-- ============================================================
INSERT INTO users (username, email, password_hash, nickname, role, status) VALUES
    ('admin', 'admin@aetherblog.com', 
     -- 默认密码: admin123 (使用 bcrypt 加密)
     '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iKcWQYhbdSBhT6V9GHXzLPRXxEKy', 
     '管理员', 'ADMIN', 'ACTIVE');

-- ============================================================
-- 结束
-- ============================================================
```

---

# 第三部分：功能模块详细设计

## 3.1 博客前台功能模块

### 3.1.1 功能模块总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        博客前台功能模块架构                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                         博客前台                                                   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    展示层模块                                                │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐              │  │ │
│   │   │   │  🏠 首页   │  │  📄 文章   │  │  📁 归档   │  │  🔍 搜索   │  │  🔗 友链   │              │  │ │
│   │   │   │  Home     │  │  Posts    │  │  Archives │  │  Search   │  │  Friends  │              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘              │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐                              │  │ │
│   │   │   │  🏷️ 分类   │  │  🏷️ 标签   │  │  👤 关于   │  │  📋 站点   │                              │  │ │
│   │   │   │ Categories│  │   Tags    │  │   About   │  │  SiteInfo │                              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘                              │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    交互层模块                                                │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐              │  │ │
│   │   │   │  💬 评论   │  │  ❤️ 点赞   │  │  📤 分享   │  │  🌙 主题   │  │  📖 目录   │              │  │ │
│   │   │   │  Comment  │  │   Like    │  │   Share   │  │   Theme   │  │    TOC    │              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘              │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.2 欢迎页模块

#### 3.1.2.1 功能描述

欢迎页是用户首次访问博客时的"数字化名片"，以电影级的视觉效果展示博主的个人品牌。

#### 3.1.2.2 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        欢迎页功能规格                                                     │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-WELCOME-001                                                                              │
│   【模块名称】欢迎页                                                                                       │
│   【优先级】P1 - 高                                                                                        │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  功能点清单                                                                                         │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-01  首次访问检测                                                                    │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：检测用户是否首次访问站点，决定是否展示欢迎页                                                    │ │
│   │  规则：                                                                                             │ │
│   │    • 使用 localStorage 存储访问标记 'aetherblog_visited'                                            │ │
│   │    • 标记有效期：24小时（可配置）                                                                     │ │
│   │    • 可通过后台设置永久关闭欢迎页                                                                     │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-02  背景效果                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：全屏沉浸式背景效果                                                                            │ │
│   │  选项：                                                                                             │ │
│   │    • Mesh Gradient：动态网格渐变（默认）                                                             │ │
│   │    • 高斯模糊图片：博主自定义背景图 + 模糊效果                                                        │ │
│   │    • 粒子动画：科技感粒子流动效果                                                                    │ │
│   │    • 视频背景：循环播放视频（性能考虑，默认关闭）                                                      │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-03  核心内容展示                                                                    │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：居中展示博主核心信息                                                                          │ │
│   │  内容：                                                                                             │ │
│   │    • 博主头像（圆形，带光环动效）                                                                     │ │
│   │    • 博客名称（大标题，渐入动画）                                                                     │ │
│   │    • 个性签名（打字机效果）                                                                          │ │
│   │    • 社交链接图标（GitHub、Twitter、邮箱等）                                                          │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-04  进入按钮                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：引导用户进入博客主页                                                                          │ │
│   │  交互：                                                                                             │ │
│   │    • 按钮文案可配置（默认："探索更多"）                                                               │ │
│   │    • 悬浮发光效果                                                                                   │ │
│   │    • 点击后页面向上滑出，露出首页                                                                     │ │
│   │    • 支持向下滚动或按下箭头键进入                                                                     │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-05  跳过功能                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：允许用户快速跳过欢迎页                                                                        │ │
│   │  交互：                                                                                             │ │
│   │    • 右上角"跳过"链接（淡入显示，2秒后出现）                                                          │ │
│   │    • 3秒后自动淡出（可配置自动进入时间）                                                              │ │
│   │    • ESC 键快速跳过                                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  动效规范                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  进入动画序列：                                                                                      │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  0ms     → 背景渐入 (opacity: 0 → 1, duration: 800ms)                                              │ │
│   │  400ms   → 头像缩放进入 (scale: 0.8 → 1, duration: 600ms, easing: spring)                          │ │
│   │  600ms   → 标题淡入上滑 (translateY: 20px → 0, duration: 500ms)                                    │ │
│   │  900ms   → 签名打字机效果开始 (每字符 50ms)                                                          │ │
│   │  1500ms  → 社交链接依次弹入 (每个间隔 100ms, scale: 0 → 1)                                          │ │
│   │  2000ms  → 进入按钮淡入 (opacity: 0 → 1, duration: 400ms)                                          │ │
│   │                                                                                                    │ │
│   │  退出动画：                                                                                         │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  整体向上滑出 (translateY: 0 → -100vh, duration: 800ms, easing: easeInOut)                         │ │
│   │  同时首页从下方滑入                                                                                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  验收标准                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  □ 首次访问正确展示欢迎页                                                                            │ │
│   │  □ 再次访问（24小时内）不展示欢迎页                                                                   │ │
│   │  □ 所有动画流畅运行，无卡顿（FPS >= 55）                                                             │ │
│   │  □ 打字机效果正确显示完整签名                                                                        │ │
│   │  □ 点击进入按钮正确过渡到首页                                                                        │ │
│   │  □ 跳过功能正常工作                                                                                  │ │
│   │  □ 移动端正确响应式适配                                                                              │ │
│   │  □ 后台可配置欢迎页内容和开关                                                                        │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.3 首页模块

#### 3.1.3.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          首页功能规格                                                     │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-HOME-001                                                                                 │
│   【模块名称】博客首页                                                                                     │
│   【优先级】P0 - 核心                                                                                      │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  页面布局                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              顶部导航栏 (固定)                                              │  │ │
│   │   │   Logo  │  首页  │  归档  │  分类  │  标签  │  友链  │  关于  │        🔍  │  🌙            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              Hero 区域 (可选)                                               │  │ │
│   │   │                                                                                            │  │ │
│   │   │                         博客名称 / 简介 / 快速入口                                          │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────┐  ┌────────────────────────────────────┐    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │              文章列表区域 (主内容)                │  │          侧边栏                    │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │  📌 置顶文章卡片 (精选样式)                │  │  │  │  👤 博主信息卡片           │   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  头像 / 名称 / 简介         │   │    │ │
│   │   │                                                  │  │  │  社交链接                   │   │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  📄 普通文章卡片                          │  │  │                                    │    │ │
│   │   │   │  封面图 / 标题 / 摘要 / 标签 / 日期       │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  🔥 热门文章                │   │    │ │
│   │   │                                                  │  │  │  Top 5 列表                │   │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  📄 普通文章卡片                          │  │  │                                    │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  ┌────────────────────────────┐   │    │ │
│   │   │                                                  │  │  │  🏷️ 标签云                  │   │    │ │
│   │   │   ... 更多文章                                  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │  📄 分页器                                │  │  │  │  📊 站点统计               │   │    │ │
│   │   │   │  « 1 2 3 ... 10 »                        │  │  │  │  文章数 / 字数 / 访问量    │   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   └──────────────────────────────────────────────────┘  └────────────────────────────────────┘    │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              页脚区域                                                       │  │ │
│   │   │   版权信息 │ ICP备案 │ 运行时间 │ 主题信息 │ 返回顶部                                       │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  功能点详细规格                                                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-01  导航栏                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 固定在页面顶部 (position: sticky)                                                               │ │
│   │  • 滚动时背景变为毛玻璃效果 (backdrop-blur)                                                         │ │
│   │  • 当前页面导航项高亮                                                                               │ │
│   │  • 移动端折叠为汉堡菜单                                                                             │ │
│   │  • 搜索按钮点击打开全屏搜索面板                                                                      │ │
│   │  • 主题切换按钮 (亮色/暗色/跟随系统)                                                                 │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-02  文章列表                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 默认每页显示 10 篇文章                                                                           │ │
│   │  • 置顶文章始终显示在最前                                                                           │ │
│   │  • 支持无限滚动加载（可选）或分页器                                                                  │ │
│   │  • 文章卡片包含：封面图、标题、摘要、分类、标签、发布日期、阅读时间、浏览量                            │ │
│   │  • 卡片悬浮效果：上浮 + 阴影增强 + 光效                                                             │ │
│   │  • 列表加载动画：依次淡入上滑                                                                        │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-03  侧边栏                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 桌面端显示，平板/移动端隐藏或折叠                                                                 │ │
│   │  • 滚动时跟随（sticky），但不超过页脚                                                                │ │
│   │  • 模块可配置显示/隐藏                                                                              │ │
│   │  • 各模块采用统一的毛玻璃卡片样式                                                                    │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-04  博主信息卡片                                                                      │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 头像（圆形，悬浮旋转效果）                                                                        │ │
│   │  • 昵称 + 一句话简介                                                                                │ │
│   │  • 社交链接图标（GitHub、Twitter、Email、RSS等）                                                     │ │
│   │  • 统计数据：文章数、标签数、分类数                                                                  │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-05  热门文章                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 显示浏览量 Top 5 的文章                                                                          │ │
│   │  • 紧凑列表样式：序号 + 标题 + 浏览量                                                               │ │
│   │  • 序号采用渐变色标识 (1-金, 2-银, 3-铜, 其他-灰)                                                    │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-06  标签云                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 显示使用频率最高的标签                                                                           │ │
│   │  • 标签大小根据使用次数动态调整                                                                      │ │
│   │  • 支持展开/收起更多标签                                                                            │ │
│   │  • 点击标签跳转到标签详情页                                                                         │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-07  站点统计                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 文章总数                                                                                        │ │
│   │  • 总字数（带单位：万字）                                                                           │ │
│   │  • 总访问量                                                                                        │ │
│   │  • 站点运行天数                                                                                    │ │
│   │  • 数字使用动态计数动画                                                                             │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.4 文章详情模块

#### 3.1.4.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       文章详情页功能规格                                                   │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-POST-001                                                                                 │
│   【模块名称】文章详情页                                                                                   │
│   【优先级】P0 - 核心                                                                                      │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  页面布局                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    顶部导航栏                                               │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              阅读进度条 (顶部细线)                                          │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              文章头部区域                                                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  封面图 (全宽，带视差滚动效果)                                                       │  │  │ │
│   │   │   │  渐变遮罩覆盖                                                                       │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │   分类标签  •  发布日期  •  更新日期  •  阅读时间  •  字数统计  •  浏览量                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ████████████████████████████████████████████████████████████████████████████████████    │  │ │
│   │   │                              文 章 标 题                                                   │  │ │
│   │   │   ████████████████████████████████████████████████████████████████████████████████████    │  │ │
│   │   │                                                                                            │  │ │
│   │   │   标签列表: #标签1  #标签2  #标签3                                                         │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────┐  ┌────────────────────────────────────┐    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │              文章正文区域                         │  │     目录导航 (TOC)                 │    │ │
│   │   │                                                  │  │     (Sticky 定位)                  │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │                                    │    │ │
│   │   │   │  Markdown 渲染内容                        │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │                                          │  │  │  │  📑 目录                    │   │    │ │
│   │   │   │  • 标题层级 (H1-H6)                      │  │  │  │  ├─ 一级标题               │   │    │ │
│   │   │   │  • 段落文本                              │  │  │  │  │  ├─ 二级标题            │   │    │ │
│   │   │   │  • 代码块 (语法高亮+折叠+复制)           │  │  │  │  │  │  └─ 三级标题         │   │    │ │
│   │   │   │  • 数学公式 (KaTeX)                      │  │  │  │  │  └─ 二级标题            │   │    │ │
│   │   │   │  • 图表 (Mermaid)                        │  │  │  │  └─ 一级标题               │   │    │ │
│   │   │   │  • 图片 (居中+灯箱)                      │  │  │  │                              │   │    │ │
│   │   │   │  • 表格                                  │  │  │  │  当前阅读位置高亮            │   │    │ │
│   │   │   │  • 引用块                                │  │  │  │  点击跳转到对应章节          │   │    │ │
│   │   │   │  • 列表                                  │  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  • 链接                                  │  │  │                                    │    │ │
│   │   │   │                                          │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  🔧 工具栏                  │   │    │ │
│   │   │                                                  │  │  │  ❤️ 点赞 (123)              │   │    │ │
│   │   │                                                  │  │  │  💬 评论 (45)               │   │    │ │
│   │   │                                                  │  │  │  📤 分享                    │   │    │ │
│   │   │                                                  │  │  │  ⬆️ 返回顶部                │   │    │ │
│   │   │                                                  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   └──────────────────────────────────────────────────┘  └────────────────────────────────────┘    │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              文章底部区域                                                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌──────────────────────────────────┐  ┌──────────────────────────────────┐              │  │ │
│   │   │   │  ⬅️ 上一篇                        │  │  下一篇 ➡️                        │              │  │ │
│   │   │   │  《上一篇文章标题》               │  │  《下一篇文章标题》               │              │  │ │
│   │   │   └──────────────────────────────────┘  └──────────────────────────────────┘              │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  🔗 相关文章推荐                                                                    │  │  │ │
│   │   │   │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐                   │  │  │ │
│   │   │   │  │ 相关文章1  │  │ 相关文章2  │  │ 相关文章3  │  │ 相关文章4  │                   │  │  │ │
│   │   │   │  └────────────┘  └────────────┘  └────────────┘  └────────────┘                   │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  💬 评论区域                                                                        │  │  │ │
│   │   │   │  评论输入框 + 评论列表                                                              │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.4.2 Markdown 渲染规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       Markdown 渲染功能规格                                               │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-POST-001-MD                                                                              │
│   【功能名称】Markdown 渲染引擎                                                                            │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  基础语法支持                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  ┌─────────────────┬───────────────────────────────────────────────────────────────────────────┐  │ │
│   │  │  语法类型        │  渲染规格                                                                  │  │ │
│   │  ├─────────────────┼───────────────────────────────────────────────────────────────────────────┤  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  标题 (H1-H6)   │  • 自动生成锚点 ID (用于目录导航)                                          │  │ │
│   │  │                 │  • 悬浮显示锚点链接图标                                                    │  │ │
│   │  │                 │  • 字号递减：H1=2rem, H2=1.75rem, H3=1.5rem...                            │  │ │
│   │  │                 │  • H1/H2 下方添加渐变分隔线                                                │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  段落           │  • 行高 1.75，字间距适中                                                   │  │ │
│   │  │                 │  • 段落间距 1.5rem                                                        │  │ │
│   │  │                 │  • 首行不缩进（西式排版）                                                  │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  粗体/斜体      │  • 粗体：font-weight: 600, 颜色加深                                       │  │ │
│   │  │                 │  • 斜体：font-style: italic                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  删除线         │  • text-decoration: line-through                                          │  │ │
│   │  │                 │  • 颜色变灰                                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  行内代码       │  • 背景色：rgba(primary, 0.1)                                              │  │ │
│   │  │                 │  • 圆角：4px                                                              │  │ │
│   │  │                 │  • 等宽字体                                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  链接           │  • 主色调下划线                                                            │  │ │
│   │  │                 │  • 悬浮变色 + 下划线加粗                                                   │  │ │
│   │  │                 │  • 外部链接添加图标标识                                                    │  │ │
│   │  │                 │  • 新窗口打开外部链接                                                      │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  列表           │  • 无序列表：自定义圆点样式                                                 │  │ │
│   │  │                 │  • 有序列表：主色调数字                                                    │  │ │
│   │  │                 │  • 支持多级嵌套                                                           │  │ │
│   │  │                 │  • 任务列表：自定义复选框样式                                              │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  引用块         │  • 左侧主色调竖线                                                          │  │ │
│   │  │                 │  • 背景色半透明                                                            │  │ │
│   │  │                 │  • 支持嵌套引用                                                            │  │ │
│   │  │                 │  • 特殊提示块：> [!NOTE], > [!WARNING], > [!TIP]                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  分隔线         │  • 渐变线条，中间亮两端暗                                                  │  │ │
│   │  │                 │  • 上下间距 2rem                                                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  表格           │  • 表头背景加深                                                            │  │ │
│   │  │                 │  • 斑马纹行                                                               │  │ │
│   │  │                 │  • 悬浮行高亮                                                             │  │ │
│   │  │                 │  • 响应式横向滚动                                                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  └─────────────────┴───────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  代码块增强规格                                                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-CODE  代码块渲染                                                                   │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  外观设计：                                                                                         │ │
│   │  • macOS 风格窗口：红黄绿三个圆点 + 语言标签                                                        │ │
│   │  • 深色主题背景：#282c34 (One Dark Pro)                                                            │ │
│   │  • 圆角边框：12px                                                                                  │ │
│   │  • 阴影效果：大阴影营造悬浮感                                                                       │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 语法高亮：支持 100+ 种语言 (Shiki 引擎)                                                         │ │
│   │  • 行号显示：可配置开关                                                                             │ │
│   │  • 行高亮：支持高亮指定行 (```js {1,3-5})                                                          │ │
│   │  • 一键复制：悬浮显示复制按钮，点击后显示"已复制"反馈                                                │ │
│   │  • 代码折叠：超过 20 行自动折叠，显示"展开全部代码"按钮                                              │ │
│   │  • 全屏查看：点击全屏按钮放大查看                                                                   │ │
│   │  • 差异显示：支持 diff 语法高亮 (+/- 行)                                                           │ │
│   │                                                                                                    │ │
│   │  支持语言（部分）：                                                                                 │ │
│   │  javascript, typescript, python, java, go, rust, c, cpp, csharp,                                  │ │
│   │  html, css, scss, json, yaml, xml, markdown, sql, bash, shell,                                    │ │
│   │  dockerfile, nginx, graphql, prisma, solidity, kotlin, swift...                                   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  数学公式规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-MATH  数学公式渲染                                                                 │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  渲染引擎：KaTeX (性能优于 MathJax)                                                                 │ │
│   │                                                                                                    │ │
│   │  语法支持：                                                                                         │ │
│   │  • 行内公式：$E = mc^2$                                                                            │ │
│   │  • 块级公式：$$...$$                                                                               │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 支持完整 LaTeX 数学语法                                                                         │ │
│   │  • 矩阵、分数、积分、求和、极限等                                                                   │ │
│   │  • 块级公式居中显示，带序号（可选）                                                                  │ │
│   │  • 公式渲染错误时显示原始代码 + 错误提示                                                            │ │
│   │  • 点击公式可放大查看                                                                               │ │
│   │                                                                                                    │ │
│   │  示例支持：                                                                                         │ │
│   │  • 分数：\frac{a}{b}                                                                               │ │
│   │  • 求和：\sum_{i=1}^{n} x_i                                                                        │ │
│   │  • 积分：\int_{a}^{b} f(x) dx                                                                      │ │
│   │  • 矩阵：\begin{bmatrix} a & b \\ c & d \end{bmatrix}                                              │ │
│   │  • 希腊字母：\alpha, \beta, \gamma, \theta, \lambda...                                             │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  图表渲染规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-CHART  Mermaid 图表渲染                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  支持图表类型：                                                                                     │ │
│   │  • 流程图 (Flowchart)                                                                              │ │
│   │  • 时序图 (Sequence Diagram)                                                                       │ │
│   │  • 类图 (Class Diagram)                                                                            │ │
│   │  • 状态图 (State Diagram)                                                                          │ │
│   │  • 甘特图 (Gantt Chart)                                                                            │ │
│   │  • 饼图 (Pie Chart)                                                                                │ │
│   │  • ER图 (Entity Relationship Diagram)                                                              │ │
│   │  • Git图 (Git Graph)                                                                               │ │
│   │  • 思维导图 (Mind Map)                                                                             │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 暗色主题适配                                                                                    │ │
│   │  • 主色调配色                                                                                      │ │
│   │  • 导出为 SVG                                                                                      │ │
│   │  • 全屏查看                                                                                        │ │
│   │  • 渲染失败时显示错误信息                                                                          │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  图片渲染规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-IMAGE  图片增强渲染                                                                │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  基础功能：                                                                                         │ │
│   │  • 默认居中显示                                                                                    │ │
│   │  • 圆角边框 + 阴影                                                                                 │ │
│   │  • 懒加载 (Lazy Loading)                                                                           │ │
│   │  • 加载骨架屏                                                                                      │ │
│   │  • 加载失败占位图                                                                                  │ │
│   │                                                                                                    │ │
│   │  灯箱功能：                                                                                         │ │
│   │  • 点击图片放大查看                                                                                 │ │
│   │  • 支持缩放和拖拽                                                                                  │ │
│   │  • 多图时支持左右切换                                                                               │ │
│   │  • 键盘快捷键：ESC关闭, ←→切换                                                                     │ │
│   │  • 下载原图按钮                                                                                    │ │
│   │                                                                                                    │ │
│   │  扩展语法：                                                                                         │ │
│   │  • 指定宽度：![alt](url){width=500}                                                                │ │
│   │  • 指定比例：![alt](url){width=50%}                                                                │ │
│   │  • 左对齐：![alt](url){align=left}                                                                 │ │
│   │  • 右对齐：![alt](url){align=right}                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.5 时间树归档模块

#### 3.1.5.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        时间树归档模块功能规格                                              │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   时间树是一个以时间轴为核心的文章归档可视化组件，采用树形层级结构展示博客历史。                          │ │
│   │   它不仅是功能性的归档工具，更是博客历史的艺术化呈现，让读者能够以非线性方式探索内容。                     │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         层级结构                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   第一层级：年份节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示年份数字（如 2025）                                                                    │  │ │
│   │   │  • 显示该年文章总数                                                                           │  │ │
│   │   │  • 圆形节点，带脉冲动画效果                                                                    │  │ │
│   │   │  • 点击可展开/收起月份列表                                                                     │  │ │
│   │   │  • 最新年份默认展开                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   第二层级：月份节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示月份名称（一月、二月...）                                                               │  │ │
│   │   │  • 显示该月文章数量                                                                           │  │ │
│   │   │  • 较小的圆形节点                                                                             │  │ │
│   │   │  • 点击可展开/收起文章列表                                                                     │  │ │
│   │   │  • 与年份节点通过连接线关联                                                                    │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   第三层级：文章节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示文章标题                                                                               │  │ │
│   │   │  • 显示发布日期（几号）                                                                        │  │ │
│   │   │  • 显示阅读时间                                                                               │  │ │
│   │   │  • 显示首个标签                                                                               │  │ │
│   │   │  • 悬浮时显示更多信息                                                                          │  │ │
│   │   │  • 点击跳转至文章详情                                                                          │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.5.2 交互设计规范

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        时间树交互设计规范                                                  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【展开/收起动画】                                                                                       │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   年份节点展开：                                                                                 │   │
│   │   • 箭头图标旋转 90°（0° → 90°，时长 200ms）                                                      │   │
│   │   • 子节点区域高度从 0 过渡到 auto                                                                │   │
│   │   • 使用 Framer Motion 的 layout 属性实现平滑过渡                                                 │   │
│   │   • 弹簧动画参数: stiffness: 300, damping: 30                                                    │   │
│   │                                                                                                 │   │
│   │   月份节点展开：                                                                                 │   │
│   │   • 与年份节点类似，但动画时长稍短（150ms）                                                        │   │
│   │   • 文章列表以瀑布流方式依次出现                                                                  │   │
│   │   • 每个文章项延迟 30ms 出现                                                                     │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【连接线动画】                                                                                          │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   主时间线：                                                                                     │   │
│   │   • 垂直渐变线（从主色到透明）                                                                    │   │
│   │   • 位于左侧，贯穿整个时间树                                                                      │   │
│   │   • 宽度 2px                                                                                    │   │
│   │                                                                                                 │   │
│   │   分支连接线：                                                                                   │   │
│   │   • 水平线连接父节点和子节点                                                                      │   │
│   │   • 展开时从左向右延伸动画                                                                        │   │
│   │   • 使用 SVG path 绘制，支持曲线效果                                                              │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【节点状态】                                                                                            │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   默认状态：                                                                                     │   │
│   │   • 年份节点: 主色背景，白色图标，带微弱光晕                                                       │   │
│   │   • 月份节点: 次要色背景，较小尺寸                                                                │   │
│   │   • 文章项: 透明背景，灰色文字                                                                    │   │
│   │                                                                                                 │   │
│   │   悬浮状态：                                                                                     │   │
│   │   • 年份节点: 放大 1.1 倍，光晕增强                                                               │   │
│   │   • 月份节点: 背景变亮                                                                           │   │
│   │   • 文章项: 背景出现，向右位移 4px，文字变白                                                       │   │
│   │                                                                                                 │   │
│   │   展开状态：                                                                                     │   │
│   │   • 节点添加脉冲动画（无限循环）                                                                  │   │
│   │   • 脉冲环从节点向外扩散渐隐                                                                      │   │
│   │                                                                                                 │   │
│   │   当前阅读状态：                                                                                 │   │
│   │   • 如果时间树在文章详情页侧边栏展示                                                               │   │
│   │   • 当前阅读文章高亮显示                                                                          │   │
│   │   • 添加特殊标记图标                                                                             │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【响应式适配】                                                                                          │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   桌面端 (≥1024px)：                                                                            │   │
│   │   • 完整的三层结构展示                                                                           │   │
│   │   • 可作为侧边栏或独立页面                                                                        │   │
│   │                                                                                                 │   │
│   │   平板端 (768px - 1023px)：                                                                     │   │
│   │   • 保持三层结构                                                                                 │   │
│   │   • 节点尺寸适当缩小                                                                             │   │
│   │                                                                                                 │   │
│   │   移动端 (<768px)：                                                                             │   │
│   │   • 全屏展示                                                                                    │   │
│   │   • 增大触摸目标区域                                                                             │   │
│   │   • 简化连接线效果                                                                               │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.5.3 数据结构设计

```typescript
// 时间树数据类型定义

/**
 * 时间树年份数据
 */
interface TimeTreeYear {
  year: number;                    // 年份
  months: TimeTreeMonth[];         // 月份列表
  totalPosts: number;              // 该年文章总数
  isExpanded?: boolean;            // 是否展开
}

/**
 * 时间树月份数据
 */
interface TimeTreeMonth {
  month: number;                   // 月份 (1-12)
  monthName: string;               // 月份名称 (一月, 二月...)
  posts: TimeTreePost[];           // 文章列表
  postCount: number;               // 文章数量
  isExpanded?: boolean;            // 是否展开
}

/**
 * 时间树文章数据
 */
interface TimeTreePost {
  id: number;                      // 文章ID
  title: string;                   // 文章标题
  slug: string;                    // URL Slug
  publishedAt: string;             // 发布时间 ISO 格式
  day: number;                     // 发布日期 (1-31)
  readingTime: number;             // 阅读时间（分钟）
  tags?: Array<{                   // 标签列表
    id: number;
    name: string;
  }>;
}

/**
 * 时间树完整数据
 */
interface TimeTreeData {
  years: TimeTreeYear[];           // 年份列表（按年份降序）
  totalPosts: number;              // 总文章数
  dateRange: {                     // 日期范围
    start: string;                 // 最早文章日期
    end: string;                   // 最新文章日期
  };
}
```

#### 3.1.5.4 API 接口设计

```yaml
# 时间树归档接口

GET /api/v1/archives/time-tree:
  summary: 获取时间树归档数据
  description: |
    返回按年份-月份-文章层级组织的归档数据，
    用于前端渲染时间树组件
  parameters:
    - name: includeDetails
      in: query
      description: 是否包含文章详细信息（标签等）
      schema:
        type: boolean
        default: false
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 200
              data:
                type: object
                properties:
                  years:
                    type: array
                    items:
                      $ref: '#/components/schemas/TimeTreeYear'
                  totalPosts:
                    type: integer
                    example: 156
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2022-03-15"
                      end:
                        type: string
                        example: "2025-01-20"

GET /api/v1/archives/calendar:
  summary: 获取日历热力图数据
  description: |
    返回每日发文数量统计，用于渲染类似 GitHub 贡献图的热力图
  parameters:
    - name: year
      in: query
      description: 年份，默认当前年
      schema:
        type: integer
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  type: object
                  properties:
                    date:
                      type: string
                      example: "2025-01-15"
                    count:
                      type: integer
                      example: 2

GET /api/v1/archives/stats:
  summary: 获取归档统计数据
  description: 返回博客的整体统计信息
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              totalPosts:
                type: integer
                example: 156
              totalWords:
                type: integer
                example: 523000
              totalCategories:
                type: integer
                example: 12
              totalTags:
                type: integer
                example: 87
              firstPostDate:
                type: string
                example: "2022-03-15"
              lastPostDate:
                type: string
                example: "2025-01-20"
              avgPostsPerMonth:
                type: number
                example: 4.5
```

### 3.1.6 全文搜索模块

#### 3.1.6.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        全文搜索模块功能规格                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   AetherBlog 的搜索功能采用混合搜索策略，结合传统关键词搜索与 AI 语义搜索，                           │ │
│   │   为用户提供精准且智能的内容发现体验。                                                               │ │
│   │                                                                                                    │ │
│   │   核心特性：                                                                                        │ │
│   │   • 全文检索：基于 Elasticsearch 的高性能全文搜索                                                    │ │
│   │   • 语义搜索：基于向量相似度的 AI 语义理解                                                           │ │
│   │   • 混合排序：RRF 算法融合两路结果                                                                  │ │
│   │   • AI 回答：基于 RAG 的智能问答                                                                    │ │
│   │   • 搜索建议：实时搜索提示与历史记录                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         搜索模式                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   模式一：快速搜索（Command+K 唤起）                                                                 │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 全局快捷键唤起搜索面板                                                                     │  │ │
│   │   │  • 支持模糊匹配文章标题                                                                       │  │ │
│   │   │  • 实时显示搜索结果（防抖 300ms）                                                             │  │ │
│   │   │  • 键盘导航：↑↓ 选择，Enter 打开，Esc 关闭                                                    │  │ │
│   │   │  • 显示最近搜索历史                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   模式二：高级搜索（搜索页面）                                                                      │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 完整的搜索结果页面                                                                         │  │ │
│   │   │  • 支持筛选：分类、标签、时间范围                                                              │  │ │
│   │   │  • 支持排序：相关度、时间、热度                                                                │  │ │
│   │   │  • 高亮匹配关键词                                                                             │  │ │
│   │   │  • 分页加载更多结果                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   模式三：AI 问答搜索                                                                              │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 支持自然语言提问                                                                           │  │ │
│   │   │  • AI 基于博客内容生成回答                                                                    │  │ │
│   │   │  • 显示回答来源（引用文章）                                                                    │  │ │
│   │   │  • 流式输出回答内容                                                                           │  │ │
│   │   │  • 可展开查看相关文章列表                                                                      │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         搜索算法                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   混合搜索流程：                                                                                   │ │
│   │                                                                                                    │ │
│   │   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐               │ │
│   │   │  用户查询    │ ──▶ │  查询预处理   │ ──▶ │   并行检索   │ ──▶ │   RRF 融合   │               │ │
│   │   └──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘               │ │
│   │                              │                     │                     │                        │ │
│   │                              ▼                     ▼                     ▼                        │ │
│   │                        • 分词处理            • 向量检索            • 结果合并                     │ │
│   │                        • 同义词扩展          • 关键词检索          • 去重排序                     │ │
│   │                        • 意图识别            • BM25 评分           • 返回 TopK                    │ │
│   │                                                                                                    │ │
│   │   RRF (Reciprocal Rank Fusion) 公式：                                                              │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   RRFscore(d) = Σ 1 / (k + rank_i(d))                                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   其中：k = 60（常用值），rank_i(d) 为文档 d 在第 i 路检索中的排名                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.6.2 搜索界面设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        搜索面板 UI 设计                                                   │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                              搜索面板布局（全屏遮罩模式）                                            │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                   🔍 搜索框区域                                              │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │ 🔍 │ 搜索文章、标签、分类... (支持自然语言)                           │ ✕ │ 加载中 │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │  提示: 支持自然语言搜索，例如 "如何优化 Spring Boot 性能"                                    │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 ✨ AI 智能回答区域                                          │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │  ✨ AI 智能回答                                                              加载中... │  │  │ │
│   │   │  │  ────────────────────────────────────────────────────────────────────────────────────  │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  根据您的问题，Spring Boot 性能优化主要可以从以下几个方面入手：                          │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  1. **JVM 参数调优** - 合理配置堆内存、GC 策略...                                       │  │  │ │
│   │   │  │  2. **数据库连接池优化** - 使用 HikariCP，调整连接数...                                 │  │  │ │
│   │   │  │  3. **缓存策略** - 引入 Redis 缓存热点数据...                                          │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  来源: Spring Boot 性能调优实战、JVM 内存管理详解                                       │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│                                                                                                          │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 📄 搜索结果列表区域                                         │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ Spring Boot 3 性能调优完全指南                                    → │ │  │  │ │
│   │   │  │  │    │ 本文详细介绍了 <mark>Spring Boot</mark> 应用的<mark>性能</mark>优化...    │ │  │  │ │
│   │   │  │  │    │ 📁 后端开发  🏷️ Spring Boot, 性能优化  📅 2025-01-15  匹配度 95%         │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ JVM 内存管理与 GC 调优实战                                         → │ │  │  │ │
│   │   │  │  │    │ 深入分析 JVM 内存结构，探讨如何通过 GC 调优提升<mark>性能</mark>...       │ │  │  │ │
│   │   │  │  │    │ 📁 Java 核心  🏷️ JVM, GC  📅 2025-01-10  匹配度 87%                      │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ 微服务架构下的性能监控体系                                          → │ │  │  │ │
│   │   │  │  │    │ 介绍如何构建完善的<mark>性能</mark>监控体系，实时发现性能瓶颈...          │ │  │  │ │
│   │   │  │  │    │ 📁 架构设计  🏷️ 微服务, 监控  📅 2024-12-20  匹配度 82%                  │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 ⌨️ 快捷键提示区域                                           │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │  ↑↓ 导航  │  Enter 打开  │  Esc 关闭  │  ✨ AI 语义搜索已启用                        │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                              无结果状态 / 初始状态设计                                              │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【初始状态 - 未输入】                                                                            │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   🕒 搜索历史                                              [清空]                           │  │ │
│   │   │   ────────────────────────────────────────────────────────────────                          │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                          │  │ │
│   │   │   │ 🕒 Spring   │ │ 🕒 React 19 │ │ 🕒 Docker   │ │ 🕒 性能优化  │                          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘                          │  │ │
│   │   │                                                                                             │  │ │
│   │   │   🔥 热门搜索                                                                               │  │ │
│   │   │   ────────────────────────────────────────────────────────────────                          │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ 1 JDK 21   │ │ 2 微服务    │ │ 3 AI 开发   │ │ 4 K8s 部署  │ │ 5 前端框架  │          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   │   💡 支持自然语言搜索，例如："如何优化 Spring Boot 性能"                                     │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   【无结果状态】                                                                                   │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │                              🔍                                                             │  │ │
│   │   │                         (搜索图标)                                                          │  │ │
│   │   │                                                                                             │  │ │
│   │   │              未找到与 "xxxxxx" 相关的内容                                                   │  │ │
│   │   │                                                                                             │  │ │
│   │   │              试试其他关键词，或使用更具体的描述                                              │  │ │
│   │   │                                                                                             │  │ │
│   │   │              ────────────────────────────────────                                           │  │ │
│   │   │              建议：                                                                         │  │ │
│   │   │              • 检查关键词拼写                                                               │  │ │
│   │   │              • 使用更通用的词汇                                                             │  │ │
│   │   │              • 尝试浏览分类页面                                                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.6.3 搜索 API 接口设计

```yaml
# 搜索相关接口定义

# 1. 基础搜索接口
POST /api/v1/search:
  summary: 混合搜索
  description: |
    执行混合搜索，同时使用关键词搜索和语义搜索，
    通过 RRF 算法融合结果返回最相关的文章
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - query
          properties:
            query:
              type: string
              description: 搜索关键词或自然语言问题
              example: "如何优化 Spring Boot 性能"
            page:
              type: integer
              default: 1
            size:
              type: integer
              default: 10
              maximum: 50
            filters:
              type: object
              properties:
                categoryId:
                  type: integer
                tagIds:
                  type: array
                  items:
                    type: integer
                dateFrom:
                  type: string
                  format: date
                dateTo:
                  type: string
                  format: date
            sortBy:
              type: string
              enum: [relevance, date, views]
              default: relevance
  responses:
    200:
      description: 搜索成功
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 200
              data:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/SearchResult'
                  total:
                    type: integer
                  page:
                    type: integer
                  hasMore:
                    type: boolean
                  queryTime:
                    type: integer
                    description: 查询耗时(毫秒)

# 2. AI 问答搜索接口
POST /api/v1/search/ai-answer:
  summary: AI 问答搜索
  description: |
    基于 RAG 的智能问答搜索，
    AI 会根据博客内容生成针对性回答
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - question
          properties:
            question:
              type: string
              description: 用户问题
              example: "Spring Boot 3 有哪些新特性？"
            stream:
              type: boolean
              default: true
              description: 是否流式输出
  responses:
    200:
      description: 成功（非流式）
      content:
        application/json:
          schema:
            type: object
            properties:
              answer:
                type: string
              sources:
                type: array
                items:
                  type: object
                  properties:
                    postId:
                      type: integer
                    title:
                      type: string
                    slug:
                      type: string
              confidence:
                type: number
                format: float
    # 流式响应
    200-stream:
      description: 成功（流式）
      content:
        text/event-stream:
          schema:
            type: string

# 3. 搜索建议接口
GET /api/v1/search/suggestions:
  summary: 获取搜索建议
  description: 根据输入前缀返回搜索建议
  parameters:
    - name: q
      in: query
      required: true
      schema:
        type: string
        minLength: 1
    - name: limit
      in: query
      schema:
        type: integer
        default: 5
        maximum: 10
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              suggestions:
                type: array
                items:
                  type: object
                  properties:
                    text:
                      type: string
                    type:
                      type: string
                      enum: [post, tag, category]
                    highlight:
                      type: string

# 4. 热门搜索接口
GET /api/v1/search/trending:
  summary: 获取热门搜索词
  parameters:
    - name: limit
      in: query
      schema:
        type: integer
        default: 10
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              trending:
                type: array
                items:
                  type: object
                  properties:
                    keyword:
                      type: string
                    count:
                      type: integer

# 组件定义
components:
  schemas:
    SearchResult:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        slug:
          type: string
        highlight:
          type: string
          description: 高亮匹配片段
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        publishedAt:
          type: string
          format: date
        score:
          type: number
          format: float
          description: 相关度分数 0-1
```

### 3.1.7 友链展示模块

#### 3.1.7.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        友链展示模块功能规格                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   友链模块不仅是链接交换的功能页面，更是博主社交圈的优雅展示。                                        │ │
│   │   每个友链都以精美的卡片形式呈现，展现独特的视觉风格。                                                │ │
│   │                                                                                                    │ │
│   │   核心设计理念：                                                                                    │ │
│   │   • 卡片化设计：每个友链独立成卡，信息层次清晰                                                       │ │
│   │   • 个性化主题：支持自定义主题色，体现友链特色                                                       │ │
│   │   • 动效增强：悬浮光效、位移动画提升交互体验                                                         │ │
│   │   • 状态检测：自动检测友链可访问性                                                                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         卡片信息结构                                                │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────────────────────────────────────────────────────────────────────────────┐   │  │ │
│   │   │   │ ═══════════════════════════════════ (主题色装饰条)                                  │   │  │ │
│   │   │   ├─────────────────────────────────────────────────────────────────────────────────────┤   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   │   ┌───────────┐                                                                    │   │  │ │
│   │   │   │   │           │   博主昵称                                    ↗                    │   │  │ │
│   │   │   │   │  头像/图标 │   ────────────────────────────────────────                        │   │  │ │
│   │   │   │   │           │   博客简介或个性签名，简要描述博客内容...                           │   │  │ │
│   │   │   │   └───────────┘                                                                    │   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   │   ┌─────────┐ ┌─────────┐ ┌─────────┐                                              │   │  │ │
│   │   │   │   │ 标签1   │ │ 标签2   │ │ 标签3   │  (可选标签)                                  │   │  │ │
│   │   │   │   └─────────┘ └─────────┘ └─────────┘                                              │   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   ├─────────────────────────────────────────────────────────────────────────────────────┤   │  │ │
│   │   │   │   🌐 example.com                                           📧  📡               │   │  │ │
│   │   │   └─────────────────────────────────────────────────────────────────────────────────────┘   │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   卡片元素说明：                                                                                   │ │
│   │   • 主题色装饰条：顶部渐变色条，使用友链配置的主题色                                                 │ │
│   │   • 头像：圆形头像，支持图片加载失败时显示首字母                                                     │ │
│   │   • 博主昵称：友链名称，悬浮变色                                                                    │ │
│   │   • 简介：博客描述，最多显示两行                                                                    │ │
│   │   • 标签：可选的分类标签                                                                           │ │
│   │   • 域名：显示友链域名                                                                             │ │
│   │   • 社交图标：邮箱、RSS 订阅链接                                                                   │ │
│   │   • 外链图标：右上角的外链指示                                                                      │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         交互效果                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   默认状态：                                                                                        │ │
│   │   • 毛玻璃背景（bg-white/5 backdrop-blur-xl）                                                       │ │
│   │   • 微弱边框（border-white/10）                                                                     │ │
│   │   • 柔和阴影                                                                                        │ │
│   │                                                                                                    │ │
│   │   悬浮状态：                                                                                        │ │
│   │   • 卡片整体上移 8px                                                                                │ │
│   │   • 背景亮度增加                                                                                    │ │
│   │   • 主题色光晕出现                                                                                  │ │
│   │   • 边框颜色加深                                                                                    │ │
│   │   • 头像轻微晃动动画                                                                                │ │
│   │                                                                                                    │ │
│   │   点击效果：                                                                                        │ │
│   │   • 轻微缩放反馈                                                                                    │ │
│   │   • 新标签页打开友链                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         页面布局                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   响应式网格布局：                                                                                  │ │
│   │   • 桌面端 (≥1024px): 3 列                                                                         │ │
│   │   • 平板端 (768-1023px): 2 列                                                                      │ │
│   │   • 移动端 (<768px): 1 列                                                                          │ │
│   │                                                                                                    │ │
│   │   加载动画：                                                                                        │ │
│   │   • 卡片按索引顺序依次出现                                                                          │ │
│   │   • 每张卡片延迟 100ms                                                                             │ │
│   │   • 使用淡入上滑动画                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.8 关于页面模块

#### 3.1.8.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        关于页面功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能概述                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   关于页面是博主的数字化名片，展示博主个人信息、技能专长、职业经历、                                    │ │
│   │   社交媒体链接以及站点介绍等内容。该页面需要体现"高级感"和"格调"，                                     │ │
│   │   通过精心设计的视觉元素和交互动效，给访客留下深刻印象。                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能清单                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【博主信息展示】                                                                                  │ │
│   │   ├── 头像展示（支持动态头像/静态头像）                                                              │ │
│   │   ├── 昵称/姓名                                                                                    │ │
│   │   ├── 职业头衔/标签                                                                                │ │
│   │   ├── 个性签名                                                                                     │ │
│   │   ├── 个人简介（支持 Markdown 格式）                                                                │ │
│   │   └── 所在地/时区                                                                                  │ │
│   │                                                                                                    │ │
│   │   【社交媒体链接】                                                                                  │ │
│   │   ├── GitHub                                                                                       │ │
│   │   ├── Twitter/X                                                                                    │ │
│   │   ├── LinkedIn                                                                                     │ │
│   │   ├── 微信公众号                                                                                   │ │
│   │   ├── 知乎                                                                                         │ │
│   │   ├── 掘金                                                                                         │ │
│   │   ├── Email                                                                                        │ │
│   │   └── 自定义链接                                                                                   │ │
│   │                                                                                                    │ │
│   │   【技能展示】                                                                                      │ │
│   │   ├── 技能标签云                                                                                   │ │
│   │   ├── 技能熟练度进度条                                                                              │ │
│   │   └── 技术栈图标展示                                                                               │ │
│   │                                                                                                    │ │
│   │   【职业经历】（可选）                                                                               │ │
│   │   ├── 时间线形式展示                                                                               │ │
│   │   ├── 公司/项目名称                                                                                │ │
│   │   ├── 职位                                                                                         │ │
│   │   └── 工作描述                                                                                     │ │
│   │                                                                                                    │ │
│   │   【站点信息】                                                                                      │ │
│   │   ├── 站点创建时间                                                                                 │ │
│   │   ├── 运行天数统计                                                                                 │ │
│   │   ├── 文章总数                                                                                     │ │
│   │   ├── 总字数统计                                                                                   │ │
│   │   ├── 总访问量                                                                                     │ │
│   │   └── 站点介绍/愿景                                                                                │ │
│   │                                                                                                    │ │
│   │   【版权声明】                                                                                      │ │
│   │   ├── 版权信息                                                                                     │ │
│   │   ├── CC协议选择                                                                                   │ │
│   │   └── 转载说明                                                                                     │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.8.2 页面布局设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        关于页面布局设计                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                    顶部导航栏 (毛玻璃效果)                                           │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                              ┌──────────────────────────────┐                                      │ │
│   │                              │                              │                                      │ │
│   │                              │       [博主头像]              │                                      │ │
│   │                              │        (120px)               │                                      │ │
│   │                              │     带光晕动效               │                                      │ │
│   │                              │                              │                                      │ │
│   │                              └──────────────────────────────┘                                      │ │
│   │                                                                                                    │ │
│   │                                       昵称 / 姓名                                                   │ │
│   │                                  ──────────────────────                                            │ │
│   │                              「 高级后端工程师 | 开源爱好者 」                                       │ │
│   │                                                                                                    │ │
│   │                                      个性签名区域                                                   │ │
│   │                              "Stay hungry, Stay foolish."                                          │ │
│   │                                                                                                    │ │
│   │                              ┌────┐ ┌────┐ ┌────┐ ┌────┐                                          │ │
│   │                              │ GH │ │ TW │ │ LI │ │ EM │  ← 社交媒体图标                           │ │
│   │                              └────┘ └────┘ └────┘ └────┘                                          │ │
│   │                                                                                                    │ │
│   │   Hero 区域                                                                                        │ │
│   │   (全屏背景 + 毛玻璃卡片)                                                                           │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   关于我                                                                                           │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   👋 Hi，我是 [昵称]，一名热爱技术的后端工程师。                                                    │ │
│   │                                                                                                    │ │
│   │   我专注于 Java 生态系统，对分布式系统、高并发架构有深入研究。                                       │ │
│   │   工作之余，我喜欢探索新技术，并通过博客分享学习心得。                                                │ │
│   │                                                                                                    │ │
│   │   目前正在研究：                                                                                   │ │
│   │   • JDK 21 虚拟线程与 AI 服务调用的结合应用                                                         │ │
│   │   • 大语言模型在代码生成领域的实践                                                                  │ │
│   │   • 云原生架构设计模式                                                                              │ │
│   │                                                                                                    │ │
│   │   (支持 Markdown 渲染，包括代码块、列表、链接等)                                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   技能专长                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────┐  ┌─────────────────────────────────────────┐        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [Java Icon]  Java                      │  │  [Spring Icon]  Spring Boot            │        │ │
│   │   │  ████████████████████████░░░  95%       │  │  ███████████████████████░░░░  90%       │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [PG Icon]    PostgreSQL                │  │  [K8s Icon]    Kubernetes              │        │ │
│   │   │  ██████████████████████░░░░░  85%       │  │  ████████████████████░░░░░░  80%        │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [React Icon] React                     │  │  [Docker Icon] Docker                  │        │ │
│   │   │  ██████████████████░░░░░░░░  75%        │  │  ███████████████████████░░░░  90%       │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   └─────────────────────────────────────────┘  └─────────────────────────────────────────┘        │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│   │   │                                     技术标签云                                               │ │ │
│   │   │                                                                                              │ │ │
│   │   │    微服务    Spring Cloud    Redis    Kafka    MySQL    MongoDB    Elasticsearch            │ │ │
│   │   │         RabbitMQ    gRPC    GraphQL    Nginx    Linux    Git    CI/CD    AWS               │ │ │
│   │   │    TypeScript    Vue    Node.js    Python    Go    Rust    WebSocket    OAuth2             │ │ │
│   │   │                                                                                              │ │ │
│   │   └──────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   关于本站                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          │ │
│   │   │   📅              │  │   📝              │  │   📖              │  │   👁️              │          │ │
│   │   │  运行天数          │  │  文章总数          │  │  总字数           │  │  总访问量          │          │ │
│   │   │    365+           │  │    128            │  │   25万+           │  │   10万+           │          │ │
│   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘          │ │
│   │                                                                                                    │ │
│   │   ────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   本站创建于 2024 年 1 月，基于 AetherBlog 构建。                                                  │ │
│   │                                                                                                    │ │
│   │   「让每一篇博客都成为艺术品，让每一次创作都有 AI 相伴」                                             │ │
│   │                                                                                                    │ │
│   │   技术栈：React 19 + Spring Boot 3.4 + PostgreSQL 17 + 独立 AI 服务                               │ │
│   │   托管于：[云服务商]                                                                               │ │
│   │   CDN：Cloudflare                                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   版权声明                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   [CC BY-NC-SA 4.0 图标]                                                                          │ │
│   │                                                                                                    │ │
│   │   本站所有原创内容均采用 CC BY-NC-SA 4.0 协议进行许可。                                             │ │
│   │                                                                                                    │ │
│   │   转载请注明出处并保留原文链接。                                                                    │ │
│   │   禁止用于商业用途。                                                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      页面底部 (Footer)                                             │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.8.3 组件实现

```tsx
// apps/blog/src/app/about/page.tsx

import React from 'react';
import { Metadata } from 'next';
import { AboutHero } from '@/components/about/AboutHero';
import { AboutContent } from '@/components/about/AboutContent';
import { SkillSection } from '@/components/about/SkillSection';
import { SiteStats } from '@/components/about/SiteStats';
import { CopyrightSection } from '@/components/about/CopyrightSection';
import { getSiteSettings, getAuthorProfile, getSiteStats } from '@/lib/api';

export const metadata: Metadata = {
  title: '关于 - AetherBlog',
  description: '了解博主和本站的更多信息',
};

export default async function AboutPage() {
  // 获取数据
  const [settings, author, stats] = await Promise.all([
    getSiteSettings(),
    getAuthorProfile(),
    getSiteStats(),
  ]);

  return (
    <main className="min-h-screen">
      {/* Hero 区域 */}
      <AboutHero author={author} />

      {/* 主要内容区域 */}
      <div className="container mx-auto px-4 py-16 space-y-24">
        {/* 关于我 */}
        <AboutContent content={author.bio} />

        {/* 技能专长 */}
        <SkillSection skills={author.skills} techStack={author.techStack} />

        {/* 关于本站 */}
        <SiteStats stats={stats} siteInfo={settings} />

        {/* 版权声明 */}
        <CopyrightSection copyright={settings.copyright} />
      </div>
    </main>
  );
}
```

```tsx
// apps/blog/src/components/about/AboutHero.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { 
  Github, 
  Twitter, 
  Linkedin, 
  Mail, 
  MapPin,
  ExternalLink 
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import type { AuthorProfile } from '@aetherblog/types';

interface AboutHeroProps {
  author: AuthorProfile;
}

/**
 * 社交媒体图标映射
 */
const socialIcons: Record<string, React.FC<{ className?: string }>> = {
  github: Github,
  twitter: Twitter,
  linkedin: Linkedin,
  email: Mail,
};

/**
 * 关于页面 Hero 区域
 */
export const AboutHero: React.FC<AboutHeroProps> = ({ author }) => {
  return (
    <section className="relative min-h-[70vh] flex items-center justify-center overflow-hidden">
      {/* 背景 */}
      <div className="absolute inset-0">
        {/* 渐变背景 */}
        <div className="absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900" />
        
        {/* 网格渐变装饰 */}
        <div 
          className="absolute inset-0 opacity-20"
          style={{
            backgroundImage: `
              radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.3) 0px, transparent 50%),
              radial-gradient(at 80% 0%, rgba(168, 85, 247, 0.2) 0px, transparent 50%),
              radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.2) 0px, transparent 50%)
            `,
          }}
        />
        
        {/* 网格线 */}
        <div 
          className="absolute inset-0 opacity-5"
          style={{
            backgroundImage: `
              linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px)
            `,
            backgroundSize: '50px 50px',
          }}
        />
      </div>

      {/* 内容 */}
      <div className="relative z-10 text-center px-4">
        {/* 头像 */}
        <motion.div
          initial={{ scale: 0, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', duration: 0.8 }}
          className="relative inline-block mb-8"
        >
          {/* 光晕效果 */}
          <motion.div
            animate={{
              scale: [1, 1.1, 1],
              opacity: [0.5, 0.8, 0.5],
            }}
            transition={{
              duration: 3,
              repeat: Infinity,
              ease: 'easeInOut',
            }}
            className="absolute -inset-4 bg-gradient-to-br from-primary/40 to-purple-500/40 rounded-full blur-xl"
          />
          
          {/* 头像图片 */}
          <div className="relative w-32 h-32 md:w-40 md:h-40 rounded-full overflow-hidden ring-4 ring-white/20">
            <img
              src={author.avatar}
              alt={author.name}
              className="w-full h-full object-cover"
            />
          </div>
          
          {/* 在线状态指示器 */}
          <div className="absolute bottom-2 right-2 w-5 h-5 bg-green-500 rounded-full ring-4 ring-gray-900" />
        </motion.div>

        {/* 姓名 */}
        <motion.h1
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.2 }}
          className="text-4xl md:text-5xl font-bold text-white mb-4"
        >
          {author.name}
        </motion.h1>

        {/* 职业头衔 */}
        <motion.div
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.3 }}
          className="flex items-center justify-center gap-3 mb-6"
        >
          {author.titles?.map((title, index) => (
            <React.Fragment key={title}>
              {index > 0 && <span className="text-gray-500">|</span>}
              <span className="text-lg text-primary font-medium">{title}</span>
            </React.Fragment>
          ))}
        </motion.div>

        {/* 个性签名 */}
        <motion.p
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.4 }}
          className="text-xl text-gray-400 italic mb-6 max-w-2xl mx-auto"
        >
          "{author.signature}"
        </motion.p>

        {/* 位置 */}
        {author.location && (
          <motion.div
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="flex items-center justify-center gap-2 text-gray-500 mb-8"
          >
            <MapPin className="w-4 h-4" />
            <span>{author.location}</span>
          </motion.div>
        )}

        {/* 社交媒体链接 */}
        <motion.div
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.6 }}
          className="flex items-center justify-center gap-4"
        >
          {author.socialLinks?.map((link, index) => {
            const Icon = socialIcons[link.platform.toLowerCase()] || ExternalLink;
            
            return (
              <motion.a
                key={link.platform}
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ delay: 0.7 + index * 0.1 }}
                whileHover={{ scale: 1.1, y: -2 }}
                whileTap={{ scale: 0.95 }}
                className={cn(
                  'w-12 h-12 rounded-full flex items-center justify-center',
                  'bg-white/5 backdrop-blur-sm border border-white/10',
                  'text-gray-400 hover:text-white',
                  'hover:bg-white/10 hover:border-white/20',
                  'transition-all duration-300'
                )}
                title={link.platform}
              >
                <Icon className="w-5 h-5" />
              </motion.a>
            );
          })}
        </motion.div>
      </div>

      {/* 向下滚动提示 */}
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 1.5 }}
        className="absolute bottom-8 left-1/2 -translate-x-1/2"
      >
        <motion.div
          animate={{ y: [0, 8, 0] }}
          transition={{ duration: 1.5, repeat: Infinity }}
          className="w-6 h-10 rounded-full border-2 border-white/30 flex justify-center pt-2"
        >
          <motion.div className="w-1.5 h-3 bg-white/50 rounded-full" />
        </motion.div>
      </motion.div>
    </section>
  );
};
```

```tsx
// apps/blog/src/components/about/SkillSection.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@aetherblog/utils';

interface Skill {
  name: string;
  level: number; // 0-100
  icon?: string;
  color?: string;
}

interface SkillSectionProps {
  skills: Skill[];
  techStack: string[];
}

/**
 * 技能展示区域
 */
export const SkillSection: React.FC<SkillSectionProps> = ({
  skills,
  techStack,
}) => {
  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">技能专长</h2>
        <p className="text-gray-400 max-w-2xl mx-auto">
          持续学习，不断精进。以下是我的主要技术栈和熟练程度。
        </p>
      </motion.div>

      {/* 技能进度条 */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
        {skills.map((skill, index) => (
          <motion.div
            key={skill.name}
            initial={{ opacity: 0, x: index % 2 === 0 ? -20 : 20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: index * 0.1 }}
            className={cn(
              'p-6 rounded-xl',
              'bg-white/5 backdrop-blur-sm border border-white/10',
              'hover:bg-white/10 transition-colors duration-300'
            )}
          >
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                {skill.icon && (
                  <img src={skill.icon} alt={skill.name} className="w-8 h-8" />
                )}
                <span className="font-medium text-white">{skill.name}</span>
              </div>
              <span className="text-sm text-primary font-medium">
                {skill.level}%
              </span>
            </div>
            
            {/* 进度条 */}
            <div className="h-2 bg-gray-800 rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                whileInView={{ width: `${skill.level}%` }}
                viewport={{ once: true }}
                transition={{ duration: 1, delay: index * 0.1, ease: 'easeOut' }}
                className="h-full rounded-full"
                style={{
                  background: skill.color || 
                    `linear-gradient(90deg, #6366f1, #a855f7)`,
                }}
              />
            </div>
          </motion.div>
        ))}
      </div>

      {/* 技术标签云 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <h3 className="text-xl font-semibold text-white mb-6 text-center">
          技术标签云
        </h3>
        <div className="flex flex-wrap justify-center gap-3">
          {techStack.map((tech, index) => (
            <motion.span
              key={tech}
              initial={{ opacity: 0, scale: 0.8 }}
              whileInView={{ opacity: 1, scale: 1 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.03 }}
              whileHover={{ 
                scale: 1.1, 
                backgroundColor: 'rgba(99, 102, 241, 0.2)',
                borderColor: 'rgba(99, 102, 241, 0.5)',
              }}
              className={cn(
                'px-4 py-2 rounded-full',
                'text-sm font-medium',
                'bg-white/5 border border-white/10',
                'text-gray-300 hover:text-white',
                'cursor-default transition-all duration-200'
              )}
            >
              {tech}
            </motion.span>
          ))}
        </div>
      </motion.div>
    </section>
  );
};

export default SkillSection;
```

```tsx
// apps/blog/src/components/about/SiteStats.tsx

'use client';

import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { Calendar, FileText, BookOpen, Eye, Clock, Server } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface SiteStatsProps {
  stats: {
    createdAt: string;
    postCount: number;
    totalWords: number;
    totalViews: number;
  };
  siteInfo: {
    name: string;
    description: string;
    techStack?: string;
    hosting?: string;
    cdn?: string;
  };
}

/**
 * 统计数据项组件
 */
const StatItem: React.FC<{
  icon: React.ReactNode;
  label: string;
  value: string | number;
  suffix?: string;
  index: number;
}> = ({ icon, label, value, suffix, index }) => {
  const [displayValue, setDisplayValue] = useState(0);
  const numericValue = typeof value === 'number' ? value : parseInt(value) || 0;

  // 数字动画效果
  useEffect(() => {
    const duration = 2000;
    const steps = 60;
    const stepDuration = duration / steps;
    const increment = numericValue / steps;
    
    let current = 0;
    const timer = setInterval(() => {
      current += increment;
      if (current >= numericValue) {
        setDisplayValue(numericValue);
        clearInterval(timer);
      } else {
        setDisplayValue(Math.floor(current));
      }
    }, stepDuration);

    return () => clearInterval(timer);
  }, [numericValue]);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true }}
      transition={{ delay: index * 0.1 }}
      whileHover={{ scale: 1.05, y: -5 }}
      className={cn(
        'flex flex-col items-center p-6 rounded-xl',
        'bg-white/5 backdrop-blur-sm border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300'
      )}
    >
      <div className="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center mb-4">
        {icon}
      </div>
      <div className="text-3xl font-bold text-white mb-1">
        {typeof value === 'number' ? displayValue.toLocaleString() : value}
        {suffix && <span className="text-lg text-gray-400">{suffix}</span>}
      </div>
      <div className="text-sm text-gray-400">{label}</div>
    </motion.div>
  );
};

/**
 * 站点统计与信息区域
 */
export const SiteStats: React.FC<SiteStatsProps> = ({ stats, siteInfo }) => {
  // 计算运行天数
  const calculateRunningDays = () => {
    const created = new Date(stats.createdAt);
    const now = new Date();
    const diff = now.getTime() - created.getTime();
    return Math.floor(diff / (1000 * 60 * 60 * 24));
  };

  const runningDays = calculateRunningDays();

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">关于本站</h2>
        <p className="text-gray-400 max-w-2xl mx-auto">
          {siteInfo.description}
        </p>
      </motion.div>

      {/* 统计数据卡片 */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
        <StatItem
          icon={<Calendar className="w-6 h-6 text-primary" />}
          label="运行天数"
          value={runningDays}
          suffix="+"
          index={0}
        />
        <StatItem
          icon={<FileText className="w-6 h-6 text-primary" />}
          label="文章总数"
          value={stats.postCount}
          index={1}
        />
        <StatItem
          icon={<BookOpen className="w-6 h-6 text-primary" />}
          label="总字数"
          value={Math.floor(stats.totalWords / 10000)}
          suffix="万+"
          index={2}
        />
        <StatItem
          icon={<Eye className="w-6 h-6 text-primary" />}
          label="总访问量"
          value={Math.floor(stats.totalViews / 10000)}
          suffix="万+"
          index={3}
        />
      </div>

      {/* 站点信息详情 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 站点愿景 */}
        <div className="text-center mb-8">
          <motion.p
            initial={{ opacity: 0 }}
            whileInView={{ opacity: 1 }}
            viewport={{ once: true }}
            transition={{ delay: 0.3 }}
            className="text-xl text-gray-300 italic"
          >
            「让每一篇博客都成为艺术品，让每一次创作都有 AI 相伴」
          </motion.p>
        </div>

        {/* 技术信息 */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {/* 技术栈 */}
          {siteInfo.techStack && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.4 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                <Server className="w-5 h-5 text-blue-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">技术栈</div>
                <div className="text-white text-sm">{siteInfo.techStack}</div>
              </div>
            </motion.div>
          )}

          {/* 托管 */}
          {siteInfo.hosting && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.5 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
                <Server className="w-5 h-5 text-green-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">托管于</div>
                <div className="text-white text-sm">{siteInfo.hosting}</div>
              </div>
            </motion.div>
          )}

          {/* CDN */}
          {siteInfo.cdn && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.6 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center flex-shrink-0">
                <Clock className="w-5 h-5 text-orange-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">CDN</div>
                <div className="text-white text-sm">{siteInfo.cdn}</div>
              </div>
            </motion.div>
          )}
        </div>

        {/* 创建时间 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.7 }}
          className="mt-8 pt-6 border-t border-white/10 text-center"
        >
          <p className="text-sm text-gray-500">
            本站创建于{' '}
            <span className="text-gray-300">
              {new Date(stats.createdAt).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </span>
            ，基于{' '}
            <span className="text-primary font-medium">AetherBlog</span> 构建
          </p>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default SiteStats;
```

```tsx
// apps/blog/src/components/about/CopyrightSection.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@aetherblog/utils';

interface CopyrightSectionProps {
  copyright: {
    type: 'CC-BY-NC-SA' | 'CC-BY-NC-ND' | 'CC-BY-SA' | 'CC-BY' | 'CUSTOM';
    customText?: string;
  };
}

/**
 * CC 协议信息
 */
const ccLicenses: Record<string, { name: string; description: string; url: string; badges: string[] }> = {
  'CC-BY-NC-SA': {
    name: 'CC BY-NC-SA 4.0',
    description: '署名-非商业性使用-相同方式共享 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh',
    badges: ['BY', 'NC', 'SA'],
  },
  'CC-BY-NC-ND': {
    name: 'CC BY-NC-ND 4.0',
    description: '署名-非商业性使用-禁止演绎 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh',
    badges: ['BY', 'NC', 'ND'],
  },
  'CC-BY-SA': {
    name: 'CC BY-SA 4.0',
    description: '署名-相同方式共享 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-sa/4.0/deed.zh',
    badges: ['BY', 'SA'],
  },
  'CC-BY': {
    name: 'CC BY 4.0',
    description: '署名 4.0 国际',
    url: 'https://creativecommons.org/licenses/by/4.0/deed.zh',
    badges: ['BY'],
  },
};

/**
 * CC 徽章 SVG 图标
 */
const CCBadge: React.FC<{ type: string }> = ({ type }) => {
  const badges: Record<string, JSX.Element> = {
    BY: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 6a3 3 0 100 6 3 3 0 000-6zM7 17c0-2.5 2.5-4 5-4s5 1.5 5 4" fill="none" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    NC: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <text x="12" y="16" textAnchor="middle" fontSize="10" fill="currentColor">$</text>
        <line x1="6" y1="18" x2="18" y2="6" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    SA: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 7c-3 0-5 2-5 5s2 5 5 5 5-2 5-5" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 10l2.5 2.5L12 15" fill="none" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    ND: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <text x="12" y="16" textAnchor="middle" fontSize="10" fill="currentColor">=</text>
      </svg>
    ),
  };

  return badges[type] || null;
};

/**
 * 版权声明区域
 */
export const CopyrightSection: React.FC<CopyrightSectionProps> = ({ copyright }) => {
  const license = ccLicenses[copyright.type];

  if (copyright.type === 'CUSTOM' && copyright.customText) {
    return (
      <section>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          className="text-center mb-8"
        >
          <h2 className="text-3xl font-bold text-white mb-4">版权声明</h2>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ delay: 0.2 }}
          className={cn(
            'p-8 rounded-2xl text-center',
            'bg-white/5 backdrop-blur-sm border border-white/10'
          )}
        >
          <p className="text-gray-300 leading-relaxed">{copyright.customText}</p>
        </motion.div>
      </section>
    );
  }

  if (!license) return null;

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-8"
      >
        <h2 className="text-3xl font-bold text-white mb-4">版权声明</h2>
      </motion.div>

      {/* 版权卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <div className="flex flex-col md:flex-row items-center gap-8">
          {/* CC 图标 */}
          <motion.a
            href={license.url}
            target="_blank"
            rel="noopener noreferrer"
            whileHover={{ scale: 1.05 }}
            className="flex items-center gap-3 text-gray-400 hover:text-white transition-colors"
          >
            {/* CC Logo */}
            <svg viewBox="0 0 24 24" className="w-10 h-10">
              <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
              <text x="12" y="16" textAnchor="middle" fontSize="12" fontWeight="bold" fill="currentColor">CC</text>
            </svg>
            
            {/* License Badges */}
            {license.badges.map((badge) => (
              <CCBadge key={badge} type={badge} />
            ))}
          </motion.a>

          {/* 说明文字 */}
          <div className="flex-1 text-center md:text-left">
            <h3 className="text-lg font-semibold text-white mb-2">
              {license.name}
            </h3>
            <p className="text-gray-400 text-sm mb-4">
              {license.description}
            </p>
            <div className="space-y-2 text-sm text-gray-500">
              <p>本站所有原创内容均采用此协议进行许可。</p>
              <p>• 转载请注明出处并保留原文链接</p>
              {copyright.type.includes('NC') && <p>• 禁止用于商业用途</p>}
              {copyright.type.includes('ND') && <p>• 禁止演绎（修改）作品</p>}
              {copyright.type.includes('SA') && <p>• 演绎作品需采用相同协议</p>}
            </div>
          </div>
        </div>

        {/* 查看协议链接 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.4 }}
          className="mt-6 pt-6 border-t border-white/10 text-center"
        >
          <a
            href={license.url}
            target="_blank"
            rel="noopener noreferrer"
            className="inline-flex items-center gap-2 text-primary hover:text-primary/80 text-sm transition-colors"
          >
            查看协议详情
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default CopyrightSection;
```

```tsx
// apps/blog/src/components/about/AboutContent.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { MarkdownRenderer } from '@aetherblog/editor';
import { cn } from '@aetherblog/utils';

interface AboutContentProps {
  content: string;
}

/**
 * 关于我内容区域
 */
export const AboutContent: React.FC<AboutContentProps> = ({ content }) => {
  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">关于我</h2>
        <div className="w-24 h-1 bg-gradient-to-r from-primary to-purple-500 mx-auto rounded-full" />
      </motion.div>

      {/* 内容区域 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <MarkdownRenderer content={content} />
      </motion.div>
    </section>
  );
};

export default AboutContent;
```

---

### 3.1.9 友链页面模块

#### 3.1.9.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        友链页面功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能概述                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   友链页面用于展示与本站互换链接的友情站点，通过精美的卡片设计展示                                     │ │
│   │   友站信息，促进博客圈的交流互动。支持自定义主题色、分组展示等功能。                                   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能清单                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【友链展示】                                                                                      │ │
│   │   ├── 精美卡片式布局                                                                               │ │
│   │   ├── 站点名称                                                                                     │ │
│   │   ├── 站点头像/Logo                                                                                │ │
│   │   ├── 站点描述                                                                                     │ │
│   │   ├── 站点链接                                                                                     │ │
│   │   ├── 自定义主题色                                                                                 │ │
│   │   ├── RSS 订阅链接（可选）                                                                          │ │
│   │   └── 邮箱联系（可选）                                                                              │ │
│   │                                                                                                    │ │
│   │   【友链分组】                                                                                      │ │
│   │   ├── 按分类分组展示（如：技术博客、生活博客等）                                                     │ │
│   │   └── 分组折叠/展开                                                                                │ │
│   │                                                                                                    │ │
│   │   【友链申请】                                                                                      │ │
│   │   ├── 申请表单（站点名称、地址、描述、头像等）                                                       │ │
│   │   ├── 本站信息展示（方便对方添加）                                                                  │ │
│   │   └── 申请须知说明                                                                                 │ │
│   │                                                                                                    │ │
│   │   【交互效果】                                                                                      │ │
│   │   ├── 卡片悬浮动效                                                                                 │ │
│   │   ├── 主题色光晕效果                                                                               │ │
│   │   ├── 加载动画                                                                                     │ │
│   │   └── 随机排序/固定排序                                                                            │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.9.2 页面组件实现

```tsx
// apps/blog/src/app/friends/page.tsx (续)

import React from 'react';
import { Metadata } from 'next';
import { FriendsHero } from '@/components/friends/FriendsHero';
import { FriendGrid } from '@/components/friends/FriendCard';
import { FriendApplySection } from '@/components/friends/FriendApplySection';
import { MySiteInfo } from '@/components/friends/MySiteInfo';
import { getFriendLinks, getSiteSettings } from '@/lib/api';
import type { FriendLink } from '@aetherblog/types';

export const metadata: Metadata = {
  title: '友链 - AetherBlog',
  description: '友情链接，一起交流学习',
};

/**
 * 友链分组类型
 */
interface FriendGroup {
  name: string;
  description?: string;
  friends: FriendLink[];
}

export default async function FriendsPage() {
  const [friends, siteSettings] = await Promise.all([
    getFriendLinks(),
    getSiteSettings(),
  ]);

  // 按分组组织友链
  const groupedFriends = groupFriendsByCategory(friends);

  // 本站信息（用于友链申请展示）
  const mySiteInfo = {
    name: siteSettings.siteName,
    url: siteSettings.siteUrl,
    avatar: siteSettings.logo,
    description: siteSettings.description,
    email: siteSettings.email,
  };

  return (
    <main className="min-h-screen bg-gray-950">
      {/* 友链页面 Hero */}
      <FriendsHero 
        title="友情链接"
        subtitle="海内存知己，天涯若比邻"
        description="这里是我欣赏的博主们，感谢你们的精彩内容"
        totalCount={friends.length}
      />

      {/* 友链内容区域 */}
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        {/* 分组展示友链 */}
        <div className="space-y-16">
          {groupedFriends.map((group, index) => (
            <FriendGroupSection 
              key={group.name} 
              group={group} 
              index={index}
            />
          ))}
        </div>

        {/* 分隔线 */}
        <div className="my-20">
          <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
        </div>

        {/* 本站信息 */}
        <MySiteInfo siteInfo={mySiteInfo} />

        {/* 分隔线 */}
        <div className="my-20">
          <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
        </div>

        {/* 友链申请区域 */}
        <FriendApplySection 
          requirements={siteSettings.friendLinkRequirements}
          email={siteSettings.email}
        />
      </div>
    </main>
  );
}

/**
 * 友链分组组件
 */
const FriendGroupSection: React.FC<{
  group: FriendGroup;
  index: number;
}> = ({ group, index }) => {
  return (
    <section>
      {/* 分组标题 */}
      <div className="mb-8">
        <h2 className="text-2xl font-bold text-white mb-2">
          {group.name}
          <span className="ml-3 text-sm font-normal text-gray-500">
            ({group.friends.length})
          </span>
        </h2>
        {group.description && (
          <p className="text-gray-400">{group.description}</p>
        )}
      </div>

      {/* 友链卡片网格 */}
      <FriendGrid friends={group.friends} />
    </section>
  );
};

/**
 * 将友链按分类分组
 */
function groupFriendsByCategory(friends: FriendLink[]): FriendGroup[] {
  const groupMap = new Map<string, FriendLink[]>();
  
  // 分组
  friends.forEach(friend => {
    const category = friend.category || '友情链接';
    if (!groupMap.has(category)) {
      groupMap.set(category, []);
    }
    groupMap.get(category)!.push(friend);
  });

  // 转换为数组并排序
  const groups: FriendGroup[] = [];
  
  // 预定义分组顺序
  const categoryOrder = ['推荐博客', '技术博客', '生活博客', '友情链接', '其他'];
  
  categoryOrder.forEach(category => {
    if (groupMap.has(category)) {
      groups.push({
        name: category,
        friends: groupMap.get(category)!,
      });
      groupMap.delete(category);
    }
  });

  // 添加剩余分组
  groupMap.forEach((friends, name) => {
    groups.push({ name, friends });
  });

  return groups;
}
```

```tsx
// apps/blog/src/components/friends/FriendsHero.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { Link2, Users, Heart, Sparkles } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface FriendsHeroProps {
  title: string;
  subtitle?: string;
  description?: string;
  totalCount: number;
}

/**
 * 友链页面 Hero 区域
 */
export const FriendsHero: React.FC<FriendsHeroProps> = ({
  title,
  subtitle,
  description,
  totalCount,
}) => {
  return (
    <section className="relative overflow-hidden">
      {/* 背景装饰 */}
      <div className="absolute inset-0">
        {/* 渐变背景 */}
        <div className="absolute inset-0 bg-gradient-to-b from-primary/10 via-gray-950 to-gray-950" />
        
        {/* 网格背景 */}
        <div 
          className="absolute inset-0 opacity-20"
          style={{
            backgroundImage: `
              linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px)
            `,
            backgroundSize: '50px 50px',
          }}
        />

        {/* 浮动装饰元素 */}
        <motion.div
          animate={{
            y: [0, -20, 0],
            rotate: [0, 5, 0],
          }}
          transition={{
            duration: 6,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute top-20 left-[15%] w-16 h-16 rounded-full bg-primary/20 blur-xl"
        />
        <motion.div
          animate={{
            y: [0, 20, 0],
            rotate: [0, -5, 0],
          }}
          transition={{
            duration: 8,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute top-40 right-[20%] w-24 h-24 rounded-full bg-purple-500/20 blur-xl"
        />
        <motion.div
          animate={{
            y: [0, 15, 0],
          }}
          transition={{
            duration: 5,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute bottom-20 left-[30%] w-20 h-20 rounded-full bg-cyan-500/20 blur-xl"
        />
      </div>

      {/* 内容 */}
      <div className="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-24 text-center">
        {/* 图标 */}
        <motion.div
          initial={{ opacity: 0, scale: 0.5 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.5 }}
          className="mb-8"
        >
          <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/20 ring-1 ring-primary/30">
            <Link2 className="w-10 h-10 text-primary" />
          </div>
        </motion.div>

        {/* 标题 */}
        <motion.h1
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
          className="text-4xl md:text-5xl font-bold text-white mb-4"
        >
          {title}
        </motion.h1>

        {/* 副标题 */}
        {subtitle && (
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="text-xl text-primary italic mb-4"
          >
            「{subtitle}」
          </motion.p>
        )}

        {/* 描述 */}
        {description && (
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="text-gray-400 max-w-2xl mx-auto mb-8"
          >
            {description}
          </motion.p>
        )}

        {/* 统计信息 */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="flex items-center justify-center gap-8"
        >
          <div className="flex items-center gap-2 text-gray-400">
            <Users className="w-5 h-5" />
            <span>
              已收录 <span className="text-white font-semibold">{totalCount}</span> 位小伙伴
            </span>
          </div>
          <div className="flex items-center gap-2 text-gray-400">
            <Heart className="w-5 h-5 text-red-400" />
            <span>互相学习，共同成长</span>
          </div>
        </motion.div>

        {/* 滚动提示 */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 1 }}
          className="absolute bottom-8 left-1/2 -translate-x-1/2"
        >
          <motion.div
            animate={{ y: [0, 8, 0] }}
            transition={{ duration: 1.5, repeat: Infinity }}
            className="flex flex-col items-center gap-2 text-gray-500"
          >
            <Sparkles className="w-4 h-4" />
            <div className="w-px h-8 bg-gradient-to-b from-gray-500 to-transparent" />
          </motion.div>
        </motion.div>
      </div>
    </section>
  );
};

export default FriendsHero;
```

```tsx
// apps/blog/src/components/friends/MySiteInfo.tsx

'use client';

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { Copy, Check, Globe, Mail, Rss, ExternalLink } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useCopyToClipboard } from '@aetherblog/hooks';

interface MySiteInfoProps {
  siteInfo: {
    name: string;
    url: string;
    avatar: string;
    description: string;
    email?: string;
    rss?: string;
  };
}

/**
 * 本站信息组件
 * 
 * 用于展示本站信息，方便对方添加友链
 */
export const MySiteInfo: React.FC<MySiteInfoProps> = ({ siteInfo }) => {
  const [copiedField, setCopiedField] = useState<string | null>(null);
  const [, copy] = useCopyToClipboard();

  const handleCopy = async (field: string, value: string) => {
    await copy(value);
    setCopiedField(field);
    setTimeout(() => setCopiedField(null), 2000);
  };

  // 信息项
  const infoItems = [
    { key: 'name', label: '站点名称', value: siteInfo.name },
    { key: 'url', label: '站点地址', value: siteInfo.url },
    { key: 'avatar', label: '站点头像', value: siteInfo.avatar },
    { key: 'description', label: '站点描述', value: siteInfo.description },
  ];

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">本站信息</h2>
        <p className="text-gray-400">欢迎添加本站为友链，以下是本站信息</p>
      </motion.div>

      {/* 信息卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 站点预览卡片 */}
        <div className="flex items-center gap-6 mb-8 p-6 rounded-xl bg-black/30 border border-white/5">
          {/* 头像 */}
          <div className="relative flex-shrink-0">
            <div className="absolute -inset-1 rounded-full bg-primary/30 blur-sm" />
            <img
              src={siteInfo.avatar}
              alt={siteInfo.name}
              className="relative w-20 h-20 rounded-full object-cover ring-2 ring-white/20"
            />
          </div>

          {/* 信息 */}
          <div className="flex-1 min-w-0">
            <h3 className="text-xl font-bold text-white mb-1">{siteInfo.name}</h3>
            <p className="text-gray-400 text-sm mb-3 line-clamp-2">
              {siteInfo.description}
            </p>
            <div className="flex items-center gap-4">
              <a
                href={siteInfo.url}
                target="_blank"
                rel="noopener noreferrer"
                className="flex items-center gap-1.5 text-sm text-primary hover:text-primary/80 transition-colors"
              >
                <Globe className="w-4 h-4" />
                <span className="truncate">{new URL(siteInfo.url).hostname}</span>
                <ExternalLink className="w-3 h-3" />
              </a>
              {siteInfo.email && (
                <a
                  href={`mailto:${siteInfo.email}`}
                  className="flex items-center gap-1.5 text-sm text-gray-400 hover:text-white transition-colors"
                >
                  <Mail className="w-4 h-4" />
                  <span>联系我</span>
                </a>
              )}
            </div>
          </div>
        </div>

        {/* 信息列表 */}
        <div className="space-y-4">
          {infoItems.map((item, index) => (
            <motion.div
              key={item.key}
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.1 }}
              className="flex items-center gap-4"
            >
              {/* 标签 */}
              <div className="w-24 flex-shrink-0">
                <span className="text-sm text-gray-500">{item.label}</span>
              </div>

              {/* 值 */}
              <div className="flex-1 min-w-0">
                <code
                  className={cn(
                    'block px-4 py-2 rounded-lg',
                    'bg-black/30 border border-white/5',
                    'text-sm text-gray-300 truncate',
                    'font-mono'
                  )}
                >
                  {item.value}
                </code>
              </div>

              {/* 复制按钮 */}
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => handleCopy(item.key, item.value)}
                className={cn(
                  'flex-shrink-0 p-2 rounded-lg',
                  'transition-colors duration-200',
                  copiedField === item.key
                    ? 'bg-green-500/20 text-green-400'
                    : 'bg-white/5 text-gray-400 hover:text-white hover:bg-white/10'
                )}
              >
                {copiedField === item.key ? (
                  <Check className="w-4 h-4" />
                ) : (
                  <Copy className="w-4 h-4" />
                )}
              </motion.button>
            </motion.div>
          ))}
        </div>

        {/* 一键复制全部 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.5 }}
          className="mt-8 pt-6 border-t border-white/10"
        >
          <button
            onClick={() => {
              const allInfo = `站点名称：${siteInfo.name}\n站点地址：${siteInfo.url}\n站点头像：${siteInfo.avatar}\n站点描述：${siteInfo.description}`;
              handleCopy('all', allInfo);
            }}
            className={cn(
              'w-full py-3 rounded-xl font-medium',
              'transition-all duration-200',
              copiedField === 'all'
                ? 'bg-green-500/20 text-green-400 border border-green-500/30'
                : 'bg-primary/20 text-primary border border-primary/30 hover:bg-primary/30'
            )}
          >
            {copiedField === 'all' ? '已复制全部信息 ✓' : '一键复制全部信息'}
          </button>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default MySiteInfo;
```

```tsx
// apps/blog/src/components/friends/FriendApplySection.tsx

'use client';

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Send, 
  CheckCircle, 
  AlertCircle, 
  Loader2,
  ChevronDown,
  ChevronUp,
  Globe,
  Image,
  FileText,
  Mail,
  User,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

interface FriendApplyProps {
  requirements?: string[];
  email?: string;
}

/**
 * 友链申请表单 Schema
 */
const applySchema = z.object({
  name: z.string().min(1, '请输入站点名称').max(50, '站点名称不能超过50个字符'),
  url: z.string().url('请输入有效的网址'),
  avatar: z.string().url('请输入有效的头像地址'),
  description: z.string().min(1, '请输入站点描述').max(200, '站点描述不能超过200个字符'),
  email: z.string().email('请输入有效的邮箱地址'),
  remark: z.string().max(500, '备注不能超过500个字符').optional(),
});

type ApplyFormData = z.infer<typeof applySchema>;

/**
 * 友链申请区域
 */
export const FriendApplySection: React.FC<FriendApplyProps> = ({
  requirements = [],
  email,
}) => {
  const [isExpanded, setIsExpanded] = useState(false);
  const [submitStatus, setSubmitStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');
  const [errorMessage, setErrorMessage] = useState('');

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<ApplyFormData>({
    resolver: zodResolver(applySchema),
  });

  // 默认申请须知
  const defaultRequirements = [
    '您的站点需要有一定的原创内容',
    '站点需要稳定运行，能够正常访问',
    '站点内容健康，无违法违规信息',
    '请先添加本站链接后再申请',
    '审核通过后会通过邮件通知',
  ];

  const displayRequirements = requirements.length > 0 ? requirements : defaultRequirements;

  // 提交表单
  const onSubmit = async (data: ApplyFormData) => {
    setSubmitStatus('loading');
    setErrorMessage('');

    try {
      const response = await fetch('/api/friend-link/apply', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || '提交失败');
      }

      setSubmitStatus('success');
      reset();
      
      // 5秒后重置状态
      setTimeout(() => {
        setSubmitStatus('idle');
      }, 5000);
    } catch (error: any) {
      setSubmitStatus('error');
      setErrorMessage(error.message || '提交失败，请稍后重试');
    }
  };

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">友链申请</h2>
        <p className="text-gray-400">欢迎与本站交换友链，互相学习</p>
      </motion.div>

      {/* 申请须知 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.1 }}
        className={cn(
          'max-w-3xl mx-auto mb-8 p-6 rounded-xl',
          'bg-amber-500/10 border border-amber-500/20'
        )}
      >
        <h3 className="text-lg font-semibold text-amber-400 mb-4 flex items-center gap-2">
          <AlertCircle className="w-5 h-5" />
          申请须知
        </h3>
        <ul className="space-y-2">
          {displayRequirements.map((req, index) => (
            <motion.li
              key={index}
              initial={{ opacity: 0, x: -10 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.05 }}
              className="flex items-start gap-2 text-gray-300"
            >
              <span className="w-5 h-5 flex-shrink-0 flex items-center justify-center rounded-full bg-amber-500/20 text-amber-400 text-xs">
                {index + 1}
              </span>
              <span>{req}</span>
            </motion.li>
          ))}
        </ul>
      </motion.div>

      {/* 申请表单卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto rounded-2xl overflow-hidden',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 折叠头部 */}
        <button
          onClick={() => setIsExpanded(!isExpanded)}
          className="w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors"
        >
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
              <Send className="w-5 h-5 text-primary" />
            </div>
            <div className="text-left">
              <h3 className="text-lg font-semibold text-white">提交友链申请</h3>
              <p className="text-sm text-gray-400">点击展开申请表单</p>
            </div>
          </div>
          <motion.div
            animate={{ rotate: isExpanded ? 180 : 0 }}
            transition={{ duration: 0.2 }}
          >
            <ChevronDown className="w-5 h-5 text-gray-400" />
          </motion.div>
        </button>

        {/* 表单内容 */}
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: 'auto', opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              transition={{ duration: 0.3 }}
              className="overflow-hidden"
            >
              <form onSubmit={handleSubmit(onSubmit)} className="p-6 pt-0 space-y-6">
                {/* 站点名称 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <User className="w-4 h-4" />
                    站点名称 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('name')}
                    placeholder="例如：AetherBlog"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.name ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.name && (
                    <p className="mt-1 text-sm text-red-400">{errors.name.message}</p>
                  )}
                </div>

                {/* 站点地址 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Globe className="w-4 h-4" />
                    站点地址 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('url')}
                    placeholder="https://example.com"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.url ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.url && (
                    <p className="mt-1 text-sm text-red-400">{errors.url.message}</p>
                  )}
                </div>

                {/* 站点头像 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Image className="w-4 h-4" />
                    站点头像 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('avatar')}
                    placeholder="https://example.com/avatar.png"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.avatar ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.avatar && (
                    <p className="mt-1 text-sm text-red-400">{errors.avatar.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    建议使用正方形图片，推荐尺寸 200x200 像素
                  </p>
                </div>

                {/* 站点描述 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <FileText className="w-4 h-4" />
                    站点描述 <span className="text-red-400">*</span>
                  </label>
                  <textarea
                    {...register('description')}
                    placeholder="简单介绍一下您的站点..."
                    rows={3}
                    className={cn(
                      'w-full px-4 py-3 rounded-xl resize-none',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.description ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.description && (
                    <p className="mt-1 text-sm text-red-400">{errors.description.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    不超过 200 个字符
                  </p>
                </div>

                {/* 联系邮箱 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Mail className="w-4 h-4" />
                    联系邮箱 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('email')}
                    type="email"
                    placeholder="your@email.com"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.email ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.email && (
                    <p className="mt-1 text-sm text-red-400">{errors.email.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    用于接收审核结果通知
                  </p>
                </div>

                {/* 备注 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <FileText className="w-4 h-4" />
                    备注（可选）
                  </label>
                  <textarea
                    {...register('remark')}
                    placeholder="有什么想说的可以写在这里..."
                    rows={2}
                    className={cn(
                      'w-full px-4 py-3 rounded-xl resize-none',
                      'bg-black/30 border border-white/10',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50',
                      'transition-all duration-200'
                    )}
                  />
                </div>

                {/* 提交按钮 */}
                <div className="pt-4">
                  <motion.button
                    type="submit"
                    disabled={submitStatus === 'loading' || submitStatus === 'success'}
                    whileHover={{ scale: submitStatus === 'idle' ? 1.02 : 1 }}
                    whileTap={{ scale: submitStatus === 'idle' ? 0.98 : 1 }}
                    className={cn(
                      'w-full py-4 rounded-xl font-semibold',
                      'flex items-center justify-center gap-2',
                      'transition-all duration-200',
                      submitStatus === 'idle' && 'bg-primary text-white hover:bg-primary/90',
                      submitStatus === 'loading' && 'bg-primary/50 text-white/70 cursor-not-allowed',
                      submitStatus === 'success' && 'bg-green-500 text-white cursor-not-allowed',
                      submitStatus === 'error' && 'bg-red-500 text-white'
                    )}
                  >
                    {submitStatus === 'idle' && (
                      <>
                        <Send className="w-5 h-5" />
                        提交申请
                      </>
                    )}
                    {submitStatus === 'loading' && (
                      <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        提交中...
                      </>
                    )}
                    {submitStatus === 'success' && (
                      <>
                        <CheckCircle className="w-5 h-5" />
                        提交成功！我们会尽快审核
                      </>
                    )}
                    {submitStatus === 'error' && (
                      <>
                        <AlertCircle className="w-5 h-5" />
                        {errorMessage || '提交失败，请重试'}
                      </>
                    )}
                  </motion.button>
                </div>
                {/* 提交按钮 */}
                <div className="pt-4">
                  <motion.button
                    type="submit"
                    disabled={submitStatus === 'loading' || submitStatus === 'success'}
                    whileHover={{ scale: submitStatus === 'idle' ? 1.02 : 1 }}
                    whileTap={{ scale: submitStatus === 'idle' ? 0.98 : 1 }}
                    className={cn(
                      'w-full py-4 rounded-xl font-semibold',
                      'flex items-center justify-center gap-2',
                      'transition-all duration-200',
                      submitStatus === 'idle' && 'bg-primary text-white hover:bg-primary/90',
                      submitStatus === 'loading' && 'bg-primary/50 text-white/70 cursor-not-allowed',
                      submitStatus === 'success' && 'bg-green-500 text-white cursor-not-allowed',
                      submitStatus === 'error' && 'bg-red-500 text-white'
                    )}
                  >
                    {submitStatus === 'idle' && (
                      <>
                        <Send className="w-5 h-5" />
                        提交申请
                      </>
                    )}
                    {submitStatus === 'loading' && (
                      <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        提交中...
                      </>
                    )}
                    {submitStatus === 'success' && (
                      <>
                        <CheckCircle className="w-5 h-5" />
                        提交成功！我们会尽快审核
                      </>
                    )}
                    {submitStatus === 'error' && (
                      <>
                        <AlertCircle className="w-5 h-5" />
                        {errorMessage || '提交失败，请重试'}
                      </>
                    )}
                  </motion.button>

                  {/* 错误重试提示 */}
                  {submitStatus === 'error' && (
                    <motion.p
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="mt-3 text-center text-sm text-gray-400"
                    >
                      遇到问题？您也可以直接
                      <a
                        href={`mailto:${email}?subject=友链申请`}
                        className="text-primary hover:underline mx-1"
                      >
                        发送邮件
                      </a>
                      申请
                    </motion.p>
                  )}
                </div>
              </form>
            </motion.div>
          )}
        </AnimatePresence>
      </motion.div>

      {/* 邮件申请备选方案 */}
      {email && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ delay: 0.3 }}
          className="max-w-3xl mx-auto mt-8 text-center"
        >
          <p className="text-gray-500 text-sm">
            不想填表单？也可以直接
            <a
              href={`mailto:${email}?subject=友链申请&body=站点名称：%0A站点地址：%0A站点头像：%0A站点描述：%0A`}
              className="text-primary hover:underline mx-1"
            >
              发送邮件
            </a>
            申请友链
          </p>
        </motion.div>
      )}
    </section>
  );
};

export default FriendApplySection;
```

---

## 3.2 内容管理后台模块

### 3.2.1 后台模块总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        管理后台功能模块总览                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   📊 仪表盘      │  │   📝 文章管理    │  │   🖼️ 媒体管理   │  │   📁 分类标签    │              │ │
│   │   │   Dashboard     │  │   Posts         │  │   Media         │  │   Categories    │              │ │
│   │   ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤              │ │
│   │   │ • 数据概览      │  │ • 文章列表      │  │ • 图片管理      │  │ • 分类管理      │              │ │
│   │   │ • 访问趋势      │  │ • 创建文章      │  │ • 附件管理      │  │ • 标签管理      │              │ │
│   │   │ • 热门文章      │  │ • 编辑文章      │  │ • 图床设置      │  │ • 批量操作      │              │ │
│   │   │ • 系统状态      │  │ • 批量操作      │  │ • 存储统计      │  │                 │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   📈 统计分析    │  │   🔗 友链管理    │  │   🤖 AI 工具    │  │   ⚙️ 系统设置   │              │ │
│   │   │   Analytics     │  │   Friends       │  │   AI Tools      │  │   Settings      │              │ │
│   │   ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤              │ │
│   │   │ • 访客分析      │  │ • 友链列表      │  │ • 文本清洗      │  │ • 站点设置      │              │ │
│   │   │ • 内容分析      │  │ • 申请审核      │  │ • 内容重写      │  │ • 个人资料      │              │ │
│   │   │ • 设备分析      │  │ • 状态检测      │  │ • Prompt管理    │  │ • 存储配置      │              │ │
│   │   │ • 地域分布      │  │ • 批量管理      │  │ • 批量处理      │  │ • AI 配置       │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐                                                        │ │
│   │   │   📋 日志监控    │  │   💬 评论管理    │                                                        │ │
│   │   │   Logs          │  │   Comments      │                                                        │ │
│   │   ├─────────────────┤  ├─────────────────┤                                                        │ │
│   │   │ • 系统日志      │  │ • 评论列表      │                                                        │ │
│   │   │ • 操作日志      │  │ • 评论审核      │                                                        │ │
│   │   │ • 错误日志      │  │ • 回复管理      │                                                        │ │
│   │   │ • 性能监控      │  │ • 批量操作      │                                                        │ │
│   │   └─────────────────┘  └─────────────────┘                                                        │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.2.2 仪表盘模块

#### 3.2.2.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        仪表盘功能规格                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      数据概览卡片                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   今日访问量     │  │   文章总数       │  │   总字数        │  │   评论数        │              │ │
│   │   │   1,234         │  │   128           │  │   32.5万        │  │   567           │              │ │
│   │   │   ↑ 12.5%       │  │   本周 +3       │  │   平均 2500/篇  │  │   待审核 5      │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      访问趋势图表                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   • 折线图展示近7天/30天访问趋势                                                                    │ │
│   │   • 支持 PV/UV 切换显示                                                                            │ │
│   │   • 鼠标悬浮显示详细数据                                                                           │ │
│   │   • 支持时间范围选择                                                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌─────────────────────────────────────────────┐  ┌─────────────────────────────────────────────────┐   │
│   │              热门文章排行                    │  │              访客地域分布                        │   │
│   ├─────────────────────────────────────────────┤  ├─────────────────────────────────────────────────┤   │
│   │                                             │  │                                                 │   │
│   │  1. 深入理解JVM虚拟线程     1,234 views    │  │  中国地图热力图                                  │   │
│   │  2. Spring Boot 3新特性      987 views    │  │  • 省份访问量分布                                 │   │
│   │  3. React 19深度解析         856 views    │  │  • Top 10 城市列表                               │   │
│   │  4. PostgreSQL优化指南       743 views    │  │  • 海外访问占比                                   │   │
│   │  5. Docker最佳实践           654 views    │  │                                                 │   │
│   │                                             │  │                                                 │   │
│   └─────────────────────────────────────────────┘  └─────────────────────────────────────────────────┘   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────┐  ┌─────────────────────────────────────────────────┐   │
│   │              设备类型占比                    │  │              系统状态监控                        │   │
│   ├─────────────────────────────────────────────┤  ├─────────────────────────────────────────────────┤   │
│   │                                             │  │                                                 │   │
│   │  饼图显示：                                  │  │  CPU 使用率: ████████░░ 78%                     │   │
│   │  • 桌面端: 65%                              │  │  内存使用: ██████░░░░ 56%                       │   │
│   │  • 移动端: 30%                              │  │  磁盘空间: ████░░░░░░ 35%                       │   │
│   │  • 平板: 5%                                 │  │  JVM 堆: ███████░░░ 67%                         │   │
│   │                                             │  │  虚拟线程: 1,234 活跃                           │   │
│   │                                             │  │  响应时间: 45ms 平均                            │   │
│   └─────────────────────────────────────────────┘  └─────────────────────────────────────────────────┘   │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      最近动态                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  时间线展示：                                                                                       │ │
│   │  • 10:30 发布文章《深入理解JVM虚拟线程》                                                            │ │
│   │  • 09:15 收到友链申请                                                                              │ │
│   │  • 08:45 新评论等待审核                                                                            │ │
│   │  • 昨天 系统自动备份完成                                                                           │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.2.2 页面组件实现

```tsx
// apps/admin/src/pages/dashboard/index.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { 
  Eye, 
  FileText, 
  BookOpen, 
  MessageSquare,
  TrendingUp,
  TrendingDown,
  Clock,
  AlertCircle,
} from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { analyticsService } from '@/services/analyticsService';

import { StatsCard } from './StatsCards';
import { VisitorChart } from './VisitorChart';
import { TopPosts } from './TopPosts';
import { GeoDistribution } from './GeoDistribution';
import { DeviceChart } from './DeviceChart';
import { SystemStatus } from './SystemStatus';
import { RecentActivity } from './RecentActivity';

/**
 * 仪表盘首页
 */
export default function DashboardPage() {
  // 获取统计数据
  const { data: overview, isLoading } = useQuery({
    queryKey: queryKeys.analytics.overview('today'),
    queryFn: () => analyticsService.getOverview('today'),
    refetchInterval: 60000, // 每分钟刷新
  });

  // 统计卡片数据
  const statsCards = [
    {
      title: '今日访问',
      value: overview?.todayViews || 0,
      change: overview?.viewsChange || 0,
      changeLabel: '较昨日',
      icon: Eye,
      color: 'primary',
    },
    {
      title: '文章总数',
      value: overview?.totalPosts || 0,
      change: overview?.newPostsThisWeek || 0,
      changeLabel: '本周新增',
      icon: FileText,
      color: 'green',
    },
    {
      title: '总字数',
      value: formatNumber(overview?.totalWords || 0),
      suffix: '字',
      subValue: `平均 ${overview?.avgWordsPerPost || 0} 字/篇`,
      icon: BookOpen,
      color: 'blue',
    },
    {
      title: '评论数',
      value: overview?.totalComments || 0,
      badge: overview?.pendingComments > 0 ? `${overview.pendingComments} 待审核` : undefined,
      icon: MessageSquare,
      color: 'orange',
    },
  ];

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">仪表盘</h1>
          <p className="text-gray-400 mt-1">欢迎回来，查看您的博客数据概览</p>
        </div>
        <div className="flex items-center gap-2 text-sm text-gray-500">
          <Clock className="w-4 h-4" />
          <span>数据更新于 {new Date().toLocaleTimeString()}</span>
        </div>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {statsCards.map((card, index) => (
          <motion.div
            key={card.title}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
          >
            <StatsCard {...card} isLoading={isLoading} />
          </motion.div>
        ))}
      </div>

      {/* 访问趋势图表 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.4 }}
      >
        <VisitorChart />
      </motion.div>

      {/* 双列布局：热门文章 + 地域分布 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
        >
          <TopPosts />
        </motion.div>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
        >
          <GeoDistribution />
        </motion.div>
      </div>

      {/* 双列布局：设备占比 + 系统状态 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.7 }}
        >
          <DeviceChart />
        </motion.div>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.8 }}
        >
          <SystemStatus />
        </motion.div>
      </div>

      {/* 最近动态 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.9 }}
      >
        <RecentActivity />
      </motion.div>
    </div>
  );
}

/**
 * 格式化数字
 */
function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + '万';
  }
  return num.toLocaleString();
}
```

```tsx
// apps/admin/src/pages/dashboard/StatsCards.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { TrendingUp, TrendingDown, LucideIcon } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface StatsCardProps {
  title: string;
  value: number | string;
  suffix?: string;
  change?: number;
  changeLabel?: string;
  subValue?: string;
  badge?: string;
  icon: LucideIcon;
  color: 'primary' | 'green' | 'blue' | 'orange' | 'red';
  isLoading?: boolean;
}

const colorMap = {
  primary: {
    bg: 'bg-primary/20',
    text: 'text-primary',
    border: 'border-primary/30',
  },
  green: {
    bg: 'bg-green-500/20',
    text: 'text-green-400',
    border: 'border-green-500/30',
  },
  blue: {
    bg: 'bg-blue-500/20',
    text: 'text-blue-400',
    border: 'border-blue-500/30',
  },
  orange: {
    bg: 'bg-orange-500/20',
    text: 'text-orange-400',
    border: 'border-orange-500/30',
  },
  red: {
    bg: 'bg-red-500/20',
    text: 'text-red-400',
    border: 'border-red-500/30',
  },
};

/**
 * 统计卡片组件
 */
export const StatsCard: React.FC<StatsCardProps> = ({
  title,
  value,
  suffix,
  change,
  changeLabel,
  subValue,
  badge,
  icon: Icon,
  color,
  isLoading,
}) => {
  const colors = colorMap[color];
  const isPositiveChange = change !== undefined && change >= 0;

  return (
    <div
      className={cn(
        'relative p-6 rounded-2xl overflow-hidden',
        'bg-white/5 backdrop-blur-sm',
        'border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300'
      )}
    >
      {/* 背景装饰 */}
      <div
        className={cn(
          'absolute -top-10 -right-10 w-32 h-32 rounded-full blur-3xl opacity-20',
          colors.bg
        )}
      />

      {/* 内容 */}
      <div className="relative">
        {/* 头部：标题 + 图标 */}
        <div className="flex items-center justify-between mb-4">
          <span className="text-gray-400 text-sm font-medium">{title}</span>
          <div className={cn('p-2 rounded-lg', colors.bg)}>
            <Icon className={cn('w-5 h-5', colors.text)} />
          </div>
        </div>

        {/* 数值 */}
        {isLoading ? (
          <div className="h-9 w-24 bg-white/10 rounded animate-pulse" />
        ) : (
          <div className="flex items-baseline gap-1">
            <span className="text-3xl font-bold text-white">{value}</span>
            {suffix && <span className="text-lg text-gray-400">{suffix}</span>}
          </div>
        )}

        {/* 变化趋势 / 子信息 / 徽章 */}
        <div className="mt-3 flex items-center justify-between">
          {change !== undefined && (
            <div
              className={cn(
                'flex items-center gap-1 text-sm',
                isPositiveChange ? 'text-green-400' : 'text-red-400'
              )}
            >
              {isPositiveChange ? (
                <TrendingUp className="w-4 h-4" />
              ) : (
                <TrendingDown className="w-4 h-4" />
              )}
              <span>
                {isPositiveChange ? '+' : ''}
                {change}%
              </span>
              {changeLabel && (
                <span className="text-gray-500 ml-1">{changeLabel}</span>
              )}
            </div>
          )}

          {subValue && (
            <span className="text-sm text-gray-500">{subValue}</span>
          )}

          {badge && (
            <span
              className={cn(
                'px-2 py-0.5 rounded-full text-xs font-medium',
                'bg-orange-500/20 text-orange-400'
              )}
            >
              {badge}
            </span>
          )}
        </div>
      </div>
    </div>
  );
};
```

```tsx
// apps/admin/src/pages/dashboard/VisitorChart.tsx

import React, { useState } from 'react';
import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from 'recharts';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { analyticsService } from '@/services/analyticsService';

type TimeRange = '7d' | '30d' | '90d';
type MetricType = 'pv' | 'uv';

/**
 * 访问趋势图表
 */
export const VisitorChart: React.FC = () => {
  const [timeRange, setTimeRange] = useState<TimeRange>('7d');
  const [metricType, setMetricType] = useState<MetricType>('pv');

  // 获取访问数据
  const { data, isLoading } = useQuery({
    queryKey: queryKeys.analytics.visitors({ range: timeRange }),
    queryFn: () => analyticsService.getVisitorTrend(timeRange),
  });

  const timeRangeOptions: { value: TimeRange; label: string }[] = [
    { value: '7d', label: '近7天' },
    { value: '30d', label: '近30天' },
    { value: '90d', label: '近90天' },
  ];

  const metricOptions: { value: MetricType; label: string }[] = [
    { value: 'pv', label: '访问量 (PV)' },
    { value: 'uv', label: '访客数 (UV)' },
  ];

  return (
    <div
      className={cn(
        'p-6 rounded-2xl',
        'bg-white/5 backdrop-blur-sm border border-white/10'
      )}
    >
      {/* 头部 */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <h3 className="text-lg font-semibold text-white">访问趋势</h3>

        <div className="flex items-center gap-4">
          {/* 指标类型切换 */}
          <div className="flex items-center bg-white/5 rounded-lg p-1">
            {metricOptions.map((option) => (
              <button
                key={option.value}
                onClick={() => setMetricType(option.value)}
                className={cn(
                  'px-3 py-1.5 rounded-md text-sm font-medium',
                  'transition-all duration-200',
                  metricType === option.value
                    ? 'bg-primary text-white'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                )}
              >
                {option.label}
              </button>
            ))}
          </div>

          {/* 时间范围选择 */}
          <div className="flex items-center bg-white/5 rounded-lg p-1">
            {timeRangeOptions.map((option) => (
              <button
                key={option.value}
                onClick={() => setTimeRange(option.value)}
                className={cn(
                  'px-3 py-1.5 rounded-md text-sm font-medium',
                  'transition-all duration-200',
                  timeRange === option.value
                    ? 'bg-primary text-white'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                )}
              >
                {option.label}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* 图表区域 */}
      <div className="h-80">
        {isLoading ? (
          <div className="h-full flex items-center justify-center">
            <div className="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin" />
          </div>
        ) : (
          <ResponsiveContainer width="100%" height="100%">
            <AreaChart data={data} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
              <defs>
                <linearGradient id="colorPv" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="var(--primary)" stopOpacity={0.3} />
                  <stop offset="95%" stopColor="var(--primary)" stopOpacity={0} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.1)" />
              <XAxis dataKey="date" stroke="rgba(255,255,255,0.4)" fontSize={12} />
              <YAxis stroke="rgba(255,255,255,0.4)" fontSize={12} />
              <Tooltip content={<CustomTooltip />} />
              <Area
                type="monotone"
                dataKey={metricType}
                stroke="var(--primary)"
                strokeWidth={2}
                fillOpacity={1}
                fill="url(#colorPv)"
              />
            </AreaChart>
          </ResponsiveContainer>
        )}
      </div>
    </div>
  );
};

/**
 * 自定义 Tooltip 组件
 */
const CustomTooltip: React.FC<any> = ({ active, payload, label }) => {
  if (!active || !payload?.length) return null;

  return (
    <div className={cn(
      'px-4 py-3 rounded-lg',
      'bg-gray-900/95 backdrop-blur-sm border border-white/10',
      'shadow-xl'
    )}>
      <p className="text-sm text-gray-400 mb-2">{label}</p>
      {payload.map((entry: any, index: number) => (
        <div key={index} className="flex items-center gap-2">
          <div className="w-2 h-2 rounded-full" style={{ backgroundColor: entry.stroke }} />
          <span className="text-sm text-white font-medium">
            {entry.name}: {entry.value.toLocaleString()}
          </span>
        </div>
      ))}
    </div>
  );
};
```

---

**TopPosts 组件 - 热门文章排行**

```tsx
// apps/admin/src/pages/dashboard/TopPosts.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { TrendingUp, Eye, ExternalLink } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { analyticsService } from '@/services/analyticsService';

/**
 * 热门文章排行组件
 */
export const TopPosts: React.FC = () => {
  const { data: posts, isLoading } = useQuery({
    queryKey: queryKeys.analytics.topPosts,
    queryFn: () => analyticsService.getTopPosts(10),
  });

  return (
    <div className={cn(
      'p-6 rounded-2xl h-full',
      'bg-white/5 backdrop-blur-sm border border-white/10'
    )}>
      <div className="flex items-center justify-between mb-6">
        <h3 className="text-lg font-semibold text-white flex items-center gap-2">
          <TrendingUp className="w-5 h-5 text-primary" />
          热门文章
        </h3>
        <span className="text-xs text-gray-500">最近7天</span>
      </div>

      <div className="space-y-3">
        {isLoading ? (
          Array.from({ length: 5 }).map((_, i) => (
            <div key={i} className="flex items-center gap-3 animate-pulse">
              <div className="w-6 h-6 rounded bg-white/10" />
              <div className="flex-1 h-4 rounded bg-white/10" />
              <div className="w-16 h-4 rounded bg-white/10" />
            </div>
          ))
        ) : (
          posts?.map((post, index) => (
            <motion.a
              key={post.id}
              href={`/admin/posts/${post.id}`}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: index * 0.05 }}
              className={cn(
                'flex items-center gap-3 p-3 rounded-lg',
                'hover:bg-white/5 transition-colors duration-200 group'
              )}
            >
              <div className={cn(
                'w-6 h-6 rounded flex items-center justify-center text-xs font-bold',
                index < 3 ? 'bg-primary/20 text-primary' : 'bg-white/5 text-gray-400'
              )}>
                {index + 1}
              </div>
              <div className="flex-1 truncate text-sm text-gray-300 group-hover:text-white">
                {post.title}
              </div>
              <div className="flex items-center gap-1 text-sm text-gray-500">
                <Eye className="w-3.5 h-3.5" />
                <span>{post.views.toLocaleString()}</span>
              </div>
              <ExternalLink className="w-4 h-4 text-gray-500 opacity-0 group-hover:opacity-100" />
            </motion.a>
          ))
        )}
      </div>
    </div>
  );
};
```

---

**SystemStatus 组件 - 系统状态监控**

```tsx
// apps/admin/src/pages/dashboard/SystemStatus.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { Activity, Cpu, HardDrive, MemoryStick, Zap, Clock } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { systemService } from '@/services/systemService';

interface StatusBarProps {
  label: string;
  value: number;
  icon: React.ReactNode;
  color: string;
}

const StatusBar: React.FC<StatusBarProps> = ({ label, value, icon, color }) => {
  const getStatusColor = (val: number) => {
    if (val >= 90) return 'text-red-400';
    if (val >= 70) return 'text-orange-400';
    return 'text-green-400';
  };

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2 text-sm text-gray-400">
          {icon}
          <span>{label}</span>
        </div>
        <span className={cn('text-sm font-medium', getStatusColor(value))}>
          {value}%
        </span>
      </div>
      <div className="h-2 bg-white/5 rounded-full overflow-hidden">
        <motion.div
          initial={{ width: 0 }}
          animate={{ width: `${value}%` }}
          transition={{ duration: 0.8, ease: 'easeOut' }}
          className="h-full rounded-full"
          style={{ background: `linear-gradient(to right, ${color}, ${color}80)` }}
        />
      </div>
    </div>
  );
};

/**
 * 系统状态监控组件
 */
export const SystemStatus: React.FC = () => {
  const { data: status, isLoading } = useQuery({
    queryKey: queryKeys.system.status,
    queryFn: () => systemService.getSystemStatus(),
    refetchInterval: 30000,
  });

  return (
    <div className={cn(
      'p-6 rounded-2xl h-full',
      'bg-white/5 backdrop-blur-sm border border-white/10'
    )}>
      <div className="flex items-center justify-between mb-6">
        <h3 className="text-lg font-semibold text-white flex items-center gap-2">
          <Activity className="w-5 h-5 text-primary" />
          系统状态
        </h3>
        <div className="flex items-center gap-1 text-xs text-gray-500">
          <Clock className="w-3 h-3" />
          <span>{new Date().toLocaleTimeString()}</span>
        </div>
      </div>

      {isLoading ? (
        <div className="space-y-4">
          {Array.from({ length: 4 }).map((_, i) => (
            <div key={i} className="space-y-2 animate-pulse">
              <div className="h-4 w-24 rounded bg-white/10" />
              <div className="h-2 rounded-full bg-white/10" />
            </div>
          ))}
        </div>
      ) : (
        <div className="space-y-5">
          <StatusBar label="CPU 使用率" value={status?.cpu || 0} icon={<Cpu className="w-4 h-4" />} color="#6366f1" />
          <StatusBar label="内存使用" value={status?.memory || 0} icon={<MemoryStick className="w-4 h-4" />} color="#22c55e" />
          <StatusBar label="磁盘空间" value={status?.disk || 0} icon={<HardDrive className="w-4 h-4" />} color="#f59e0b" />
          <StatusBar label="JVM 堆内存" value={status?.jvmHeap || 0} icon={<Zap className="w-4 h-4" />} color="#ef4444" />
        </div>
      )}

      <div className="mt-6 pt-4 border-t border-white/5 grid grid-cols-2 gap-4">
        <div>
          <div className="text-xs text-gray-500 mb-1">虚拟线程</div>
          <div className="text-lg font-semibold text-white">
            {status?.virtualThreads?.toLocaleString() || '-'}
            <span className="text-xs text-gray-400 ml-1">活跃</span>
          </div>
        </div>
        <div>
          <div className="text-xs text-gray-500 mb-1">平均响应</div>
          <div className="text-lg font-semibold text-white">
            {status?.avgResponseTime || '-'}
            <span className="text-xs text-gray-400 ml-1">ms</span>
          </div>
        </div>
      </div>
    </div>
  );
};
```

---

**RecentActivity 组件 - 最近动态**

```tsx
// apps/admin/src/pages/dashboard/RecentActivity.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { FileText, MessageSquare, Link as LinkIcon, Settings, Check, Clock, AlertCircle } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { activityService } from '@/services/activityService';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

const activityIcons = {
  post: FileText,
  comment: MessageSquare,
  friend: LinkIcon,
  system: Settings,
};

const activityColors = {
  post: 'bg-blue-500/20 text-blue-400',
  comment: 'bg-green-500/20 text-green-400',
  friend: 'bg-purple-500/20 text-purple-400',
  system: 'bg-orange-500/20 text-orange-400',
};

/**
 * 最近动态组件
 */
export const RecentActivity: React.FC = () => {
  const { data: activities, isLoading } = useQuery({
    queryKey: queryKeys.activity.recent,
    queryFn: () => activityService.getRecentActivities(10),
    refetchInterval: 60000,
  });

  return (
    <div className={cn(
      'p-6 rounded-2xl',
      'bg-white/5 backdrop-blur-sm border border-white/10'
    )}>
      <div className="flex items-center justify-between mb-6">
        <h3 className="text-lg font-semibold text-white flex items-center gap-2">
          <Clock className="w-5 h-5 text-primary" />
          最近动态
        </h3>
        <a href="/admin/logs" className="text-sm text-gray-400 hover:text-primary transition-colors">
          查看全部
        </a>
      </div>

      <div className="relative">
        <div className="absolute left-5 top-3 bottom-3 w-px bg-white/10" />

        <div className="space-y-4">
          {isLoading ? (
            Array.from({ length: 4 }).map((_, i) => (
              <div key={i} className="flex items-start gap-4 animate-pulse">
                <div className="w-10 h-10 rounded-full bg-white/10" />
                <div className="flex-1 space-y-2">
                  <div className="h-4 w-3/4 rounded bg-white/10" />
                  <div className="h-3 w-20 rounded bg-white/10" />
                </div>
              </div>
            ))
          ) : (
            activities?.map((activity, index) => {
              const Icon = activityIcons[activity.type as keyof typeof activityIcons] || Settings;
              const colorClass = activityColors[activity.type as keyof typeof activityColors] || activityColors.system;

              return (
                <motion.div
                  key={activity.id}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: index * 0.05 }}
                  className="relative flex items-start gap-4"
                >
                  <div className={cn('relative z-10 w-10 h-10 rounded-full flex items-center justify-center', colorClass)}>
                    <Icon className="w-4 h-4" />
                  </div>
                  <div className="flex-1 min-w-0 pt-1">
                    <p className="text-sm text-gray-300">{activity.content}</p>
                    <div className="flex items-center gap-2 mt-1">
                      <span className="text-xs text-gray-500">
                        {formatDistanceToNow(new Date(activity.createdAt), { addSuffix: true, locale: zhCN })}
                      </span>
                      {activity.status === 'success' && (
                        <span className="flex items-center gap-1 text-xs text-green-400">
                          <Check className="w-3 h-3" /> 成功
                        </span>
                      )}
                      {activity.status === 'error' && (
                        <span className="flex items-center gap-1 text-xs text-red-400">
                          <AlertCircle className="w-3 h-3" /> 失败
                        </span>
                      )}
                    </div>
                  </div>
                </motion.div>
              );
            })
          )}
        </div>
      </div>
    </div>
  );
};
```

---

### 3.2.3 文章管理模块

#### 3.2.3.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        文章管理功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      文章列表页                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  搜索栏   [🔍 搜索文章标题、内容...]     [状态 ▼]  [分类 ▼]  [标签 ▼]  [📅 日期范围]       │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  操作栏   [☑ 全选]  [批量删除]  [批量发布]  [批量移动]        [+ 新建文章]  [📥 导入]      │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  表头     [☐]  标题                        分类      状态      浏览    更新时间     操作   │  │ │
│   │   ├─────────────────────────────────────────────────────────────────────────────────────────────┤  │ │
│   │   │           [☐]  深入理解JVM虚拟线程...     技术分享  ✅ 已发布  1,234   2024-01-15  [编辑]  │  │ │
│   │   │           [☐]  Spring Boot 3新特性解析    后端开发  ✅ 已发布   987    2024-01-14  [编辑]  │  │ │
│   │   │           [☐]  React 19深度解析（草稿）   前端开发  📝 草稿     -      2024-01-13  [编辑]  │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  分页     [< 上一页]  1  2  3  ...  10  [下一页 >]        共 128 篇文章，每页显示 [20 ▼]   │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      文章编辑页                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────┐  ┌─────────────────────────────────────────────┐   │ │
│   │   │           编辑器区域 (70%)                │  │         侧边栏 (30%)                        │   │ │
│   │   │                                          │  │                                             │   │ │
│   │   │  ┌──────────────────────────────────┐   │  │  ┌─────────────────────────────────────┐   │   │ │
│   │   │  │ 标题输入框                        │   │  │  │ 设置                             │   │   │ │
│   │   │  │ 请输入文章标题...                 │   │  │  │  状态: [草稿 ▼]                     │   │   │ │
│   │   │  └──────────────────────────────────┘   │  │  │  可见性: [公开 ▼]                    │   │   │ │
│   │   │                                          │  │  │  发布时间: [📅 立即发布]            │   │   │ │
│   │   │  ┌──────────────────────────────────┐   │  │  │  [💾 保存草稿]  [🚀 发布文章]        │   │   │ │
│   │   │  │ Markdown 编辑器                   │   │  │  └─────────────────────────────────────┘   │   │ │
│   │   │  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │   │  │                                             │   │ │
│   │   │  │  B  I  S  H1 H2  📎  🖼️  📊  🤖  │   │  │  ┌─────────────────────────────────────┐   │   │ │
│   │   │  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │   │  │  │ 分类与标签                           │   │   │ │
│   │   │  │                                   │   │  │  │  分类: [技术分享 ▼]                 │   │   │ │
│   │   │  │  # 深入理解JVM虚拟线程            │   │  │  │  标签: [Java] [JVM] [+添加]         │   │   │ │
│   │   │  │                                   │   │  │  └─────────────────────────────────────┘   │   │ │
│   │   │  └──────────────────────────────────┘   │  │                                             │   │ │
│   │   │                                          │  │  ┌─────────────────────────────────────┐   │   │ │
│   │   └──────────────────────────────────────────┘  │  │ 封面图片 / 摘要 / SEO设置            │   │   │ │
│   │                                                  │  └─────────────────────────────────────┘   │   │ │
│   │                                                  └─────────────────────────────────────────────┘   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.3.2 文章列表页组件实现

```tsx
// apps/admin/src/pages/posts/index.tsx

import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Plus, Search, Trash2, Upload, CheckCircle, FileText, Clock, Folder } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { postService } from '@/services/postService';
import { useDebounce } from '@aetherblog/hooks';

import { PostFilters } from './PostFilters';
import { PostTable } from './PostTable';
import { Pagination } from '@/components/common/Pagination';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';

/**
 * 文章状态配置
 */
const statusConfig = {
  published: { label: '已发布', color: 'text-green-400', bg: 'bg-green-500/20', icon: CheckCircle },
  draft: { label: '草稿', color: 'text-gray-400', bg: 'bg-gray-500/20', icon: FileText },
  scheduled: { label: '定时发布', color: 'text-orange-400', bg: 'bg-orange-500/20', icon: Clock },
  archived: { label: '已归档', color: 'text-blue-400', bg: 'bg-blue-500/20', icon: Folder },
};

/**
 * 文章管理主页面
 */
export default function PostsPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedStatus, setSelectedStatus] = useState<string | null>(null);
  const [selectedCategory, setSelectedCategory] = useState<number | null>(null);
  const [selectedTags, setSelectedTags] = useState<number[]>([]);
  const [dateRange, setDateRange] = useState<[Date | null, Date | null]>([null, null]);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(20);
  const [selectedIds, setSelectedIds] = useState<number[]>([]);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

  const queryClient = useQueryClient();
  const debouncedSearch = useDebounce(searchQuery, 300);

  // 构建查询参数
  const queryParams = useMemo(() => ({
    keyword: debouncedSearch || undefined,
    status: selectedStatus || undefined,
    categoryId: selectedCategory || undefined,
    tagIds: selectedTags.length > 0 ? selectedTags : undefined,
    startDate: dateRange[0]?.toISOString(),
    endDate: dateRange[1]?.toISOString(),
    page: currentPage,
    size: pageSize,
  }), [debouncedSearch, selectedStatus, selectedCategory, selectedTags, dateRange, currentPage, pageSize]);

  // 获取文章列表
  const { data: postsData, isLoading } = useQuery({
    queryKey: queryKeys.posts.list(queryParams),
    queryFn: () => postService.getList(queryParams),
  });

  // 获取分类列表
  const { data: categories } = useQuery({
    queryKey: queryKeys.categories.all,
    queryFn: () => postService.getCategories(),
  });

  // 获取标签列表
  const { data: tags } = useQuery({
    queryKey: queryKeys.tags.all,
    queryFn: () => postService.getTags(),
  });

  // 批量删除
  const deleteMutation = useMutation({
    mutationFn: (ids: number[]) => postService.batchDelete(ids),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
      setSelectedIds([]);
      setShowDeleteConfirm(false);
    },
  });

  // 批量发布
  const publishMutation = useMutation({
    mutationFn: (ids: number[]) => postService.batchPublish(ids),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
      setSelectedIds([]);
    },
  });

  const handleSelectAll = () => {
    if (selectedIds.length === postsData?.list.length) {
      setSelectedIds([]);
    } else {
      setSelectedIds(postsData?.list.map(post => post.id) || []);
    }
  };

  const handleSelect = (id: number) => {
    setSelectedIds(prev => 
      prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
    );
  };

  const handleClearFilters = () => {
    setSearchQuery('');
    setSelectedStatus(null);
    setSelectedCategory(null);
    setSelectedTags([]);
    setDateRange([null, null]);
    setCurrentPage(1);
  };

  const hasActiveFilters = searchQuery || selectedStatus || selectedCategory || selectedTags.length > 0 || dateRange[0];

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">文章管理</h1>
          <p className="text-gray-400 mt-1">管理您的所有博客文章，共 {postsData?.total || 0} 篇</p>
        </div>
        <div className="flex items-center gap-3">
          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className={cn(
              'flex items-center gap-2 px-4 py-2 rounded-lg',
              'bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10'
            )}
          >
            <Upload className="w-4 h-4" />
            导入
          </motion.button>
          <motion.a
            href="/admin/posts/new"
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className={cn(
              'flex items-center gap-2 px-4 py-2 rounded-lg',
              'bg-primary text-white hover:bg-primary/90'
            )}
          >
            <Plus className="w-4 h-4" />
            新建文章
          </motion.a>
        </div>
      </div>

      {/* 搜索和筛选栏 */}
      <div className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <div className="flex flex-col lg:flex-row gap-4">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="搜索文章标题、内容..."
              className={cn(
                'w-full pl-10 pr-4 py-2.5 rounded-lg',
                'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                'focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/30'
              )}
            />
          </div>
          <PostFilters
            status={selectedStatus}
            onStatusChange={setSelectedStatus}
            category={selectedCategory}
            onCategoryChange={setSelectedCategory}
            tags={selectedTags}
            onTagsChange={setSelectedTags}
            dateRange={dateRange}
            onDateRangeChange={setDateRange}
            categories={categories || []}
            allTags={tags || []}
          />
          {hasActiveFilters && (
            <motion.button
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              onClick={handleClearFilters}
              className="px-4 py-2 text-sm text-gray-400 hover:text-white"
            >
              清除筛选
            </motion.button>
          )}
        </div>
      </div>

      {/* 批量操作栏 */}
      <AnimatePresence>
        {selectedIds.length > 0 && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className={cn('flex items-center justify-between p-4 rounded-xl', 'bg-primary/10 border border-primary/30')}
          >
            <div className="flex items-center gap-3">
              <span className="text-sm text-primary">已选择 {selectedIds.length} 篇文章</span>
              <button onClick={() => setSelectedIds([])} className="text-sm text-gray-400 hover:text-white">
                取消选择
              </button>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={() => publishMutation.mutate(selectedIds)}
                disabled={publishMutation.isPending}
                className={cn('flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm', 'bg-green-500/20 text-green-400 hover:bg-green-500/30')}
              >
                <CheckCircle className="w-4 h-4" />
                批量发布
              </button>
              <button
                onClick={() => setShowDeleteConfirm(true)}
                className={cn('flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm', 'bg-red-500/20 text-red-400 hover:bg-red-500/30')}
              >
                <Trash2 className="w-4 h-4" />
                批量删除
              </button>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* 文章表格 */}
      <PostTable
        posts={postsData?.list || []}
        isLoading={isLoading}
        selectedIds={selectedIds}
        onSelectAll={handleSelectAll}
        onSelect={handleSelect}
        statusConfig={statusConfig}
      />

      {/* 分页 */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2 text-sm text-gray-400">
          <span>每页显示</span>
          <select
            value={pageSize}
            onChange={(e) => { setPageSize(Number(e.target.value)); setCurrentPage(1); }}
            className={cn('px-2 py-1 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none')}
          >
            <option value={10}>10</option>
            <option value={20}>20</option>
            <option value={50}>50</option>
          </select>
          <span>条</span>
        </div>
        <Pagination current={currentPage} total={postsData?.total || 0} pageSize={pageSize} onChange={setCurrentPage} />
      </div>

      {/* 删除确认对话框 */}
      <ConfirmDialog
        isOpen={showDeleteConfirm}
        onClose={() => setShowDeleteConfirm(false)}
        onConfirm={() => deleteMutation.mutate(selectedIds)}
        title="确认删除"
        message={`确定要删除选中的 ${selectedIds.length} 篇文章吗？此操作不可恢复。`}
        confirmText="删除"
        confirmVariant="danger"
        isLoading={deleteMutation.isPending}
      />
    </div>
  );
}
```

---

**PostFilters 组件 - 文章筛选器**

```tsx
// apps/admin/src/pages/posts/PostFilters.tsx

import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown, Calendar, Tag, Folder, X, Check } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { format } from 'date-fns';
import { zhCN } from 'date-fns/locale';
import { DayPicker } from 'react-day-picker';

interface PostFiltersProps {
  status: string | null;
  onStatusChange: (status: string | null) => void;
  category: number | null;
  onCategoryChange: (category: number | null) => void;
  tags: number[];
  onTagsChange: (tags: number[]) => void;
  dateRange: [Date | null, Date | null];
  onDateRangeChange: (range: [Date | null, Date | null]) => void;
  categories: { id: number; name: string }[];
  allTags: { id: number; name: string; color?: string }[];
}

const statusOptions = [
  { value: null, label: '全部状态' },
  { value: 'published', label: '已发布' },
  { value: 'draft', label: '草稿' },
  { value: 'scheduled', label: '定时发布' },
  { value: 'archived', label: '已归档' },
];

/**
 * 文章筛选器组件
 */
export const PostFilters: React.FC<PostFiltersProps> = ({
  status,
  onStatusChange,
  category,
  onCategoryChange,
  tags,
  onTagsChange,
  dateRange,
  onDateRangeChange,
  categories,
  allTags,
}) => {
  const [openDropdown, setOpenDropdown] = useState<string | null>(null);
  const dropdownRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setOpenDropdown(null);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  const renderDropdown = (
    id: string,
    label: string,
    icon: React.ReactNode,
    content: React.ReactNode,
    hasValue: boolean
  ) => (
    <div className="relative">
      <button
        onClick={() => setOpenDropdown(openDropdown === id ? null : id)}
        className={cn(
          'flex items-center gap-2 px-3 py-2 rounded-lg text-sm',
          'border transition-all duration-200',
          openDropdown === id
            ? 'border-primary/50 bg-primary/10 text-white'
            : hasValue
              ? 'border-primary/30 bg-primary/5 text-primary'
              : 'border-white/10 bg-white/5 text-gray-400 hover:text-white hover:border-white/20'
        )}
      >
        {icon}
        <span>{label}</span>
        <ChevronDown className={cn('w-4 h-4 transition-transform', openDropdown === id && 'rotate-180')} />
      </button>
      <AnimatePresence>
        {openDropdown === id && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className={cn(
              'absolute top-full left-0 mt-2 z-50 min-w-[200px]',
              'bg-gray-900/95 backdrop-blur-sm border border-white/10 rounded-xl shadow-xl overflow-hidden'
            )}
          >
            {content}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );

  return (
    <div ref={dropdownRef} className="flex items-center gap-2 flex-wrap">
      {/* 状态筛选 */}
      {renderDropdown(
        'status',
        statusOptions.find(s => s.value === status)?.label || '状态',
        <Folder className="w-4 h-4" />,
        <div className="p-2">
          {statusOptions.map((option) => (
            <button
              key={option.value ?? 'all'}
              onClick={() => { onStatusChange(option.value); setOpenDropdown(null); }}
              className={cn(
                'w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm',
                'hover:bg-white/5 transition-colors',
                status === option.value ? 'text-primary' : 'text-gray-300'
              )}
            >
              {option.label}
              {status === option.value && <Check className="w-4 h-4" />}
            </button>
          ))}
        </div>,
        status !== null
      )}

      {/* 分类筛选 */}
      {renderDropdown(
        'category',
        categories.find(c => c.id === category)?.name || '分类',
        <Folder className="w-4 h-4" />,
        <div className="p-2 max-h-60 overflow-y-auto">
          <button
            onClick={() => { onCategoryChange(null); setOpenDropdown(null); }}
            className={cn(
              'w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm',
              'hover:bg-white/5 transition-colors',
              category === null ? 'text-primary' : 'text-gray-300'
            )}
          >
            全部分类
            {category === null && <Check className="w-4 h-4" />}
          </button>
          {categories.map((cat) => (
            <button
              key={cat.id}
              onClick={() => { onCategoryChange(cat.id); setOpenDropdown(null); }}
              className={cn(
                'w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm',
                'hover:bg-white/5 transition-colors',
                category === cat.id ? 'text-primary' : 'text-gray-300'
              )}
            >
              {cat.name}
              {category === cat.id && <Check className="w-4 h-4" />}
            </button>
          ))}
        </div>,
        category !== null
      )}

      {/* 标签筛选 */}
      {renderDropdown(
        'tags',
        tags.length > 0 ? `${tags.length} 个标签` : '标签',
        <Tag className="w-4 h-4" />,
        <div className="p-3 max-h-60 overflow-y-auto">
          <div className="flex flex-wrap gap-2">
            {allTags.map((tag) => (
              <button
                key={tag.id}
                onClick={() => {
                  if (tags.includes(tag.id)) {
                    onTagsChange(tags.filter(t => t !== tag.id));
                  } else {
                    onTagsChange([...tags, tag.id]);
                  }
                }}
                className={cn(
                  'px-2.5 py-1 rounded-full text-xs font-medium transition-all',
                  tags.includes(tag.id)
                    ? 'bg-primary text-white'
                    : 'bg-white/10 text-gray-300 hover:bg-white/20'
                )}
                style={tag.color && tags.includes(tag.id) ? { backgroundColor: tag.color } : undefined}
              >
                {tag.name}
              </button>
            ))}
          </div>
        </div>,
        tags.length > 0
      )}

      {/* 日期范围筛选 */}
      {renderDropdown(
        'date',
        dateRange[0]
          ? dateRange[1]
            ? `${format(dateRange[0], 'MM/dd')} - ${format(dateRange[1], 'MM/dd')}`
            : format(dateRange[0], 'yyyy/MM/dd')
          : '日期范围',
        <Calendar className="w-4 h-4" />,
        <div className="p-3">
          <DayPicker
            mode="range"
            selected={{ from: dateRange[0] || undefined, to: dateRange[1] || undefined }}
            onSelect={(range) => onDateRangeChange([range?.from || null, range?.to || null])}
            locale={zhCN}
            classNames={{
              day_selected: 'bg-primary text-white',
              day_today: 'text-primary font-bold',
            }}
          />
          {(dateRange[0] || dateRange[1]) && (
            <button
              onClick={() => onDateRangeChange([null, null])}
              className="w-full mt-2 px-3 py-1.5 text-sm text-gray-400 hover:text-white bg-white/5 rounded-lg"
            >
              清除日期
            </button>
          )}
        </div>,
        dateRange[0] !== null
      )}

      {/* 已选标签展示 */}
      {tags.length > 0 && (
        <div className="flex items-center gap-1 ml-2">
          {tags.slice(0, 3).map((tagId) => {
            const tag = allTags.find(t => t.id === tagId);
            return tag ? (
              <span
                key={tagId}
                className="flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-primary/20 text-primary"
              >
                {tag.name}
                <X
                  className="w-3 h-3 cursor-pointer hover:text-white"
                  onClick={() => onTagsChange(tags.filter(t => t !== tagId))}
                />
              </span>
            ) : null;
          })}
          {tags.length > 3 && (
            <span className="text-xs text-gray-400">+{tags.length - 3}</span>
          )}
        </div>
      )}
    </div>
  );
};
```

---

**PostTable 组件 - 文章列表表格**

```tsx
// apps/admin/src/pages/posts/PostTable.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { MoreVertical, Edit, Eye, Trash2, Copy, ExternalLink, Pin, Archive } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { format } from 'date-fns';
import { Menu, Transition } from '@headlessui/react';

interface Post {
  id: number;
  title: string;
  slug: string;
  status: string;
  category: { id: number; name: string };
  tags: { id: number; name: string }[];
  views: number;
  commentsCount: number;
  isPinned: boolean;
  createdAt: string;
  updatedAt: string;
  cover?: string;
}

interface PostTableProps {
  posts: Post[];
  isLoading: boolean;
  selectedIds: number[];
  onSelectAll: () => void;
  onSelect: (id: number) => void;
  statusConfig: Record<string, { label: string; color: string; bg: string; icon: React.ComponentType }>;
}

/**
 * 文章列表表格组件
 */
export const PostTable: React.FC<PostTableProps> = ({
  posts,
  isLoading,
  selectedIds,
  onSelectAll,
  onSelect,
  statusConfig,
}) => {
  if (isLoading) {
    return (
      <div className={cn('rounded-xl overflow-hidden', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <div className="divide-y divide-white/5">
          {Array.from({ length: 5 }).map((_, i) => (
            <div key={i} className="flex items-center gap-4 p-4 animate-pulse">
              <div className="w-5 h-5 rounded bg-white/10" />
              <div className="w-16 h-12 rounded-lg bg-white/10" />
              <div className="flex-1 space-y-2">
                <div className="h-4 w-3/4 rounded bg-white/10" />
                <div className="h-3 w-1/4 rounded bg-white/10" />
              </div>
              <div className="w-16 h-5 rounded bg-white/10" />
              <div className="w-12 h-4 rounded bg-white/10" />
              <div className="w-24 h-4 rounded bg-white/10" />
              <div className="w-8 h-8 rounded bg-white/10" />
            </div>
          ))}
        </div>
      </div>
    );
  }

  if (posts.length === 0) {
    return (
      <div className={cn('p-12 rounded-xl text-center', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center">
          <Edit className="w-8 h-8 text-gray-500" />
        </div>
        <h3 className="text-lg font-medium text-white mb-2">暂无文章</h3>
        <p className="text-gray-400 mb-4">开始创建您的第一篇博客文章吧</p>
        <a
          href="/admin/posts/new"
          className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90"
        >
          新建文章
        </a>
      </div>
    );
  }

  return (
    <div className={cn('rounded-xl overflow-hidden', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      {/* 表头 */}
      <div className="flex items-center gap-4 px-4 py-3 bg-white/5 border-b border-white/10 text-sm text-gray-400">
        <input
          type="checkbox"
          checked={selectedIds.length === posts.length && posts.length > 0}
          onChange={onSelectAll}
          className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30"
        />
        <div className="w-16">封面</div>
        <div className="flex-1">标题</div>
        <div className="w-20 text-center">分类</div>
        <div className="w-20 text-center">状态</div>
        <div className="w-16 text-center">浏览</div>
        <div className="w-28">更新时间</div>
        <div className="w-10"></div>
      </div>

      {/* 文章列表 */}
      <div className="divide-y divide-white/5">
        {posts.map((post, index) => {
          const config = statusConfig[post.status] || statusConfig.draft;
          const StatusIcon = config.icon;

          return (
            <motion.div
              key={post.id}
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: index * 0.03 }}
              className={cn(
                'flex items-center gap-4 px-4 py-3',
                'hover:bg-white/5 transition-colors group',
                selectedIds.includes(post.id) && 'bg-primary/5'
              )}
            >
              <input
                type="checkbox"
                checked={selectedIds.includes(post.id)}
                onChange={() => onSelect(post.id)}
                className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30"
              />

              {/* 封面 */}
              <div className="w-16 h-12 rounded-lg overflow-hidden bg-white/5 flex-shrink-0">
                {post.cover ? (
                  <img src={post.cover} alt={post.title} className="w-full h-full object-cover" />
                ) : (
                  <div className="w-full h-full flex items-center justify-center text-gray-500">
                    <Edit className="w-4 h-4" />
                  </div>
                )}
              </div>

              {/* 标题 */}
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                  {post.isPinned && (
                    <Pin className="w-3.5 h-3.5 text-primary flex-shrink-0" />
                  )}
                  <a
                    href={`/admin/posts/${post.id}/edit`}
                    className="text-white hover:text-primary truncate font-medium transition-colors"
                  >
                    {post.title}
                  </a>
                </div>
                <div className="flex items-center gap-2 mt-1">
                  {post.tags.slice(0, 2).map((tag) => (
                    <span key={tag.id} className="text-xs text-gray-500">#{tag.name}</span>
                  ))}
                  {post.tags.length > 2 && (
                    <span className="text-xs text-gray-500">+{post.tags.length - 2}</span>
                  )}
                </div>
              </div>

              {/* 分类 */}
              <div className="w-20 text-center">
                <span className="text-sm text-gray-400">{post.category.name}</span>
              </div>

              {/* 状态 */}
              <div className="w-20 flex justify-center">
                <span className={cn('flex items-center gap-1 px-2 py-1 rounded-full text-xs', config.bg, config.color)}>
                  <StatusIcon className="w-3 h-3" />
                  {config.label}
                </span>
              </div>

              {/* 浏览量 */}
              <div className="w-16 text-center text-sm text-gray-400">
                {post.status === 'published' ? post.views.toLocaleString() : '-'}
              </div>

              {/* 更新时间 */}
              <div className="w-28 text-sm text-gray-500">
                {format(new Date(post.updatedAt), 'yyyy-MM-dd HH:mm')}
              </div>

              {/* 操作菜单 */}
              <Menu as="div" className="relative">
                <Menu.Button className={cn(
                  'p-2 rounded-lg text-gray-400 hover:text-white hover:bg-white/10',
                  'opacity-0 group-hover:opacity-100 transition-all'
                )}>
                  <MoreVertical className="w-4 h-4" />
                </Menu.Button>
                <Transition
                  enter="transition duration-100 ease-out"
                  enterFrom="transform scale-95 opacity-0"
                  enterTo="transform scale-100 opacity-100"
                  leave="transition duration-75 ease-in"
                  leaveFrom="transform scale-100 opacity-100"
                  leaveTo="transform scale-95 opacity-0"
                >
                  <Menu.Items className={cn(
                    'absolute right-0 mt-2 w-48 origin-top-right z-50',
                    'bg-gray-900/95 backdrop-blur-sm border border-white/10 rounded-xl shadow-xl',
                    'divide-y divide-white/5 overflow-hidden'
                  )}>
                    <div className="p-1">
                      <Menu.Item>
                        {({ active }) => (
                          <a
                            href={`/admin/posts/${post.id}/edit`}
                            className={cn('flex items-center gap-2 px-3 py-2 rounded-lg text-sm', active ? 'bg-white/10 text-white' : 'text-gray-300')}
                          >
                            <Edit className="w-4 h-4" /> 编辑
                          </a>
                        )}
                      </Menu.Item>
                      {post.status === 'published' && (
                        <Menu.Item>
                          {({ active }) => (
                            <a
                              href={`/blog/${post.slug}`}
                              target="_blank"
                              className={cn('flex items-center gap-2 px-3 py-2 rounded-lg text-sm', active ? 'bg-white/10 text-white' : 'text-gray-300')}
                            >
                              <ExternalLink className="w-4 h-4" /> 查看
                            </a>
                          )}
                        </Menu.Item>
                      )}
                      <Menu.Item>
                        {({ active }) => (
                          <button className={cn('w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm', active ? 'bg-white/10 text-white' : 'text-gray-300')}>
                            <Copy className="w-4 h-4" /> 复制
                          </button>
                        )}
                      </Menu.Item>
                    </div>
                    <div className="p-1">
                      <Menu.Item>
                        {({ active }) => (
                          <button className={cn('w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm', active ? 'bg-white/10 text-white' : 'text-gray-300')}>
                            <Archive className="w-4 h-4" /> 归档
                          </button>
                        )}
                      </Menu.Item>
                      <Menu.Item>
                        {({ active }) => (
                          <button className={cn('w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm text-red-400', active && 'bg-red-500/10')}>
                            <Trash2 className="w-4 h-4" /> 删除
                          </button>
                        )}
                      </Menu.Item>
                    </div>
                  </Menu.Items>
                </Transition>
              </Menu>
            </motion.div>
          );
        })}
      </div>
    </div>
  );
};
```

---

#### 3.2.3.3 文章编辑器页面

```tsx
// apps/admin/src/pages/posts/[id]/edit.tsx

import React, { useState, useCallback, useEffect } from 'react';
import { motion } from 'framer-motion';
import { ArrowLeft, Save, Send, Eye, Clock, Loader2, Sparkles, Settings } from 'lucide-react';
import { useParams, useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { postService } from '@/services/postService';
import { useAutoSave } from '@/hooks/useAutoSave';

import { MarkdownEditor } from '@/components/editor/MarkdownEditor';
import { PublishSettings } from './components/PublishSettings';
import { CategoryTagSelector } from './components/CategoryTagSelector';
import { CoverImageUpload } from './components/CoverImageUpload';
import { SummaryEditor } from './components/SummaryEditor';
import { SeoSettings } from './components/SeoSettings';

const postSchema = z.object({
  title: z.string().min(1, '请输入文章标题').max(200, '标题不能超过200个字符'),
  content: z.string().min(1, '请输入文章内容'),
  slug: z.string().optional(),
  status: z.enum(['draft', 'published', 'scheduled']),
  visibility: z.enum(['public', 'private', 'password']),
  password: z.string().optional(),
  publishAt: z.date().optional(),
  categoryId: z.number().nullable(),
  tagIds: z.array(z.number()),
  cover: z.string().optional(),
  summary: z.string().max(500, '摘要不能超过500个字符').optional(),
  seoTitle: z.string().max(60).optional(),
  seoDescription: z.string().max(160).optional(),
  seoKeywords: z.array(z.string()).optional(),
  isPinned: z.boolean(),
  allowComment: z.boolean(),
});

type PostFormData = z.infer<typeof postSchema>;

/**
 * 文章编辑器页面
 */
export default function PostEditorPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const isNew = id === 'new';

  const [showSettings, setShowSettings] = useState(true);
  const [lastSaved, setLastSaved] = useState<Date | null>(null);

  const methods = useForm<PostFormData>({
    resolver: zodResolver(postSchema),
    defaultValues: {
      title: '',
      content: '',
      status: 'draft',
      visibility: 'public',
      categoryId: null,
      tagIds: [],
      isPinned: false,
      allowComment: true,
    },
  });

  const { watch, setValue, formState: { isDirty, errors } } = methods;

  // 获取文章详情
  const { data: post, isLoading } = useQuery({
    queryKey: queryKeys.posts.detail(Number(id)),
    queryFn: () => postService.getDetail(Number(id)),
    enabled: !isNew && !!id,
  });

  // 填充表单数据
  useEffect(() => {
    if (post) {
      methods.reset({
        title: post.title,
        content: post.content,
        slug: post.slug,
        status: post.status,
        visibility: post.visibility,
        password: post.password,
        publishAt: post.publishAt ? new Date(post.publishAt) : undefined,
        categoryId: post.category?.id || null,
        tagIds: post.tags?.map(t => t.id) || [],
        cover: post.cover,
        summary: post.summary,
        seoTitle: post.seoTitle,
        seoDescription: post.seoDescription,
        seoKeywords: post.seoKeywords,
        isPinned: post.isPinned,
        allowComment: post.allowComment,
      });
    }
  }, [post, methods]);

  // 保存文章
  const saveMutation = useMutation({
    mutationFn: (data: PostFormData) =>
      isNew ? postService.create(data) : postService.update(Number(id), data),
    onSuccess: (result) => {
      setLastSaved(new Date());
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
      if (isNew && result.id) {
        navigate(`/admin/posts/${result.id}/edit`, { replace: true });
      }
    },
  });

  // 自动保存
  const formData = watch();
  useAutoSave({
    data: formData,
    onSave: () => saveMutation.mutate(formData),
    enabled: isDirty && !isNew,
    debounceMs: 30000,
  });

  const handleSaveDraft = useCallback(() => {
    setValue('status', 'draft');
    saveMutation.mutate({ ...formData, status: 'draft' });
  }, [formData, setValue, saveMutation]);

  const handlePublish = useCallback(() => {
    setValue('status', 'published');
    saveMutation.mutate({ ...formData, status: 'published' });
  }, [formData, setValue, saveMutation]);

  if (isLoading && !isNew) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Loader2 className="w-8 h-8 text-primary animate-spin" />
      </div>
    );
  }

  return (
    <FormProvider {...methods}>
      <div className="min-h-screen bg-gray-950">
        {/* 顶部工具栏 */}
        <div className={cn(
          'sticky top-0 z-40 px-6 py-3',
          'bg-gray-950/80 backdrop-blur-xl border-b border-white/5'
        )}>
          <div className="flex items-center justify-between max-w-screen-2xl mx-auto">
            <div className="flex items-center gap-4">
              <button
                onClick={() => navigate('/admin/posts')}
                className="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-white/5"
              >
                <ArrowLeft className="w-5 h-5" />
              </button>
              <div>
                <h1 className="text-lg font-semibold text-white">
                  {isNew ? '新建文章' : '编辑文章'}
                </h1>
                {lastSaved && (
                  <p className="text-xs text-gray-500 flex items-center gap-1">
                    <Clock className="w-3 h-3" />
                    上次保存于 {lastSaved.toLocaleTimeString()}
                  </p>
                )}
              </div>
            </div>

            <div className="flex items-center gap-3">
              {isDirty && (
                <span className="text-xs text-orange-400 flex items-center gap-1">
                  <span className="w-1.5 h-1.5 rounded-full bg-orange-400" />
                  未保存
                </span>
              )}

              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={() => setShowSettings(!showSettings)}
                className={cn(
                  'p-2 rounded-lg transition-colors',
                  showSettings ? 'bg-primary/20 text-primary' : 'text-gray-400 hover:text-white hover:bg-white/5'
                )}
              >
                <Settings className="w-5 h-5" />
              </motion.button>

              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleSaveDraft}
                disabled={saveMutation.isPending}
                className={cn(
                  'flex items-center gap-2 px-4 py-2 rounded-lg',
                  'bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10'
                )}
              >
                {saveMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                保存草稿
              </motion.button>

              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handlePublish}
                disabled={saveMutation.isPending}
                className={cn(
                  'flex items-center gap-2 px-4 py-2 rounded-lg',
                  'bg-primary text-white hover:bg-primary/90'
                )}
              >
                {saveMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : <Send className="w-4 h-4" />}
                发布文章
              </motion.button>
            </div>
          </div>
        </div>

        {/* 编辑区域 */}
        <div className="max-w-screen-2xl mx-auto px-6 py-6">
          <div className="flex gap-6">
            {/* 左侧编辑器 */}
            <div className={cn('flex-1 min-w-0 space-y-4', showSettings ? 'max-w-[calc(100%-380px)]' : 'w-full')}>
              {/* 标题输入 */}
              <input
                {...methods.register('title')}
                placeholder="请输入文章标题..."
                className={cn(
                  'w-full px-4 py-3 text-2xl font-bold',
                  'bg-transparent border-none text-white placeholder-gray-500',
                  'focus:outline-none focus:ring-0',
                  errors.title && 'text-red-400'
                )}
              />
              {errors.title && (
                <p className="px-4 text-sm text-red-400">{errors.title.message}</p>
              )}

              {/* Markdown 编辑器 */}
              <div className={cn('rounded-xl overflow-hidden', 'bg-white/5 border border-white/10')}>
                <MarkdownEditor
                  value={watch('content')}
                  onChange={(value) => setValue('content', value || '', { shouldDirty: true })}
                  placeholder="开始撰写您的文章..."
                  minHeight={600}
                />
              </div>
            </div>

            {/* 右侧设置面板 */}
            {showSettings && (
              <motion.div
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                className="w-[360px] flex-shrink-0 space-y-4"
              >
                <PublishSettings />
                <CategoryTagSelector />
                <CoverImageUpload />
                <SummaryEditor />
                <SeoSettings />
              </motion.div>
            )}
          </div>
        </div>
      </div>
    </FormProvider>
  );
}
```

---

**PublishSettings 组件 - 设置**

```tsx
// apps/admin/src/pages/posts/[id]/components/PublishSettings.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { Globe, Lock, Key, Calendar, MessageSquare, Pin } from 'lucide-react';
import { useFormContext } from 'react-hook-form';
import { cn } from '@aetherblog/utils';
import { DayPicker } from 'react-day-picker';

const visibilityOptions = [
  { value: 'public', label: '公开', icon: Globe, desc: '所有人可见' },
  { value: 'private', label: '私密', icon: Lock, desc: '仅自己可见' },
  { value: 'password', label: '密码保护', icon: Key, desc: '需要密码访问' },
];

/**
 * 设置组件
 */
export const PublishSettings: React.FC = () => {
  const { register, watch, setValue } = useFormContext();
  const visibility = watch('visibility');
  const publishAt = watch('publishAt');
  const isPinned = watch('isPinned');
  const allowComment = watch('allowComment');

  return (
    <div className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      <h3 className="text-sm font-medium text-white mb-4">设置</h3>

      {/* 可见性 */}
      <div className="space-y-2 mb-4">
        <label className="text-xs text-gray-400">可见性</label>
        <div className="grid grid-cols-3 gap-2">
          {visibilityOptions.map((option) => (
            <button
              key={option.value}
              type="button"
              onClick={() => setValue('visibility', option.value)}
              className={cn(
                'flex flex-col items-center gap-1 p-3 rounded-lg text-center transition-all',
                visibility === option.value
                  ? 'bg-primary/20 border border-primary/50 text-primary'
                  : 'bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:border-white/20'
              )}
            >
              <option.icon className="w-4 h-4" />
              <span className="text-xs">{option.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* 密码输入 */}
      {visibility === 'password' && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: 'auto' }}
          exit={{ opacity: 0, height: 0 }}
          className="mb-4"
        >
          <label className="text-xs text-gray-400 mb-1 block">访问密码</label>
          <input
            {...register('password')}
            type="password"
            placeholder="设置访问密码"
            className={cn(
              'w-full px-3 py-2 rounded-lg text-sm',
              'bg-black/30 border border-white/10 text-white placeholder-gray-500',
              'focus:outline-none focus:border-primary/50'
            )}
          />
        </motion.div>
      )}

      {/* 定时发布 */}
      <div className="mb-4">
        <label className="text-xs text-gray-400 mb-2 flex items-center gap-2">
          <Calendar className="w-3.5 h-3.5" />
          发布时间
        </label>
        <div className="flex items-center gap-2">
          <button
            type="button"
            onClick={() => setValue('publishAt', undefined)}
            className={cn(
              'flex-1 px-3 py-2 rounded-lg text-sm transition-all',
              !publishAt
                ? 'bg-primary/20 text-primary border border-primary/50'
                : 'bg-white/5 text-gray-400 border border-white/10 hover:text-white'
            )}
          >
            立即发布
          </button>
          <button
            type="button"
            onClick={() => setValue('publishAt', new Date())}
            className={cn(
              'flex-1 px-3 py-2 rounded-lg text-sm transition-all',
              publishAt
                ? 'bg-primary/20 text-primary border border-primary/50'
                : 'bg-white/5 text-gray-400 border border-white/10 hover:text-white'
            )}
          >
            定时发布
          </button>
        </div>
      </div>

      {/* 日期选择器 */}
      {publishAt && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: 'auto' }}
          className="mb-4 p-3 bg-black/20 rounded-lg"
        >
          <DayPicker
            mode="single"
            selected={publishAt}
            onSelect={(date) => setValue('publishAt', date)}
            disabled={{ before: new Date() }}
          />
        </motion.div>
      )}

      {/* 其他选项 */}
      <div className="space-y-3 pt-3 border-t border-white/5">
        <label className="flex items-center justify-between cursor-pointer group">
          <span className="flex items-center gap-2 text-sm text-gray-300 group-hover:text-white">
            <Pin className="w-4 h-4" />
            置顶文章
          </span>
          <input
            type="checkbox"
            checked={isPinned}
            onChange={(e) => setValue('isPinned', e.target.checked)}
            className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30"
          />
        </label>
        <label className="flex items-center justify-between cursor-pointer group">
          <span className="flex items-center gap-2 text-sm text-gray-300 group-hover:text-white">
            <MessageSquare className="w-4 h-4" />
            开启评论
          </span>
          <input
            type="checkbox"
            checked={allowComment}
            onChange={(e) => setValue('allowComment', e.target.checked)}
            className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30"
          />
        </label>
      </div>
    </div>
  );
};
```

---

**CategoryTagSelector 组件 - 分类标签选择器**

```tsx
// apps/admin/src/pages/posts/[id]/components/CategoryTagSelector.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Folder, Tag, Plus, X, ChevronDown, Sparkles, Loader2 } from 'lucide-react';
import { useFormContext } from 'react-hook-form';
import { useQuery, useMutation } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { postService } from '@/services/postService';
import { aiService } from '@/services/aiService';

/**
 * 分类标签选择器组件
 */
export const CategoryTagSelector: React.FC = () => {
  const { watch, setValue } = useFormContext();
  const categoryId = watch('categoryId');
  const tagIds = watch('tagIds') as number[];
  const content = watch('content');

  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);
  const [newTagName, setNewTagName] = useState('');

  // 获取分类列表
  const { data: categories } = useQuery({
    queryKey: queryKeys.categories.all,
    queryFn: () => postService.getCategories(),
  });

  // 获取标签列表
  const { data: tags } = useQuery({
    queryKey: queryKeys.tags.all,
    queryFn: () => postService.getTags(),
  });

  // AI 自动标签
  const aiTagMutation = useMutation({
    mutationFn: () => aiService.suggestTags(content),
    onSuccess: (suggestedTags) => {
      const existingTagIds = tags?.filter(t => suggestedTags.includes(t.name)).map(t => t.id) || [];
      setValue('tagIds', [...new Set([...tagIds, ...existingTagIds])]);
    },
  });

  const selectedCategory = categories?.find(c => c.id === categoryId);
  const selectedTags = tags?.filter(t => tagIds.includes(t.id)) || [];

  const handleAddTag = (tagId: number) => {
    if (!tagIds.includes(tagId)) {
      setValue('tagIds', [...tagIds, tagId]);
    }
  };

  const handleRemoveTag = (tagId: number) => {
    setValue('tagIds', tagIds.filter(id => id !== tagId));
  };

  return (
    <div className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      <h3 className="text-sm font-medium text-white mb-4">分类与标签</h3>

      {/* 分类选择 */}
      <div className="mb-4">
        <label className="text-xs text-gray-400 mb-2 flex items-center gap-2">
          <Folder className="w-3.5 h-3.5" />
          文章分类
        </label>
        <div className="relative">
          <button
            type="button"
            onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}
            className={cn(
              'w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm',
              'bg-black/30 border border-white/10 text-left',
              selectedCategory ? 'text-white' : 'text-gray-500'
            )}
          >
            <span>{selectedCategory?.name || '选择分类'}</span>
            <ChevronDown className={cn('w-4 h-4 transition-transform', showCategoryDropdown && 'rotate-180')} />
          </button>
          <AnimatePresence>
            {showCategoryDropdown && (
              <motion.div
                initial={{ opacity: 0, y: -10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className={cn(
                  'absolute top-full left-0 right-0 mt-1 z-20',
                  'bg-gray-900/95 backdrop-blur-sm border border-white/10 rounded-lg shadow-xl',
                  'max-h-48 overflow-y-auto'
                )}
              >
                {categories?.map((cat) => (
                  <button
                    key={cat.id}
                    type="button"
                    onClick={() => {
                      setValue('categoryId', cat.id);
                      setShowCategoryDropdown(false);
                    }}
                    className={cn(
                      'w-full px-3 py-2 text-left text-sm hover:bg-white/5',
                      categoryId === cat.id ? 'text-primary' : 'text-gray-300'
                    )}
                  >
                    {cat.name}
                  </button>
                ))}
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      </div>

      {/* 标签选择 */}
      <div>
        <div className="flex items-center justify-between mb-2">
          <label className="text-xs text-gray-400 flex items-center gap-2">
            <Tag className="w-3.5 h-3.5" />
            文章标签
          </label>
          <button
            type="button"
            onClick={() => aiTagMutation.mutate()}
            disabled={aiTagMutation.isPending || !content}
            className={cn(
              'flex items-center gap-1 px-2 py-1 rounded text-xs',
              'bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300',
              'hover:from-purple-500/30 hover:to-pink-500/30 transition-colors',
              'disabled:opacity-50 disabled:cursor-not-allowed'
            )}
          >
            {aiTagMutation.isPending ? (
              <Loader2 className="w-3 h-3 animate-spin" />
            ) : (
              <Sparkles className="w-3 h-3" />
            )}
            AI 推荐
          </button>
        </div>

        {/* 已选标签 */}
        {selectedTags.length > 0 && (
          <div className="flex flex-wrap gap-1.5 mb-3">
            {selectedTags.map((tag) => (
              <span
                key={tag.id}
                className="flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-primary/20 text-primary"
              >
                {tag.name}
                <X
                  className="w-3 h-3 cursor-pointer hover:text-white"
                  onClick={() => handleRemoveTag(tag.id)}
                />
              </span>
            ))}
          </div>
        )}

        {/* 可选标签 */}
        <div className="flex flex-wrap gap-1.5 p-2 bg-black/20 rounded-lg max-h-32 overflow-y-auto">
          {tags?.filter(t => !tagIds.includes(t.id)).map((tag) => (
            <button
              key={tag.id}
              type="button"
              onClick={() => handleAddTag(tag.id)}
              className="px-2 py-1 rounded-full text-xs bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white transition-colors"
            >
              {tag.name}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};
```

---

**CoverImageUpload 组件 - 封面图片上传**

```tsx
// apps/admin/src/pages/posts/[id]/components/CoverImageUpload.tsx

import React, { useState, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Image, Upload, X, Loader2, Sparkles, Link as LinkIcon } from 'lucide-react';
import { useFormContext } from 'react-hook-form';
import { useMutation } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { uploadService } from '@/services/uploadService';
import { aiService } from '@/services/aiService';
import { useDropzone } from 'react-dropzone';

/**
 * 封面图片上传组件
 */
export const CoverImageUpload: React.FC = () => {
  const { watch, setValue } = useFormContext();
  const cover = watch('cover');
  const content = watch('content');

  const [showUrlInput, setShowUrlInput] = useState(false);
  const [urlValue, setUrlValue] = useState('');

  // 上传图片
  const uploadMutation = useMutation({
    mutationFn: (file: File) => uploadService.uploadImage(file),
    onSuccess: (url) => setValue('cover', url),
  });

  // AI 生成封面
  const aiCoverMutation = useMutation({
    mutationFn: () => aiService.generateCover(content),
    onSuccess: (url) => setValue('cover', url),
  });

  const onDrop = useCallback((acceptedFiles: File[]) => {
    if (acceptedFiles[0]) {
      uploadMutation.mutate(acceptedFiles[0]);
    }
  }, [uploadMutation]);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: { 'image/*': ['.png', '.jpg', '.jpeg', '.webp', '.gif'] },
    maxFiles: 1,
    maxSize: 5 * 1024 * 1024,
  });

  const handleUrlSubmit = () => {
    if (urlValue.trim()) {
      setValue('cover', urlValue.trim());
      setUrlValue('');
      setShowUrlInput(false);
    }
  };

  const isLoading = uploadMutation.isPending || aiCoverMutation.isPending;

  return (
    <div className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-sm font-medium text-white flex items-center gap-2">
          <Image className="w-4 h-4" />
          封面图片
        </h3>
        {cover && (
          <button
            type="button"
            onClick={() => setValue('cover', undefined)}
            className="text-xs text-gray-400 hover:text-red-400 transition-colors"
          >
            移除
          </button>
        )}
      </div>

      <AnimatePresence mode="wait">
        {cover ? (
          <motion.div
            key="preview"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="relative aspect-video rounded-lg overflow-hidden group"
          >
            <img src={cover} alt="封面预览" className="w-full h-full object-cover" />
            <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
              <button
                type="button"
                onClick={() => setValue('cover', undefined)}
                className="p-2 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/30"
              >
                <X className="w-4 h-4" />
              </button>
            </div>
          </motion.div>
        ) : (
          <motion.div key="upload" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
            <div
              {...getRootProps()}
              className={cn(
                'aspect-video rounded-lg border-2 border-dashed',
                'flex flex-col items-center justify-center gap-2 cursor-pointer',
                'transition-colors',
                isDragActive
                  ? 'border-primary bg-primary/10'
                  : 'border-white/10 hover:border-white/20 hover:bg-white/5',
                isLoading && 'pointer-events-none opacity-50'
              )}
            >
              <input {...getInputProps()} />
              {isLoading ? (
                <Loader2 className="w-8 h-8 text-primary animate-spin" />
              ) : (
                <>
                  <Upload className="w-8 h-8 text-gray-500" />
                  <p className="text-sm text-gray-400">拖放图片或点击上传</p>
                  <p className="text-xs text-gray-500">支持 PNG, JPG, WebP, GIF (最大 5MB)</p>
                </>
              )}
            </div>

            {/* 其他选项 */}
            <div className="flex items-center gap-2 mt-3">
              <button
                type="button"
                onClick={() => setShowUrlInput(!showUrlInput)}
                className={cn(
                  'flex-1 flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-xs',
                  'bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 transition-colors'
                )}
              >
                <LinkIcon className="w-3.5 h-3.5" />
                URL链接
              </button>
              <button
                type="button"
                onClick={() => aiCoverMutation.mutate()}
                disabled={!content || aiCoverMutation.isPending}
                className={cn(
                  'flex-1 flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-xs',
                  'bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300',
                  'hover:from-purple-500/30 hover:to-pink-500/30 transition-colors',
                  'disabled:opacity-50 disabled:cursor-not-allowed'
                )}
              >
                {aiCoverMutation.isPending ? (
                  <Loader2 className="w-3.5 h-3.5 animate-spin" />
                ) : (
                  <Sparkles className="w-3.5 h-3.5" />
                )}
                AI生成
              </button>
            </div>

            {/* URL 输入框 */}
            <AnimatePresence>
              {showUrlInput && (
                <motion.div
                  initial={{ opacity: 0, height: 0 }}
                  animate={{ opacity: 1, height: 'auto' }}
                  exit={{ opacity: 0, height: 0 }}
                  className="mt-3"
                >
                  <div className="flex gap-2">
                    <input
                      type="url"
                      value={urlValue}
                      onChange={(e) => setUrlValue(e.target.value)}
                      placeholder="输入图片URL..."
                      className={cn(
                        'flex-1 px-3 py-2 rounded-lg text-sm',
                        'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                        'focus:outline-none focus:border-primary/50'
                      )}
                    />
                    <button
                      type="button"
                      onClick={handleUrlSubmit}
                      className="px-3 py-2 rounded-lg bg-primary text-white text-sm hover:bg-primary/90"
                    >
                      确定
                    </button>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};
```

---

**SummaryEditor 组件 - 摘要编辑器**

```tsx
// apps/admin/src/pages/posts/[id]/components/SummaryEditor.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { FileText, Sparkles, Loader2 } from 'lucide-react';
import { useFormContext } from 'react-hook-form';
import { useMutation } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { aiService } from '@/services/aiService';

/**
 * 摘要编辑器组件
 */
export const SummaryEditor: React.FC = () => {
  const { register, watch, setValue, formState: { errors } } = useFormContext();
  const summary = watch('summary') || '';
  const content = watch('content');

  // AI 生成摘要
  const aiSummaryMutation = useMutation({
    mutationFn: () => aiService.generateSummary(content),
    onSuccess: (generatedSummary) => setValue('summary', generatedSummary),
  });

  const maxLength = 500;
  const remaining = maxLength - summary.length;

  return (
    <div className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-sm font-medium text-white flex items-center gap-2">
          <FileText className="w-4 h-4" />
          文章摘要
        </h3>
        <button
          type="button"
          onClick={() => aiSummaryMutation.mutate()}
          disabled={!content || aiSummaryMutation.isPending}
          className={cn(
            'flex items-center gap-1 px-2 py-1 rounded text-xs',
            'bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300',
            'hover:from-purple-500/30 hover:to-pink-500/30 transition-colors',
            'disabled:opacity-50 disabled:cursor-not-allowed'
          )}
        >
          {aiSummaryMutation.isPending ? (
            <Loader2 className="w-3 h-3 animate-spin" />
          ) : (
            <Sparkles className="w-3 h-3" />
          )}
          AI 生成
        </button>
      </div>

      <textarea
        {...register('summary')}
        placeholder="输入文章摘要，用于SEO和列表展示..."
        rows={4}
        maxLength={maxLength}
        className={cn(
          'w-full px-3 py-2 rounded-lg text-sm resize-none',
          'bg-black/30 border border-white/10 text-white placeholder-gray-500',
          'focus:outline-none focus:border-primary/50',
          errors.summary && 'border-red-500/50'
        )}
      />

      <div className="flex items-center justify-between mt-2">
        {errors.summary ? (
          <p className="text-xs text-red-400">{errors.summary.message as string}</p>
        ) : (
          <p className="text-xs text-gray-500">简洁描述文章内容，建议 50-160 个字符</p>
        )}
        <span className={cn(
          'text-xs',
          remaining < 50 ? 'text-orange-400' : 'text-gray-500'
        )}>
          {remaining}
        </span>
      </div>
    </div>
  );
};
```

---

**SeoSettings 组件 - SEO 设置**

```tsx
// apps/admin/src/pages/posts/[id]/components/SeoSettings.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Search, ChevronDown, AlertCircle, CheckCircle, X } from 'lucide-react';
import { useFormContext } from 'react-hook-form';
import { cn } from '@aetherblog/utils';

/**
 * SEO 设置组件
 */
export const SeoSettings: React.FC = () => {
  const { register, watch, setValue, formState: { errors } } = useFormContext();
  const [isExpanded, setIsExpanded] = useState(false);

  const title = watch('title');
  const seoTitle = watch('seoTitle') || title;
  const seoDescription = watch('seoDescription') || '';
  const seoKeywords = watch('seoKeywords') || [];
  const slug = watch('slug') || '';

  const [keywordInput, setKeywordInput] = useState('');

  const handleAddKeyword = () => {
    if (keywordInput.trim() && !seoKeywords.includes(keywordInput.trim())) {
      setValue('seoKeywords', [...seoKeywords, keywordInput.trim()]);
      setKeywordInput('');
    }
  };

  const handleRemoveKeyword = (keyword: string) => {
    setValue('seoKeywords', seoKeywords.filter((k: string) => k !== keyword));
  };

  // SEO 评分
  const getSeoScore = () => {
    let score = 0;
    if (seoTitle && seoTitle.length >= 10 && seoTitle.length <= 60) score += 25;
    if (seoDescription && seoDescription.length >= 50 && seoDescription.length <= 160) score += 25;
    if (seoKeywords.length >= 3 && seoKeywords.length <= 8) score += 25;
    if (slug && slug.length > 0) score += 25;
    return score;
  };

  const score = getSeoScore();
  const getScoreColor = () => {
    if (score >= 75) return 'text-green-400';
    if (score >= 50) return 'text-orange-400';
    return 'text-red-400';
  };

  return (
    <div className={cn('rounded-xl overflow-hidden', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      {/* 标题栏 */}
      <button
        type="button"
        onClick={() => setIsExpanded(!isExpanded)}
        className="w-full flex items-center justify-between p-4 text-left hover:bg-white/5 transition-colors"
      >
        <div className="flex items-center gap-2">
          <Search className="w-4 h-4 text-gray-400" />
          <h3 className="text-sm font-medium text-white">SEO 设置</h3>
        </div>
        <div className="flex items-center gap-2">
          <span className={cn('text-sm font-medium', getScoreColor())}>{score}%</span>
          <ChevronDown className={cn('w-4 h-4 text-gray-400 transition-transform', isExpanded && 'rotate-180')} />
        </div>
      </button>

      {/* 内容区 */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            className="overflow-hidden"
          >
            <div className="px-4 pb-4 space-y-4">
              {/* SEO 预览 */}
              <div className="p-3 bg-black/20 rounded-lg">
                <p className="text-xs text-gray-500 mb-2">搜索结果预览</p>
                <div className="space-y-1">
                  <p className="text-blue-400 text-sm truncate">{seoTitle || title || '文章标题'}</p>
                  <p className="text-green-400 text-xs truncate">
                    https://yourblog.com/posts/{slug || 'article-slug'}
                  </p>
                  <p className="text-gray-400 text-xs line-clamp-2">
                    {seoDescription || '文章描述将显示在这里...'}
                  </p>
                </div>
              </div>

              {/* URL Slug */}
              <div>
                <label className="text-xs text-gray-400 mb-1 block">URL 别名</label>
                <div className="flex items-center gap-2">
                  <span className="text-xs text-gray-500">/posts/</span>
                  <input
                    {...register('slug')}
                    placeholder="article-url-slug"
                    className={cn(
                      'flex-1 px-3 py-2 rounded-lg text-sm',
                      'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                      'focus:outline-none focus:border-primary/50'
                    )}
                  />
                </div>
              </div>

              {/* SEO 标题 */}
              <div>
                <div className="flex items-center justify-between mb-1">
                  <label className="text-xs text-gray-400">SEO 标题</label>
                  <span className={cn(
                    'text-xs',
                    seoTitle.length > 60 ? 'text-red-400' : seoTitle.length >= 10 ? 'text-green-400' : 'text-gray-500'
                  )}>
                    {seoTitle.length}/60
                  </span>
                </div>
                <input
                  {...register('seoTitle')}
                  placeholder={title || '输入SEO标题...'}
                  maxLength={60}
                  className={cn(
                    'w-full px-3 py-2 rounded-lg text-sm',
                    'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                    'focus:outline-none focus:border-primary/50'
                  )}
                />
              </div>

              {/* SEO 描述 */}
              <div>
                <div className="flex items-center justify-between mb-1">
                  <label className="text-xs text-gray-400">SEO 描述</label>
                  <span className={cn(
                    'text-xs',
                    seoDescription.length > 160 ? 'text-red-400' : seoDescription.length >= 50 ? 'text-green-400' : 'text-gray-500'
                  )}>
                    {seoDescription.length}/160
                  </span>
                </div>
                <textarea
                  {...register('seoDescription')}
                  placeholder="输入SEO描述..."
                  rows={2}
                  maxLength={160}
                  className={cn(
                    'w-full px-3 py-2 rounded-lg text-sm resize-none',
                    'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                    'focus:outline-none focus:border-primary/50'
                  )}
                />
              </div>

              {/* 关键词 */}
              <div>
                <label className="text-xs text-gray-400 mb-2 block">关键词</label>
                <div className="flex flex-wrap gap-1.5 mb-2">
                  {seoKeywords.map((keyword: string) => (
                    <span
                      key={keyword}
                      className="flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-white/10 text-gray-300"
                    >
                      {keyword}
                      <X
                        className="w-3 h-3 cursor-pointer hover:text-red-400"
                        onClick={() => handleRemoveKeyword(keyword)}
                      />
                    </span>
                  ))}
                </div>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={keywordInput}
                    onChange={(e) => setKeywordInput(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddKeyword())}
                    placeholder="添加关键词..."
                    className={cn(
                      'flex-1 px-3 py-2 rounded-lg text-sm',
                      'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                      'focus:outline-none focus:border-primary/50'
                    )}
                  />
                  <button
                    type="button"
                    onClick={handleAddKeyword}
                    className="px-3 py-2 rounded-lg bg-white/10 text-gray-300 text-sm hover:bg-white/20"
                  >
                    添加
                  </button>
                </div>
              </div>

              {/* SEO 提示 */}
              <div className="space-y-2 pt-2 border-t border-white/5">
                {seoTitle.length < 10 && (
                  <p className="flex items-center gap-2 text-xs text-orange-400">
                    <AlertCircle className="w-3 h-3" />
                    标题建议至少 10 个字符
                  </p>
                )}
                {seoDescription.length < 50 && (
                  <p className="flex items-center gap-2 text-xs text-orange-400">
                    <AlertCircle className="w-3 h-3" />
                    描述建议至少 50 个字符
                  </p>
                )}
                {score >= 75 && (
                  <p className="flex items-center gap-2 text-xs text-green-400">
                    <CheckCircle className="w-3 h-3" />
                    SEO 设置良好
                  </p>
                )}
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};
```

---

### 3.2.4 媒体管理模块

#### 3.2.4.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        媒体管理功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      媒体库主页面                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  工具栏   [🔍 搜索媒体...]   [类型 ▼]  [日期 ▼]  [排序 ▼]    [🔲 网格] [≡ 列表]  [📤 上传]  │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐                    │ │
│   │   │  📷     │  │  📷     │  │  🎬     │  │  📷     │  │  📄     │  │  📷     │                    │ │
│   │   │         │  │         │  │         │  │         │  │         │  │         │                    │ │
│   │   │ 图片1   │  │ 图片2   │  │ 视频1   │  │ 图片3   │  │ 文档1   │  │ 图片4   │                    │ │
│   │   │ 1.2 MB  │  │ 800 KB  │  │ 15 MB   │  │ 2.1 MB  │  │ 256 KB  │  │ 1.8 MB  │                    │ │
│   │   └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘                    │ │
│   │                                                                                                    │ │
│   │   ┌─────────┐  ┌─────────┐  ┌─────────────────────────────────────────────────────────────────┐   │ │
│   │   │  📷     │  │  🎵     │  │                     上传区域                                     │   │ │
│   │   │         │  │         │  │                                                                 │   │ │
│   │   │ 图片5   │  │ 音频1   │  │    📤 拖放文件到此处上传，或点击选择文件                        │   │ │
│   │   │ 960 KB  │  │ 3.5 MB  │  │    支持 PNG, JPG, GIF, MP4, PDF 等格式                          │   │ │
│   │   └─────────┘  └─────────┘  └─────────────────────────────────────────────────────────────────┘   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  分页     [< 上一页]  1  2  3  ...  5  [下一页 >]              共 86 个媒体文件              │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      媒体详情面板                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│   │   │    ┌────────────────────────────────┐    ┌───────────────────────────────────────────────┐  │ │ │
│   │   │    │                                │    │  文件信息                                     │  │ │ │
│   │   │    │                                │    │                                               │  │ │ │
│   │   │    │        [图片预览区域]          │    │  名称: cover-image.jpg                        │  │ │ │
│   │   │    │                                │    │  类型: image/jpeg                             │  │ │ │
│   │   │    │                                │    │  大小: 1.2 MB                                 │  │ │ │
│   │   │    └────────────────────────────────┘    │  尺寸: 1920 × 1080                            │  │ │ │
│   │   │                                          │  上传时间: 2024-01-15 14:30                   │  │ │ │
│   │   │    ┌────────────────────────────────┐    │                                               │  │ │ │
│   │   │    │  URL: https://cdn.../image.jpg │    │  [📋 复制链接]  [📥 下载]  [🗑️ 删除]          │  │ │ │
│   │   │    └────────────────────────────────┘    └───────────────────────────────────────────────┘  │ │ │
│   │   └──────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.4.2 媒体库页面组件实现

```tsx
// apps/admin/src/pages/media/index.tsx

import React, { useState, useMemo, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Search, Upload, Grid, List, Filter, Image, Video, FileText, Music, X, Loader2 } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { mediaService } from '@/services/mediaService';
import { useDropzone } from 'react-dropzone';
import { useDebounce } from '@aetherblog/hooks';

import { MediaGrid } from './MediaGrid';
import { MediaList } from './MediaList';
import { MediaDetail } from './MediaDetail';
import { UploadProgress } from './UploadProgress';
import { Pagination } from '@/components/common/Pagination';

type ViewMode = 'grid' | 'list';
type MediaType = 'all' | 'image' | 'video' | 'audio' | 'document';

const typeOptions: { value: MediaType; label: string; icon: React.ComponentType }[] = [
  { value: 'all', label: '全部', icon: Filter },
  { value: 'image', label: '图片', icon: Image },
  { value: 'video', label: '视频', icon: Video },
  { value: 'audio', label: '音频', icon: Music },
  { value: 'document', label: '文档', icon: FileText },
];

/**
 * 媒体库主页面
 */
export default function MediaPage() {
  const [viewMode, setViewMode] = useState<ViewMode>('grid');
  const [searchQuery, setSearchQuery] = useState('');
  const [mediaType, setMediaType] = useState<MediaType>('all');
  const [sortBy, setSortBy] = useState<'newest' | 'oldest' | 'name' | 'size'>('newest');
  const [currentPage, setCurrentPage] = useState(1);
  const [selectedMedia, setSelectedMedia] = useState<number | null>(null);
  const [uploadingFiles, setUploadingFiles] = useState<{ file: File; progress: number; id: string }[]>([]);

  const queryClient = useQueryClient();
  const debouncedSearch = useDebounce(searchQuery, 300);

  // 构建查询参数
  const queryParams = useMemo(() => ({
    keyword: debouncedSearch || undefined,
    type: mediaType !== 'all' ? mediaType : undefined,
    sortBy,
    page: currentPage,
    size: 24,
  }), [debouncedSearch, mediaType, sortBy, currentPage]);

  // 获取媒体列表
  const { data: mediaData, isLoading } = useQuery({
    queryKey: queryKeys.media.list(queryParams),
    queryFn: () => mediaService.getList(queryParams),
  });

  // 上传媒体
  const uploadMutation = useMutation({
    mutationFn: async ({ file, id }: { file: File; id: string }) => {
      return mediaService.upload(file, (progress) => {
        setUploadingFiles(prev => prev.map(f => f.id === id ? { ...f, progress } : f));
      });
    },
    onSuccess: (_, { id }) => {
      setUploadingFiles(prev => prev.filter(f => f.id !== id));
      queryClient.invalidateQueries({ queryKey: queryKeys.media.lists() });
    },
    onError: (_, { id }) => {
      setUploadingFiles(prev => prev.filter(f => f.id !== id));
    },
  });

  // 删除媒体
  const deleteMutation = useMutation({
    mutationFn: (id: number) => mediaService.delete(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.media.lists() });
      setSelectedMedia(null);
    },
  });

  const onDrop = useCallback((acceptedFiles: File[]) => {
    const newFiles = acceptedFiles.map(file => ({
      file,
      progress: 0,
      id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    }));

    setUploadingFiles(prev => [...prev, ...newFiles]);

    newFiles.forEach(({ file, id }) => {
      uploadMutation.mutate({ file, id });
    });
  }, [uploadMutation]);

  const { getRootProps, getInputProps, isDragActive, open } = useDropzone({
    onDrop,
    accept: {
      'image/*': ['.png', '.jpg', '.jpeg', '.webp', '.gif', '.svg'],
      'video/*': ['.mp4', '.webm', '.mov'],
      'audio/*': ['.mp3', '.wav', '.ogg'],
      'application/pdf': ['.pdf'],
    },
    noClick: true,
    multiple: true,
  });

  return (
    <div className="p-6 space-y-6" {...getRootProps()}>
      <input {...getInputProps()} />

      {/* 拖放覆盖层 */}
      <AnimatePresence>
        {isDragActive && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 z-50 bg-gray-950/90 flex items-center justify-center"
          >
            <div className="text-center">
              <Upload className="w-16 h-16 text-primary mx-auto mb-4" />
              <p className="text-xl text-white">释放以上传文件</p>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">媒体库</h1>
          <p className="text-gray-400 mt-1">管理您的所有媒体文件，共 {mediaData?.total || 0} 个</p>
        </div>
        <motion.button
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
          onClick={open}
          className={cn(
            'flex items-center gap-2 px-4 py-2 rounded-lg',
            'bg-primary text-white hover:bg-primary/90'
          )}
        >
          <Upload className="w-4 h-4" />
          上传文件
        </motion.button>
      </div>

      {/* 工具栏 */}
      <div className={cn('flex flex-col lg:flex-row lg:items-center gap-4 p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        {/* 搜索框 */}
        <div className="flex-1 relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            placeholder="搜索媒体文件..."
            className={cn(
              'w-full pl-10 pr-4 py-2.5 rounded-lg',
              'bg-black/30 border border-white/10 text-white placeholder-gray-500',
              'focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/30'
            )}
          />
        </div>

        {/* 类型筛选 */}
        <div className="flex items-center gap-1 bg-white/5 rounded-lg p-1">
          {typeOptions.map((option) => {
            const Icon = option.icon;
            return (
              <button
                key={option.value}
                onClick={() => setMediaType(option.value)}
                className={cn(
                  'flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm',
                  'transition-all duration-200',
                  mediaType === option.value
                    ? 'bg-primary text-white'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                )}
              >
                <Icon className="w-4 h-4" />
                <span className="hidden sm:inline">{option.label}</span>
              </button>
            );
          })}
        </div>

        {/* 视图切换 */}
        <div className="flex items-center gap-1 bg-white/5 rounded-lg p-1">
          <button
            onClick={() => setViewMode('grid')}
            className={cn(
              'p-2 rounded-md transition-colors',
              viewMode === 'grid' ? 'bg-primary text-white' : 'text-gray-400 hover:text-white'
            )}
          >
            <Grid className="w-4 h-4" />
          </button>
          <button
            onClick={() => setViewMode('list')}
            className={cn(
              'p-2 rounded-md transition-colors',
              viewMode === 'list' ? 'bg-primary text-white' : 'text-gray-400 hover:text-white'
            )}
          >
            <List className="w-4 h-4" />
          </button>
        </div>
      </div>

      {/* 上传进度 */}
      <AnimatePresence>
        {uploadingFiles.length > 0 && (
          <UploadProgress files={uploadingFiles} onCancel={(id) => setUploadingFiles(prev => prev.filter(f => f.id !== id))} />
        )}
      </AnimatePresence>

      {/* 主内容区 */}
      <div className="flex gap-6">
        {/* 媒体列表 */}
        <div className="flex-1 min-w-0">
          {isLoading ? (
            <div className="flex items-center justify-center h-64">
              <Loader2 className="w-8 h-8 text-primary animate-spin" />
            </div>
          ) : mediaData?.list.length === 0 ? (
            <div className={cn('p-12 rounded-xl text-center', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
              <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center">
                <Image className="w-8 h-8 text-gray-500" />
              </div>
              <h3 className="text-lg font-medium text-white mb-2">暂无媒体文件</h3>
              <p className="text-gray-400 mb-4">上传您的第一个媒体文件开始使用</p>
              <button onClick={open} className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90">
                <Upload className="w-4 h-4" />
                上传文件
              </button>
            </div>
          ) : viewMode === 'grid' ? (
            <MediaGrid
              items={mediaData?.list || []}
              selectedId={selectedMedia}
              onSelect={setSelectedMedia}
            />
          ) : (
            <MediaList
              items={mediaData?.list || []}
              selectedId={selectedMedia}
              onSelect={setSelectedMedia}
            />
          )}

          {/* 分页 */}
          {mediaData && mediaData.total > 24 && (
            <div className="mt-6">
              <Pagination
                current={currentPage}
                total={mediaData.total}
                pageSize={24}
                onChange={setCurrentPage}
              />
            </div>
          )}
        </div>

        {/* 详情面板 */}
        <AnimatePresence>
          {selectedMedia && (
            <motion.div
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: 20 }}
              className="w-80 flex-shrink-0"
            >
              <MediaDetail
                mediaId={selectedMedia}
                onClose={() => setSelectedMedia(null)}
                onDelete={() => deleteMutation.mutate(selectedMedia)}
                isDeleting={deleteMutation.isPending}
              />
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}
```

---

**MediaGrid 组件 - 媒体网格视图**

```tsx
// apps/admin/src/pages/media/MediaGrid.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { Image, Video, Music, FileText, Check } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface MediaItem {
  id: number;
  name: string;
  url: string;
  type: 'image' | 'video' | 'audio' | 'document';
  size: number;
  mimeType: string;
  width?: number;
  height?: number;
  createdAt: string;
}

interface MediaGridProps {
  items: MediaItem[];
  selectedId: number | null;
  onSelect: (id: number) => void;
}

const typeIcons = {
  image: Image,
  video: Video,
  audio: Music,
  document: FileText,
};

const formatFileSize = (bytes: number) => {
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
};

/**
 * 媒体网格视图组件
 */
export const MediaGrid: React.FC<MediaGridProps> = ({ items, selectedId, onSelect }) => {
  return (
    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      {items.map((item, index) => {
        const Icon = typeIcons[item.type];
        const isSelected = selectedId === item.id;

        return (
          <motion.div
            key={item.id}
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: index * 0.02 }}
            onClick={() => onSelect(item.id)}
            className={cn(
              'relative aspect-square rounded-xl overflow-hidden cursor-pointer group',
              'bg-white/5 border-2 transition-all duration-200',
              isSelected
                ? 'border-primary ring-2 ring-primary/30'
                : 'border-transparent hover:border-white/20'
            )}
          >
            {/* 预览区域 */}
            {item.type === 'image' ? (
              <img src={item.url} alt={item.name} className="w-full h-full object-cover" />
            ) : item.type === 'video' ? (
              <video src={item.url} className="w-full h-full object-cover" muted />
            ) : (
              <div className="w-full h-full flex items-center justify-center bg-white/5">
                <Icon className="w-12 h-12 text-gray-500" />
              </div>
            )}

            {/* 选中指示 */}
            {isSelected && (
              <div className="absolute top-2 right-2 w-6 h-6 rounded-full bg-primary flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}

            {/* 悬停遮罩 */}
            <div className={cn(
              'absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent',
              'opacity-0 group-hover:opacity-100 transition-opacity',
              isSelected && 'opacity-100'
            )}>
              <div className="absolute bottom-0 left-0 right-0 p-3">
                <p className="text-sm text-white truncate">{item.name}</p>
                <p className="text-xs text-gray-400">{formatFileSize(item.size)}</p>
              </div>
            </div>
          </motion.div>
        );
      })}
    </div>
  );
};
```

---

**MediaDetail 组件 - 媒体详情面板**

```tsx
// apps/admin/src/pages/media/MediaDetail.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { X, Copy, Download, Trash2, ExternalLink, Image, Video, Music, FileText, Loader2, Check } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { mediaService } from '@/services/mediaService';
import { format } from 'date-fns';
import { useCopyToClipboard } from '@aetherblog/hooks';

interface MediaDetailProps {
  mediaId: number;
  onClose: () => void;
  onDelete: () => void;
  isDeleting: boolean;
}

const typeIcons = {
  image: Image,
  video: Video,
  audio: Music,
  document: FileText,
};

const formatFileSize = (bytes: number) => {
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
};

/**
 * 媒体详情面板组件
 */
export const MediaDetail: React.FC<MediaDetailProps> = ({ mediaId, onClose, onDelete, isDeleting }) => {
  const [copied, copy] = useCopyToClipboard();

  const { data: media, isLoading } = useQuery({
    queryKey: queryKeys.media.detail(mediaId),
    queryFn: () => mediaService.getDetail(mediaId),
  });

  if (isLoading) {
    return (
      <div className={cn('p-6 rounded-xl h-full', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <div className="flex items-center justify-center h-64">
          <Loader2 className="w-8 h-8 text-primary animate-spin" />
        </div>
      </div>
    );
  }

  if (!media) return null;

  const Icon = typeIcons[media.type as keyof typeof typeIcons] || FileText;

  return (
    <div className={cn('rounded-xl overflow-hidden sticky top-6', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
      {/* 头部 */}
      <div className="flex items-center justify-between p-4 border-b border-white/10">
        <h3 className="text-sm font-medium text-white">文件详情</h3>
        <button onClick={onClose} className="p-1 rounded-lg text-gray-400 hover:text-white hover:bg-white/10">
          <X className="w-4 h-4" />
        </button>
      </div>

      {/* 预览区域 */}
      <div className="aspect-video bg-black/30">
        {media.type === 'image' ? (
          <img src={media.url} alt={media.name} className="w-full h-full object-contain" />
        ) : media.type === 'video' ? (
          <video src={media.url} controls className="w-full h-full" />
        ) : media.type === 'audio' ? (
          <div className="w-full h-full flex flex-col items-center justify-center gap-4">
            <Music className="w-16 h-16 text-gray-500" />
            <audio src={media.url} controls className="w-3/4" />
          </div>
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <Icon className="w-16 h-16 text-gray-500" />
          </div>
        )}
      </div>

      {/* 文件信息 */}
      <div className="p-4 space-y-3">
        <div>
          <p className="text-xs text-gray-500 mb-1">文件名</p>
          <p className="text-sm text-white truncate">{media.name}</p>
        </div>

        <div className="grid grid-cols-2 gap-3">
          <div>
            <p className="text-xs text-gray-500 mb-1">类型</p>
            <p className="text-sm text-gray-300">{media.mimeType}</p>
          </div>
          <div>
            <p className="text-xs text-gray-500 mb-1">大小</p>
            <p className="text-sm text-gray-300">{formatFileSize(media.size)}</p>
          </div>
        </div>

        {media.width && media.height && (
          <div>
            <p className="text-xs text-gray-500 mb-1">尺寸</p>
            <p className="text-sm text-gray-300">{media.width} × {media.height}</p>
          </div>
        )}

        <div>
          <p className="text-xs text-gray-500 mb-1">上传时间</p>
          <p className="text-sm text-gray-300">{format(new Date(media.createdAt), 'yyyy-MM-dd HH:mm:ss')}</p>
        </div>

        {/* URL */}
        <div>
          <p className="text-xs text-gray-500 mb-1">文件地址</p>
          <div className="flex items-center gap-2">
            <input
              type="text"
              value={media.url}
              readOnly
              className={cn(
                'flex-1 px-3 py-2 rounded-lg text-xs',
                'bg-black/30 border border-white/10 text-gray-300',
                'focus:outline-none'
              )}
            />
            <button
              onClick={() => copy(media.url)}
              className={cn(
                'p-2 rounded-lg transition-colors',
                copied ? 'bg-green-500/20 text-green-400' : 'bg-white/5 text-gray-400 hover:text-white'
              )}
            >
              {copied ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
            </button>
          </div>
        </div>
      </div>

      {/* 操作按钮 */}
      <div className="p-4 border-t border-white/10 flex items-center gap-2">
        <a
          href={media.url}
          target="_blank"
          className={cn(
            'flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-sm',
            'bg-white/5 text-gray-300 hover:text-white hover:bg-white/10'
          )}
        >
          <ExternalLink className="w-4 h-4" />
          打开
        </a>
        <a
          href={media.url}
          download={media.name}
          className={cn(
            'flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-sm',
            'bg-white/5 text-gray-300 hover:text-white hover:bg-white/10'
          )}
        >
          <Download className="w-4 h-4" />
          下载
        </a>
        <button
          onClick={onDelete}
          disabled={isDeleting}
          className={cn(
            'flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-sm',
            'bg-red-500/10 text-red-400 hover:bg-red-500/20'
          )}
        >
          {isDeleting ? <Loader2 className="w-4 h-4 animate-spin" /> : <Trash2 className="w-4 h-4" />}
        </button>
      </div>
    </div>
  );
};
```

---

**UploadProgress 组件 - 上传进度**

```tsx
// apps/admin/src/pages/media/UploadProgress.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { X, File, CheckCircle, Loader2 } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface UploadFile {
  id: string;
  file: File;
  progress: number;
}

interface UploadProgressProps {
  files: UploadFile[];
  onCancel: (id: string) => void;
}

/**
 * 上传进度组件
 */
export const UploadProgress: React.FC<UploadProgressProps> = ({ files, onCancel }) => {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: 20 }}
      className={cn('p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}
    >
      <h4 className="text-sm font-medium text-white mb-3 flex items-center gap-2">
        <Loader2 className="w-4 h-4 animate-spin" />
        正在上传 ({files.length} 个文件)
      </h4>

      <div className="space-y-2 max-h-48 overflow-y-auto">
        {files.map((item) => (
          <div key={item.id} className="flex items-center gap-3 p-2 rounded-lg bg-white/5">
            <div className="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
              {item.progress === 100 ? (
                <CheckCircle className="w-5 h-5 text-green-400" />
              ) : (
                <File className="w-5 h-5 text-gray-400" />
              )}
            </div>

            <div className="flex-1 min-w-0">
              <p className="text-sm text-white truncate">{item.file.name}</p>
              <div className="mt-1.5 h-1.5 bg-white/10 rounded-full overflow-hidden">
                <motion.div
                  initial={{ width: 0 }}
                  animate={{ width: `${item.progress}%` }}
                  className={cn(
                    'h-full rounded-full',
                    item.progress === 100 ? 'bg-green-500' : 'bg-primary'
                  )}
                />
              </div>
            </div>

            <span className="text-xs text-gray-400 w-12 text-right">{item.progress}%</span>

            <button
              onClick={() => onCancel(item.id)}
              className="p-1 rounded text-gray-500 hover:text-red-400"
            >
              <X className="w-4 h-4" />
            </button>
          </div>
        ))}
      </div>
    </motion.div>
  );
};
```

---

### 3.2.5 分类标签管理模块

#### 3.2.5.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      分类标签管理功能规格                                                  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│  ┌───────────────────────────────────────────────┬──────────────────────────────────────────────────────┐│
│  │              分类管理                          │                标签管理                              ││
│  ├───────────────────────────────────────────────┼──────────────────────────────────────────────────────┤│
│  │                                               │                                                      ││
│  │  ┌─────────────────────────────────────────┐  │  ┌──────────────────────────────────────────────┐    ││
│  │  │ [+ 新建分类]          [🔍 搜索分类...]  │  │  │ [+ 新建标签]            [🔍 搜索标签...]    │    ││
│  │  └─────────────────────────────────────────┘  │  └──────────────────────────────────────────────┘    ││
│  │                                               │                                                      ││
│  │  ┌─────────────────────────────────────────┐  │  ┌──────────────────────────────────────────────┐    ││
│  │  │  📁 技术分享          (15 篇)  [编辑]   │  │  │  ● Java         12篇   ● React      8篇    │    ││
│  │  │  ├── 后端开发         (8 篇)   [编辑]   │  │  │  ● Spring      10篇   ● TypeScript 6篇    │    ││
│  │  │  ├── 前端开发         (5 篇)   [编辑]   │  │  │  ● Docker       7篇   ● Kubernetes 5篇    │    ││
│  │  │  └── DevOps           (2 篇)   [编辑]   │  │  │  ● PostgreSQL   4篇   ● Redis      3篇    │    ││
│  │  │                                         │  │  │  ● AI           3篇   ● 微服务     2篇    │    ││
│  │  │  📁 生活随笔          (5 篇)   [编辑]   │  │  └──────────────────────────────────────────────┘    ││
│  │  │  📁 读书笔记          (3 篇)   [编辑]   │  │                                                      ││
│  │  └─────────────────────────────────────────┘  │  ┌──────────────────────────────────────────────┐    ││
│  │                                               │  │ 标签云预览                                    │    ││
│  │  ┌─────────────────────────────────────────┐  │  │   Java  React  Spring  TypeScript Docker   │    ││
│  │  │ 编辑分类                                │  │  │    Kubernetes  PostgreSQL  Redis  AI       │    ││
│  │  │  名称: [技术分享]                       │  │  └──────────────────────────────────────────────┘    ││
│  │  │  别名: [tech]                           │  │                                                      ││
│  │  │  描述: [技术相关的文章分享...]          │  │                                                      ││
│  │  │  父级: [无]                             │  │                                                      ││
│  │  │  [✓ 保存]  [✗ 取消]                     │  │                                                      ││
│  │  └─────────────────────────────────────────┘  │                                                      ││
│  │                                               │                                                      ││
│  └───────────────────────────────────────────────┴──────────────────────────────────────────────────────┘│
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.5.2 分类标签管理页面实现

```tsx
// apps/admin/src/pages/categories/index.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Folder, Tag, Plus, Search, ChevronRight, Edit2, Trash2, Save, X, Loader2 } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { categoryService } from '@/services/categoryService';
import { tagService } from '@/services/tagService';

const categorySchema = z.object({
  name: z.string().min(1, '请输入分类名称').max(50),
  slug: z.string().min(1, '请输入分类别名').max(50),
  description: z.string().max(200).optional(),
  parentId: z.number().nullable(),
});

const tagSchema = z.object({
  name: z.string().min(1, '请输入标签名称').max(30),
  slug: z.string().min(1, '请输入标签别名').max(30),
  color: z.string().optional(),
});

type CategoryFormData = z.infer<typeof categorySchema>;
type TagFormData = z.infer<typeof tagSchema>;

/**
 * 分类标签管理页面
 */
export default function CategoriesPage() {
  const [activeTab, setActiveTab] = useState<'categories' | 'tags'>('categories');
  const [searchQuery, setSearchQuery] = useState('');
  const [editingCategory, setEditingCategory] = useState<number | null>(null);
  const [editingTag, setEditingTag] = useState<number | null>(null);
  const [showNewCategory, setShowNewCategory] = useState(false);
  const [showNewTag, setShowNewTag] = useState(false);
  const [expandedCategories, setExpandedCategories] = useState<Set<number>>(new Set());

  const queryClient = useQueryClient();

  // 获取分类列表
  const { data: categories, isLoading: categoriesLoading } = useQuery({
    queryKey: queryKeys.categories.tree,
    queryFn: () => categoryService.getTree(),
  });

  // 获取标签列表
  const { data: tags, isLoading: tagsLoading } = useQuery({
    queryKey: queryKeys.tags.all,
    queryFn: () => tagService.getAll(),
  });

  // 分类表单
  const categoryForm = useForm<CategoryFormData>({
    resolver: zodResolver(categorySchema),
    defaultValues: { name: '', slug: '', description: '', parentId: null },
  });

  // 标签表单
  const tagForm = useForm<TagFormData>({
    resolver: zodResolver(tagSchema),
    defaultValues: { name: '', slug: '', color: '#6366f1' },
  });

  // 保存分类
  const saveCategoryMutation = useMutation({
    mutationFn: (data: CategoryFormData & { id?: number }) =>
      data.id ? categoryService.update(data.id, data) : categoryService.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.categories.tree });
      setEditingCategory(null);
      setShowNewCategory(false);
      categoryForm.reset();
    },
  });

  // 删除分类
  const deleteCategoryMutation = useMutation({
    mutationFn: (id: number) => categoryService.delete(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.categories.tree }),
  });

  // 保存标签
  const saveTagMutation = useMutation({
    mutationFn: (data: TagFormData & { id?: number }) =>
      data.id ? tagService.update(data.id, data) : tagService.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.tags.all });
      setEditingTag(null);
      setShowNewTag(false);
      tagForm.reset();
    },
  });

  // 删除标签
  const deleteTagMutation = useMutation({
    mutationFn: (id: number) => tagService.delete(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.tags.all }),
  });

  const toggleExpand = (id: number) => {
    setExpandedCategories(prev => {
      const newSet = new Set(prev);
      if (newSet.has(id)) newSet.delete(id);
      else newSet.add(id);
      return newSet;
    });
  };

  const renderCategoryTree = (items: any[], level = 0) => {
    return items.map((category) => (
      <div key={category.id}>
        <motion.div
          initial={{ opacity: 0, x: -10 }}
          animate={{ opacity: 1, x: 0 }}
          className={cn(
            'flex items-center gap-3 p-3 rounded-lg',
            'hover:bg-white/5 transition-colors group',
            level > 0 && 'ml-6'
          )}
        >
          {category.children?.length > 0 ? (
            <button onClick={() => toggleExpand(category.id)} className="p-1">
              <ChevronRight className={cn(
                'w-4 h-4 text-gray-400 transition-transform',
                expandedCategories.has(category.id) && 'rotate-90'
              )} />
            </button>
          ) : (
            <div className="w-6" />
          )}

          <Folder className="w-5 h-5 text-primary" />
          <span className="flex-1 text-white">{category.name}</span>
          <span className="text-sm text-gray-500">({category.postCount} 篇)</span>

          <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100">
            <button
              onClick={() => {
                setEditingCategory(category.id);
                categoryForm.reset(category);
              }}
              className="p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-white/10"
            >
              <Edit2 className="w-4 h-4" />
            </button>
            <button
              onClick={() => deleteCategoryMutation.mutate(category.id)}
              className="p-1.5 rounded-lg text-gray-400 hover:text-red-400 hover:bg-red-500/10"
            >
              <Trash2 className="w-4 h-4" />
            </button>
          </div>
        </motion.div>

        {category.children?.length > 0 && expandedCategories.has(category.id) && (
          <AnimatePresence>{renderCategoryTree(category.children, level + 1)}</AnimatePresence>
        )}
      </div>
    ));
  };

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div>
        <h1 className="text-2xl font-bold text-white">分类与标签</h1>
        <p className="text-gray-400 mt-1">管理您的博客分类和标签</p>
      </div>

      {/* 标签页切换 */}
      <div className="flex items-center gap-2 bg-white/5 rounded-lg p-1 w-fit">
        <button
          onClick={() => setActiveTab('categories')}
          className={cn(
            'flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all',
            activeTab === 'categories' ? 'bg-primary text-white' : 'text-gray-400 hover:text-white'
          )}
        >
          <Folder className="w-4 h-4" />
          分类管理
        </button>
        <button
          onClick={() => setActiveTab('tags')}
          className={cn(
            'flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all',
            activeTab === 'tags' ? 'bg-primary text-white' : 'text-gray-400 hover:text-white'
          )}
        >
          <Tag className="w-4 h-4" />
          标签管理
        </button>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 列表区域 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <div className="flex items-center justify-between mb-4">
            <div className="relative flex-1 max-w-xs">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder={activeTab === 'categories' ? '搜索分类...' : '搜索标签...'}
                className={cn(
                  'w-full pl-9 pr-4 py-2 rounded-lg text-sm',
                  'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                  'focus:outline-none focus:border-primary/50'
                )}
              />
            </div>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => activeTab === 'categories' ? setShowNewCategory(true) : setShowNewTag(true)}
              className="flex items-center gap-2 px-3 py-2 rounded-lg bg-primary text-white text-sm"
            >
              <Plus className="w-4 h-4" />
              新建{activeTab === 'categories' ? '分类' : '标签'}
            </motion.button>
          </div>

          {activeTab === 'categories' ? (
            <div className="space-y-1">
              {categoriesLoading ? (
                <div className="flex items-center justify-center h-32">
                  <Loader2 className="w-6 h-6 text-primary animate-spin" />
                </div>
              ) : (
                renderCategoryTree(categories || [])
              )}
            </div>
          ) : (
            <div className="flex flex-wrap gap-2">
              {tagsLoading ? (
                <div className="flex items-center justify-center w-full h-32">
                  <Loader2 className="w-6 h-6 text-primary animate-spin" />
                </div>
              ) : (
                tags?.map((tag) => (
                  <motion.div
                    key={tag.id}
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className={cn(
                      'flex items-center gap-2 px-3 py-1.5 rounded-full text-sm',
                      'bg-white/5 border border-white/10 group'
                    )}
                    style={{ borderColor: tag.color + '40' }}
                  >
                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: tag.color }} />
                    <span className="text-gray-300">{tag.name}</span>
                    <span className="text-xs text-gray-500">{tag.postCount}</span>
                    <button
                      onClick={() => { setEditingTag(tag.id); tagForm.reset(tag); }}
                      className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-white"
                    >
                      <Edit2 className="w-3 h-3" />
                    </button>
                  </motion.div>
                ))
              )}
            </div>
          )}
        </div>

        {/* 编辑区域 */}
        <AnimatePresence mode="wait">
          {(showNewCategory || editingCategory !== null) && activeTab === 'categories' && (
            <motion.div
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: 20 }}
              className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}
            >
              <h3 className="text-lg font-medium text-white mb-4">
                {editingCategory ? '编辑分类' : '新建分类'}
              </h3>
              <form onSubmit={categoryForm.handleSubmit((data) => 
                saveCategoryMutation.mutate({ ...data, id: editingCategory || undefined })
              )} className="space-y-4">
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">分类名称</label>
                  <input {...categoryForm.register('name')} className={cn(
                    'w-full px-3 py-2 rounded-lg text-sm',
                    'bg-black/30 border border-white/10 text-white',
                    'focus:outline-none focus:border-primary/50'
                  )} />
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">别名 (URL)</label>
                  <input {...categoryForm.register('slug')} className={cn(
                    'w-full px-3 py-2 rounded-lg text-sm',
                    'bg-black/30 border border-white/10 text-white',
                    'focus:outline-none focus:border-primary/50'
                  )} />
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">描述</label>
                  <textarea {...categoryForm.register('description')} rows={3} className={cn(
                    'w-full px-3 py-2 rounded-lg text-sm resize-none',
                    'bg-black/30 border border-white/10 text-white',
                    'focus:outline-none focus:border-primary/50'
                  )} />
                </div>
                <div className="flex items-center gap-2 pt-2">
                  <button type="submit" disabled={saveCategoryMutation.isPending} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">
                    {saveCategoryMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                    保存
                  </button>
                  <button type="button" onClick={() => { setEditingCategory(null); setShowNewCategory(false); }} className="px-4 py-2 rounded-lg bg-white/5 text-gray-300 text-sm">
                    取消
                  </button>
                </div>
              </form>
            </motion.div>
          )}

          {(showNewTag || editingTag !== null) && activeTab === 'tags' && (
            <motion.div
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: 20 }}
              className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}
            >
              <h3 className="text-lg font-medium text-white mb-4">{editingTag ? '编辑标签' : '新建标签'}</h3>
              <form onSubmit={tagForm.handleSubmit((data) => saveTagMutation.mutate({ ...data, id: editingTag || undefined }))} className="space-y-4">
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">标签名称</label>
                  <input {...tagForm.register('name')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">别名 (URL)</label>
                  <input {...tagForm.register('slug')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">颜色</label>
                  <input type="color" {...tagForm.register('color')} className="w-12 h-12 rounded-lg cursor-pointer" />
                </div>
                <div className="flex items-center gap-2 pt-2">
                  <button type="submit" disabled={saveTagMutation.isPending} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">
                    {saveTagMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                    保存
                  </button>
                  <button type="button" onClick={() => { setEditingTag(null); setShowNewTag(false); }} className="px-4 py-2 rounded-lg bg-white/5 text-gray-300 text-sm">取消</button>
                </div>
              </form>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}
```

---

### 3.2.6 评论管理模块

#### 3.2.6.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        评论管理功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  工具栏   [🔍 搜索评论...]   [状态 ▼]  [日期范围 ▼]     [📊 待审核: 12]  [🚫 垃圾: 3]              │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ ┌──────────────────────────────────────────────────────────────────────────────────────────────┐   │  │
│  │ │ 👤 张三                                                              2024-01-15 14:30       │   │  │
│  │ │    Re: 《深入理解JVM虚拟线程》                                       ✅ 已通过               │   │  │
│  │ │    ──────────────────────────────────────────────────────────────────────────────────────    │   │  │
│  │ │    这篇文章写得太棒了！对虚拟线程的原理讲解非常清晰，学到了很多...                           │   │  │
│  │ │    ──────────────────────────────────────────────────────────────────────────────────────    │   │  │
│  │ │    [👍 10]  [💬 回复]  [✏️ 编辑]  [🗑️ 删除]  [⚠️ 标记垃圾]                                    │   │  │
│  │ └──────────────────────────────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                                                    │  │
│  │ ┌──────────────────────────────────────────────────────────────────────────────────────────────┐   │  │
│  │ │ 👤 李四                                                              2024-01-15 15:00       │   │  │
│  │ │    Re: 《深入理解JVM虚拟线程》                                       ⏳ 待审核               │   │  │
│  │ │    ──────────────────────────────────────────────────────────────────────────────────────    │   │  │
│  │ │    请问虚拟线程和协程有什么区别？                                                            │   │  │
│  │ │    ──────────────────────────────────────────────────────────────────────────────────────    │   │  │
│  │ │    [✅ 通过]  [🚫 拒绝]  [💬 回复]  [🗑️ 删除]                                                │   │  │
│  │ └──────────────────────────────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                                                    │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.6.2 评论管理页面实现

```tsx
// apps/admin/src/pages/comments/index.tsx

import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { MessageSquare, Search, Filter, Check, X, Trash2, Reply, Flag, AlertCircle, Clock, User, ExternalLink, Loader2 } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { commentService } from '@/services/commentService';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

type CommentStatus = 'all' | 'pending' | 'approved' | 'spam' | 'trash';

const statusConfig = {
  pending: { label: '待审核', color: 'text-orange-400', bg: 'bg-orange-500/20', icon: Clock },
  approved: { label: '已通过', color: 'text-green-400', bg: 'bg-green-500/20', icon: Check },
  spam: { label: '垃圾评论', color: 'text-red-400', bg: 'bg-red-500/20', icon: Flag },
  trash: { label: '已删除', color: 'text-gray-400', bg: 'bg-gray-500/20', icon: Trash2 },
};

/**
 * 评论管理页面
 */
export default function CommentsPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedStatus, setSelectedStatus] = useState<CommentStatus>('all');
  const [replyingTo, setReplyingTo] = useState<number | null>(null);
  const [replyContent, setReplyContent] = useState('');

  const queryClient = useQueryClient();

  // 获取评论列表
  const { data: commentsData, isLoading } = useQuery({
    queryKey: queryKeys.comments.list({ status: selectedStatus, keyword: searchQuery }),
    queryFn: () => commentService.getList({ status: selectedStatus !== 'all' ? selectedStatus : undefined, keyword: searchQuery }),
  });

  // 获取统计
  const { data: stats } = useQuery({
    queryKey: queryKeys.comments.stats,
    queryFn: () => commentService.getStats(),
  });

  // 审核评论
  const approveMutation = useMutation({
    mutationFn: (id: number) => commentService.approve(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.comments.lists() }),
  });

  // 拒绝评论
  const rejectMutation = useMutation({
    mutationFn: (id: number) => commentService.reject(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.comments.lists() }),
  });

  // 标记垃圾
  const spamMutation = useMutation({
    mutationFn: (id: number) => commentService.markSpam(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.comments.lists() }),
  });

  // 删除评论
  const deleteMutation = useMutation({
    mutationFn: (id: number) => commentService.delete(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.comments.lists() }),
  });

  // 回复评论
  const replyMutation = useMutation({
    mutationFn: ({ parentId, content }: { parentId: number; content: string }) =>
      commentService.reply(parentId, content),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.comments.lists() });
      setReplyingTo(null);
      setReplyContent('');
    },
  });

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div>
        <h1 className="text-2xl font-bold text-white">评论管理</h1>
        <p className="text-gray-400 mt-1">管理您博客的所有评论</p>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        {[
          { label: '待审核', count: stats?.pending || 0, status: 'pending' as const },
          { label: '已通过', count: stats?.approved || 0, status: 'approved' as const },
          { label: '垃圾评论', count: stats?.spam || 0, status: 'spam' as const },
          { label: '回收站', count: stats?.trash || 0, status: 'trash' as const },
        ].map((item) => {
          const config = statusConfig[item.status];
          return (
            <button
              key={item.status}
              onClick={() => setSelectedStatus(item.status)}
              className={cn(
                'p-4 rounded-xl text-left transition-all',
                'bg-white/5 border border-white/10 hover:border-white/20',
                selectedStatus === item.status && 'border-primary/50 bg-primary/5'
              )}
            >
              <div className={cn('text-2xl font-bold', config.color)}>{item.count}</div>
              <div className="text-sm text-gray-400 mt-1">{item.label}</div>
            </button>
          );
        })}
      </div>

      {/* 工具栏 */}
      <div className={cn('flex items-center gap-4 p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <div className="flex-1 relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            placeholder="搜索评论内容..."
            className={cn(
              'w-full pl-10 pr-4 py-2.5 rounded-lg',
              'bg-black/30 border border-white/10 text-white placeholder-gray-500',
              'focus:outline-none focus:border-primary/50'
            )}
          />
        </div>
        <button
          onClick={() => setSelectedStatus('all')}
          className={cn(
            'px-4 py-2 rounded-lg text-sm transition-colors',
            selectedStatus === 'all' ? 'bg-primary text-white' : 'bg-white/5 text-gray-400 hover:text-white'
          )}
        >
          全部
        </button>
      </div>

      {/* 评论列表 */}
      <div className="space-y-4">
        {isLoading ? (
          <div className="flex items-center justify-center h-64">
            <Loader2 className="w-8 h-8 text-primary animate-spin" />
          </div>
        ) : commentsData?.list.length === 0 ? (
          <div className={cn('p-12 rounded-xl text-center', 'bg-white/5 border border-white/10')}>
            <MessageSquare className="w-12 h-12 text-gray-500 mx-auto mb-4" />
            <p className="text-gray-400">暂无评论</p>
          </div>
        ) : (
          commentsData?.list.map((comment, index) => {
            const config = statusConfig[comment.status as keyof typeof statusConfig];
            return (
              <motion.div
                key={comment.id}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.05 }}
                className={cn('p-4 rounded-xl', 'bg-white/5 border border-white/10')}
              >
                {/* 评论头部 */}
                <div className="flex items-start justify-between mb-3">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                      {comment.avatar ? (
                        <img src={comment.avatar} alt={comment.author} className="w-full h-full rounded-full object-cover" />
                      ) : (
                        <User className="w-5 h-5 text-primary" />
                      )}
                    </div>
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="font-medium text-white">{comment.author}</span>
                        {comment.email && (
                          <span className="text-xs text-gray-500">{comment.email}</span>
                        )}
                      </div>
                      <div className="flex items-center gap-2 text-xs text-gray-500">
                        <span>回复：</span>
                        <a href={`/admin/posts/${comment.postId}`} className="text-primary hover:underline">
                          {comment.postTitle}
                        </a>
                      </div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className={cn('flex items-center gap-1 px-2 py-1 rounded-full text-xs', config.bg, config.color)}>
                      <config.icon className="w-3 h-3" />
                      {config.label}
                    </span>
                    <span className="text-xs text-gray-500">
                      {formatDistanceToNow(new Date(comment.createdAt), { addSuffix: true, locale: zhCN })}
                    </span>
                  </div>
                </div>

                {/* 评论内容 */}
                <div className="pl-13 ml-13">
                  <p className="text-gray-300 leading-relaxed">{comment.content}</p>
                </div>

                {/* 操作按钮 */}
                <div className="flex items-center gap-2 mt-4 pl-13">
                  {comment.status === 'pending' && (
                    <>
                      <button
                        onClick={() => approveMutation.mutate(comment.id)}
                        disabled={approveMutation.isPending}
                        className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-green-500/10 text-green-400 hover:bg-green-500/20"
                      >
                        <Check className="w-4 h-4" /> 通过
                      </button>
                      <button
                        onClick={() => rejectMutation.mutate(comment.id)}
                        disabled={rejectMutation.isPending}
                        className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-red-500/10 text-red-400 hover:bg-red-500/20"
                      >
                        <X className="w-4 h-4" /> 拒绝
                      </button>
                    </>
                  )}
                  <button
                    onClick={() => setReplyingTo(replyingTo === comment.id ? null : comment.id)}
                    className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"
                  >
                    <Reply className="w-4 h-4" /> 回复
                  </button>
                  <button
                    onClick={() => spamMutation.mutate(comment.id)}
                    className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-white/5 text-gray-400 hover:text-orange-400 hover:bg-orange-500/10"
                  >
                    <Flag className="w-4 h-4" /> 垃圾
                  </button>
                  <button
                    onClick={() => deleteMutation.mutate(comment.id)}
                    className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-white/5 text-gray-400 hover:text-red-400 hover:bg-red-500/10"
                  >
                    <Trash2 className="w-4 h-4" /> 删除
                  </button>
                </div>

                {/* 回复框 */}
                <AnimatePresence>
                  {replyingTo === comment.id && (
                    <motion.div
                      initial={{ opacity: 0, height: 0 }}
                      animate={{ opacity: 1, height: 'auto' }}
                      exit={{ opacity: 0, height: 0 }}
                      className="mt-4 pl-13"
                    >
                      <textarea
                        value={replyContent}
                        onChange={(e) => setReplyContent(e.target.value)}
                        placeholder="输入回复内容..."
                        rows={3}
                        className={cn(
                          'w-full px-3 py-2 rounded-lg text-sm resize-none',
                          'bg-black/30 border border-white/10 text-white placeholder-gray-500',
                          'focus:outline-none focus:border-primary/50'
                        )}
                      />
                      <div className="flex items-center gap-2 mt-2">
                        <button
                          onClick={() => replyMutation.mutate({ parentId: comment.id, content: replyContent })}
                          disabled={!replyContent.trim() || replyMutation.isPending}
                          className="px-4 py-2 rounded-lg bg-primary text-white text-sm hover:bg-primary/90 disabled:opacity-50"
                        >
                          {replyMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : '发送回复'}
                        </button>
                        <button
                          onClick={() => { setReplyingTo(null); setReplyContent(''); }}
                          className="px-4 py-2 rounded-lg bg-white/5 text-gray-300 text-sm"
                        >
                          取消
                        </button>
                      </div>
                    </motion.div>
                  )}
                </AnimatePresence>
              </motion.div>
            );
          })
        )}
      </div>
    </div>
  );
}
```

---

### 3.2.7 友链管理模块

#### 3.2.7.1 友链管理页面实现

```tsx
// apps/admin/src/pages/friends/index.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Link as LinkIcon, Plus, Search, Edit2, Trash2, ExternalLink, Check, X, Globe, Loader2, GripVertical } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { friendService } from '@/services/friendService';
import { DndContext, closestCenter, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { SortableContext, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

const friendSchema = z.object({
  name: z.string().min(1, '请输入友链名称').max(50),
  url: z.string().url('请输入有效的URL'),
  avatar: z.string().url('请输入有效的头像URL').optional().or(z.literal('')),
  description: z.string().max(200).optional(),
});

type FriendFormData = z.infer<typeof friendSchema>;

/**
 * 友链管理页面
 */
export default function FriendsPage() {
  const [editingId, setEditingId] = useState<number | null>(null);
  const [showNew, setShowNew] = useState(false);

  const queryClient = useQueryClient();
  const sensors = useSensors(useSensor(PointerSensor, { activationConstraint: { distance: 10 } }));

  // 获取友链列表
  const { data: friends, isLoading } = useQuery({
    queryKey: queryKeys.friends.all,
    queryFn: () => friendService.getAll(),
  });

  // 表单
  const form = useForm<FriendFormData>({
    resolver: zodResolver(friendSchema),
    defaultValues: { name: '', url: '', avatar: '', description: '' },
  });

  // 保存
  const saveMutation = useMutation({
    mutationFn: (data: FriendFormData & { id?: number }) =>
      data.id ? friendService.update(data.id, data) : friendService.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.friends.all });
      setEditingId(null);
      setShowNew(false);
      form.reset();
    },
  });

  // 删除
  const deleteMutation = useMutation({
    mutationFn: (id: number) => friendService.delete(id),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.friends.all }),
  });

  // 排序
  const reorderMutation = useMutation({
    mutationFn: (ids: number[]) => friendService.reorder(ids),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.friends.all }),
  });

  const handleDragEnd = (event: any) => {
    const { active, over } = event;
    if (active.id !== over?.id && friends) {
      const oldIndex = friends.findIndex(f => f.id === active.id);
      const newIndex = friends.findIndex(f => f.id === over?.id);
      const newOrder = [...friends];
      const [removed] = newOrder.splice(oldIndex, 1);
      newOrder.splice(newIndex, 0, removed);
      reorderMutation.mutate(newOrder.map(f => f.id));
    }
  };

  return (
    <div className="p-6 space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">友链管理</h1>
          <p className="text-gray-400 mt-1">管理您的友情链接</p>
        </div>
        <motion.button
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
          onClick={() => { setShowNew(true); form.reset(); }}
          className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white"
        >
          <Plus className="w-4 h-4" /> 添加友链
        </motion.button>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 友链列表 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <h3 className="text-lg font-medium text-white mb-4">友链列表</h3>
          {isLoading ? (
            <div className="flex items-center justify-center h-32">
              <Loader2 className="w-6 h-6 text-primary animate-spin" />
            </div>
          ) : friends?.length === 0 ? (
            <div className="text-center py-8">
              <Globe className="w-12 h-12 text-gray-500 mx-auto mb-3" />
              <p className="text-gray-400">暂无友链，添加您的第一个友链</p>
            </div>
          ) : (
            <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
              <SortableContext items={friends?.map(f => f.id) || []} strategy={verticalListSortingStrategy}>
                <div className="space-y-2">
                  {friends?.map((friend) => (
                    <SortableFriendItem
                      key={friend.id}
                      friend={friend}
                      onEdit={() => { setEditingId(friend.id); form.reset(friend); }}
                      onDelete={() => deleteMutation.mutate(friend.id)}
                    />
                  ))}
                </div>
              </SortableContext>
            </DndContext>
          )}
        </div>

        {/* 编辑表单 */}
        <AnimatePresence>
          {(showNew || editingId !== null) && (
            <motion.div
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: 20 }}
              className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}
            >
              <h3 className="text-lg font-medium text-white mb-4">
                {editingId ? '编辑友链' : '添加友链'}
              </h3>
              <form onSubmit={form.handleSubmit((data) => saveMutation.mutate({ ...data, id: editingId || undefined }))} className="space-y-4">
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">网站名称</label>
                  <input {...form.register('name')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                  {form.formState.errors.name && <p className="text-xs text-red-400 mt-1">{form.formState.errors.name.message}</p>}
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">网站地址</label>
                  <input {...form.register('url')} placeholder="https://example.com" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                  {form.formState.errors.url && <p className="text-xs text-red-400 mt-1">{form.formState.errors.url.message}</p>}
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">头像地址</label>
                  <input {...form.register('avatar')} placeholder="https://example.com/avatar.png" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                </div>
                <div>
                  <label className="text-sm text-gray-400 mb-1 block">描述</label>
                  <textarea {...form.register('description')} rows={3} className={cn('w-full px-3 py-2 rounded-lg text-sm resize-none', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
                </div>
                <div className="flex items-center gap-2 pt-2">
                  <button type="submit" disabled={saveMutation.isPending} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">
                    {saveMutation.isPending ? <Loader2 className="w-4 h-4 animate-spin" /> : <Check className="w-4 h-4" />} 保存
                  </button>
                  <button type="button" onClick={() => { setEditingId(null); setShowNew(false); }} className="px-4 py-2 rounded-lg bg-white/5 text-gray-300 text-sm">取消</button>
                </div>
              </form>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}

// 可排序友链项
const SortableFriendItem: React.FC<{ friend: any; onEdit: () => void; onDelete: () => void }> = ({ friend, onEdit, onDelete }) => {
  const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({ id: friend.id });
  const style = { transform: CSS.Transform.toString(transform), transition, opacity: isDragging ? 0.5 : 1 };

  return (
    <div ref={setNodeRef} style={style} className={cn('flex items-center gap-3 p-3 rounded-lg', 'bg-white/5 border border-white/10 group')}>
      <button {...attributes} {...listeners} className="p-1 cursor-grab text-gray-500 hover:text-white">
        <GripVertical className="w-4 h-4" />
      </button>
      <div className="w-10 h-10 rounded-full bg-white/10 overflow-hidden flex-shrink-0">
        {friend.avatar ? <img src={friend.avatar} alt={friend.name} className="w-full h-full object-cover" /> : <Globe className="w-5 h-5 text-gray-400 m-2.5" />}
      </div>
      <div className="flex-1 min-w-0">
        <p className="text-white font-medium truncate">{friend.name}</p>
        <p className="text-xs text-gray-500 truncate">{friend.url}</p>
      </div>
      <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100">
        <a href={friend.url} target="_blank" className="p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-white/10"><ExternalLink className="w-4 h-4" /></a>
        <button onClick={onEdit} className="p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-white/10"><Edit2 className="w-4 h-4" /></button>
        <button onClick={onDelete} className="p-1.5 rounded-lg text-gray-400 hover:text-red-400 hover:bg-red-500/10"><Trash2 className="w-4 h-4" /></button>
      </div>
    </div>
  );
};
```

---

### 3.2.8 系统设置模块

#### 3.2.8.1 系统设置页面实现

```tsx
// apps/admin/src/pages/settings/index.tsx

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { Settings, Globe, Palette, Bell, Shield, Database, Mail, Cloud, Save, Loader2, Check, Key, Image, FileText } from 'lucide-react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { settingsService } from '@/services/settingsService';

type SettingsTab = 'general' | 'appearance' | 'seo' | 'security' | 'notification' | 'storage';

const tabs: { id: SettingsTab; label: string; icon: React.ComponentType<{ className?: string }> }[] = [
  { id: 'general', label: '基本设置', icon: Globe },
  { id: 'appearance', label: '外观设置', icon: Palette },
  { id: 'seo', label: 'SEO 设置', icon: FileText },
  { id: 'security', label: '安全设置', icon: Shield },
  { id: 'notification', label: '通知设置', icon: Bell },
  { id: 'storage', label: '存储设置', icon: Cloud },
];

/**
 * 系统设置页面
 */
export default function SettingsPage() {
  const [activeTab, setActiveTab] = useState<SettingsTab>('general');
  const queryClient = useQueryClient();

  // 获取设置
  const { data: settings, isLoading } = useQuery({
    queryKey: queryKeys.settings.all,
    queryFn: () => settingsService.getAll(),
  });

  // 保存设置
  const saveMutation = useMutation({
    mutationFn: (data: any) => settingsService.update(data),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: queryKeys.settings.all }),
  });

  return (
    <div className="p-6 space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-white">系统设置</h1>
        <p className="text-gray-400 mt-1">配置您的博客系统</p>
      </div>

      <div className="flex gap-6">
        {/* 侧边导航 */}
        <div className={cn('w-56 flex-shrink-0 p-4 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <nav className="space-y-1">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={cn(
                  'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm transition-all',
                  activeTab === tab.id ? 'bg-primary/20 text-primary' : 'text-gray-400 hover:text-white hover:bg-white/5'
                )}
              >
                <tab.icon className="w-4 h-4" />
                {tab.label}
              </button>
            ))}
          </nav>
        </div>

        {/* 内容区 */}
        <div className={cn('flex-1 p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          {isLoading ? (
            <div className="flex items-center justify-center h-64">
              <Loader2 className="w-8 h-8 text-primary animate-spin" />
            </div>
          ) : (
            <>
              {activeTab === 'general' && <GeneralSettings settings={settings?.general} onSave={(data) => saveMutation.mutate({ general: data })} isSaving={saveMutation.isPending} />}
              {activeTab === 'appearance' && <AppearanceSettings settings={settings?.appearance} onSave={(data) => saveMutation.mutate({ appearance: data })} isSaving={saveMutation.isPending} />}
              {activeTab === 'seo' && <SeoSettings settings={settings?.seo} onSave={(data) => saveMutation.mutate({ seo: data })} isSaving={saveMutation.isPending} />}
              {activeTab === 'security' && <SecuritySettings settings={settings?.security} onSave={(data) => saveMutation.mutate({ security: data })} isSaving={saveMutation.isPending} />}
              {activeTab === 'notification' && <NotificationSettings settings={settings?.notification} onSave={(data) => saveMutation.mutate({ notification: data })} isSaving={saveMutation.isPending} />}
              {activeTab === 'storage' && <StorageSettings settings={settings?.storage} onSave={(data) => saveMutation.mutate({ storage: data })} isSaving={saveMutation.isPending} />}
            </>
          )}
        </div>
      </div>
    </div>
  );
}

// 基本设置
const GeneralSettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });

  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">基本设置</h3>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label className="text-sm text-gray-400 mb-1 block">网站名称</label>
          <input {...form.register('siteName')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
        </div>
        <div>
          <label className="text-sm text-gray-400 mb-1 block">网站副标题</label>
          <input {...form.register('siteSubtitle')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
        </div>
        <div className="md:col-span-2">
          <label className="text-sm text-gray-400 mb-1 block">网站描述</label>
          <textarea {...form.register('siteDescription')} rows={3} className={cn('w-full px-3 py-2 rounded-lg text-sm resize-none', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
        </div>
        <div>
          <label className="text-sm text-gray-400 mb-1 block">网站URL</label>
          <input {...form.register('siteUrl')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
        </div>
        <div>
          <label className="text-sm text-gray-400 mb-1 block">管理员邮箱</label>
          <input {...form.register('adminEmail')} type="email" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
        </div>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">
        {isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置
      </button>
    </form>
  );
};

// 外观设置
const AppearanceSettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });
  const primaryColor = form.watch('primaryColor');

  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">外观设置</h3>
      <div className="space-y-4">
        <div>
          <label className="text-sm text-gray-400 mb-2 block">主题色</label>
          <div className="flex items-center gap-3">
            <input type="color" {...form.register('primaryColor')} className="w-12 h-12 rounded-lg cursor-pointer" />
            <input type="text" value={primaryColor} onChange={(e) => form.setValue('primaryColor', e.target.value)} className={cn('w-28 px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} />
          </div>
        </div>
        <div>
          <label className="text-sm text-gray-400 mb-2 block">字体</label>
          <select {...form.register('fontFamily')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')}>
            <option value="inter">Inter</option>
            <option value="roboto">Roboto</option>
            <option value="noto-sans-sc">Noto Sans SC</option>
          </select>
        </div>
        <div>
          <label className="flex items-center justify-between cursor-pointer">
            <span className="text-sm text-gray-300">启用暗色模式</span>
            <input type="checkbox" {...form.register('darkMode')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30" />
          </label>
        </div>
        <div>
          <label className="flex items-center justify-between cursor-pointer">
            <span className="text-sm text-gray-300">启用代码高亮</span>
            <input type="checkbox" {...form.register('codeHighlight')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary focus:ring-primary/30" />
          </label>
        </div>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">
        {isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置
      </button>
    </form>
  );
};

// SEO 设置 (简化)
const SeoSettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });
  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">SEO 设置</h3>
      <div className="space-y-4">
        <div><label className="text-sm text-gray-400 mb-1 block">默认标题模板</label><input {...form.register('titleTemplate')} placeholder="%s | 博客名称" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} /></div>
        <div><label className="text-sm text-gray-400 mb-1 block">默认 Meta 描述</label><textarea {...form.register('defaultDescription')} rows={3} className={cn('w-full px-3 py-2 rounded-lg text-sm resize-none', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} /></div>
        <div><label className="text-sm text-gray-400 mb-1 block">默认关键词</label><input {...form.register('defaultKeywords')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} /></div>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">{isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置</button>
    </form>
  );
};

// 安全设置 (简化)
const SecuritySettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });
  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">安全设置</h3>
      <div className="space-y-4">
        <label className="flex items-center justify-between cursor-pointer"><span className="text-sm text-gray-300">启用两步验证</span><input type="checkbox" {...form.register('twoFactorAuth')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary" /></label>
        <label className="flex items-center justify-between cursor-pointer"><span className="text-sm text-gray-300">登录失败锁定</span><input type="checkbox" {...form.register('loginLock')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary" /></label>
        <label className="flex items-center justify-between cursor-pointer"><span className="text-sm text-gray-300">评论需要审核</span><input type="checkbox" {...form.register('commentModeration')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary" /></label>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">{isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置</button>
    </form>
  );
};

// 通知设置 (简化)
const NotificationSettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });
  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">通知设置</h3>
      <div className="space-y-4">
        <label className="flex items-center justify-between cursor-pointer"><span className="text-sm text-gray-300">新评论通知</span><input type="checkbox" {...form.register('commentNotify')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary" /></label>
        <label className="flex items-center justify-between cursor-pointer"><span className="text-sm text-gray-300">系统更新通知</span><input type="checkbox" {...form.register('updateNotify')} className="w-4 h-4 rounded border-white/20 bg-transparent text-primary" /></label>
        <div><label className="text-sm text-gray-400 mb-1 block">通知邮箱</label><input {...form.register('notifyEmail')} type="email" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} /></div>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">{isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置</button>
    </form>
  );
};

// 存储设置 (简化)
const StorageSettings: React.FC<{ settings: any; onSave: (data: any) => void; isSaving: boolean }> = ({ settings, onSave, isSaving }) => {
  const form = useForm({ defaultValues: settings });
  return (
    <form onSubmit={form.handleSubmit(onSave)} className="space-y-6">
      <h3 className="text-lg font-medium text-white">存储设置</h3>
      <div className="space-y-4">
        <div>
          <label className="text-sm text-gray-400 mb-1 block">存储类型</label>
          <select {...form.register('storageType')} className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')}>
            <option value="local">本地存储</option>
            <option value="aliyun-oss">阿里云 OSS</option>
            <option value="tencent-cos">腾讯云 COS</option>
            <option value="qiniu">七牛云</option>
          </select>
        </div>
        <div><label className="text-sm text-gray-400 mb-1 block">CDN 地址</label><input {...form.register('cdnUrl')} placeholder="https://cdn.example.com" className={cn('w-full px-3 py-2 rounded-lg text-sm', 'bg-black/30 border border-white/10 text-white', 'focus:outline-none focus:border-primary/50')} /></div>
      </div>
      <button type="submit" disabled={isSaving} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm">{isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} 保存设置</button>
    </form>
  );
};
```

---

### 3.2.9 AI 工具模块

#### 3.2.9.1 AI 工具页面实现

```tsx
// apps/admin/src/pages/ai-tools/index.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Sparkles, Wand2, FileText, Tags, Image, MessageSquare, Loader2, Copy, Check, RefreshCw, Zap, Settings } from 'lucide-react';
import { useMutation } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { aiService } from '@/services/aiService';
import { useCopyToClipboard } from '@aetherblog/hooks';

type AITool = 'summary' | 'tags' | 'title' | 'outline' | 'rewrite' | 'translate';

const tools: { id: AITool; label: string; description: string; icon: React.ComponentType<{ className?: string }> }[] = [
  { id: 'summary', label: '智能摘要', description: '自动生成文章摘要', icon: FileText },
  { id: 'tags', label: '智能标签', description: '自动提取文章标签', icon: Tags },
  { id: 'title', label: '标题优化', description: '生成吸引人的标题', icon: Wand2 },
  { id: 'outline', label: '大纲生成', description: '根据主题生成大纲', icon: FileText },
  { id: 'rewrite', label: '内容润色', description: '优化文章表达', icon: RefreshCw },
  { id: 'translate', label: '智能翻译', description: '中英文互译', icon: MessageSquare },
];

/**
 * AI 工具页面
 */
export default function AIToolsPage() {
  const [activeTool, setActiveTool] = useState<AITool>('summary');
  const [inputText, setInputText] = useState('');
  const [outputText, setOutputText] = useState('');
  const [copied, copy] = useCopyToClipboard();

  // AI 处理
  const processMutation = useMutation({
    mutationFn: ({ tool, content }: { tool: AITool; content: string }) => {
      switch (tool) {
        case 'summary': return aiService.generateSummary(content);
        case 'tags': return aiService.suggestTags(content);
        case 'title': return aiService.generateTitles(content);
        case 'outline': return aiService.generateOutline(content);
        case 'rewrite': return aiService.polishContent(content);
        case 'translate': return aiService.translate(content);
        default: return Promise.resolve('');
      }
    },
    onSuccess: (result) => {
      setOutputText(Array.isArray(result) ? result.join('\n') : result);
    },
  });

  const handleProcess = () => {
    if (inputText.trim()) {
      processMutation.mutate({ tool: activeTool, content: inputText });
    }
  };

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white flex items-center gap-2">
            <Sparkles className="w-6 h-6 text-primary" />
            AI 工具箱
          </h1>
          <p className="text-gray-400 mt-1">借助 AI 提升创作效率</p>
        </div>
        <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30">
          <Zap className="w-4 h-4 text-purple-400" />
          <span className="text-sm text-purple-300">Powered by Aether AI Service</span>
        </div>
      </div>

      {/* 工具选择 */}
      <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
        {tools.map((tool) => (
          <motion.button
            key={tool.id}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            onClick={() => setActiveTool(tool.id)}
            className={cn(
              'p-4 rounded-xl text-left transition-all',
              'border',
              activeTool === tool.id
                ? 'bg-primary/10 border-primary/50'
                : 'bg-white/5 border-white/10 hover:border-white/20'
            )}
          >
            <tool.icon className={cn('w-6 h-6 mb-2', activeTool === tool.id ? 'text-primary' : 'text-gray-400')} />
            <p className="font-medium text-white text-sm">{tool.label}</p>
            <p className="text-xs text-gray-500 mt-1">{tool.description}</p>
          </motion.button>
        ))}
      </div>

      {/* 工作区 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 输入区 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-medium text-white">输入内容</h3>
            <span className="text-xs text-gray-500">{inputText.length} 字符</span>
          </div>
          <textarea
            value={inputText}
            onChange={(e) => setInputText(e.target.value)}
            placeholder={
              activeTool === 'outline' ? '输入文章主题或关键词...' :
              activeTool === 'translate' ? '输入要翻译的内容...' :
              '粘贴或输入文章内容...'
            }
            rows={12}
            className={cn(
              'w-full px-4 py-3 rounded-lg text-sm resize-none',
              'bg-black/30 border border-white/10 text-white placeholder-gray-500',
              'focus:outline-none focus:border-primary/50'
            )}
          />
          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            onClick={handleProcess}
            disabled={!inputText.trim() || processMutation.isPending}
            className={cn(
              'mt-4 w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg',
              'bg-gradient-to-r from-primary to-purple-500 text-white font-medium',
              'disabled:opacity-50 disabled:cursor-not-allowed'
            )}
          >
            {processMutation.isPending ? (
              <>
                <Loader2 className="w-5 h-5 animate-spin" />
                AI 处理中...
              </>
            ) : (
              <>
                <Sparkles className="w-5 h-5" />
                开始处理
              </>
            )}
          </motion.button>
        </div>

        {/* 输出区 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-medium text-white">输出结果</h3>
            {outputText && (
              <button
                onClick={() => copy(outputText)}
                className={cn(
                  'flex items-center gap-1 px-2 py-1 rounded text-xs',
                  copied ? 'bg-green-500/20 text-green-400' : 'bg-white/5 text-gray-400 hover:text-white'
                )}
              >
                {copied ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-3" />}
                {copied ? '已复制' : '复制'}
              </button>
            )}
          </div>
          
          <div className={cn(
            'min-h-[300px] px-4 py-3 rounded-lg text-sm',
            'bg-black/30 border border-white/10 text-gray-300',
            'overflow-y-auto whitespace-pre-wrap'
          )}>
            {processMutation.isPending ? (
              <div className="flex items-center justify-center h-full">
                <div className="text-center">
                  <Loader2 className="w-8 h-8 text-primary animate-spin mx-auto mb-3" />
                  <p className="text-gray-400">AI 正在思考中...</p>
                </div>
              </div>
            ) : outputText ? (
              outputText
            ) : (
              <div className="flex items-center justify-center h-full">
                <p className="text-gray-500">AI 处理结果将显示在这里</p>
              </div>
            )}
          </div>

          {/* 操作提示 */}
          {outputText && (
            <div className="mt-4 flex items-center gap-2">
              <button
                onClick={() => setInputText(outputText)}
                className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs bg-white/5 text-gray-400 hover:text-white"
              >
                <RefreshCw className="w-3 h-3" />
                用于再次处理
              </button>
            </div>
          )}
        </div>
      </div>

      {/* 使用提示 */}
      <div className={cn('p-4 rounded-xl', 'bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20')}>
        <div className="flex items-start gap-3">
          <Sparkles className="w-5 h-5 text-purple-400 flex-shrink-0 mt-0.5" />
          <div>
            <p className="text-sm text-purple-300 font-medium">使用提示</p>
            <p className="text-xs text-purple-400/70 mt-1">
              • 内容越详细，AI 生成的结果越准确<br />
              • 对于长文章，建议分段处理以获得更好的效果<br />
              • 生成的内容仅供参考，请根据实际需要进行修改
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
```

---

### 3.2.10 系统监控模块

#### 3.2.10.1 系统监控页面实现

```tsx
// apps/admin/src/pages/monitor/index.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { Activity, Server, Database, HardDrive, Cpu, MemoryStick, Clock, AlertTriangle, CheckCircle, RefreshCw, Loader2 } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { monitorService } from '@/services/monitorService';
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, AreaChart, Area } from 'recharts';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

/**
 * 系统监控页面
 */
export default function MonitorPage() {
  // 获取系统状态
  const { data: systemStatus, isLoading, refetch, isFetching } = useQuery({
    queryKey: queryKeys.monitor.status,
    queryFn: () => monitorService.getSystemStatus(),
    refetchInterval: 30000, // 30秒刷新一次
  });

  // 获取性能历史
  const { data: performanceHistory } = useQuery({
    queryKey: queryKeys.monitor.performance,
    queryFn: () => monitorService.getPerformanceHistory(),
    refetchInterval: 60000,
  });

  // 获取日志
  const { data: recentLogs } = useQuery({
    queryKey: queryKeys.monitor.logs,
    queryFn: () => monitorService.getRecentLogs(),
  });

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-64">
        <Loader2 className="w-8 h-8 text-primary animate-spin" />
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white flex items-center gap-2">
            <Activity className="w-6 h-6 text-primary" />
            系统监控
          </h1>
          <p className="text-gray-400 mt-1">实时监控系统运行状态</p>
        </div>
        <button
          onClick={() => refetch()}
          disabled={isFetching}
          className={cn(
            'flex items-center gap-2 px-4 py-2 rounded-lg',
            'bg-white/5 text-gray-400 hover:text-white hover:bg-white/10'
          )}
        >
          <RefreshCw className={cn('w-4 h-4', isFetching && 'animate-spin')} />
          刷新
        </button>
      </div>

      {/* 服务状态卡片 */}
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {[
          { label: 'Java 后端', status: systemStatus?.java, icon: Server, port: 8080 },
          { label: 'PostgreSQL', status: systemStatus?.database, icon: Database, port: 5432 },
          { label: 'Redis', status: systemStatus?.redis, icon: HardDrive, port: 6379 },
          { label: 'Elasticsearch', status: systemStatus?.elasticsearch, icon: Database, port: 9200 },
        ].map((service, index) => (
          <motion.div
            key={service.label}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
            className={cn(
              'p-4 rounded-xl border',
              service.status?.healthy
                ? 'bg-green-500/5 border-green-500/20'
                : 'bg-red-500/5 border-red-500/20'
            )}
          >
            <div className="flex items-start justify-between">
              <div>
                <service.icon className={cn('w-8 h-8 mb-2', service.status?.healthy ? 'text-green-400' : 'text-red-400')} />
                <p className="font-medium text-white">{service.label}</p>
                <p className="text-xs text-gray-500">:{service.port}</p>
              </div>
              {service.status?.healthy ? (
                <CheckCircle className="w-5 h-5 text-green-400" />
              ) : (
                <AlertTriangle className="w-5 h-5 text-red-400" />
              )}
            </div>
            <p className={cn('text-xs mt-2', service.status?.healthy ? 'text-green-400' : 'text-red-400')}>
              {service.status?.healthy ? '运行正常' : service.status?.error || '连接失败'}
            </p>
            {service.status?.responseTime && (
              <p className="text-xs text-gray-500 mt-1">响应: {service.status.responseTime}ms</p>
            )}
          </motion.div>
        ))}
      </div>

      {/* 资源使用 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* CPU 使用率 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-medium text-white flex items-center gap-2">
              <Cpu className="w-5 h-5 text-primary" />
              CPU 使用率
            </h3>
            <span className={cn(
              'text-2xl font-bold',
              (systemStatus?.cpu || 0) > 80 ? 'text-red-400' : (systemStatus?.cpu || 0) > 60 ? 'text-orange-400' : 'text-green-400'
            )}>
              {systemStatus?.cpu || 0}%
            </span>
          </div>
          <div className="h-40">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={performanceHistory?.cpu || []}>
                <defs>
                  <linearGradient id="cpuGradient" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#6366f1" stopOpacity={0.3} />
                    <stop offset="95%" stopColor="#6366f1" stopOpacity={0} />
                  </linearGradient>
                </defs>
                <XAxis dataKey="time" tick={{ fill: '#6b7280', fontSize: 10 }} axisLine={false} />
                <YAxis tick={{ fill: '#6b7280', fontSize: 10 }} axisLine={false} domain={[0, 100]} />
                <Tooltip content={<CustomTooltip />} />
                <Area type="monotone" dataKey="value" stroke="#6366f1" fill="url(#cpuGradient)" />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </div>

        {/* 内存使用 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-medium text-white flex items-center gap-2">
              <MemoryStick className="w-5 h-5 text-purple-400" />
              内存使用
            </h3>
            <div className="text-right">
              <span className={cn(
                'text-2xl font-bold',
                (systemStatus?.memory?.percentage || 0) > 80 ? 'text-red-400' : 'text-green-400'
              )}>
                {systemStatus?.memory?.percentage || 0}%
              </span>
              <p className="text-xs text-gray-500">
                {systemStatus?.memory?.used || 0} / {systemStatus?.memory?.total || 0} GB
              </p>
            </div>
          </div>
          <div className="h-40">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={performanceHistory?.memory || []}>
                <defs>
                  <linearGradient id="memGradient" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#a855f7" stopOpacity={0.3} />
                    <stop offset="95%" stopColor="#a855f7" stopOpacity={0} />
                  </linearGradient>
                </defs>
                <XAxis dataKey="time" tick={{ fill: '#6b7280', fontSize: 10 }} axisLine={false} />
                <YAxis tick={{ fill: '#6b7280', fontSize: 10 }} axisLine={false} domain={[0, 100]} />
                <Tooltip content={<CustomTooltip />} />
                <Area type="monotone" dataKey="value" stroke="#a855f7" fill="url(#memGradient)" />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>

      {/* 磁盘和运行时间 */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* 磁盘使用 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <h3 className="text-lg font-medium text-white flex items-center gap-2 mb-4">
            <HardDrive className="w-5 h-5 text-cyan-400" />
            磁盘使用
          </h3>
          {systemStatus?.disks?.map((disk: any, index: number) => (
            <div key={index} className="mb-4 last:mb-0">
              <div className="flex items-center justify-between mb-1">
                <span className="text-sm text-gray-400">{disk.mount}</span>
                <span className="text-sm text-white">{disk.used} / {disk.total} GB</span>
              </div>
              <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                <div
                  className={cn(
                    'h-full rounded-full',
                    disk.percentage > 80 ? 'bg-red-500' : disk.percentage > 60 ? 'bg-orange-500' : 'bg-cyan-500'
                  )}
                  style={{ width: `${disk.percentage}%` }}
                />
              </div>
            </div>
          ))}
        </div>

        {/* 系统运行时间 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <h3 className="text-lg font-medium text-white flex items-center gap-2 mb-4">
            <Clock className="w-5 h-5 text-green-400" />
            运行时间
          </h3>
          <div className="space-y-3">
            <div className="flex justify-between">
              <span className="text-gray-400">系统启动</span>
              <span className="text-white">{systemStatus?.uptime || '-'}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-400">Java 进程</span>
              <span className="text-white">{systemStatus?.javaUptime || '-'}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-400">JVM 版本</span>
              <span className="text-white">{systemStatus?.jvmVersion || '-'}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-400">Spring Boot</span>
              <span className="text-white">{systemStatus?.springVersion || '-'}</span>
            </div>
          </div>
        </div>

        {/* JVM 信息 */}
        <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
          <h3 className="text-lg font-medium text-white flex items-center gap-2 mb-4">
            <Server className="w-5 h-5 text-orange-400" />
            JVM 状态
          </h3>
          <div className="space-y-3">
            <div>
              <div className="flex justify-between mb-1">
                <span className="text-xs text-gray-400">堆内存</span>
                <span className="text-xs text-white">{systemStatus?.jvm?.heapUsed} / {systemStatus?.jvm?.heapMax} MB</span>
              </div>
              <div className="h-1.5 bg-white/10 rounded-full overflow-hidden">
                <div className="h-full bg-orange-500 rounded-full" style={{ width: `${systemStatus?.jvm?.heapPercentage || 0}%` }} />
              </div>
            </div>
            <div>
              <div className="flex justify-between mb-1">
                <span className="text-xs text-gray-400">非堆内存</span>
                <span className="text-xs text-white">{systemStatus?.jvm?.nonHeapUsed} MB</span>
              </div>
              <div className="h-1.5 bg-white/10 rounded-full overflow-hidden">
                <div className="h-full bg-yellow-500 rounded-full" style={{ width: '45%' }} />
              </div>
            </div>
            <div className="flex justify-between text-sm">
              <span className="text-gray-400">线程数</span>
              <span className="text-white">{systemStatus?.jvm?.threadCount || 0}</span>
            </div>
            <div className="flex justify-between text-sm">
              <span className="text-gray-400">GC 次数</span>
              <span className="text-white">{systemStatus?.jvm?.gcCount || 0}</span>
            </div>
          </div>
        </div>
      </div>

      {/* 最近日志 */}
      <div className={cn('p-6 rounded-xl', 'bg-white/5 backdrop-blur-sm border border-white/10')}>
        <h3 className="text-lg font-medium text-white mb-4">最近日志</h3>
        <div className="space-y-2 max-h-64 overflow-y-auto font-mono text-xs">
          {recentLogs?.map((log: any, index: number) => (
            <div key={index} className={cn(
              'flex items-start gap-3 p-2 rounded',
              log.level === 'ERROR' && 'bg-red-500/10',
              log.level === 'WARN' && 'bg-orange-500/10'
            )}>
              <span className={cn(
                'px-1.5 py-0.5 rounded text-[10px] font-medium',
                log.level === 'INFO' && 'bg-blue-500/20 text-blue-400',
                log.level === 'WARN' && 'bg-orange-500/20 text-orange-400',
                log.level === 'ERROR' && 'bg-red-500/20 text-red-400',
                log.level === 'DEBUG' && 'bg-gray-500/20 text-gray-400'
              )}>
                {log.level}
              </span>
              <span className="text-gray-500">{log.timestamp}</span>
              <span className="text-gray-300 flex-1">{log.message}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// 自定义 Tooltip
const CustomTooltip: React.FC<any> = ({ active, payload, label }) => {
  if (active && payload?.length) {
    return (
      <div className="p-2 rounded-lg bg-gray-900/95 border border-white/10">
        <p className="text-xs text-gray-400">{label}</p>
        <p className="text-sm text-white font-medium">{payload[0].value}%</p>
      </div>
    );
  }
  return null;
};
```

---

## 3.3 AI 智能功能模块

### 3.3.1 模块概述

本模块由独立 AI 服务提供，采用 FastAPI + LiteLLM 统一 OpenAI 协议接入，主后端通过 HTTP API 调用，支持多供应商切换与独立扩缩容。

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AI 智能功能架构                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│                                    ┌─────────────────────────┐                                           │
│                                    │   AI 服务 (FastAPI)     │                                           │
│                                    │   LiteLLM Router        │                                           │
│                                    └───────────┬─────────────┘                                           │
│                                                │                                                         │
│                    ┌───────────────────────────┼───────────────────────────┐                             │
│                    │                           │                           │                             │
│           ┌────────▼────────┐        ┌────────▼────────┐        ┌────────▼────────┐                      │
│           │   OpenAI API    │        │ OpenAI协议供应商 │        │ Claude/Gemini  │                      │
│           │  GPT-4o/4.1     │        │  Qwen/DeepSeek   │        │ Sonnet/Pro     │                      │
│           └─────────────────┘        └─────────────────┘        └─────────────────┘                      │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能模块                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐   │ │
│   │   │ 内容摘要   │  │ 智能标签   │  │ 标题生成   │  │ 内容润色   │  │ 大纲生成   │  │ 智能翻译   │   │ │
│   │   │ 生成       │  │ 推荐       │  │ 优化       │  │ 改写       │  │ 扩展       │  │ 多语言     │   │ │
│   │   └────────────┘  └────────────┘  └────────────┘  └────────────┘  └────────────┘  └────────────┘   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                    向量搜索 (pgvector)                                              │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │   • 文章内容向量化存储    • 语义相似度搜索    • 相关文章推荐    • 智能问答检索                     │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.3.2 后端服务实现

```java
// apps/server/src/main/java/com/aetherblog/ai/service/AiContentService.java

package com.aetherblog.ai.service;

import org.springframework.ai.chat.ChatClient;
import org.springframework.ai.chat.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.chat.prompt.PromptTemplate;
import org.springframework.ai.embedding.EmbeddingClient;
import org.springframework.stereotype.Service;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

import java.util.List;
import java.util.Map;

/**
 * AI 内容服务
 * 提供基于大语言模型的内容生成和处理能力
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class AiContentService {

    private final ChatClient chatClient;
    private final EmbeddingClient embeddingClient;
    private final VectorStoreService vectorStoreService;

    /**
     * 生成文章摘要
     */
    public String generateSummary(String content, int maxLength) {
        String promptText = """
            请为以下文章生成一段简洁的摘要，要求：
            1. 摘要长度不超过 {maxLength} 个字符
            2. 准确概括文章的核心内容
            3. 语言流畅，适合作为文章预览
            
            文章内容：
            {content}
            
            请直接输出摘要内容，不要包含任何前缀或说明。
            """;
        
        PromptTemplate template = new PromptTemplate(promptText);
        Prompt prompt = template.create(Map.of(
            "content", truncateContent(content, 3000),
            "maxLength", String.valueOf(maxLength)
        ));
        
        ChatResponse response = chatClient.call(prompt);
        return response.getResult().getOutput().getContent();
    }

    /**
     * 智能标签推荐
     */
    public List<String> suggestTags(String content, int maxTags) {
        String promptText = """
            分析以下文章内容，提取最相关的标签关键词。要求：
            1. 提取 {maxTags} 个最相关的标签
            2. 标签应该是技术术语、概念或主题名称
            3. 每个标签 2-4 个字符为宜
            4. 按相关性从高到低排序
            
            文章内容：
            {content}
            
            请以英文逗号分隔的格式输出标签，例如：Java,Spring Boot,微服务
            """;
        
        PromptTemplate template = new PromptTemplate(promptText);
        Prompt prompt = template.create(Map.of(
            "content", truncateContent(content, 3000),
            "maxTags", String.valueOf(maxTags)
        ));
        
        ChatResponse response = chatClient.call(prompt);
        String result = response.getResult().getOutput().getContent();
        return List.of(result.split(",")).stream()
            .map(String::trim)
            .filter(s -> !s.isEmpty())
            .limit(maxTags)
            .toList();
    }

    /**
     * 生成优化标题
     */
    public List<String> generateTitles(String content, int count) {
        String promptText = """
            根据以下文章内容，生成 {count} 个吸引人的标题选项。要求：
            1. 标题简洁有力，突出文章价值
            2. 适合技术博客，避免标题党
            3. 每个标题独立成行
            
            文章内容：
            {content}
            
            请直接输出标题，每行一个。
            """;
        
        PromptTemplate template = new PromptTemplate(promptText);
        Prompt prompt = template.create(Map.of(
            "content", truncateContent(content, 2000),
            "count", String.valueOf(count)
        ));
        
        ChatResponse response = chatClient.call(prompt);
        return List.of(response.getResult().getOutput().getContent().split("\n")).stream()
            .map(String::trim)
            .filter(s -> !s.isEmpty())
            .limit(count)
            .toList();
    }

    /**
     * 内容润色
     */
    public String polishContent(String content) {
        String promptText = """
            请对以下技术文章内容进行润色和优化。要求：
            1. 保持原意不变
            2. 优化语句表达，使其更加流畅
            3. 规范技术术语的使用
            4. 保持 Markdown 格式
            
            原文内容：
            {content}
            
            请直接输出润色后的内容。
            """;
        
        PromptTemplate template = new PromptTemplate(promptText);
        Prompt prompt = template.create(Map.of("content", content));
        
        ChatResponse response = chatClient.call(prompt);
        return response.getResult().getOutput().getContent();
    }

    /**
     * 生成文章大纲
     */
    public String generateOutline(String topic) {
        String promptText = """
            请为「{topic}」这个主题生成一份详细的技术文章大纲。要求：
            1. 包含引言、正文、总结等部分
            2. 正文分为多个章节，每章有 2-4 个要点
            3. 使用 Markdown 格式
            4. 为每个章节添加简要说明
            
            请直接输出大纲内容。
            """;
        
        PromptTemplate template = new PromptTemplate(promptText);
        Prompt prompt = template.create(Map.of("topic", topic));
        
        ChatResponse response = chatClient.call(prompt);
        return response.getResult().getOutput().getContent();
    }

    /**
     * 语义搜索相关文章
     */
    public List<Long> searchSimilarPosts(String query, int limit) {
        // 生成查询向量
        List<Double> queryEmbedding = embeddingClient.embed(query);
        
        // 从向量存储中搜索相似文章
        return vectorStoreService.similaritySearch(queryEmbedding, limit);
    }

    /**
     * 文章向量化存储
     */
    public void indexPost(Long postId, String title, String content) {
        String text = title + "\n\n" + content;
        List<Double> embedding = embeddingClient.embed(text);
        vectorStoreService.store(postId, embedding);
    }

    private String truncateContent(String content, int maxLength) {
        if (content.length() <= maxLength) {
            return content;
        }
        return content.substring(0, maxLength) + "...";
    }
}
```

---

## 3.4 系统管理功能模块

### 3.4.1 用户认证与授权

本系统采用 JWT + RBAC 的认证授权方案，确保系统安全性。

```java
// apps/server/src/main/java/com/aetherblog/security/JwtTokenProvider.java

package com.aetherblog.security;

import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Component;
import lombok.extern.slf4j.Slf4j;

import javax.crypto.SecretKey;
import java.util.Date;

/**
 * JWT Token 提供者
 */
@Slf4j
@Component
public class JwtTokenProvider {

    private final SecretKey key;
    private final long accessTokenValidity;
    private final long refreshTokenValidity;

    public JwtTokenProvider(
            @Value("${jwt.secret}") String secret,
            @Value("${jwt.access-token-validity:3600000}") long accessTokenValidity,
            @Value("${jwt.refresh-token-validity:604800000}") long refreshTokenValidity) {
        this.key = Keys.hmacShaKeyFor(secret.getBytes());
        this.accessTokenValidity = accessTokenValidity;
        this.refreshTokenValidity = refreshTokenValidity;
    }

    /**
     * 生成访问令牌
     */
    public String generateAccessToken(Authentication authentication) {
        UserPrincipal userPrincipal = (UserPrincipal) authentication.getPrincipal();
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + accessTokenValidity);

        return Jwts.builder()
                .setSubject(Long.toString(userPrincipal.getId()))
                .claim("username", userPrincipal.getUsername())
                .claim("roles", userPrincipal.getAuthorities())
                .setIssuedAt(now)
                .setExpiration(expiryDate)
                .signWith(key, SignatureAlgorithm.HS512)
                .compact();
    }

    /**
     * 生成刷新令牌
     */
    public String generateRefreshToken(Long userId) {
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + refreshTokenValidity);

        return Jwts.builder()
                .setSubject(Long.toString(userId))
                .setIssuedAt(now)
                .setExpiration(expiryDate)
                .signWith(key, SignatureAlgorithm.HS512)
                .compact();
    }

    /**
     * 从令牌中获取用户ID
     */
    public Long getUserIdFromToken(String token) {
        Claims claims = Jwts.parserBuilder()
                .setSigningKey(key)
                .build()
                .parseClaimsJws(token)
                .getBody();

        return Long.parseLong(claims.getSubject());
    }

    /**
     * 验证令牌
     */
    public boolean validateToken(String token) {
        try {
            Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            log.error("JWT令牌验证失败: {}", e.getMessage());
            return false;
        }
    }
}
```

### 3.4.2 数据备份与恢复

```java
// apps/server/src/main/java/com/aetherblog/system/service/BackupService.java

package com.aetherblog.system.service;

import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * 数据备份服务
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class BackupService {

    private final DatabaseService databaseService;
    private final StorageService storageService;

    /**
     * 每日自动备份
     */
    @Scheduled(cron = "0 0 3 * * ?") // 每天凌晨3点执行
    public void dailyBackup() {
        log.info("开始执行每日自动备份...");
        String backupName = "daily_" + LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss"));
        createBackup(backupName);
    }

    /**
     * 创建备份
     */
    public String createBackup(String name) {
        // 1. 备份数据库
        String dbBackupPath = databaseService.exportDatabase();
        
        // 2. 备份媒体文件
        String mediaBackupPath = storageService.backupMedia();
        
        // 3. 打包并上传到远程存储
        String backupFile = packageBackup(name, dbBackupPath, mediaBackupPath);
        storageService.uploadToRemote(backupFile);
        
        log.info("备份完成: {}", backupFile);
        return backupFile;
    }

    /**
     * 恢复备份
     */
    public void restoreBackup(String backupPath) {
        log.info("开始恢复备份: {}", backupPath);
        
        // 1. 下载备份文件
        String localPath = storageService.downloadFromRemote(backupPath);
        
        // 2. 解压备份
        String extractedPath = extractBackup(localPath);
        
        // 3. 恢复数据库
        databaseService.importDatabase(extractedPath + "/database.sql");
        
        // 4. 恢复媒体文件
        storageService.restoreMedia(extractedPath + "/media");
        
        log.info("备份恢复完成");
    }

    private String packageBackup(String name, String dbPath, String mediaPath) {
        // 打包逻辑
        return "/backups/" + name + ".tar.gz";
    }

    private String extractBackup(String backupPath) {
        // 解压逻辑
        return backupPath.replace(".tar.gz", "");
    }
}
```

---

# 第四部分：数据库详细设计

## 4.1 数据模型概述

### 4.1.1 ER 关系图

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    AetherBlog 数据模型关系图                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                  │
│   ┌─────────────┐           ┌─────────────┐           ┌─────────────┐                            │
│   │    User     │───────────│    Post     │───────────│  Category   │                            │
│   └─────────────┘    1:N    └─────────────┘    N:1    └─────────────┘                            │
│         │                         │                         │                                   │
│         │ 1:N                     │ N:M                     │ 1:N (自引用)                       │
│         ▼                         ▼                         ▼                                   │
│   ┌─────────────┐           ┌─────────────┐           ┌─────────────┐                            │
│   │   Comment   │           │  PostTag    │───────────│    Tag      │                            │
│   └─────────────┘           └─────────────┘    N:1    └─────────────┘                            │
│         │                         │                                                              │
│         │ 1:N (自引用)             │                                                              │
│         ▼                         ▼                                                              │
│   ┌─────────────┐           ┌─────────────┐           ┌─────────────┐                            │
│   │   Reply     │           │   Media     │           │  FriendLink │                            │
│   └─────────────┘           └─────────────┘           └─────────────┘                            │
│                                                                                                  │
│   ┌─────────────┐           ┌─────────────┐           ┌─────────────┐                            │
│   │   Setting   │           │  AccessLog  │           │ PostVector  │                            │
│   └─────────────┘           └─────────────┘           └─────────────┘                            │
│                                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 4.1.2 设计原则

- **范式遵循**: 核心表遵循第三范式(3NF)，适当反规范化提升查询性能
- **软删除**: 所有业务表支持软删除(`deleted_at` 字段)
- **审计追踪**: 统一的 `created_at`、`updated_at` 时间戳
- **乐观锁**: 关键表使用 `version` 字段实现乐观锁
- **UUID vs Long**: 主键使用 BIGSERIAL，对外暴露使用 UUID

---

## 4.2 核心表结构设计

### 4.2.1 用户表 (users)

```sql
-- 用户表
CREATE TABLE users (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    username        VARCHAR(50) NOT NULL UNIQUE,
    email           VARCHAR(100) NOT NULL UNIQUE,
    password_hash   VARCHAR(255) NOT NULL,
    nickname        VARCHAR(50),
    avatar          VARCHAR(500),
    bio             TEXT,
    role            VARCHAR(20) NOT NULL DEFAULT 'USER',  -- ADMIN, EDITOR, USER
    status          VARCHAR(20) NOT NULL DEFAULT 'ACTIVE', -- ACTIVE, INACTIVE, BANNED
    email_verified  BOOLEAN DEFAULT FALSE,
    last_login_at   TIMESTAMP WITH TIME ZONE,
    last_login_ip   VARCHAR(45),
    login_count     INTEGER DEFAULT 0,
    version         INTEGER DEFAULT 0,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at      TIMESTAMP WITH TIME ZONE
);

-- 索引
CREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_role ON users(role) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;

COMMENT ON TABLE users IS '用户表';
COMMENT ON COLUMN users.role IS '用户角色: ADMIN-管理员, EDITOR-编辑, USER-普通用户';
```

### 4.2.2 文章表 (posts)

```sql
-- 文章表
CREATE TABLE posts (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    title           VARCHAR(200) NOT NULL,
    slug            VARCHAR(200) NOT NULL UNIQUE,
    content         TEXT NOT NULL,
    content_html    TEXT,                    -- 预渲染的 HTML
    summary         VARCHAR(500),
    cover_image     VARCHAR(500),
    author_id       BIGINT NOT NULL REFERENCES users(id),
    category_id     BIGINT REFERENCES categories(id),
    status          VARCHAR(20) NOT NULL DEFAULT 'DRAFT', -- DRAFT, PUBLISHED, ARCHIVED
    visibility      VARCHAR(20) NOT NULL DEFAULT 'PUBLIC', -- PUBLIC, PRIVATE, PASSWORD
    password        VARCHAR(100),            -- 密码保护
    is_top          BOOLEAN DEFAULT FALSE,
    is_featured     BOOLEAN DEFAULT FALSE,
    allow_comment   BOOLEAN DEFAULT TRUE,
    view_count      INTEGER DEFAULT 0,
    like_count      INTEGER DEFAULT 0,
    comment_count   INTEGER DEFAULT 0,
    word_count      INTEGER DEFAULT 0,
    reading_time    INTEGER DEFAULT 0,       -- 预估阅读时间(分钟)
    seo_title       VARCHAR(100),
    seo_description VARCHAR(200),
    seo_keywords    VARCHAR(200),
    published_at    TIMESTAMP WITH TIME ZONE,
    version         INTEGER DEFAULT 0,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at      TIMESTAMP WITH TIME ZONE
);

-- 索引
CREATE INDEX idx_posts_author ON posts(author_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_posts_category ON posts(category_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_posts_status ON posts(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_posts_published_at ON posts(published_at DESC) WHERE deleted_at IS NULL AND status = 'PUBLISHED';
CREATE INDEX idx_posts_is_top ON posts(is_top DESC, published_at DESC) WHERE deleted_at IS NULL;

-- 全文搜索索引
CREATE INDEX idx_posts_fulltext ON posts USING gin(to_tsvector('zhparser', title || ' ' || COALESCE(content, '')));

COMMENT ON TABLE posts IS '文章表';
```

### 4.2.3 分类表 (categories)

```sql
-- 分类表 (支持层级)
CREATE TABLE categories (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    name            VARCHAR(50) NOT NULL,
    slug            VARCHAR(50) NOT NULL UNIQUE,
    description     VARCHAR(200),
    cover_image     VARCHAR(500),
    parent_id       BIGINT REFERENCES categories(id),
    sort_order      INTEGER DEFAULT 0,
    post_count      INTEGER DEFAULT 0,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at      TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_categories_parent ON categories(parent_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_categories_slug ON categories(slug) WHERE deleted_at IS NULL;

COMMENT ON TABLE categories IS '文章分类表，支持层级结构';
```

### 4.2.4 标签表 (tags)

```sql
-- 标签表
CREATE TABLE tags (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    name            VARCHAR(50) NOT NULL UNIQUE,
    slug            VARCHAR(50) NOT NULL UNIQUE,
    color           VARCHAR(7) DEFAULT '#6366f1',  -- HEX 颜色
    post_count      INTEGER DEFAULT 0,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tags_slug ON tags(slug);
CREATE INDEX idx_tags_post_count ON tags(post_count DESC);

COMMENT ON TABLE tags IS '文章标签表';

-- 文章-标签关联表
CREATE TABLE post_tags (
    post_id         BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    tag_id          BIGINT NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (post_id, tag_id)
);

CREATE INDEX idx_post_tags_tag ON post_tags(tag_id);

COMMENT ON TABLE post_tags IS '文章标签关联表';
```

### 4.2.5 评论表 (comments)

```sql
-- 评论表
CREATE TABLE comments (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    post_id         BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    user_id         BIGINT REFERENCES users(id),  -- 可为空(游客评论)
    parent_id       BIGINT REFERENCES comments(id) ON DELETE CASCADE,
    author_name     VARCHAR(50) NOT NULL,
    author_email    VARCHAR(100),
    author_url      VARCHAR(200),
    author_ip       VARCHAR(45),
    author_ua       VARCHAR(500),
    content         TEXT NOT NULL,
    content_html    TEXT,
    status          VARCHAR(20) NOT NULL DEFAULT 'PENDING', -- PENDING, APPROVED, SPAM, TRASH
    like_count      INTEGER DEFAULT 0,
    is_admin_reply  BOOLEAN DEFAULT FALSE,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at      TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_comments_post ON comments(post_id, status) WHERE deleted_at IS NULL;
CREATE INDEX idx_comments_parent ON comments(parent_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_comments_status ON comments(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_comments_created ON comments(created_at DESC) WHERE deleted_at IS NULL;

COMMENT ON TABLE comments IS '评论表';
```

### 4.2.6 媒体表 (media)

```sql
-- 媒体文件表
CREATE TABLE media (
    id              BIGSERIAL PRIMARY KEY,
    uuid            UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
    filename        VARCHAR(255) NOT NULL,
    original_name   VARCHAR(255) NOT NULL,
    file_path       VARCHAR(500) NOT NULL,
    file_url        VARCHAR(500) NOT NULL,
    file_size       BIGINT NOT NULL,
    mime_type       VARCHAR(100) NOT NULL,
    file_type       VARCHAR(20) NOT NULL,    -- IMAGE, VIDEO, AUDIO, DOCUMENT, OTHER
    width           INTEGER,                  -- 图片/视频宽度
    height          INTEGER,                  -- 图片/视频高度
    duration        INTEGER,                  -- 视频/音频时长(秒)
    alt_text        VARCHAR(200),
    description     TEXT,
    upload_by       BIGINT NOT NULL REFERENCES users(id),
    storage_type    VARCHAR(20) DEFAULT 'LOCAL', -- LOCAL, OSS, COS, S3
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at      TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_media_type ON media(file_type) WHERE deleted_at IS NULL;
CREATE INDEX idx_media_upload_by ON media(upload_by) WHERE deleted_at IS NULL;
CREATE INDEX idx_media_created ON media(created_at DESC) WHERE deleted_at IS NULL;

COMMENT ON TABLE media IS '媒体文件表';
```

### 4.2.7 友情链接表 (friend_links)

```sql
-- 友情链接表
CREATE TABLE friend_links (
    id              BIGSERIAL PRIMARY KEY,
    name            VARCHAR(100) NOT NULL,
    url             VARCHAR(500) NOT NULL,
    avatar          VARCHAR(500),
    description     VARCHAR(200),
    sort_order      INTEGER DEFAULT 0,
    is_active       BOOLEAN DEFAULT TRUE,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_friend_links_active ON friend_links(is_active, sort_order);

COMMENT ON TABLE friend_links IS '友情链接表';
```

### 4.2.8 系统设置表 (settings)

```sql
-- 系统设置表 (键值对形式)
CREATE TABLE settings (
    id              BIGSERIAL PRIMARY KEY,
    setting_key     VARCHAR(100) NOT NULL UNIQUE,
    setting_value   TEXT,
    setting_type    VARCHAR(20) DEFAULT 'STRING', -- STRING, NUMBER, BOOLEAN, JSON
    category        VARCHAR(50) DEFAULT 'GENERAL', -- GENERAL, SEO, APPEARANCE, SECURITY
    description     VARCHAR(200),
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_settings_category ON settings(category);

COMMENT ON TABLE settings IS '系统设置表';

-- 初始化默认设置
INSERT INTO settings (setting_key, setting_value, setting_type, category, description) VALUES
('site_name', 'AetherBlog', 'STRING', 'GENERAL', '网站名称'),
('site_subtitle', '一个优雅的技术博客', 'STRING', 'GENERAL', '网站副标题'),
('site_description', '分享技术与生活', 'STRING', 'GENERAL', '网站描述'),
('site_url', 'https://example.com', 'STRING', 'GENERAL', '网站地址'),
('admin_email', 'admin@example.com', 'STRING', 'GENERAL', '管理员邮箱'),
('posts_per_page', '10', 'NUMBER', 'GENERAL', '每页文章数'),
('comment_moderation', 'true', 'BOOLEAN', 'SECURITY', '评论审核'),
('allow_guest_comment', 'true', 'BOOLEAN', 'SECURITY', '允许游客评论');
```

---

## 4.3 索引策略设计

### 4.3.1 索引设计原则

```text
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                 索引策略设计原则                                      │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  1. 查询优先                                                                         │
│     • 为高频查询条件创建索引                                                          │
│     • 组合索引遵循最左前缀原则                                                        │
│                                                                                      │
│  2. 部分索引                                                                         │
│     • 使用 WHERE 子句过滤已删除记录                                                   │
│     • 减少索引大小，提升维护效率                                                      │
│                                                                                      │
│  3. 覆盖索引                                                                         │
│     • 对于列表查询，尽量使用覆盖索引                                                  │
│     • 避免回表查询                                                                    │
│                                                                                      │
│  4. 定期维护                                                                         │
│     • 定期执行 VACUUM ANALYZE                                                        │
│     • 监控索引使用情况，删除无用索引                                                  │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

### 4.3.2 关键查询场景索引

```sql
-- 首页文章列表查询优化
CREATE INDEX idx_posts_homepage ON posts(is_top DESC, published_at DESC)
INCLUDE (uuid, title, slug, summary, cover_image, view_count, comment_count)
WHERE deleted_at IS NULL AND status = 'PUBLISHED';

-- 分类归档查询优化
CREATE INDEX idx_posts_category_archive ON posts(category_id, published_at DESC)
WHERE deleted_at IS NULL AND status = 'PUBLISHED';

-- 标签文章查询优化
CREATE INDEX idx_post_tags_with_post ON post_tags(tag_id)
INCLUDE (post_id);

-- 评论列表查询优化
CREATE INDEX idx_comments_post_tree ON comments(post_id, parent_id, created_at)
WHERE deleted_at IS NULL AND status = 'APPROVED';
```

---

## 4.4 向量存储设计

### 4.4.1 pgvector 扩展配置

```sql
-- 启用 pgvector 扩展
CREATE EXTENSION IF NOT EXISTS vector;

-- 文章向量表
CREATE TABLE post_vectors (
    id              BIGSERIAL PRIMARY KEY,
    post_id         BIGINT NOT NULL UNIQUE REFERENCES posts(id) ON DELETE CASCADE,
    embedding       vector(1536),            -- OpenAI text-embedding-3-small 维度
    model           VARCHAR(50) DEFAULT 'text-embedding-3-small',
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 创建 HNSW 索引 (用于近似最近邻搜索)
CREATE INDEX idx_post_vectors_embedding ON post_vectors 
USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

COMMENT ON TABLE post_vectors IS '文章向量表，用于语义搜索和相关推荐';
COMMENT ON COLUMN post_vectors.embedding IS '文章内容的向量嵌入，1536维度';
```

### 4.4.2 向量搜索函数

```sql
-- 语义相似度搜索函数
CREATE OR REPLACE FUNCTION search_similar_posts(
    query_embedding vector(1536),
    match_threshold float DEFAULT 0.7,
    match_count int DEFAULT 5
)
RETURNS TABLE (
    post_id BIGINT,
    similarity float
)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT 
        pv.post_id,
        1 - (pv.embedding <=> query_embedding) AS similarity
    FROM post_vectors pv
    JOIN posts p ON p.id = pv.post_id
    WHERE p.deleted_at IS NULL 
      AND p.status = 'PUBLISHED'
      AND 1 - (pv.embedding <=> query_embedding) > match_threshold
    ORDER BY pv.embedding <=> query_embedding
    LIMIT match_count;
END;
$$;

COMMENT ON FUNCTION search_similar_posts IS '基于向量相似度搜索相关文章';
```

---

# 第五部分：API接口详细设计

## 5.1 接口设计规范

### 5.1.1 RESTful 设计原则

```text
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                 RESTful API 设计规范                                  │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  URL 命名规范:                                                                        │
│  • 使用小写字母和连字符: /api/v1/blog-posts                                           │
│  • 资源使用复数形式: /api/v1/posts, /api/v1/categories                               │
│  • 层级关系使用嵌套: /api/v1/posts/{id}/comments                                      │
│                                                                                      │
│  Context Path:                                                                       │
│  • 后端 API 统一前缀: /api                                                            │
│                                                                                      │
│  HTTP 方法:                                                                          │
│  • GET    - 获取资源                                                                 │
│  • POST   - 创建资源                                                                 │
│  • PUT    - 完整更新资源                                                             │
│  • PATCH  - 部分更新资源                                                             │
│  • DELETE - 删除资源                                                                 │
│                                                                                      │
│  版本控制:                                                                            │
│  • URL 路径: /api/v1/...                                                             │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

### 5.1.2 响应格式规范

```typescript
// 统一响应格式
interface ApiResponse<T> {
  code: number;        // 业务状态码
  message: string;     // 响应消息
  data: T;            // 响应数据
  timestamp: number;   // 响应时间戳
  traceId: string;    // 追踪ID
}

// 分页响应格式
interface PageResponse<T> {
  code: number;
  message: string;
  data: {
    list: T[];
    pagination: {
      page: number;
      size: number;
      total: number;
      totalPages: number;
      hasNext: boolean;
      hasPrev: boolean;
    };
  };
  timestamp: number;
  traceId: string;
}
```

### 5.1.3 错误码定义

```java
// 错误码枚举
public enum ErrorCode {
    // 成功
    SUCCESS(0, "操作成功"),
    
    // 客户端错误 (4xx)
    BAD_REQUEST(400, "请求参数错误"),
    UNAUTHORIZED(401, "未授权访问"),
    FORBIDDEN(403, "禁止访问"),
    NOT_FOUND(404, "资源不存在"),
    METHOD_NOT_ALLOWED(405, "请求方法不支持"),
    CONFLICT(409, "资源冲突"),
    VALIDATION_ERROR(422, "参数校验失败"),
    TOO_MANY_REQUESTS(429, "请求过于频繁"),
    
    // 服务端错误 (5xx)
    INTERNAL_ERROR(500, "服务器内部错误"),
    SERVICE_UNAVAILABLE(503, "服务暂不可用"),
    
    // 业务错误 (1xxx)
    USER_NOT_FOUND(1001, "用户不存在"),
    USER_ALREADY_EXISTS(1002, "用户已存在"),
    INVALID_PASSWORD(1003, "密码错误"),
    POST_NOT_FOUND(1101, "文章不存在"),
    CATEGORY_NOT_FOUND(1201, "分类不存在"),
    COMMENT_CLOSED(1301, "评论已关闭"),
    
    // AI 相关错误 (2xxx)
    AI_SERVICE_ERROR(2001, "AI服务异常"),
    AI_RATE_LIMITED(2002, "AI调用频率超限");
}
```

---

## 5.2 认证授权接口

### 5.2.1 用户认证

```yaml
# 用户登录
POST /api/v1/auth/login
Request:
  Content-Type: application/json
  Body:
    username: string    # 用户名或邮箱
    password: string    # 密码
    remember: boolean   # 记住我

Response 200:
  {
    "code": 0,
    "message": "登录成功",
    "data": {
      "accessToken": "eyJhbG...",
      "refreshToken": "eyJhbG...",
      "expiresIn": 3600,
      "user": {
        "id": "uuid",
        "username": "admin",
        "nickname": "管理员",
        "avatar": "https://...",
        "role": "ADMIN"
      }
    }
  }

---
# 刷新令牌
POST /api/v1/auth/refresh
Request:
  Authorization: Bearer {refreshToken}

Response 200:
  {
    "code": 0,
    "data": {
      "accessToken": "eyJhbG...",
      "expiresIn": 3600
    }
  }

---
# 退出登录
POST /api/v1/auth/logout
Request:
  Authorization: Bearer {accessToken}

Response 200:
  {
    "code": 0,
    "message": "已退出登录"
  }
```

---

## 5.3 博客内容接口

### 5.3.1 文章接口

```yaml
# 获取文章列表 (前台)
GET /api/v1/posts
Query:
  page: 1              # 页码
  size: 10             # 每页数量
  category: slug       # 分类筛选
  tag: slug            # 标签筛选
  keyword: string      # 关键词搜索

Response 200:
  {
    "code": 0,
    "data": {
      "list": [
        {
          "id": "uuid",
          "title": "文章标题",
          "slug": "post-slug",
          "summary": "文章摘要...",
          "coverImage": "https://...",
          "category": { "id": "uuid", "name": "技术", "slug": "tech" },
          "tags": [{ "id": "uuid", "name": "Java", "slug": "java" }],
          "author": { "nickname": "作者", "avatar": "..." },
          "viewCount": 100,
          "commentCount": 10,
          "publishedAt": "2024-01-15T10:00:00Z"
        }
      ],
      "pagination": { "page": 1, "size": 10, "total": 100 }
    }
  }

---
# 获取文章详情
GET /api/v1/posts/{slug}

Response 200:
  {
    "code": 0,
    "data": {
      "id": "uuid",
      "title": "文章标题",
      "slug": "post-slug",
      "content": "# Markdown 内容...",
      "contentHtml": "<h1>渲染后的 HTML</h1>...",
      "summary": "摘要",
      "coverImage": "...",
      "category": {...},
      "tags": [...],
      "author": {...},
      "viewCount": 100,
      "likeCount": 50,
      "commentCount": 10,
      "wordCount": 2000,
      "readingTime": 8,
      "allowComment": true,
      "publishedAt": "...",
      "prevPost": { "slug": "...", "title": "..." },
      "nextPost": { "slug": "...", "title": "..." },
      "relatedPosts": [...]
    }
  }

---
# 创建文章 (后台)
POST /api/v1/admin/posts
Authorization: Bearer {token}
Request:
  {
    "title": "文章标题",
    "content": "Markdown 内容",
    "summary": "摘要",
    "coverImage": "封面图片URL",
    "categoryId": "分类ID",
    "tagIds": ["标签ID1", "标签ID2"],
    "status": "DRAFT",
    "visibility": "PUBLIC",
    "isTop": false,
    "allowComment": true,
    "seoTitle": "SEO标题",
    "seoDescription": "SEO描述",
    "seoKeywords": "关键词"
  }

Response 201:
  {
    "code": 0,
    "message": "文章创建成功",
    "data": { "id": "uuid", "slug": "auto-generated-slug" }
  }
```

### 5.3.2 评论接口

```yaml
# 获取文章评论
GET /api/v1/posts/{postId}/comments
Query:
  page: 1
  size: 20

Response 200:
  {
    "code": 0,
    "data": {
      "list": [
        {
          "id": "uuid",
          "authorName": "张三",
          "authorAvatar": "...",
          "content": "评论内容",
          "likeCount": 5,
          "createdAt": "...",
          "replies": [
            {
              "id": "uuid",
              "authorName": "博主",
              "content": "回复内容",
              "isAdminReply": true,
              "createdAt": "..."
            }
          ]
        }
      ],
      "pagination": {...}
    }
  }

---
# 发表评论
POST /api/v1/posts/{postId}/comments
Request:
  {
    "authorName": "评论者",
    "authorEmail": "email@example.com",
    "content": "评论内容",
    "parentId": null  # 回复评论时填写
  }

Response 201:
  {
    "code": 0,
    "message": "评论提交成功，等待审核"
  }
```

---

## 5.4 AI 能力接口

```yaml
# AI 生成摘要
POST /api/v1/ai/summary
Authorization: Bearer {token}
Request:
  {
    "content": "文章内容...",
    "maxLength": 200
  }

Response 200:
  {
    "code": 0,
    "data": {
      "summary": "AI生成的摘要内容..."
    }
  }

---
# AI 推荐标签
POST /api/v1/ai/tags
Authorization: Bearer {token}
Request:
  {
    "content": "文章内容...",
    "maxTags": 5
  }

Response 200:
  {
    "code": 0,
    "data": {
      "tags": ["Java", "Spring Boot", "微服务", "架构设计"]
    }
  }

---
# 语义搜索
GET /api/v1/search/semantic
Query:
  q: 搜索查询
  limit: 10

Response 200:
  {
    "code": 0,
    "data": {
      "results": [
        {
          "post": { "id": "...", "title": "...", "slug": "..." },
          "similarity": 0.92,
          "highlight": "匹配的内容片段..."
        }
      ]
    }
  }
```

---

## 5.5 系统管理接口

```yaml
# 获取系统设置
GET /api/v1/admin/settings
Authorization: Bearer {token}

Response 200:
  {
    "code": 0,
    "data": {
      "general": {
        "siteName": "AetherBlog",
        "siteSubtitle": "...",
        "siteUrl": "..."
      },
      "seo": {...},
      "appearance": {...},
      "security": {...}
    }
  }

---
# 更新系统设置
PATCH /api/v1/admin/settings
Authorization: Bearer {token}
Request:
  {
    "general": {
      "siteName": "新名称"
    }
  }

Response 200:
  {
    "code": 0,
    "message": "设置已更新"
  }

---
# 获取系统状态
GET /api/v1/admin/system/status
Authorization: Bearer {token}

Response 200:
  {
    "code": 0,
    "data": {
      "java": { "healthy": true, "responseTime": 5 },
      "database": { "healthy": true, "responseTime": 2 },
      "redis": { "healthy": true, "responseTime": 1 },
      "cpu": 25,
      "memory": { "used": 4, "total": 16, "percentage": 25 },
      "uptime": "10天5小时",
      "jvm": {
        "heapUsed": 512,
        "heapMax": 2048,
        "threadCount": 50
      }
    }
  }
```

---

# 第六部分：安全架构设计

## 6.1 安全架构总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                 安全架构分层设计                                      │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           应用层安全                                           │  │
│  │  • JWT 认证    • RBAC 授权    • 会话管理    • 密码策略                        │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           接口层安全                                           │  │
│  │  • 参数校验    • SQL注入防护    • XSS防护    • CSRF防护    • 速率限制         │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           数据层安全                                           │  │
│  │  • 字段加密    • 脱敏处理    • 审计日志    • 备份加密                         │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           网络层安全                                           │  │
│  │  • HTTPS强制    • 防火墙    • DDoS防护    • IP白名单                          │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

## 6.2 认证授权机制

### 6.2.1 JWT 令牌设计

```java
// JWT 令牌结构
{
  "header": {
    "alg": "HS512",
    "typ": "JWT"
  },
  "payload": {
    "sub": "1001",           // 用户ID
    "username": "admin",
    "roles": ["ADMIN"],
    "iat": 1705305600,       // 签发时间
    "exp": 1705309200        // 过期时间
  },
  "signature": "..."
}
```

### 6.2.2 RBAC 权限模型

```text
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              RBAC 权限模型                                           │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  角色定义:                                                                          │
│  ┌─────────────┬───────────────────────────────────────────────────────────────┐   │
│  │   ADMIN     │ 完整权限：所有功能                                             │   │
│  ├─────────────┼───────────────────────────────────────────────────────────────┤   │
│  │   EDITOR    │ 内容权限：文章、媒体、评论管理                                  │   │
│  ├─────────────┼───────────────────────────────────────────────────────────────┤   │
│  │   USER      │ 基础权限：查看、评论                                           │   │
│  └─────────────┴───────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## 6.3 数据安全策略

### 6.3.1 敏感数据加密

```java
// 密码加密 (BCrypt)
@Service
public class PasswordService {
    private final BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(12);
    
    public String encode(String rawPassword) {
        return encoder.encode(rawPassword);
    }
    
    public boolean matches(String rawPassword, String encodedPassword) {
        return encoder.matches(rawPassword, encodedPassword);
    }
}
```

### 6.3.2 数据脱敏

```java
// 脱敏处理
public class DataMaskingUtil {
    // 邮箱脱敏: a***@example.com
    public static String maskEmail(String email) {
        if (email == null || !email.contains("@")) return email;
        int atIndex = email.indexOf("@");
        if (atIndex <= 1) return email;
        return email.charAt(0) + "***" + email.substring(atIndex);
    }
    
    // IP脱敏: 192.168.*.*
    public static String maskIp(String ip) {
        if (ip == null) return null;
        String[] parts = ip.split("\\.");
        if (parts.length == 4) {
            return parts[0] + "." + parts[1] + ".*.*";
        }
        return ip;
    }
}
```

## 6.4 接口安全防护

### 6.4.1 参数校验

```java
// 请求参数校验
@RestController
@RequestMapping("/api/v1/posts")
public class PostController {
    
    @PostMapping
    public ResponseEntity<?> createPost(@Valid @RequestBody CreatePostRequest request) {
        // 校验通过后执行业务逻辑
    }
}

@Data
public class CreatePostRequest {
    @NotBlank(message = "标题不能为空")
    @Size(max = 200, message = "标题最多200字符")
    private String title;
    
    @NotBlank(message = "内容不能为空")
    private String content;
    
    @URL(message = "封面图片地址格式错误")
    private String coverImage;
}
```

### 6.4.2 速率限制

```java
// 基于 Redis 的分布式限流过滤器
@Component
public class RateLimitFilter implements Filter {

    private final RedisService redisService;
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) 
            throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        
        // 获取方法上的 @RateLimit 注解并进行校验
        if (rateLimit != null && !checkRateLimit(httpRequest, rateLimit)) {
            HttpServletResponse httpResponse = (HttpServletResponse) response;
            httpResponse.setStatus(429);
            ServletUtils.renderJson(httpResponse, JsonUtils.toJson(R.fail(429, "请求过于频繁")));
            return;
        }
        chain.doFilter(request, response);
    }

    private boolean checkRateLimit(HttpServletRequest request, RateLimit rateLimit) {
        String key = buildKey(request, rateLimit);
        long count = redisService.increment(key, 1);
        if (count == 1) {
            redisService.expire(key, rateLimit.time(), rateLimit.timeUnit());
        }
        return count <= rateLimit.count();
    }
}
```

---

# 第七部分：前端详细设计

## 7.1 前端架构设计

### 7.1.1 目录结构

```text
apps/
├── blog/                          # 博客前台
│   ├── src/
│   │   ├── app/                   # Next.js App Router
│   │   │   ├── (blog)/           # 博客相关页面
│   │   │   ├── api/              # API Routes
│   │   │   └── layout.tsx
│   │   ├── components/           # 页面组件
│   │   ├── lib/                  # 工具函数
│   │   └── styles/               # 全局样式
│   └── next.config.js
│
├── admin/                         # 管理后台
│   ├── src/
│   │   ├── pages/                # 页面组件
│   │   ├── components/           # 通用组件
│   │   ├── hooks/                # 自定义 Hooks
│   │   ├── services/             # API 服务
│   │   ├── stores/               # Zustand 状态
│   │   └── lib/                  # 工具函数
│   └── vite.config.ts
│
└── packages/
    ├── ui/                        # 共享 UI 组件库
    ├── utils/                     # 共享工具函数
    └── hooks/                     # 共享 Hooks
```

### 7.1.2 状态管理设计

```typescript
// Zustand 全局状态
// stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (user: User, token: string) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      login: (user, token) => set({ user, token, isAuthenticated: true }),
      logout: () => set({ user: null, token: null, isAuthenticated: false }),
    }),
    { name: 'auth-storage' }
  )
);
```

## 7.2 组件体系设计

### 7.2.1 原子组件

```typescript
// 按钮组件
// packages/ui/src/Button.tsx
import { cva, type VariantProps } from 'class-variance-authority';
import { motion } from 'framer-motion';

const buttonVariants = cva(
  'inline-flex items-center justify-center rounded-lg font-medium transition-all',
  {
    variants: {
      variant: {
        primary: 'bg-primary text-white hover:bg-primary/90',
        secondary: 'bg-white/10 text-white hover:bg-white/20',
        ghost: 'text-gray-400 hover:text-white hover:bg-white/5',
        danger: 'bg-red-500 text-white hover:bg-red-600',
      },
      size: {
        sm: 'px-3 py-1.5 text-sm',
        md: 'px-4 py-2 text-sm',
        lg: 'px-6 py-3 text-base',
      },
    },
    defaultVariants: {
      variant: 'primary',
      size: 'md',
    },
  }
);

interface ButtonProps extends VariantProps<typeof buttonVariants> {
  children: React.ReactNode;
  loading?: boolean;
  onClick?: () => void;
}

export const Button: React.FC<ButtonProps> = ({ 
  children, variant, size, loading, onClick 
}) => (
  <motion.button
    whileHover={{ scale: 1.02 }}
    whileTap={{ scale: 0.98 }}
    className={buttonVariants({ variant, size })}
    onClick={onClick}
    disabled={loading}
  >
    {loading && <Loader2 className="w-4 h-4 mr-2 animate-spin" />}
    {children}
  </motion.button>
);
```

### 7.2.2 复合组件

```typescript
// 卡片组件
// packages/ui/src/Card.tsx
import { cn } from '@aetherblog/utils';

interface CardProps {
  children: React.ReactNode;
  className?: string;
  hover?: boolean;
}

export const Card: React.FC<CardProps> = ({ children, className, hover }) => (
  <div className={cn(
    'p-6 rounded-xl',
    'bg-white/5 backdrop-blur-sm border border-white/10',
    hover && 'hover:border-white/20 transition-all cursor-pointer',
    className
  )}>
    {children}
  </div>
);

Card.Header = ({ children, className }) => (
  <div className={cn('flex items-center justify-between mb-4', className)}>
    {children}
  </div>
);

Card.Title = ({ children }) => (
  <h3 className="text-lg font-medium text-white">{children}</h3>
);

Card.Content = ({ children }) => (
  <div className="text-gray-300">{children}</div>
);
```

## 7.3 页面交互设计

### 7.3.1 路由结构

```typescript
// 博客前台路由
const blogRoutes = [
  { path: '/', page: 'Home' },
  { path: '/posts', page: 'PostList' },
  { path: '/posts/:slug', page: 'PostDetail' },
  { path: '/categories/:slug', page: 'CategoryPosts' },
  { path: '/tags/:slug', page: 'TagPosts' },
  { path: '/archives', page: 'Archives' },
  { path: '/about', page: 'About' },
  { path: '/search', page: 'Search' },
];

// 管理后台路由
const adminRoutes = [
  { path: '/admin', page: 'Dashboard' },
  { path: '/admin/posts', page: 'PostsPage' },
  { path: '/admin/posts/new', page: 'PostEditor' },
  { path: '/admin/posts/:id/edit', page: 'PostEditor' },
  { path: '/admin/categories', page: 'CategoriesPage' },
  { path: '/admin/media', page: 'MediaPage' },
  { path: '/admin/comments', page: 'CommentsPage' },
  { path: '/admin/friends', page: 'FriendsPage' },
  { path: '/admin/settings', page: 'SettingsPage' },
  { path: '/admin/ai-tools', page: 'AIToolsPage' },
  { path: '/admin/monitor', page: 'MonitorPage' },
];
```

## 7.4 视觉规范与动效

### 7.4.1 设计令牌

```css
/* 设计系统变量 */
:root {
  /* 颜色 */
  --color-primary: #6366f1;
  --color-secondary: #8b5cf6;
  --color-success: #22c55e;
  --color-warning: #f59e0b;
  --color-danger: #ef4444;
  
  /* 背景 */
  --bg-primary: #0a0a0f;
  --bg-secondary: #13131a;
  --bg-card: rgba(255, 255, 255, 0.05);
  
  /* 边框 */
  --border-default: rgba(255, 255, 255, 0.1);
  --border-hover: rgba(255, 255, 255, 0.2);
  
  /* 阴影 */
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
  
  /* 圆角 */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.5rem;
  
  /* 过渡 */
  --transition-fast: 150ms ease;
  --transition-normal: 200ms ease;
  --transition-slow: 300ms ease;
}
```

### 7.4.2 动画规范

```typescript
// Framer Motion 动画变体
export const fadeInUp = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
  transition: { duration: 0.3 }
};

export const staggerChildren = {
  animate: {
    transition: {
      staggerChildren: 0.05
    }
  }
};

export const scaleOnHover = {
  whileHover: { scale: 1.02 },
  whileTap: { scale: 0.98 }
};

export const slideIn = {
  initial: { opacity: 0, x: -20 },
  animate: { opacity: 1, x: 0 },
  exit: { opacity: 0, x: 20 }
};
```

---

# 第八部分：后端详细设计

## 8.1 服务架构设计

### 8.1.1 模块化单体架构 (Modular Monolith)

系统采用 **模块化单体 (Modular Monolith)** 架构设计，旨在平衡开发的敏捷性与未来的可扩展性。

- **物理分离**: 核心功能按 Maven 模块（`blog-service`, `ai-service` 等）进行物理隔离，每个模块拥有独立的职责边界。
- **逻辑分层**: 在每个业务模块内部，遵循标准的 Spring Boot 分层模式（Controller -> Service -> Repository -> Entity）。
- **统一入口**: 通过 `aetherblog-app` 作为唯一的运行入口，聚合所有业务模块，降低运维复杂度。
- **能力共享**: 通过 `aetherblog-common` 提供跨模块的基础能力（安全、日志、缓存）。

### 8.1.2 物理与包结构映射

每个核心业务模块（如 `blog-service`）内部遵循以下规范：

```text
com.aetherblog.[module]/
├── controller/            # 接口层 (RESTful Endpoints)
├── service/              # 业务逻辑接口
│   └── impl/             # 业务逻辑实现
├── repository/           # 数据访问层 (Spring Data JPA)
├── entity/               # 领域实体 (JPA Entities)
├── dto/                  # 数据传输对象 (Request/Response)
└── config/                # 模块私有配置
```

## 8.2 核心业务实现

### 8.2.1 文章服务 (PostService)

核心业务逻辑实现了文章的全生命周期管理，并集成了 Slug 唯一性处理和分页查询。

```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class PostServiceImpl implements PostService {

    private final PostRepository postRepository;
    private final CategoryRepository categoryRepository;
    private final TagRepository tagRepository;

    @Override
    public PageResult<PostListResponse> getPublishedPosts(int pageNum, int pageSize) {
        Page<Post> page = postRepository.findPublished(PageRequest.of(pageNum - 1, pageSize));
        return toPageResult(page, pageNum, pageSize);
    }

    @Override
    @Transactional
    public PostDetailResponse createPost(CreatePostRequest request) {
        Post post = new Post();
        // ... 属性赋值
        post.setSlug(generateUniqueSlug(request.getTitle()));
        // 处理分类与标签关联
        // ...
        return toDetailResponse(postRepository.save(post));
    }
}
```

## 8.3 AI 服务集成

### 8.3.1 AI 服务配置

```yaml
# apps/ai-service/.env (示意)
AI_DEFAULT_PROVIDER=openai
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_BASE_URL=https://api.openai.com
OPENAI_COMPAT_BASE_URL=${OPENAI_COMPAT_BASE_URL}
OPENAI_COMPAT_API_KEY=${OPENAI_COMPAT_API_KEY}
```

```yaml
# blog-service application.yml (示意)
ai:
  base-url: ${AI_SERVICE_BASE_URL:http://localhost:8000}
  api-key: ${AI_SERVICE_API_KEY}
  timeout-ms: 15000
```

## 8.4 性能优化策略

### 8.4.1 缓存策略

```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public RedisCacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));
        
        return RedisCacheManager.builder(factory)
            .cacheDefaults(config)
            .withCacheConfiguration("posts", config.entryTtl(Duration.ofHours(1)))
            .withCacheConfiguration("categories", config.entryTtl(Duration.ofHours(24)))
            .build();
    }
}
```

### 8.4.2 虚拟线程配置

系统利用 JDK 21+ 的虚拟线程特性来提升并发性能。

**Spring Boot 3.2+ 配置 (推荐):**

```yaml
spring:
  threads:
    virtual:
      enabled: true
```

**底层自定义配置 (可选):**

```java
@Configuration
public class VirtualThreadConfig {
    
    @Bean
    public TomcatProtocolHandlerCustomizer<?> virtualThreadCustomizer() {
        return protocolHandler -> {
            protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor());
        };
    }
}
```

---

# 第九部分：DevOps与运维设计

## 9.1 部署架构设计

### 9.1.0 统一网关架构（v1.1.2+）

生产环境使用 **Nginx 网关容器**（端口 7899）作为统一入口，自动路由所有请求：

```
                        ┌─────────────────────────────────────┐
                        │         统一网关 (:7899)             │
                        │         Nginx Gateway               │
                        └────────────┬────────────────────────┘
                                     │
           ┌─────────────────────────┼─────────────────────────┐
           │                         │                         │
           ▼                         ▼                         ▼
   ┌───────────────┐        ┌───────────────┐        ┌───────────────┐
   │   /           │        │   /admin      │        │   /api        │
   │   blog:3000   │        │   admin:80    │        │   backend:8080│
   │   (Next.js)   │        │   (Nginx)     │        │   (Spring)    │
   └───────────────┘        └───────────────┘        └───────┬───────┘
                                                              │
                                                    ┌─────────┴─────────┐
                                                    ▼                   ▼
                                              postgres:5432       redis:6999
                                              (容器内)            (宿主机)
```

**端口分配**:

| 服务 | 端口 | 环境变量 | 说明 |
|:-----|:-----|:---------|:-----|
| 统一网关 | 7899 | `GATEWAY_PORT` | ⭐ 推荐使用 |
| 博客前台 | 7893 | `BLOG_PORT` | 可选直接访问 |
| 管理后台 | 7894 | `ADMIN_PORT` | 可选直接访问 |
| PostgreSQL | 7895 | `POSTGRES_PORT` | 数据库 |

**Admin Base Path 配置**:

Admin 应用使用 Vite 动态 base path，自动适应开发与生产环境：

```typescript
// vite.config.ts
export default defineConfig(({ command }) => ({
  base: command === 'serve' ? '/' : '/admin/',
}));

// App.tsx
const basename = import.meta.env.BASE_URL.replace(/\/$/, '') || '/';
<BrowserRouter basename={basename === '/' ? undefined : basename}>
```

### 9.1.1 Docker Compose 配置

```yaml
# docker-compose.prod.yml
services:
  # 统一网关
  gateway:
    image: nginx:alpine
    container_name: aetherblog-gateway
    ports:
      - "${GATEWAY_PORT:-7899}:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - blog
      - admin
      - backend

  postgres:
    image: pgvector/pgvector:pg17
    ports:
      - "${POSTGRES_PORT:-7895}:5432"
    environment:
      - POSTGRES_DB=aetherblog
      - POSTGRES_USER=aetherblog
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-aetherblog123}
    volumes:
      - aetherblog_postgres_data:/var/lib/postgresql/data

  backend:
    image: ${DOCKER_REGISTRY:-}aetherblog-backend:${VERSION:-latest}
    expose:
      - "8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/aetherblog
    depends_on:
      - postgres

  blog:
    image: ${DOCKER_REGISTRY:-}aetherblog-blog:${VERSION:-latest}
    ports:
      - "${BLOG_PORT:-7893}:3000"
    depends_on:
      - backend

  admin:
    image: ${DOCKER_REGISTRY:-}aetherblog-admin:${VERSION:-latest}
    ports:
      - "${ADMIN_PORT:-7894}:80"
    depends_on:
      - backend

volumes:
  aetherblog_postgres_data:
```

## 9.2 CI/CD 流水线

### 9.2.1 GitHub Actions

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Build Frontend
        run: |
          cd frontend
          npm ci
          npm run build
          
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: 21
          distribution: temurin
          
      - name: Build Backend
        run: |
          cd backend
          ./gradlew build -x test
          
      - name: Deploy
        run: |
          # 部署脚本
```

## 9.3 监控告警体系

### 9.3.1 Prometheus 指标

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'spring-boot'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['backend:8080']
```

## 9.4 日志管理方案

### 9.4.1 日志配置

```xml
<!-- logback-spring.xml -->
<configuration>
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/application.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/application.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="FILE" />
    </root>
</configuration>
```

## 9.5 运行与维护

### 9.5.1 一键启停脚本

项目根目录下提供了用于快速启停服务的 Shell 脚本：

- **启动脚本**: `./start.sh`
  - 自动检测并拉起 Docker 中间件（Postgres, Redis）
  - 自动运行 Maven 构建并生成后端 JAR
  - 启动后端服务 (`aetherblog-app`)
  - 启动博客前台 (`apps/blog`) 和管理后台 (`apps/admin`)
- **停止脚本**: `./stop.sh`
  - 优雅关闭所有前端进程
  - 优雅关闭后端服务进程
  - （可选）停止相关 Docker 容器

### 9.5.2 常见问题排查 (Troubleshooting)

| 问题分类 | 现象 | 解决方法 |
| :--- | :--- | :--- |
| **端口冲突** | `Port 8080/6379/5432 already in use` | 使用 `docker stop` 停止旧容器；或使用 `lsof -i :PORT` 查杀占用进程。 |
| **编译失败** | `Could not resolve dependencies` | 确保模块版本在父 POM 的 `dependencyManagement` 中统一定义。 |
| **API 404** | 访问后端接口返回 404 | 检查 `application.yml` 中的 `server.servlet.context-path` 是否包含 `/api`。 |
| **API 500** | 后端启动报错或请求失败 | 检查数据库连接；检查 `aetherblog-app` 是否依赖了正确的业务模块。 |
```

---

# 第十部分：项目实施计划

## 10.1 开发阶段规划

```text
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        项目开发里程碑                                                    │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                         │
│  Phase 1: 基础架构搭建 (2周)                                                                            │
│  ├─ Week 1: 项目初始化、技术栈配置、数据库设计                                                          │
│  └─ Week 2: 认证授权系统、基础 API 框架                                                                  │
│                                                                                                         │
│  Phase 2: 核心功能开发 (4周)                                                                            │
│  ├─ Week 3-4: 后台管理系统 UI、文章管理 CRUD                                                            │
│  └─ Week 5-6: 媒体管理、分类标签、评论系统                                                               │
│                                                                                                         │
│  Phase 3: 前端博客开发 (3周)                                                                            │
│  ├─ Week 7: 首页、文章列表、文章详情                                                                     │
│  ├─ Week 8: 归档、分类、标签页面                                                                         │
│  └─ Week 9: 搜索功能、评论系统集成                                                                       │
│                                                                                                         │
│  Phase 4: AI 功能集成 (2周)                                                                             │
│  ├─ Week 10: 独立 AI 服务接入、智能摘要/标签                                                             │
│  └─ Week 11: 向量搜索、相关推荐                                                                          │
│                                                                                                         │
│  Phase 5: 优化与部署 (2周)                                                                              │
│  ├─ Week 12: 性能优化、安全加固                                                                          │
│  └─ Week 13: Docker 部署、CI/CD 配置、文档完善                                                           │
│                                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 10.2 里程碑定义

| 里程碑 | 目标 | 交付物 | 时间 |
|--------|------|--------|------|
| M1 | 基础架构就绪 | 可运行的项目骨架、数据库、认证 | Week 2 |
| M2 | 后台系统完成 | 完整的管理后台 | Week 6 |
| M3 | 博客前台完成 | 可访问的博客网站 | Week 9 |
| M4 | AI 功能上线 | 智能摘要、标签、搜索 | Week 11 |
| M5 | 正式发布 | 生产环境部署、文档 | Week 13 |

## 10.3 质量保证策略

- **代码审查**: 所有 PR 需经过 Code Review
- **单元测试**: 核心业务覆盖率 > 80%
- **集成测试**: API 接口自动化测试
- **性能测试**: 并发、压力测试
- **安全审计**: 定期安全扫描

## 10.4 风险评估与应对

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| AI API 成本超预期 | 中 | 高 | 本地模型备选、调用频率限制 |
| 性能瓶颈 | 低 | 中 | 提前进行负载测试、优化索引 |
| 第三方库兼容性 | 低 | 低 | 锁定依赖版本、定期更新 |

---

*文档完成日期: 2025-01-15*

*版本: v1.0*

*作者: AetherBlog 开发团队*
