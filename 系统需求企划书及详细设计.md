# GBlog 需求起草书及详细设计书

# AetherBlog 智能博客系统

# 产品需求企划书与技术详细设计文档

---

## 📋 文档信息

| 项目  | 内容  |
| --- | --- |
| **产品名称** | AetherBlog（以太博客） |
| **文档版本** | V1.0.0 |
| **文档状态** | 正式版 |
| **编制日期** | 2025年1月 |
| **文档性质** | 产品需求规格说明书 + 技术详细设计 |
| **适用范围** | 产品、设计、开发、测试、运维团队 |

---

## 📑 目录

```text
第一部分：产品愿景与战略定位
  1.1 项目背景与愿景
  1.2 设计哲学：认知优雅
  1.3 用户画像与场景分析
  1.4 竞品分析与差异化定位
  1.5 商业模式与价值主张

第二部分：技术架构顶层设计
  2.1 系统架构全景图
  2.2 技术选型决策矩阵
  2.3 前端技术栈详解
  2.4 后端技术栈详解
  2.5 AI技术栈详解
  2.6 数据存储架构
  2.7 基础设施规划

第三部分：功能模块详细设计
  3.1 博客前台功能模块
  3.2 内容管理后台模块
  3.3 AI智能功能模块
  3.4 系统管理功能模块

第四部分：数据库详细设计
  4.1 数据模型概述
  4.2 核心表结构设计
  4.3 索引策略设计
  4.4 向量存储设计

第五部分：API接口详细设计
  5.1 接口设计规范
  5.2 认证授权接口
  5.3 博客内容接口
  5.4 AI能力接口
  5.5 系统管理接口

第六部分：安全架构设计
  6.1 安全架构总览
  6.2 认证授权机制
  6.3 数据安全策略
  6.4 接口安全防护

第七部分：前端详细设计
  7.1 前端架构设计
  7.2 组件体系设计
  7.3 页面交互设计
  7.4 视觉规范与动效

第八部分：后端详细设计
  8.1 服务架构设计
  8.2 核心业务实现
  8.3 AI服务集成
  8.4 性能优化策略

第九部分：DevOps与运维设计
  9.1 部署架构设计
  9.2 CI/CD流水线
  9.3 监控告警体系
  9.4 日志管理方案

第十部分：项目实施计划
  10.1 开发阶段规划
  10.2 里程碑定义
  10.3 质量保证策略
  10.4 风险评估与应对
```

---

# 第一部分：产品愿景与战略定位

## 1.1 项目背景与愿景

### 1.1.1 项目背景

在当今数字内容生态高速发展的时代，博客作为个人品牌建设和知识传播的重要载体，正在经历深刻的变革。传统的博客系统（如 WordPress、Hexo、Hugo 等）虽然功能成熟，但在以下方面存在明显不足：

**现有博客系统的痛点分析：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           现有博客系统痛点矩阵                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         设计美学层面                                     │   │
│  │  • WordPress: 模板老旧，难以实现现代化设计语言                             │   │
│  │  • Hexo/Hugo: 高度依赖主题，定制成本高                                    │   │
│  │  • Ghost: 设计尚可，但缺乏极致的交互动效                                  │   │
│  │  • 通病: 难以达到 Apple/Microsoft 级别的设计品质                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         技术架构层面                                     │   │
│  │  • WordPress: PHP技术栈老旧，性能瓶颈明显                                 │   │
│  │  • Hexo/Hugo: 静态生成，动态功能受限                                      │   │
│  │  • 通病: 缺乏对现代 Java 生态的支持                                       │   │
│  │  • 通病: 无法充分利用 JDK21 虚拟线程等新特性                              │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         AI集成层面                                       │   │
│  │  • 现有方案: 依赖第三方插件，集成度低                                      │   │
│  │  • 功能局限: 仅支持简单的文本生成                                         │   │
│  │  • 缺失能力: 无RAG检索、无智能标签、无语义搜索                             │   │
│  │  • 体验割裂: AI功能与写作流程分离                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         专业功能层面                                     │   │
│  │  • 数学公式: 需要额外插件，渲染效果参差不齐                                │   │
│  │  • 代码展示: 缺乏IDE级别的代码体验                                        │   │
│  │  • 图表支持: Mermaid等图表支持不完善                                      │   │
│  │  • 附件管理: 缺乏安全的文件分发机制                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.1.2 产品愿景

**AetherBlog** 的命名源自 "Aether"（以太），在古希腊哲学中代表着纯净、精致与无限可能。这个名字完美诠释了我们的产品愿景：

> **「让每一篇博客都成为艺术品，让每一次创作都有AI相伴」**

**愿景分解：**

| 维度  | 愿景描述 | 实现路径 |
| --- | --- | --- |
| **设计极致** | 达到 Apple/Microsoft 级别的视觉品质 | Glassmorphism + Framer Motion |
| **技术领先** | 采用 Java 生态最前沿技术栈 | JDK21 + Spring Boot 3.4 + Spring AI |
| **AI原生** | AI 能力深度融入创作全流程 | Spring AI + RAG + 智能Agent |
| **体验流畅** | 无论写作还是阅读都如丝般顺滑 | React 19 + 虚拟线程 + 智能缓存 |
| **专业可靠** | 满足技术博主的所有专业需求 | LaTeX + 代码高亮 + Mermaid |

### 1.1.3 产品定位

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 产品定位                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                              目标用户群体                                        │
│                                   │                                             │
│                    ┌──────────────┼──────────────┐                              │
│                    │              │              │                              │
│                    ▼              ▼              ▼                              │
│              ┌──────────┐  ┌──────────┐  ┌──────────┐                           │
│              │ 技术博主  │  │ 独立开发者 │  │ 技术团队  │                           │
│              │          │  │          │  │          │                           │
│              │ 个人品牌  │  │ 项目展示  │  │ 技术博客  │                           │
│              │ 知识分享  │  │ 作品集   │  │ 团队文化  │                           │
│              └──────────┘  └──────────┘  └──────────┘                           │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│                              核心价值主张                                        │
│                                                                                 │
│      ┌────────────────────────────────────────────────────────────────┐        │
│      │                                                                │        │
│      │   「为追求极致的技术人，打造一款配得上其专业水准的博客系统」       │        │
│      │                                                                │        │
│      └────────────────────────────────────────────────────────────────┘        │
│                                                                                 │
│                              差异化竞争点                                        │
│                                                                                 │
│      ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│      │  🎨 设计美学 │ │  🤖 AI原生  │ │  ⚡ 极致性能 │ │  🔧 专业功能 │           │
│      │             │ │             │ │             │ │             │           │
│      │ 苹果级视觉  │ │ 智能创作    │ │ 毫秒响应    │ │ 技术写作    │           │
│      │ 流体动效    │ │ 语义搜索    │ │ 丝滑体验    │ │ 全面支持    │           │
│      └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.2 设计哲学：认知优雅

### 1.2.1 认知优雅的定义

**认知优雅（Cognitive Elegance）** 是 AetherBlog 的核心设计哲学。这一概念融合了认知心理学与设计美学，强调：

> 界面应当如空气般透明，通过精心设计的视觉层次和交互反馈，引导用户的注意力自然流动，而非通过繁杂的控件去抢夺注意力。

**认知优雅的三大支柱：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           认知优雅设计哲学                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                           ┌─────────────────┐                                   │
│                           │   认知优雅      │                                   │
│                           │ Cognitive       │                                   │
│                           │ Elegance        │                                   │
│                           └────────┬────────┘                                   │
│                                    │                                            │
│              ┌─────────────────────┼─────────────────────┐                      │
│              │                     │                     │                      │
│              ▼                     ▼                     ▼                      │
│     ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐            │
│     │   视觉透明      │   │   交互自然      │   │   内容优先      │            │
│     │   Visual        │   │   Natural       │   │   Content       │            │
│     │   Transparency  │   │   Interaction   │   │   First         │            │
│     ├─────────────────┤   ├─────────────────┤   ├─────────────────┤            │
│     │ • 毛玻璃效果    │   │ • 物理动效      │   │ • 留白设计      │            │
│     │ • 微妙阴影      │   │ • 手势响应      │   │ • 排版张力      │            │
│     │ • 渐变过渡      │   │ • 流体动画      │   │ • 视觉层次      │            │
│     │ • 光影流动      │   │ • 触觉反馈      │   │ • 焦点引导      │            │
│     └─────────────────┘   └─────────────────┘   └─────────────────┘            │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2.2 设计灵感来源

**Apple Design Language 启发：**

| 设计元素 | Apple 实现 | AetherBlog 应用 |
| --- | --- | --- |
| 毛玻璃效果 | macOS 窗口、iOS 控制中心 | 导航栏、卡片背景、模态框 |
| 阴影层次 | 多层阴影营造深度 | 悬浮卡片、按钮状态 |
| 动效曲线 | 弹簧物理动画 | 页面转场、列表加载 |
| 色彩运用 | 渐变与透明度 | 主题色系、强调色 |
| 排版规范 | SF Pro 字体系统 | 中文优化排版体系 |

**Microsoft Fluent Design 启发：**

| 设计元素 | Fluent 实现 | AetherBlog 应用 |
| --- | --- | --- |
| 深度系统 | Z轴层级管理 | 组件层叠规范 |
| 光照效果 | Reveal Highlight | 卡片悬浮光效 |
| 材质系统 | Acrylic 材质 | 背景材质处理 |
| 动作系统 | Connected Animations | 路由转场动画 |
| 缩放响应 | Responsive Breakpoints | 自适应布局 |

### 1.2.3 设计原则

**AetherBlog 十大设计原则：**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 设计原则                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  1️⃣ 内容至上 (Content First)                                             │   │
│  │     所有设计决策都应服务于内容的呈现与阅读体验                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  2️⃣ 克制美学 (Restrained Aesthetics)                                     │   │
│  │     避免过度装饰，用最少的元素传达最多的信息                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  3️⃣ 一致性 (Consistency)                                                 │   │
│  │     全站保持统一的视觉语言、交互模式和动效风格                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  4️⃣ 呼吸感 (Breathing Space)                                             │   │
│  │     充足的留白让内容呼吸，让视觉层次自然呈现                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  5️⃣ 即时反馈 (Instant Feedback)                                          │   │
│  │     每一个用户操作都应获得及时、优雅的视觉反馈                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  6️⃣ 流畅动效 (Fluid Motion)                                              │   │
│  │     动效应当自然、流畅，符合物理直觉                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  7️⃣ 可达性 (Accessibility)                                               │   │
│  │     确保所有用户都能无障碍地使用系统                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  8️⃣ 性能优先 (Performance First)                                         │   │
│  │     视觉效果不应以牺牲性能为代价                                            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  9️⃣ 渐进增强 (Progressive Enhancement)                                   │   │
│  │     核心功能优先保证，高级特性作为增强                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  🔟 情感化设计 (Emotional Design)                                         │   │
│  │     通过微交互和细节处理，建立与用户的情感连接                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.3 用户画像与场景分析

### 1.3.1 核心用户画像

**用户角色一：技术博主（Primary Persona）**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           👨‍💻 用户画像：技术博主                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐                                                          │
│  │                  │   姓名：Alex Chen                                         │
│  │    [头像区域]     │   年龄：28岁                                              │
│  │                  │   职业：高级后端工程师                                      │
│  │                  │   技术栈：Java/Go/Kubernetes                              │
│  └──────────────────┘                                                          │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              用户背景                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 5年开发经验，目前在一线互联网公司担任技术专家                            │   │
│  │  • 热衷于技术分享，希望建立个人技术品牌                                     │   │
│  │  • 对设计有追求，不满足于普通博客模板的"程序员审美"                         │   │
│  │  • 追求效率，希望专注于内容创作而非系统维护                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心需求                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ✅ 专业的代码展示：语法高亮、代码折叠、一键复制                            │   │
│  │  ✅ 完善的 Markdown 支持：表格、公式、图表、脚注                            │   │
│  │  ✅ 高颜值设计：能够体现其技术品味和专业形象                                │   │
│  │  ✅ AI 辅助写作：帮助润色、生成摘要、自动打标签                             │   │
│  │  ✅ 流量分析：了解读者行为，优化内容策略                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              痛点问题                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ❌ WordPress 太臃肿，配置复杂，主题审美一般                               │   │
│  │  ❌ Hexo/Hugo 每次更新需要重新构建部署，效率低                              │   │
│  │  ❌ 掘金/CSDN 等平台广告多，无法体现个人品牌                                │   │
│  │  ❌ 写作时需要频繁切换工具：写作、AI润色、图床上传                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              期望价值                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  💡 一个能够代表"技术大佬"身份的数字化名片                                  │   │
│  │  💡 写作体验流畅，AI助手随叫随到                                           │   │
│  │  💡 读者能够沉浸式阅读，提升内容传播效果                                    │   │
│  │  💡 一键部署，专注内容而非运维                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**用户角色二：技术阅读者（续）**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           👩‍💻 用户画像：技术阅读者（续）                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心需求                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ✅ 快速加载：不愿意等待超过3秒                                           │   │
│  │  ✅ 清晰的内容结构：目录导航、章节跳转                                      │   │
│  │  ✅ 优秀的代码阅读体验：高亮、复制、折叠                                    │   │
│  │  ✅ 移动端适配：在通勤时也能舒适阅读                                        │   │
│  │  ✅ 相关推荐：发现更多感兴趣的内容                                          │   │
│  │  ✅ 搜索功能：快速定位需要的信息                                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              痛点问题                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  ❌ 很多博客页面加载缓慢，充斥着广告                                        │   │
│  │  ❌ 代码无法一键复制，格式复制后错乱                                        │   │
│  │  ❌ 移动端阅读体验差，排版混乱                                             │   │
│  │  ❌ 搜索功能弱，无法找到想要的内容                                          │   │
│  │  ❌ 文章之间缺乏关联，阅读后不知道看什么                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              期望体验                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  💡 页面秒开，无广告干扰                                                  │   │
│  │  💡 阅读体验舒适，像翻阅精美杂志                                           │   │
│  │  💡 代码可以直接复制使用                                                  │   │
│  │  💡 能够用自然语言搜索问题                                                │   │
│  │  💡 发现优质相关内容，持续学习                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**用户角色三：AI代理（System Persona）**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           🤖 用户画像：AI代理                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐                                                          │
│  │                  │   名称：AetherMind                                        │
│  │    [AI图标]      │   类型：系统内置智能代理                                    │
│  │                  │   角色：创作助手 + 内容分析师                               │
│  │                  │   能力：理解、生成、分析、推荐                               │
│  └──────────────────┘                                                          │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              代理定位                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  AI代理不是一个可见的用户，而是一个隐形的系统协作者。                         │   │
│  │  它在后台持续运行，默默地为博主和读者提供智能化服务。                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              核心职责                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │  │  📝 写作助手 │  │  🏷️ 智能标签 │  │  📊 内容分析 │  │  🔍 语义搜索 │     │   │
│  │  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤     │   │
│  │  │• 文本清洗   │  │• 自动生成   │  │• 向量化存储 │  │• 问答检索   │     │   │
│  │  │• 内容重写   │  │• 关键词提取 │  │• 知识图谱   │  │• 相关推荐   │     │   │
│  │  │• 风格转换   │  │• 分类推荐   │  │• 阅读分析   │  │• 智能问答   │     │   │
│  │  │• 摘要生成   │  │• SEO优化    │  │• 趋势预测   │  │• 模糊匹配   │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                              工作模式                                    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  【主动模式】                                                             │   │
│  │  • 新文章发布时自动生成摘要和标签                                          │   │
│  │  • 定期更新文章的语义向量                                                  │   │
│  │  • 分析访客行为优化推荐算法                                                │   │
│  │                                                                          │   │
│  │  【被动模式】                                                             │   │
│  │  • 响应博主的写作辅助请求                                                  │   │
│  │  • 处理读者的语义搜索查询                                                  │   │
│  │  • 根据上下文生成智能回复                                                  │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.3.2 用户场景分析

**场景一：博主创作场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        📝 场景一：技术博客创作流程                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Alex 刚完成一个复杂的技术方案，想要将实践经验整理成博客文章。               │   │
│  │  他有大量的笔记、代码片段和设计图，需要整理成一篇结构清晰的技术博客。         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  用户旅程                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  Step 1: 登录后台                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 打开管理后台，进入文章编辑页面                                          │   │
│  │  ↓ 系统展示简洁的Markdown编辑器界面                                        │   │
│  │                                                                          │   │
│  │  Step 2: 粘贴素材                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 将笔记软件中的内容直接粘贴                                              │   │
│  │  ↓ 系统自动检测到格式混乱                                                  │   │
│  │  ↓ AI助手提示：「检测到格式问题，是否自动清洗？」                           │   │
│  │  ↓ 点击确认，AI 自动修复格式、统一标点、优化排版                            │   │
│  │                                                                          │   │
│  │  Step 3: 插入代码                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 使用 ```java 语法插入代码块                                            │   │
│  │  ↓ 编辑器实时渲染语法高亮                                                  │   │
│  │  ↓ 超长代码自动显示「折叠」按钮                                            │   │
│  │                                                                          │   │
│  │  Step 4: 插入公式和图表                                                   │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 使用 $$ 语法插入 LaTeX 公式                                            │   │
│  │  ↓ 使用 ```mermaid 插入流程图                                             │   │
│  │  ↓ 编辑器实时预览渲染效果                                                  │   │
│  │                                                                          │   │
│  │  Step 5: 上传图片                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 直接粘贴截图或拖拽图片文件                                              │   │
│  │  ↓ 系统自动上传至配置的图床（本地/腾讯云COS）                               │   │
│  │  ↓ 自动生成居中的Markdown图片语法                                          │   │
│  │  ↓ 图片自动压缩优化                                                       │   │
│  │                                                                          │   │
│  │  Step 6: AI 辅助优化                                                     │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 选中一段文字，点击「AI润色」                                            │   │
│  │  ↓ 选择风格：更学术 / 更通俗 / 更简洁                                      │   │
│  │  ↓ AI 返回优化后的版本，可预览对比                                         │   │
│  │  ↓ 确认采用或继续微调                                                     │   │
│  │                                                                          │   │
│  │  Step 7: 生成摘要和标签                                                   │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 点击「智能摘要」按钮                                                    │   │
│  │  ↓ AI 分析全文，生成100字以内的精炼摘要                                    │   │
│  │  ↓ 同时推荐5个最相关的标签                                                 │   │
│  │  ↓ 博主可编辑调整后确认                                                    │   │
│  │                                                                          │   │
│  │  Step 8: 预览发布                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 切换到预览模式，查看最终效果                                            │   │
│  │  ↓ 查看字数统计、预估阅读时间                                              │   │
│  │  ↓ 选择立即发布或定时发布                                                  │   │
│  │  ↓ 文章发布后自动进行向量化索引                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  系统响应要求                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 编辑器响应：< 50ms（输入无延迟）                                        │   │
│  │  • 图片上传：< 3s（含压缩处理）                                            │   │
│  │  • AI 响应：首字 < 500ms（流式输出）                                       │   │
│  │  • 预览渲染：< 200ms                                                      │   │
│  │  • 发布操作：< 1s                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**场景二：读者阅读场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        📖 场景二：技术文章阅读流程                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Lisa 在调试 Java 应用时遇到内存溢出问题，通过搜索引擎找到了 Alex 的       │   │
│  │  博客文章。她需要快速定位解决方案并理解原理。                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  用户旅程                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  Step 1: 首次访问                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 通过 Google 搜索结果点击进入                                           │   │
│  │  ↓ 页面在 1 秒内完成加载                                                  │   │
│  │  ↓ 首次访问展示欢迎动画（可跳过）                                          │   │
│  │  ↓ 文章内容清晰呈现，无广告干扰                                            │   │
│  │                                                                          │   │
│  │  Step 2: 快速导航                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 右侧显示文章目录（Table of Contents）                                  │   │
│  │  ↓ 点击目录项平滑滚动到对应章节                                            │   │
│  │  ↓ 当前阅读位置在目录中高亮标识                                            │   │
│  │                                                                          │   │
│  │  Step 3: 代码交互                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 找到相关代码片段                                                       │   │
│  │  ↓ 点击「复制」按钮，代码复制到剪贴板                                      │   │
│  │  ↓ 按钮显示「已复制 ✓」反馈                                               │   │
│  │  ↓ 长代码块点击展开查看完整内容                                            │   │
│  │                                                                          │   │
│  │  Step 4: 深入阅读                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 阅读包含数学公式的性能分析部分                                          │   │
│  │  ↓ 公式渲染清晰，可点击放大查看                                            │   │
│  │  ↓ 流程图直观展示调优步骤                                                  │   │
│  │                                                                          │   │
│  │  Step 5: 智能搜索                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 想了解更多相关内容                                                     │   │
│  │  ↓ 使用搜索框输入「如何分析堆内存」                                        │   │
│  │  ↓ 系统返回语义相关的文章列表                                              │   │
│  │  ↓ 同时展示 AI 生成的直接回答摘要                                          │   │
│  │                                                                          │   │
│  │  Step 6: 继续探索                                                        │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 文章底部展示「相关推荐」卡片                                            │   │
│  │  ↓ 推荐内容基于语义相似度计算                                              │   │
│  │  ↓ 点击进入下一篇继续阅读                                                  │   │
│  │  ↓ 页面转场动画流畅自然                                                    │   │
│  │                                                                          │   │
│  │  Step 7: 时间树浏览                                                      │   │
│  │  ────────────────────────────────────────────────────────────────────    │   │
│  │  ↓ 点击导航栏「归档」进入时间树                                            │   │
│  │  ↓ 以年份-月份层级展示历史文章                                             │   │
│  │  ↓ 点击年份平滑展开月份列表                                               │   │
│  │  ↓ 发现更多感兴趣的历史文章                                               │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  体验指标要求                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  • 首屏加载 (FCP)：< 1.0s                                                │   │
│  │  • 可交互时间 (TTI)：< 1.5s                                              │   │
│  │  • 页面转场：< 300ms                                                     │   │
│  │  • 搜索响应：< 500ms                                                     │   │
│  │  • 滚动帧率：稳定 60fps                                                  │   │
│  │  • 移动端适配：完美响应式                                                 │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**场景三：博主管理场景**

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        ⚙️ 场景三：后台管理与监控                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  场景描述                                                                │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │  Alex 想要了解博客的运营状况，检查系统健康状态，并管理友链和配置。            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  核心管理场景                                                            │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  【仪表盘概览】                                                           │   │
│  │  • 今日/本周/本月访问量趋势图                                              │   │
│  │  • 热门文章 Top 10 排行                                                   │   │
│  │  • 访客地理分布热力图                                                     │   │
│  │  • 设备类型占比饼图                                                       │   │
│  │  • 系统资源实时监控（CPU/内存/JVM）                                        │   │
│  │                                                                          │   │
│  │  【文章管理】                                                             │   │
│  │  • 文章列表（草稿/已发布/定时发布）                                        │   │
│  │  • 批量操作（删除/归档/更改分类）                                          │   │
│  │  • 文章数据统计（阅读/点赞/评论）                                          │   │
│  │                                                                          │   │
│  │  【媒体库管理】                                                           │   │
│  │  • 图片/附件统一管理                                                      │   │
│  │  • 存储空间使用情况                                                       │   │
│  │  • 切换存储策略（本地/云存储）                                             │   │
│  │                                                                          │   │
│  │  【友链管理】                                                             │   │
│  │  • 添加/编辑/删除友链                                                     │   │
│  │  • 友链卡片样式预览                                                       │   │
│  │  • 友链状态检测（是否可访问）                                              │   │
│  │                                                                          │   │
│  │  【系统设置】                                                             │   │
│  │  • 站点基础信息配置                                                       │   │
│  │  • 博主个人信息编辑                                                       │   │
│  │  • 存储配置（图床切换）                                                    │   │
│  │  • AI 服务配置（API Key/Prompt管理）                                      │   │
│  │  • 主题与外观设置                                                         │   │
│  │                                                                          │   │
│  │  【日志与监控】                                                           │   │
│  │  • 系统运行日志查看                                                       │   │
│  │  • 错误日志筛选与告警                                                     │   │
│  │  • API 调用统计                                                          │   │
│  │  • 慢请求分析                                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.4 竞品分析与差异化定位

### 1.4.1 竞品全景分析

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              竞品分析矩阵（续）                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Hexo / Hugo                                                             │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：静态站点生成器，适合技术博客                                        │   │
│  │  技术栈：Node.js (Hexo) / Go (Hugo)                                      │   │
│  │  优势：部署简单、性能极佳、无服务器成本                                     │   │
│  │  劣势：无动态功能、每次更新需重新构建、AI集成困难                           │   │
│  │  适用场景：纯静态内容展示、对动态功能无需求的场景                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Ghost                                                                   │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：专注于写作的现代化博客平台                                          │   │
│  │  技术栈：Node.js + Ember.js                                              │   │
│  │  优势：设计现代、专注写作体验、会员订阅功能                                 │   │
│  │  劣势：技术栈相对小众、定制成本高、AI功能基础                              │   │
│  │  商业模式：开源自托管 + 付费托管服务                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Notion / 语雀                                                           │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：知识管理与协作平台，可作为博客使用                                   │   │
│  │  优势：编辑体验优秀、协作功能强大、AI集成逐步完善                           │   │
│  │  劣势：SEO较弱、定制性有限、品牌展示不够独立                               │   │
│  │  适用场景：团队知识库、轻量级内容发布                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  掘金 / CSDN / 博客园                                                    │   │
│  │  ─────────────────────────────────────────────────────────────────────   │   │
│  │  定位：技术社区平台                                                       │   │
│  │  优势：自带流量、社区互动、无需维护                                        │   │
│  │  劣势：广告干扰、难以建立个人品牌、内容归属权问题                           │   │
│  │  适用场景：快速发布、社区推广                                              │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.4.2 竞品功能对比矩阵

| 功能维度 | WordPress | Hexo/Hugo | Ghost | Notion | **AetherBlog** |
| --- | --- | --- | --- | --- | --- |
| **部署方式** | 动态服务 | 静态生成 | 动态服务 | SaaS | 动态服务 |
| **技术栈** | PHP | Node/Go | Node.js | 闭源  | **Java 21** |
| **设计美感** | ⭐⭐  | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **⭐⭐⭐⭐⭐** |
| **性能表现** | ⭐⭐  | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | **⭐⭐⭐⭐⭐** |
| **Markdown** | 插件  | ✅ 原生 | ✅ 原生 | ✅ 原生 | **✅ 增强** |
| **数学公式** | 插件  | 插件  | 有限  | ✅   | **✅ 原生** |
| **代码高亮** | 插件  | 主题  | ✅   | ✅   | **✅ IDE级** |
| **Mermaid图表** | 插件  | 插件  | ❌   | ❌   | **✅ 原生** |
| **AI写作** | ❌   | ❌   | 基础  | ✅   | **✅ 深度** |
| **AI标签** | ❌   | ❌   | ❌   | ❌   | **✅** |
| **语义搜索** | ❌   | ❌   | ❌   | 有限  | **✅ RAG** |
| **流量统计** | 插件  | 第三方 | 内置  | 有限  | **✅ 自研** |
| **后台管理** | 复杂  | 无   | 简洁  | 简洁  | **✅ 专业** |
| **开源免费** | ✅   | ✅   | ✅   | ❌   | **✅** |

### 1.4.3 差异化竞争策略

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 差异化定位                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                              核心差异化优势                                      │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点一：      │   🎨 极致设计美学                                  │   │
│  │   │  设计层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • 参考 Apple/Microsoft 设计语言                   │   │
│  │   │                 │   • Glassmorphism 毛玻璃效果                        │   │
│  │   │                 │   • Framer Motion 物理动效                         │   │
│  │   │                 │   • 远超传统博客的视觉品质                           │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点二：      │   🤖 AI 原生集成                                   │   │
│  │   │  智能层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • Spring AI 深度集成                             │   │
│  │   │                 │   • 智能写作助手（清洗/重写/润色）                    │   │
│  │   │                 │   • 自动标签与摘要生成                              │   │
│  │   │                 │   • RAG 语义搜索                                   │   │
│  │   │                 │   • 可自定义 Prompt 模板                            │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点三：      │   ⚡ 现代技术架构                                  │   │
│  │   │  技术层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • JDK 21 虚拟线程（高并发支持）                    │   │
│  │   │                 │   • Spring Boot 3.4+（最新特性）                    │   │
│  │   │                 │   • PostgreSQL 17 + pgvector                       │   │
│  │   │                 │   • React 19（并发渲染）                            │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  │   ┌─────────────────┐                                                    │   │
│  │   │  差异点四：      │   🔧 专业技术写作支持                               │   │
│  │   │  功能层面       │   ─────────────────────────────────────────────    │   │
│  │   │                 │   • LaTeX 数学公式原生支持                          │   │
│  │   │                 │   • IDE 级代码展示体验                              │   │
│  │   │                 │   • Mermaid 图表原生渲染                            │   │
│  │   │                 │   • 附件加密安全分发                                │   │
│  │   └─────────────────┘                                                    │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           目标市场定位                                   │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  目标用户：追求极致的技术人                                                │   │
│  │  ──────────────────────────────────────────────────────────────────────  │   │
│  │                                                                          │   │
│  │  他们是：                                                                 │   │
│  │  • 对代码有洁癖的完美主义者                                               │   │
│  │  • 追求效率的工具控                                                       │   │
│  │  • 重视个人品牌的技术领袖                                                 │   │
│  │  • 愿意为优质体验付费的专业人士                                            │   │
│  │                                                                          │   │
│  │  他们不满足于：                                                           │   │
│  │  • WordPress 的臃肿和老旧                                                 │   │
│  │  • Hexo 的静态限制                                                       │   │
│  │  • 第三方平台的广告和品牌稀释                                              │   │
│  │                                                                          │   │
│  │  他们渴望：                                                               │   │
│  │  • 一个能够代表其专业水准的数字化名片                                       │   │
│  │  • AI 赋能的高效创作体验                                                  │   │
│  │  • 极致的阅读与视觉体验                                                   │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 1.5 商业模式与价值主张

### 1.5.1 商业模式画布

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 商业模式画布                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌───────────────────┬───────────────────┬───────────────────────────────────┐ │
│  │    关键合作伙伴    │     关键活动      │           价值主张                │ │
│  ├───────────────────┼───────────────────┼───────────────────────────────────┤ │
│  │                   │                   │                                   │ │
│  │  • OpenAI/Claude  │  • 产品研发       │  「为追求极致的技术人，打造       │ │
│  │  • 云服务商       │  • 社区运营       │    配得上其专业水准的博客系统」   │ │
│  │  • CDN 服务商     │  • 技术支持       │                                   │ │
│  │  • 开源社区       │  • 内容营销       │  核心价值：                       │ │
│  │                   │                   │  • 极致设计美学                   │ │
│  │                   │                   │  • AI 原生创作体验                │ │
│  │                   │                   │  • 专业技术写作支持               │ │
│  │                   │                   │  • 高性能架构                     │ │
│  │                   │                   │                                   │ │
│  ├───────────────────┼───────────────────┼─────────────────┬─────────────────┤ │
│  │     关键资源      │                   │    客户关系     │    渠道通路     │ │
│  ├───────────────────┤                   ├─────────────────┼─────────────────┤ │
│  │                   │                   │                 │                 │ │
│  │  • 技术团队       │                   │  • 开源社区     │  • GitHub       │ │
│  │  • 开源代码库     │                   │  • 技术文档     │  • 技术博客     │ │
│  │  • 设计系统       │                   │  • Issue支持    │  • 技术社区     │ │
│  │  • AI 能力       │                   │  • Discord社群  │  • 口碑传播     │ │
│  │                   │                   │                 │  • SEO          │ │
│  │                   │                   │                 │                 │ │
│  ├───────────────────┴───────────────────┼─────────────────┴─────────────────┤ │
│  │              成本结构                  │             收入来源              │ │
│  ├────────────────────────────────────────┼───────────────────────────────────┤ │
│  │                                        │                                   │ │
│  │  • 研发人力成本                        │  • 开源版本：免费                  │ │
│  │  • 云服务基础设施                      │  • Pro 订阅：¥99/年               │ │
│  │  • AI API 调用成本                    │  • Team 版本：¥499/年             │ │
│  │  • 运营推广成本                        │  • Enterprise：定制报价            │ │
│  │                                        │  • 托管服务 (SaaS)                │ │
│  │                                        │  • 主题/插件市场                  │ │
│  │                                        │  • 技术咨询服务                   │ │
│  │                                        │                                   │ │
│  └────────────────────────────────────────┴───────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5.2 版本定价策略

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 版本矩阵                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐│
│  │   Community     │  │      Pro        │  │      Team       │  │  Enterprise ││
│  │   社区版        │  │     专业版       │  │     团队版       │  │    企业版   ││
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────┤│
│  │                 │  │                 │  │                 │  │             ││
│  │     免费        │  │   ¥99/年       │  │   ¥499/年      │  │   定制报价  ││
│  │                 │  │                 │  │                 │  │             ││
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────┤│
│  │                 │  │                 │  │                 │  │             ││
│  │ ✅ 全部基础功能 │  │ ✅ 全部基础功能  │  │ ✅ 全部基础功能  │  │ ✅ 全部功能 ││
│  │ ✅ Markdown+   │  │ ✅ Markdown+    │  │ ✅ Markdown+    │  │ ✅ 私有部署 ││
│  │ ✅ 代码高亮     │  │ ✅ 代码高亮     │  │ ✅ 代码高亮      │  │ ✅ 定制开发 ││
│  │ ✅ 数学公式     │  │ ✅ 数学公式     │  │ ✅ 数学公式      │  │ ✅ SLA保障  ││
│  │ ✅ 基础AI功能   │  │ ✅ 完整AI功能   │  │ ✅ 完整AI功能    │  │ ✅ 专属支持 ││
│  │ ✅ 本地图床     │  │ ✅ 云存储集成   │  │ ✅ 云存储集成    │  │ ✅ 培训服务 ││
│  │ ❌ 高级AI功能   │  │ ✅ 优先客服     │  │ ✅ 多用户管理    │  │             ││
│  │ ❌ 云存储集成   │  │ ✅ 高级统计     │  │ ✅ 权限控制      │  │             ││
│  │                 │  │ ✅ 自定义Prompt │  │ ✅ 协作编辑      │  │             ││
│  │                 │  │                 │  │ ✅ 审核流程      │  │             ││
│  │                 │  │                 │  │                 │  │             ││
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────┘│
│                                                                                 │
│       适合：                适合：              适合：              适合：       │
│    个人开发者           专业技术博主         技术团队/公司       大型企业      │
│    学习体验             个人品牌建设         团队技术博客        合规要求高    │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5.3 价值主张声明

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AetherBlog 价值主张                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                          │   │
│  │   「 AetherBlog 不只是一个博客系统，                                      │   │
│  │                                                                          │   │
│  │      它是您技术实力的数字化名片，                                          │   │
│  │                                                                          │   │
│  │      是您创作思想的优雅容器，                                              │   │
│  │                                                                          │   │
│  │      是与 AI 协作的智能工作台。」                                          │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           核心价值承诺                                   │   │
│  ├─────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │   对博主的承诺：                                                          │   │
│  │   ─────────────────────────────────────────────────────────────────────  │   │
│  │   📝 让您专注于创作，而非与工具搏斗                                        │   │
│  │   🤖 AI 助手随时待命，让写作事半功倍                                       │   │
│  │   🎨 您的博客将成为品味与专业的象征                                        │   │
│  │   📊 深度洞察读者行为，优化内容策略                                        │   │
│  │                                                                          │   │
│  │   对读者的承诺：                                                          │   │
│  │   ─────────────────────────────────────────────────────────────────────  │   │
│  │   ⚡ 页面秒开，零等待阅读体验                                             │   │
│  │   📖 沉浸式阅读，如翻阅精美杂志                                            │   │
│  │   🔍 智能搜索，快速找到所需内容                                            │   │
│  │   💻 专业代码展示，一键复制即用                                            │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

# 第二部分：技术架构顶层设计

## 2.1 系统架构全景图

# AetherBlog 智能博客系统

# 产品需求企划书与技术详细设计文档（续三）

---

# 第二部分：技术架构顶层设计

## 2.1 系统架构全景图

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AetherBlog 系统架构全景图                                           │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        🌐 接入层                                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                 CDN + WAF + DDoS 防护                                      │ │  │
│    │   │                          Cloudflare / 腾讯云CDN / 阿里云CDN                                 │ │  │
│    │   │                     静态资源加速 | HTTPS终结 | 边缘缓存 | 攻击防护                          │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                    ┌───────────────┴───────────────┐                                     │
│                                    │                               │                                     │
│                                    ▼                               ▼                                     │
│    ┌────────────────────────────────────────────┐   ┌────────────────────────────────────────────┐      │
│    │              🖥️ 博客前台                    │   │              🔧 管理后台                    │      │
│    │          Blog Frontend (SSR/CSR)           │   │          Admin Dashboard (SPA)             │      │
│    ├────────────────────────────────────────────┤   ├────────────────────────────────────────────┤      │
│    │                                            │   │                                            │      │
│    │  框架: React 19 + Next.js 15               │   │  框架: React 19 + Vite 5                   │      │
│    │  样式: Tailwind CSS v4 + Shadcn/UI         │   │  样式: Tailwind CSS v4 + Shadcn/UI         │      │
│    │  动效: Framer Motion 11                    │   │  图表: Recharts + Apache ECharts           │      │
│    │  状态: Zustand + TanStack Query            │   │  状态: Zustand + TanStack Query            │      │
│    │                                            │   │                                            │      │
│    │  页面模块:                                  │   │  页面模块:                                  │      │
│    │  • 🏠 首页 (Hero + 文章列表)                │   │  • 📊 仪表盘 (数据概览)                     │      │
│    │  • 📄 文章详情 (Markdown渲染)              │   │  • 📝 文章管理 (CRUD + 编辑器)              │      │
│    │  • 📁 归档页 (时间树)                       │   │  • 🖼️ 媒体库 (图片/附件)                    │      │
│    │  • 🏷️ 分类/标签页                          │   │  • 📈 统计分析 (流量/行为)                  │      │
│    │  • 🔍 搜索页 (AI语义搜索)                  │   │  • 🤖 AI工具 (写作助手)                     │      │
│    │  • 🔗 友链页 (卡片展示)                    │   │  • ⚙️ 系统设置 (站点/存储)                  │      │
│    │  • 👤 关于页 (博主介绍)                    │   │  • 📋 日志监控 (系统日志)                   │      │
│    │                                            │   │                                            │      │
│    └────────────────────────────────────────────┘   └────────────────────────────────────────────┘      │
│                                    │                               │                                     │
│                                    └───────────────┬───────────────┘                                     │
│                                                    │ HTTPS / REST API / WebSocket                        │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        🚪 网关层                                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                              Nginx / Spring Cloud Gateway                                  │ │  │
│    │   │                                                                                            │ │  │
│    │   │    ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │ │  │
│    │   │    │ 路由转发  │ │ JWT验证  │ │ 限流熔断  │ │ 日志追踪  │ │ 跨域处理  │ │ 负载均衡  │          │ │  │
│    │   │    └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘          │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    ☕ 业务服务层 (Spring Boot 3.4+)                               │  │
│    │                                         JDK 21 + Virtual Threads                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │   📝 博客服务     │  │   👤 用户服务     │  │   🖼️ 媒体服务     │  │   📊 统计服务     │  │ │  │
│    │   │   │   Blog Service   │  │   User Service   │  │   Media Service  │  │ Analytics Service│  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ • 文章CRUD       │  │ • 用户认证       │  │ • 图片上传       │  │ • 访问统计       │  │ │  │
│    │   │   │ • 分类管理       │  │ • JWT签发        │  │ • 文件管理       │  │ • 行为分析       │  │ │  │
│    │   │   │ • 标签管理       │  │ • 权限校验       │  │ • 图床切换       │  │ • 热门排行       │  │ │  │
│    │   │   │ • 评论管理       │  │ • 会话管理       │  │ • 附件加密       │  │ • 地域分布       │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │   🔍 搜索服务     │  │   🔔 通知服务     │  │   ⚙️ 配置服务     │  │   🔗 友链服务     │  │ │  │
│    │   │   │  Search Service  │  │  Notify Service  │  │  Config Service  │  │  FriendLink Svc  │  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ • 全文检索       │  │ • 邮件通知       │  │ • 站点配置       │  │ • 友链管理       │  │ │  │
│    │   │   │ • 语义搜索       │  │ • Webhook推送    │  │ • 主题设置       │  │ • 状态检测       │  │ │  │
│    │   │   │ • 混合检索       │  │ • 异常告警       │  │ • 存储配置       │  │ • 卡片样式       │  │ │  │
│    │   │   │ • 相关推荐       │  │ • 定时任务       │  │ • AI配置         │  │ • 自动申请       │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    🤖 AI 能力层 (Spring AI 1.0+)                                  │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              AI Agent 编排引擎                                      │  │ │  │
│    │   │   │                        LangChain4j / Spring AI Advisors                            │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                            │                                              │ │  │
│    │   │          ┌─────────────────┬───────────────┼───────────────┬─────────────────┐            │ │  │
│    │   │          │                 │               │               │                 │            │ │  │
│    │   │          ▼                 ▼               ▼               ▼                 ▼            │ │  │
│    │   │   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐     │ │  │
│    │   │   │ 📝 写作Agent│   │ 🏷️ 标签Agent│   │ 📋 摘要Agent│   │ 🔍 搜索Agent│   │ 🧹 清洗Agent│     │ │  │
│    │   │   ├────────────┤   ├────────────┤   ├────────────┤   ├────────────┤   ├────────────┤     │ │  │
│    │   │   │• 内容重写  │   │• 智能标签  │   │• 摘要生成  │   │• RAG检索   │   │• 格式清洗  │     │ │  │
│    │   │   │• 风格转换  │   │• 关键词    │   │• SEO描述   │   │• 语义问答  │   │• 排版优化  │     │ │  │
│    │   │   │• 续写建议  │   │• 分类推荐  │   │• 多语言    │   │• 相关推荐  │   │• 标点修正  │     │ │  │
│    │   │   └────────────┘   └────────────┘   └────────────┘   └────────────┘   └────────────┘     │ │  │
│    │   │                                            │                                              │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              Prompt 模板管理器                                      │  │ │  │
│    │   │   │                   内置模板 + 自定义模板 + 版本管理 + A/B测试                         │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                            │                                              │ │  │
│    │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │ │  │
│    │   │   │                              LLM 模型适配层                                         │  │ │  │
│    │   │   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐             │  │ │  │
│    │   │   │  │ OpenAI   │  │ Claude   │  │ 通义千问  │  │ DeepSeek │  │ Ollama   │             │  │ │  │
│    │   │   │  │ GPT-4o   │  │ Sonnet   │  │ Qwen-Max │  │ V3       │  │ 本地模型 │             │  │ │  │
│    │   │   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘             │  │ │  │
│    │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                        💾 数据存储层                                              │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │  │
│    │   │   │  🐘 PostgreSQL   │  │   🔴 Redis       │  │  🔍 Elasticsearch │  │   📦 对象存储     │  │ │  │
│    │   │   │      17          │  │     7.2+         │  │       8.x        │  │   MinIO/COS      │  │ │  │
│    │   │   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤  │ │  │
│    │   │   │ 主数据存储       │  │ 缓存层           │  │ 搜索引擎         │  │ 文件存储         │  │ │  │
│    │   │   │ • 用户数据       │  │ • Session缓存    │  │ • 全文检索       │  │ • 图片存储       │  │ │  │
│    │   │   │ • 文章内容       │  │ • 热点数据       │  │ • 向量检索       │  │ • 附件存储       │  │ │  │
│    │   │   │ • 配置信息       │  │ • 限流计数       │  │ • 日志索引       │  │ • 备份存储       │  │ │  │
│    │   │   │                  │  │ • 分布式锁       │  │ • 混合搜索       │  │ • CDN源站        │  │ │  │
│    │   │   │ ┌──────────────┐ │  │                  │  │                  │  │                  │  │ │  │
│    │   │   │ │  pgvector    │ │  │                  │  │ ┌──────────────┐ │  │ 存储策略:        │  │ │  │
│    │   │   │ │  向量扩展     │ │  │                  │  │ │ Dense Vector │ │  │ • 本地存储       │  │ │  │
│    │   │   │ │  • 文章嵌入   │ │  │                  │  │ │ 8.x 向量搜索 │ │  │ • 腾讯云COS      │  │ │  │
│    │   │   │ │  • HNSW索引   │ │  │                  │  │ └──────────────┘ │  │ • 阿里云OSS      │  │ │  │
│    │   │   │ └──────────────┘ │  │                  │  │                  │  │ • AWS S3         │  │ │  │
│    │   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘  │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                    │                                                     │
│                                                    ▼                                                     │
│    ┌──────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                       🔧 基础设施层                                               │  │
│    │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │  │
│    │   │                                                                                            │ │  │
│    │   │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐          │ │  │
│    │   │   │  🐳 Docker     │  │  ⚙️ CI/CD      │  │  📈 监控告警    │  │  📋 日志系统    │          │ │  │
│    │   │   │  Compose/K8s   │  │  GitHub Actions│  │  Prometheus    │  │  ELK Stack     │          │ │  │
│    │   │   ├────────────────┤  ├────────────────┤  ├────────────────┤  ├────────────────┤          │ │  │
│    │   │   │ • 容器化部署   │  │ • 自动构建     │  │ • 指标采集     │  │ • 日志收集     │          │ │  │
│    │   │   │ • 服务编排     │  │ • 自动测试     │  │ • Grafana可视化│  │ • 日志分析     │          │ │  │
│    │   │   │ • 弹性伸缩     │  │ • 自动部署     │  │ • 告警通知     │  │ • 日志检索     │          │ │  │
│    │   │   │ • 健康检查     │  │ • 版本回滚     │  │ • 链路追踪     │  │ • 审计日志     │          │ │  │
│    │   │   └────────────────┘  └────────────────┘  └────────────────┘  └────────────────┘          │ │  │
│    │   │                                                                                            │ │  │
│    │   └────────────────────────────────────────────────────────────────────────────────────────────┘ │  │
│    └──────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 2.2 技术选型决策矩阵

### 2.2.1 技术选型总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        技术选型决策矩阵                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  层级          │  技术选型                    │  版本        │  选型理由                            │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  前端框架      │  React                       │  19.x        │  并发渲染、Hooks生态、社区活跃        │ │
│   │  构建工具      │  Vite / Next.js              │  5.x / 15.x  │  极速HMR、SSR支持                    │ │
│   │  类型系统      │  TypeScript                  │  5.4+        │  类型安全、重构友好                   │ │
│   │  状态管理      │  Zustand + TanStack Query    │  Latest      │  轻量、服务端状态管理优秀             │ │
│   │  UI组件库      │  Shadcn/UI + Radix UI        │  Latest      │  无障碍、高度可定制                   │ │
│   │  CSS框架       │  Tailwind CSS                │  4.x         │  原子化、JIT编译                     │ │
│   │  动画库        │  Framer Motion               │  11.x        │  声明式、物理动画                    │ │
│   │  Markdown      │  MDX + unified               │  Latest      │  组件嵌入、AST转换                   │ │
│   │  代码高亮      │  Shiki                       │  1.x         │  VS Code主题兼容                     │ │
│   │  数学公式      │  KaTeX                       │  0.16+       │  性能优于MathJax                     │ │
│   │  图表         │  Mermaid + Recharts          │  Latest      │  流程图、数据可视化                   │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  JDK          │  Eclipse Temurin             │  21 LTS      │  虚拟线程、模式匹配、Record类         │ │
│   │  核心框架      │  Spring Boot                 │  3.4+        │  云原生、GraalVM兼容                  │ │
│   │  构建工具      │  Maven                       │  3.9+        │  成熟稳定、插件丰富                   │ │
│   │  安全框架      │  Spring Security             │  6.x         │  OAuth2.1、JWT支持                   │ │
│   │  数据访问      │  Spring Data JPA             │  3.x         │  类型安全查询                        │ │
│   │  API文档       │  SpringDoc OpenAPI           │  2.x         │  Swagger UI自动生成                  │ │
│   │  参数校验      │  Jakarta Validation          │  3.x         │  声明式校验                          │ │
│   │  对象映射      │  MapStruct                   │  1.5+        │  编译时生成、零反射                   │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  AI框架        │  Spring AI                   │  1.0.0+      │  Spring原生、统一抽象                 │ │
│   │  Agent编排     │  LangChain4j (可选)          │  0.31+       │  复杂Agent场景                       │ │
│   │  向量计算      │  pgvector                    │  0.7+        │  PostgreSQL原生集成                  │ │
│   │  Embedding     │  OpenAI / 本地模型           │  -           │  text-embedding-3-small             │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  主数据库      │  PostgreSQL                  │  17          │  ACID、JSON、向量支持                │ │
│   │  缓存         │  Redis                       │  7.2+        │  高性能、数据结构丰富                 │ │
│   │  搜索引擎      │  Elasticsearch               │  8.x         │  全文检索、向量搜索                   │ │
│   │  对象存储      │  MinIO / 腾讯云COS           │  -           │  S3兼容、多策略切换                  │ │
│   │                │                              │              │                                      │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                │                              │              │                                      │ │
│   │  容器化        │  Docker                      │  24+         │  标准化部署                          │ │
│   │  编排         │  Docker Compose / K8s        │  -           │  开发/生产环境                       │ │
│   │  CI/CD        │  GitHub Actions              │  -           │  自动化流水线                        │ │
│   │  监控         │  Prometheus + Grafana        │  -           │  指标可视化                          │ │
│   │  日志         │  ELK Stack                   │  8.x         │  日志聚合分析                        │ │
│   │  反向代理      │  Nginx                       │  1.25+       │  负载均衡、SSL                       │ │
│   │                │                              │              │                                      │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2.2 关键技术决策说明

**决策一：为什么选择 JDK 21 + 虚拟线程？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    JDK 21 虚拟线程技术决策                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      问题背景                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   在 AetherBlog 中，后端需要频繁处理以下 I/O 密集型操作：                                            │ │
│   │                                                                                                    │ │
│   │   • 数据库查询（PostgreSQL）                                                                        │ │
│   │   • 缓存读写（Redis）                                                                               │ │
│   │   • 文件上传下载（对象存储）                                                                         │ │
│   │   • AI 模型调用（OpenAI API，单次调用可能耗时 3-10 秒）                                              │ │
│   │   • 搜索引擎查询（Elasticsearch）                                                                   │ │
│   │                                                                                                    │ │
│   │   传统方案的问题：                                                                                  │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │   • 线程池模型：每个请求占用一个平台线程，AI调用期间线程被阻塞                                         │ │
│   │   • WebFlux响应式：学习曲线陡峭，代码可读性差，调试困难                                               │ │
│   │   • 线程池耗尽：高并发 AI 请求时，Tomcat 线程池（默认200）迅速耗尽                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      解决方案                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   JDK 21 虚拟线程（Project Loom）：                                                                 │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │     传统线程模型                          虚拟线程模型                                       │  │ │
│   │   │     ─────────────                         ─────────────                                     │  │ │
│   │   │                                                                                             │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                                       │  │ │
│   │   │     │ 请求 1  │ ──▶ 平台线程1 (阻塞等待)    │ 请求 1  │ ──▶ 虚拟线程1 ──┐                     │  │ │
│   │   │     └─────────┘                           └─────────┘                │                     │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                │   ┌─────────┐       │  │ │
│   │   │     │ 请求 2  │ ──▶ 平台线程2 (阻塞等待)    │ 请求 2  │ ──▶ 虚拟线程2 ──┼──▶│ 载体线程 │       │  │ │
│   │   │     └─────────┘                           └─────────┘                │   │ (少量)  │       │  │ │
│   │   │     ┌─────────┐                           ┌─────────┐                │   └─────────┘       │  │ │
│   │   │     │ 请求 N  │ ──▶ 线程池耗尽！           │ 请求 N  │ ──▶ 虚拟线程N ──┘     ↓               │  │ │
│   │   │     └─────────┘                           └─────────┘              自动挂起/恢复           │  │ │
│   │   │                                                                                             │  │ │
│   │   │     问题：200线程处理200并发               优势：百万级虚拟线程，极低开销                      │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   代码示例：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   // application.yml - 开启虚拟线程                                                                 │ │
│   │   spring:                                                                                          │ │
│   │     threads:                                                                                       │ │
│   │       virtual:                                                                                     │ │
│   │         enabled: true                                                                              │ │
│   │                                                                                                    │ │
│   │   // 同步代码风格，但底层自动使用虚拟线程                                                             │ │
│   │   @GetMapping("/api/posts/{id}/ai-summary")                                                        │ │
│   │   public AiSummaryResponse generateSummary(@PathVariable Long id) {                                │ │
│   │       Post post = postRepository.findById(id).orElseThrow();  // I/O 操作                          │ │
│   │       String summary = aiService.generateSummary(post.getContent());  // AI调用，可能耗时5秒        │ │
│   │       return new AiSummaryResponse(summary);  // 虚拟线程自动挂起/恢复，不阻塞平台线程               │ │
│   │   }                                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      性能对比                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   场景：1000 并发 AI 摘要生成请求（每次 AI 调用耗时约 3 秒）                                          │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────┬─────────────────────────┬─────────────────────────┐                  │ │
│   │   │        指标             │   传统线程池 (200)      │   虚拟线程 (JDK 21)     │                  │ │
│   │   ├─────────────────────────┼─────────────────────────┼─────────────────────────┤                  │ │
│   │   │  最大并发处理数         │        200              │        1000+            │                  │ │
│   │   │  平均响应时间           │       15秒 (排队)       │        3秒              │                  │ │
│   │   │  内存占用               │      ~200MB             │       ~50MB             │                  │ │
│   │   │  线程创建开销           │       ~1ms/线程         │      ~1μs/线程          │                  │ │
│   │   │  代码复杂度             │       简单              │        简单             │                  │ │
│   │   └─────────────────────────┴─────────────────────────┴─────────────────────────┘                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**决策二：为什么选择 Spring AI 而非 LangChain4j？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    AI 框架选型对比分析                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                           Spring AI vs LangChain4j 详细对比                                        │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────┬──────────────────────────────┬──────────────────────────────┐            │ │
│   │   │       评估维度       │         Spring AI            │        LangChain4j           │            │ │
│   │   ├─────────────────────┼──────────────────────────────┼──────────────────────────────┤            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  设计哲学           │  Spring 生态原生设计          │  LangChain Python 的 Java 版 │            │ │
│   │   │                     │  依赖注入、自动配置           │  独立库，需额外适配           │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  配置方式           │  application.yml 配置        │  Builder 模式编程配置        │            │ │
│   │   │                     │  @Bean 注入                  │  工厂类创建                  │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  ChatClient        │  统一的 ChatClient 接口       │  独立的 ChatLanguageModel    │            │ │
│   │   │                     │  链式调用、流畅 API           │  接口相对分散                │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  结构化输出         │  ✅ 直接映射 Java Record      │  ✅ 支持，配置较繁琐          │            │ │
│   │   │                     │  BeanOutputConverter 内置    │  需要自定义解析器             │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  RAG 支持           │  ✅ VectorStore 统一抽象      │  ✅ EmbeddingStore 抽象      │            │ │
│   │   │                     │  与 Spring Data 风格一致      │  API 设计独立                │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  Advisors/拦截器    │  ✅ 强大的 Advisors API       │  ⚠️ 拦截能力有限             │            │ │
│   │   │                     │  日志、记忆、安全横切         │  需手动实现                  │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  Agent 能力         │  ⚠️ Function Calling 支持    │  ✅ 更成熟的 Agent 编排       │            │ │
│   │   │                     │  1.0 版本持续增强             │  Chains、Tools 更完善        │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  可观测性           │  ✅ Micrometer + Actuator     │  ⚠️ 需额外配置               │            │ │
│   │   │                     │  开箱即用                    │                              │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  学习曲线           │  Spring 开发者零成本          │  需学习新的 API 体系         │            │ │
│   │   │                     │                              │                              │            │ │
│   │   │  社区活跃度         │  ✅ Spring 官方维护           │  ✅ 社区活跃                 │            │ │
│   │   │                     │                              │                              │            │ │
│   │   └─────────────────────┴──────────────────────────────┴──────────────────────────────┘            │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      最终决策                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ✅ 选择 Spring AI 作为主要 AI 框架                                                                │ │
│   │                                                                                                    │ │
│   │   决策理由：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   1. 项目明确要求使用 Spring Boot 3+ 技术栈，Spring AI 提供最佳集成体验                              │ │
│   │                                                                                                    │ │
│   │   2. AetherBlog 的 AI 场景主要是：                                                                  │ │
│   │      • 文本清洗/重写 → 单次 LLM 调用，Spring AI ChatClient 完美支持                                  │ │
│   │      • 摘要/标签生成 → 结构化输出，Spring AI BeanOutputConverter 优势明显                            │ │
│   │      • RAG 搜索 → Spring AI VectorStore 与 PostgreSQL pgvector 无缝集成                             │ │
│   │      这些场景不需要复杂的 Agent 编排，Spring AI 完全满足需求                                         │ │
│   │                                                                                                    │ │
│   │   3. Advisors API 可优雅处理：日志记录、Token 统计、敏感词过滤、记忆管理                              │ │
│   │                                                                                                    │ │
│   │   4. 与 Spring Boot Actuator 集成，开箱即用的 AI 调用监控                                            │ │
│   │                                                                                                    │ │
│   │   备选方案：                                                                                        │ │
│   │   如果未来需要复杂的多步骤 Agent（如自主研究、工具链调用），可引入 LangChain4j 作为补充               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**决策三：为什么选择 PostgreSQL 17 + pgvector？**

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    向量数据库选型决策                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      候选方案对比                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐  │ │
│   │   │       方案          │  PostgreSQL     │    Milvus       │    Pinecone     │   Elasticsearch │  │ │
│   │   │                     │  + pgvector     │                 │                 │    8.x          │  │ │
│   │   ├─────────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  部署复杂度         │  ⭐ 最低        │  中等           │  ⭐ 托管服务    │  中等           │  │ │
│   │   │                     │  复用现有PG     │  独立集群       │  无需部署       │  独立集群       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  运维成本           │  ⭐ 最低        │  较高           │  按量付费       │  中等           │  │ │
│   │   │                     │  单一数据库     │  额外组件       │  成本不可控     │  额外组件       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  数据一致性         │  ⭐ ACID事务    │  最终一致       │  最终一致       │  最终一致       │  │ │
│   │   │                     │  强一致         │                 │                 │                 │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  混合查询           │  ⭐ 原生SQL     │  有限           │  有限           │  ✅ 强大        │  │ │
│   │   │                     │  关系+向量      │                 │                 │  全文+向量      │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  性能 (100万向量)   │  ✅ 优秀       │  ⭐ 最优        │  ⭐ 最优        │  ✅ 优秀        │  │ │
│   │   │                     │  HNSW索引      │  专业优化       │  专业优化       │  HNSW索引       │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   │  Spring AI 集成    │  ⭐ 原生支持    │  ✅ 支持        │  ✅ 支持        │  ✅ 支持        │  │ │
│   │   │                     │                 │                 │                 │                 │  │ │
│   │   └─────────────────────┴─────────────────┴─────────────────┴─────────────────┴─────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      决策结论                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ✅ 主选：PostgreSQL 17 + pgvector                                                                │ │
│   │   ✅ 补充：Elasticsearch 8.x（全文检索 + 可选向量搜索）                                              │ │
│   │                                                                                                    │ │
│   │   决策理由：                                                                                        │ │
│   │   ─────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   1. 架构简化：无需维护独立的向量数据库集群                                                          │ │
│   │                                                                                                    │ │
│   │   2. 事务一致性：文章发布 + 向量索引可在同一事务中完成                                                │ │
│   │      BEGIN;                                                                                        │ │
│   │        INSERT INTO posts (title, content) VALUES (...);                                            │ │
│   │        INSERT INTO post_embeddings (post_id, embedding) VALUES (...);                              │ │
│   │      COMMIT;  -- 原子操作，数据永不不一致                                                           │ │
│   │                                                                                                    │ │
│   │   3. 混合查询能力：                                                                                 │ │
│   │      SELECT p.*, 1 - (e.embedding <=> query_vector) as similarity                                  │ │
│   │      FROM posts p                                                                                  │ │
│   │      JOIN post_embeddings e ON p.id = e.post_id                                                    │ │
│   │      WHERE p.status = 'PUBLISHED'                                                                  │ │
│   │        AND p.category_id = 5                                                                       │ │
│   │      ORDER BY e.embedding <=> query_vector                                                         │ │
│   │      LIMIT 10;                                                                                     │ │
│   │                                                                                                    │ │
│   │   4. 博客场景向量规模有限（通常 < 100万），pgvector HNSW 索引性能完全满足                             │ │
│   │                                                                                                    │ │
│   │   5. 成本最优：不增加额外基础设施                                                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 2.3 前端技术栈详解

### 2.3.1 前端架构设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端架构设计图（完整版）                                            │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                    前端 Monorepo 完整目录结构                                       │ │
│   │                                                                                                    │ │
│   │   aetherblog-frontend/                                                                             │ │
│   │   │                                                                                                │ │
│   │   ├── apps/                                         # 📱 应用层                                    │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── blog/                                     # 🖥️ 博客前台应用 (Next.js 15)                 │ │
│   │   │   │   ├── src/                                                                                 │ │
│   │   │   │   │   ├── app/                              # App Router 路由                              │ │
│   │   │   │   │   │   ├── (home)/                       # 首页路由组                                   │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 首页                                         │ │
│   │   │   │   │   │   │   └── loading.tsx               # 加载状态                                     │ │
│   │   │   │   │   │   ├── posts/                        # 文章模块                                     │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 文章列表                                     │ │
│   │   │   │   │   │   │   └── [slug]/                   # 动态路由                                     │ │
│   │   │   │   │   │   │       ├── page.tsx              # 文章详情                                     │ │
│   │   │   │   │   │   │       ├── loading.tsx           # 骨架屏                                       │ │
│   │   │   │   │   │   │       └── opengraph-image.tsx   # OG图片生成                                   │ │
│   │   │   │   │   │   ├── archives/                     # 归档页 (时间树)                              │ │
│   │   │   │   │   │   │   └── page.tsx                                                                 │ │
│   │   │   │   │   │   ├── categories/                   # 分类页                                       │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 分类列表                                     │ │
│   │   │   │   │   │   │   └── [slug]/page.tsx           # 分类详情                                     │ │
│   │   │   │   │   │   ├── tags/                         # 标签页                                       │ │
│   │   │   │   │   │   │   ├── page.tsx                  # 标签云                                       │ │
│   │   │   │   │   │   │   └── [slug]/page.tsx           # 标签详情                                     │ │
│   │   │   │   │   │   ├── search/                       # 搜索页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # AI 语义搜索                                  │ │
│   │   │   │   │   │   ├── friends/                      # 友链页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # 友链卡片展示                                 │ │
│   │   │   │   │   │   ├── about/                        # 关于页                                       │ │
│   │   │   │   │   │   │   └── page.tsx                  # 博主介绍                                     │ │
│   │   │   │   │   │   ├── layout.tsx                    # 根布局                                       │ │
│   │   │   │   │   │   ├── not-found.tsx                 # 404 页面                                     │ │
│   │   │   │   │   │   ├── error.tsx                     # 错误边界                                     │ │
│   │   │   │   │   │   └── globals.css                   # 全局样式                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   ├── components/                       # 页面专用组件                                 │ │
│   │   │   │   │   │   ├── home/                         # 首页组件                                     │ │
│   │   │   │   │   │   │   ├── HeroSection.tsx           # 欢迎区域                                     │ │
│   │   │   │   │   │   │   ├── FeaturedPosts.tsx         # 精选文章                                     │ │
│   │   │   │   │   │   │   ├── RecentPosts.tsx           # 最新文章                                     │ │
│   │   │   │   │   │   │   └── WelcomeModal.tsx          # 欢迎弹窗                                     │ │
│   │   │   │   │   │   ├── post/                         # 文章组件                                     │ │
│   │   │   │   │   │   │   ├── PostCard.tsx              # 文章卡片                                     │ │
│   │   │   │   │   │   │   ├── PostContent.tsx           # 文章内容                                     │ │
│   │   │   │   │   │   │   ├── PostToc.tsx               # 文章目录                                     │ │
│   │   │   │   │   │   │   ├── PostMeta.tsx              # 文章元信息                                   │ │
│   │   │   │   │   │   │   ├── PostNavigation.tsx        # 上下篇导航                                   │ │
│   │   │   │   │   │   │   ├── RelatedPosts.tsx          # 相关推荐                                     │ │
│   │   │   │   │   │   │   └── ShareButtons.tsx          # 分享按钮                                     │ │
│   │   │   │   │   │   ├── archives/                     # 归档组件                                     │ │
│   │   │   │   │   │   │   ├── TimeTree.tsx              # 时间树                                       │ │
│   │   │   │   │   │   │   ├── YearNode.tsx              # 年份节点                                     │ │
│   │   │   │   │   │   │   ├── MonthNode.tsx             # 月份节点                                     │ │
│   │   │   │   │   │   │   └── PostNode.tsx              # 文章节点                                     │ │
│   │   │   │   │   │   ├── search/                       # 搜索组件                                     │ │
│   │   │   │   │   │   │   ├── SearchInput.tsx           # 搜索输入框                                   │ │
│   │   │   │   │   │   │   ├── SearchResults.tsx         # 搜索结果                                     │ │
│   │   │   │   │   │   │   ├── AiAnswer.tsx              # AI 回答                                      │ │
│   │   │   │   │   │   │   └── SearchHistory.tsx         # 搜索历史                                     │ │
│   │   │   │   │   │   └── friends/                      # 友链组件                                     │ │
│   │   │   │   │   │       ├── FriendCard.tsx            # 友链卡片                                     │ │
│   │   │   │   │   │       └── FriendGrid.tsx            # 友链网格                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   ├── hooks/                            # 自定义 Hooks                                 │ │
│   │   │   │   │   │   ├── useScrollProgress.ts          # 滚动进度                                     │ │
│   │   │   │   │   │   ├── useReadingTime.ts             # 阅读时间                                     │ │
│   │   │   │   │   │   ├── useTheme.ts                   # 主题切换                                     │ │
│   │   │   │   │   │   └── useIntersection.ts            # 交叉观察                                     │ │
│   │   │   │   │   │                                                                                    │ │
│   │   │   │   │   └── lib/                              # 工具库                                       │ │
│   │   │   │   │       ├── api.ts                        # API 客户端                                   │ │
│   │   │   │   │       ├── mdx.ts                        # MDX 处理                                     │ │
│   │   │   │   │       └── utils.ts                      # 通用工具                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── public/                               # 静态资源                                     │ │
│   │   │   │   │   ├── fonts/                            # 字体文件                                     │ │
│   │   │   │   │   ├── images/                           # 图片资源                                     │ │
│   │   │   │   │   └── favicon.ico                       # 站点图标                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── next.config.mjs                       # Next.js 配置                                 │ │
│   │   │   │   ├── tailwind.config.ts                    # Tailwind 配置                                │ │
│   │   │   │   ├── tsconfig.json                         # TypeScript 配置                              │ │
│   │   │   │   └── package.json                                                                         │ │
│   │   │   │                                                                                            │ │
│   │   │   │                                                                                            │ │
│   │   │   └── admin/                                    # 🔧 管理后台应用 (Vite + React)               │ │
│   │   │       ├── src/                                                                                 │ │
│   │   │       │   ├── main.tsx                          # 应用入口                                     │ │
│   │   │       │   ├── App.tsx                           # 根组件                                       │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── pages/                            # 页面目录                                     │ │
│   │   │       │   │   ├── dashboard/                    # 仪表盘                                       │ │
│   │   │       │   │   │   ├── index.tsx                 # 仪表盘首页                                   │ │
│   │   │       │   │   │   ├── StatsCards.tsx            # 统计卡片                                     │ │
│   │   │       │   │   │   ├── VisitorChart.tsx          # 访问趋势图                                   │ │
│   │   │       │   │   │   ├── TopPosts.tsx              # 热门文章                                     │ │
│   │   │       │   │   │   ├── GeoDistribution.tsx       # 地域分布                                     │ │
│   │   │       │   │   │   └── SystemStatus.tsx          # 系统状态                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── posts/                        # 文章管理                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 文章列表                                     │ │
│   │   │       │   │   │   ├── create.tsx                # 创建文章                                     │ │
│   │   │       │   │   │   ├── [id]/edit.tsx             # 编辑文章                                     │ │
│   │   │       │   │   │   └── components/                                                              │ │
│   │   │       │   │   │       ├── PostEditor.tsx        # 文章编辑器                                   │ │
│   │   │       │   │   │       ├── PostPreview.tsx       # 预览面板                                     │ │
│   │   │       │   │   │       ├── PostSettings.tsx      # 发布设置                                     │ │
│   │   │       │   │   │       ├── AiAssistant.tsx       # AI 助手面板                                  │ │
│   │   │       │   │   │       └── ImageUploader.tsx     # 图片上传                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── media/                        # 媒体管理                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 媒体库                                       │ │
│   │   │       │   │   │   ├── MediaGrid.tsx             # 媒体网格                                     │ │
│   │   │       │   │   │   ├── MediaUpload.tsx           # 上传组件                                     │ │
│   │   │       │   │   │   └── MediaDetail.tsx           # 详情弹窗                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── categories/                   # 分类管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── tags/                         # 标签管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── friends/                      # 友链管理                                     │ │
│   │   │       │   │   │   └── index.tsx                                                                │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── analytics/                    # 统计分析                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 统计首页                                     │ │
│   │   │       │   │   │   ├── VisitorAnalytics.tsx      # 访客分析                                     │ │
│   │   │       │   │   │   ├── ContentAnalytics.tsx      # 内容分析                                     │ │
│   │   │       │   │   │   └── DeviceAnalytics.tsx       # 设备分析                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── ai-tools/                     # AI 工具                                      │ │
│   │   │       │   │   │   ├── index.tsx                 # AI 工具首页                                  │ │
│   │   │       │   │   │   ├── TextCleaner.tsx           # 文本清洗                                     │ │
│   │   │       │   │   │   ├── ContentRewriter.tsx       # 内容重写                                     │ │
│   │   │       │   │   │   ├── PromptManager.tsx         # Prompt 管理                                  │ │
│   │   │       │   │   │   └── BatchProcessor.tsx        # 批量处理                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── settings/                     # 系统设置                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 设置首页                                     │ │
│   │   │       │   │   │   ├── SiteSettings.tsx          # 站点设置                                     │ │
│   │   │       │   │   │   ├── ProfileSettings.tsx       # 个人资料                                     │ │
│   │   │       │   │   │   ├── StorageSettings.tsx       # 存储配置                                     │ │
│   │   │       │   │   │   ├── AiSettings.tsx            # AI 配置                                      │ │
│   │   │       │   │   │   └── ThemeSettings.tsx         # 主题配置                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── logs/                         # 日志监控                                     │ │
│   │   │       │   │   │   ├── index.tsx                 # 日志首页                                     │ │
│   │   │       │   │   │   ├── SystemLogs.tsx            # 系统日志                                     │ │
│   │   │       │   │   │   ├── ErrorLogs.tsx             # 错误日志                                     │ │
│   │   │       │   │   │   └── AuditLogs.tsx             # 审计日志                                     │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   └── auth/                         # 认证页面                                     │ │
│   │   │       │   │       ├── login.tsx                 # 登录页                                       │ │
│   │   │       │   │       └── forgot-password.tsx       # 忘记密码                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── components/                       # 后台专用组件                                 │ │
│   │   │       │   │   ├── layout/                       # 布局组件                                     │ │
│   │   │       │   │   │   ├── AdminLayout.tsx           # 后台布局                                     │ │
│   │   │       │   │   │   ├── Sidebar.tsx               # 侧边栏                                       │ │
│   │   │       │   │   │   ├── Header.tsx                # 顶部栏                                       │ │
│   │   │       │   │   │   ├── Breadcrumb.tsx            # 面包屑                                       │ │
│   │   │       │   │   │   └── Footer.tsx                # 底部栏                                       │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   ├── common/                       # 通用组件                                     │ │
│   │   │       │   │   │   ├── DataTable.tsx             # 数据表格                                     │ │
│   │   │       │   │   │   ├── Pagination.tsx            # 分页组件                                     │ │
│   │   │       │   │   │   ├── ConfirmDialog.tsx         # 确认弹窗                                     │ │
│   │   │       │   │   │   ├── LoadingSpinner.tsx        # 加载动画                                     │ │
│   │   │       │   │   │   └── EmptyState.tsx            # 空状态                                       │ │
│   │   │       │   │   │                                                                                │ │
│   │   │       │   │   └── charts/                       # 图表组件                                     │ │
│   │   │       │   │       ├── LineChart.tsx             # 折线图                                       │ │
│   │   │       │   │       ├── BarChart.tsx              # 柱状图                                       │ │
│   │   │       │   │       ├── PieChart.tsx              # 饼图                                         │ │
│   │   │       │   │       └── GeoMap.tsx                # 地理分布图                                   │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── stores/                           # Zustand 状态管理                             │ │
│   │   │       │   │   ├── authStore.ts                  # 认证状态                                     │ │
│   │   │       │   │   ├── postStore.ts                  # 文章状态                                     │ │
│   │   │       │   │   ├── uiStore.ts                    # UI 状态                                      │ │
│   │   │       │   │   └── settingsStore.ts              # 设置状态                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── services/                         # API 服务层                                   │ │
│   │   │       │   │   ├── api.ts                        # Axios 实例                                   │ │
│   │   │       │   │   ├── authService.ts                # 认证服务                                     │ │
│   │   │       │   │   ├── postService.ts                # 文章服务                                     │ │
│   │   │       │   │   ├── mediaService.ts               # 媒体服务                                     │ │
│   │   │       │   │   ├── analyticsService.ts           # 统计服务                                     │ │
│   │   │       │   │   └── aiService.ts                  # AI 服务                                      │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── hooks/                            # 自定义 Hooks                                 │ │
│   │   │       │   │   ├── useAuth.ts                    # 认证 Hook                                    │ │
│   │   │       │   │   ├── usePosts.ts                   # 文章 Hook                                    │ │
│   │   │       │   │   └── useDebounce.ts                # 防抖 Hook                                    │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   ├── types/                            # 类型定义                                     │ │
│   │   │       │   │   ├── post.ts                       # 文章类型                                     │ │
│   │   │       │   │   ├── user.ts                       # 用户类型                                     │ │
│   │   │       │   │   ├── api.ts                        # API 类型                                     │ │
│   │   │       │   │   └── index.ts                      # 类型导出                                     │ │
│   │   │       │   │                                                                                    │ │
│   │   │       │   └── utils/                            # 工具函数                                     │ │
│   │   │       │       ├── format.ts                     # 格式化                                       │ │
│   │   │       │       ├── validation.ts                 # 校验                                         │ │
│   │   │       │       └── storage.ts                    # 本地存储                                     │ │
│   │   │       │                                                                                        │ │
│   │   │       ├── index.html                            # HTML 入口                                    │ │
│   │   │       ├── vite.config.ts                        # Vite 配置                                    │ │
│   │   │       ├── tailwind.config.ts                    # Tailwind 配置                                │ │
│   │   │       ├── tsconfig.json                         # TypeScript 配置                              │ │
│   │   │       └── package.json                                                                         │ │
│   │   │                                                                                                │ │
│   │                                                                                                    │ │
│   ├── packages/                                         # 📦 共享包层                                  │ │
│   │   │                                                                                                │ │
│   │   ├── ui/                                           # 🎨 共享 UI 组件库                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── components/                           # 基础组件                                     │ │
│   │   │   │   │   ├── Button/                                                                          │ │
│   │   │   │   │   │   ├── Button.tsx                    # 按钮组件                                     │ │
│   │   │   │   │   │   ├── Button.styles.ts              # 按钮样式                                     │ │
│   │   │   │   │   │   └── index.ts                                                                     │ │
│   │   │   │   │   ├── Card/                             # 卡片组件                                     │ │
│   │   │   │   │   ├── Input/                            # 输入框组件                                   │ │
│   │   │   │   │   ├── Modal/                            # 模态框组件                                   │ │
│   │   │   │   │   ├── Dropdown/                         # 下拉菜单                                     │ │
│   │   │   │   │   ├── Toast/                            # 提示消息                                     │ │
│   │   │   │   │   ├── Tooltip/                          # 工具提示                                     │ │
│   │   │   │   │   ├── Avatar/                           # 头像组件                                     │ │
│   │   │   │   │   ├── Badge/                            # 徽章组件                                     │ │
│   │   │   │   │   ├── Tag/                              # 标签组件                                     │ │
│   │   │   │   │   ├── Skeleton/                         # 骨架屏                                       │ │
│   │   │   │   │   └── index.ts                          # 统一导出                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── primitives/                           # Radix UI 封装                                │ │
│   │   │   │   │   ├── Dialog.tsx                        # 对话框                                       │ │
│   │   │   │   │   ├── Popover.tsx                       # 弹出框                                       │ │
│   │   │   │   │   ├── Select.tsx                        # 选择器                                       │ │
│   │   │   │   │   ├── Tabs.tsx                          # 标签页                                       │ │
│   │   │   │   │   ├── Accordion.tsx                     # 手风琴                                       │ │
│   │   │   │   │   └── Switch.tsx                        # 开关                                         │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── themes/                               # 主题配置                                     │ │
│   │   │   │       ├── tokens.ts                         # 设计令牌                                     │ │
│   │   │   │       ├── lightTheme.ts                     # 亮色主题                                     │ │
│   │   │   │       └── darkTheme.ts                      # 暗色主题                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   ├── editor/                                       # 📝 Markdown 编辑器包                         │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── MarkdownEditor.tsx                    # 编辑器主组件                                 │ │
│   │   │   │   ├── Toolbar.tsx                           # 工具栏                                       │ │
│   │   │   │   ├── Preview.tsx                           # 预览面板                                     │ │
│   │   │   │   ├── StatusBar.tsx                         # 状态栏 (字数统计等)                          │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── plugins/                              # 编辑器插件                                   │ │
│   │   │   │   │   ├── codeBlock.ts                      # 代码块插件                                   │ │
│   │   │   │   │   ├── mathBlock.ts                      # 数学公式插件 (KaTeX)                         │ │
│   │   │   │   │   ├── mermaid.ts                        # Mermaid 图表插件                             │ │
│   │   │   │   │   ├── imageUpload.ts                    # 图片上传插件                                 │ │
│   │   │   │   │   ├── tablePlugin.ts                    # 表格增强插件                                 │ │
│   │   │   │   │   ├── linkPlugin.ts                     # 链接插件                                     │ │
│   │   │   │   │   ├── emojiPlugin.ts                    # Emoji 插件                                   │ │
│   │   │   │   │   ├── tocPlugin.ts                      # 目录生成插件                                 │ │
│   │   │   │   │   └── index.ts                          # 插件注册                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── extensions/                           # CodeMirror/Monaco 扩展                       │ │
│   │   │   │   │   ├── markdown.ts                       # Markdown 语法支持                            │ │
│   │   │   │   │   ├── syntaxHighlight.ts                # 语法高亮                                     │ │
│   │   │   │   │   ├── autoComplete.ts                   # 自动补全                                     │ │
│   │   │   │   │   ├── bracketMatch.ts                   # 括号匹配                                     │ │
│   │   │   │   │   └── lineNumbers.ts                    # 行号显示                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── renderers/                            # Markdown 渲染器                              │ │
│   │   │   │   │   ├── CodeBlockRenderer.tsx             # 代码块渲染                                   │ │
│   │   │   │   │   │   ├── SyntaxHighlighter.tsx         # 语法高亮 (Shiki)                             │ │
│   │   │   │   │   │   ├── CopyButton.tsx                # 复制按钮                                     │ │
│   │   │   │   │   │   ├── CollapseToggle.tsx            # 折叠切换                                     │ │
│   │   │   │   │   │   └── LanguageLabel.tsx             # 语言标签                                     │ │
│   │   │   │   │   ├── MathRenderer.tsx                  # 数学公式渲染 (KaTeX)                         │ │
│   │   │   │   │   ├── MermaidRenderer.tsx               # Mermaid 图表渲染                             │ │
│   │   │   │   │   ├── ImageRenderer.tsx                 # 图片渲染 (居中/缩放)                         │ │
│   │   │   │   │   ├── TableRenderer.tsx                 # 表格渲染                                     │ │
│   │   │   │   │   ├── BlockquoteRenderer.tsx            # 引用块渲染                                   │ │
│   │   │   │   │   ├── HeadingRenderer.tsx               # 标题渲染 (锚点)                              │ │
│   │   │   │   │   └── LinkRenderer.tsx                  # 链接渲染                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── utils/                                # 工具函数                                     │ │
│   │   │   │   │   ├── markdownParser.ts                 # Markdown 解析                                │ │
│   │   │   │   │   ├── htmlSanitizer.ts                  # HTML 净化                                    │ │
│   │   │   │   │   ├── wordCounter.ts                    # 字数统计                                     │ │
│   │   │   │   │   ├── readingTime.ts                    # 阅读时间估算                                 │ │
│   │   │   │   │   ├── imageHandler.ts                   # 图片处理                                     │ │
│   │   │   │   │   └── shortcutKeys.ts                   # 快捷键配置                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── hooks/                                # 编辑器 Hooks                                 │ │
│   │   │   │   │   ├── useEditor.ts                      # 编辑器核心 Hook                              │ │
│   │   │   │   │   ├── useMarkdown.ts                    # Markdown 处理 Hook                           │ │
│   │   │   │   │   ├── useAutoSave.ts                    # 自动保存 Hook                                │ │
│   │   │   │   │   ├── useImagePaste.ts                  # 图片粘贴 Hook                                │ │
│   │   │   │   │   └── useUndoRedo.ts                    # 撤销重做 Hook                                │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── types/                                # 类型定义                                     │ │
│   │   │   │   │   ├── editor.ts                         # 编辑器类型                                   │ │
│   │   │   │   │   ├── plugin.ts                         # 插件类型                                     │ │
│   │   │   │   │   └── renderer.ts                       # 渲染器类型                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── hooks/                                        # 🪝 共享 Hooks 包                             │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── useApi.ts                             # API 请求 Hook                                │ │
│   │   │   │   ├── useAuth.ts                            # 认证状态 Hook                                │ │
│   │   │   │   ├── useDebounce.ts                        # 防抖 Hook                                    │ │
│   │   │   │   ├── useThrottle.ts                        # 节流 Hook                                    │ │
│   │   │   │   ├── useLocalStorage.ts                    # 本地存储 Hook                                │ │
│   │   │   │   ├── useSessionStorage.ts                  # 会话存储 Hook                                │ │
│   │   │   │   ├── useMediaQuery.ts                      # 媒体查询 Hook                                │ │
│   │   │   │   ├── useClickOutside.ts                    # 点击外部 Hook                                │ │
│   │   │   │   ├── useScrollLock.ts                      # 滚动锁定 Hook                                │ │
│   │   │   │   ├── useIntersectionObserver.ts            # 交叉观察 Hook                                │ │
│   │   │   │   ├── useCopyToClipboard.ts                 # 复制剪贴板 Hook                              │ │
│   │   │   │   ├── useKeyPress.ts                        # 按键检测 Hook                                │ │
│   │   │   │   ├── useWindowSize.ts                      # 窗口尺寸 Hook                                │ │
│   │   │   │   ├── useScrollPosition.ts                  # 滚动位置 Hook                                │ │
│   │   │   │   ├── usePrevious.ts                        # 前值保存 Hook                                │ │
│   │   │   │   ├── useToggle.ts                          # 切换状态 Hook                                │ │
│   │   │   │   ├── useAsync.ts                           # 异步操作 Hook                                │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── utils/                                        # 🔧 共享工具函数包                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── format/                               # 格式化工具                                   │ │
│   │   │   │   │   ├── date.ts                           # 日期格式化                                   │ │
│   │   │   │   │   ├── number.ts                         # 数字格式化                                   │ │
│   │   │   │   │   ├── string.ts                         # 字符串格式化                                 │ │
│   │   │   │   │   ├── fileSize.ts                       # 文件大小格式化                               │ │
│   │   │   │   │   └── duration.ts                       # 时长格式化                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── validation/                           # 校验工具                                     │ │
│   │   │   │   │   ├── email.ts                          # 邮箱校验                                     │ │
│   │   │   │   │   ├── url.ts                            # URL 校验                                     │ │
│   │   │   │   │   ├── password.ts                       # 密码强度校验                                 │ │
│   │   │   │   │   └── form.ts                           # 表单校验                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── helpers/                              # 辅助函数                                     │ │
│   │   │   │   │   ├── classNames.ts                     # 类名合并 (clsx)                              │ │
│   │   │   │   │   ├── deepClone.ts                      # 深拷贝                                       │ │
│   │   │   │   │   ├── debounce.ts                       # 防抖函数                                     │ │
│   │   │   │   │   ├── throttle.ts                       # 节流函数                                     │ │
│   │   │   │   │   ├── sleep.ts                          # 延迟函数                                     │ │
│   │   │   │   │   ├── retry.ts                          # 重试函数                                     │ │
│   │   │   │   │   ├── omit.ts                           # 对象属性剔除                                 │ │
│   │   │   │   │   ├── pick.ts                           # 对象属性选取                                 │ │
│   │   │   │   │   └── uniqueId.ts                       # 唯一ID生成                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── storage/                              # 存储工具                                     │ │
│   │   │   │   │   ├── localStorage.ts                   # 本地存储封装                                 │ │
│   │   │   │   │   ├── sessionStorage.ts                 # 会话存储封装                                 │ │
│   │   │   │   │   └── indexedDB.ts                      # IndexedDB 封装                               │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── url/                                  # URL 工具                                     │ │
│   │   │   │   │   ├── queryString.ts                    # 查询字符串处理                               │ │
│   │   │   │   │   ├── slugify.ts                        # Slug 生成                                    │ │
│   │   │   │   │   └── urlBuilder.ts                     # URL 构建器                                   │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   ├── types/                                        # 📋 共享类型定义包                            │ │
│   │   │   ├── src/                                                                                     │ │
│   │   │   │   ├── api/                                  # API 相关类型                                 │ │
│   │   │   │   │   ├── request.ts                        # 请求类型                                     │ │
│   │   │   │   │   ├── response.ts                       # 响应类型                                     │ │
│   │   │   │   │   ├── pagination.ts                     # 分页类型                                     │ │
│   │   │   │   │   └── error.ts                          # 错误类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── models/                               # 数据模型类型                                 │ │
│   │   │   │   │   ├── post.ts                           # 文章类型                                     │ │
│   │   │   │   │   ├── category.ts                       # 分类类型                                     │ │
│   │   │   │   │   ├── tag.ts                            # 标签类型                                     │ │
│   │   │   │   │   ├── user.ts                           # 用户类型                                     │ │
│   │   │   │   │   ├── comment.ts                        # 评论类型                                     │ │
│   │   │   │   │   ├── media.ts                          # 媒体类型                                     │ │
│   │   │   │   │   ├── friendLink.ts                     # 友链类型                                     │ │
│   │   │   │   │   └── settings.ts                       # 设置类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── ai/                                   # AI 相关类型                                  │ │
│   │   │   │   │   ├── prompt.ts                         # Prompt 类型                                  │ │
│   │   │   │   │   ├── completion.ts                     # 补全类型                                     │ │
│   │   │   │   │   └── embedding.ts                      # 嵌入类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   ├── common/                               # 通用类型                                     │ │
│   │   │   │   │   ├── base.ts                           # 基础类型                                     │ │
│   │   │   │   │   └── utility.ts                        # 工具类型                                     │ │
│   │   │   │   │                                                                                        │ │
│   │   │   │   └── index.ts                              # 统一导出                                     │ │
│   │   │   │                                                                                            │ │
│   │   │   ├── package.json                                                                             │ │
│   │   │   └── tsconfig.json                                                                            │ │
│   │   │                                                                                                │ │
│   │   │                                                                                                │ │
│   │   └── config/                                       # ⚙️ 共享配置包                                │ │
│   │       ├── src/                                                                                     │ │
│   │       │   ├── tailwind/                             # Tailwind 预设                                │ │
│   │       │   │   ├── preset.ts                         # 主题预设                                     │ │
│   │       │   │   ├── colors.ts                         # 颜色配置                                     │ │
│   │       │   │   ├── typography.ts                     # 排版配置                                     │ │
│   │       │   │   ├── animation.ts                      # 动画配置                                     │ │
│   │       │   │   └── plugins.ts                        # 插件配置                                     │ │
│   │       │   │                                                                                        │ │
│   │       │   ├── eslint/                               # ESLint 配置                                  │ │
│   │       │   │   └── index.js                          # ESLint 预设                                  │ │
│   │       │   │                                                                                        │ │
│   │       │   ├── typescript/                           # TypeScript 配置                              │ │
│   │       │   │   ├── base.json                         # 基础配置                                     │ │
│   │       │   │   ├── react.json                        # React 配置                                   │ │
│   │       │   │   └── nextjs.json                       # Next.js 配置                                 │ │
│   │       │   │                                                                                        │ │
│   │       │   └── constants/                            # 常量配置                                     │ │
│   │       │       ├── api.ts                            # API 常量                                     │ │
│   │       │       ├── routes.ts                         # 路由常量                                     │ │
│   │       │       └── theme.ts                          # 主题常量                                     │ │
│   │       │                                                                                            │ │
│   │       ├── package.json                                                                             │ │
│   │       └── tsconfig.json                                                                            │ │
│   │                                                                                                    │ │
│   │                                                                                                    │ │
│   ├── pnpm-workspace.yaml                               # PNPM 工作区配置                              │ │
│   ├── package.json                                      # 根 package.json                              │ │
│   ├── turbo.json                                        # Turborepo 配置                               │ │
│   ├── .eslintrc.js                                      # ESLint 配置                                  │ │
│   ├── .prettierrc                                       # Prettier 配置                                │ │
│   ├── tsconfig.base.json                                # TypeScript 基础配置                          │ │
│   └── README.md                                         # 项目说明                                     │ │
│                                                                                                        │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.3.2 前端核心组件设计

#### 2.3.2.1 UI 组件层级设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端组件层级架构                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                         组件分层设计                                                │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  📄 页面层 (Pages)                                           │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：路由入口、数据获取、页面布局组装                                                       │  │ │
│   │   │   示例：HomePage, PostDetailPage, ArchivesPage, SearchPage                                  │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🧩 特性层 (Features)                                        │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：业务功能模块、包含业务逻辑、组合多个基础组件                                            │  │ │
│   │   │   示例：PostEditor, AiAssistant, TimeTree, SearchPanel, FriendCardGrid                      │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🔲 布局层 (Layouts)                                         │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：页面结构骨架、响应式布局、导航与内容区域划分                                            │  │ │
│   │   │   示例：MainLayout, AdminLayout, AuthLayout, FullscreenLayout                               │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🧱 基础层 (Primitives)                                      │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：无业务逻辑、高度复用、遵循设计系统                                                      │  │ │
│   │   │   示例：Button, Card, Input, Modal, Tooltip, Badge, Avatar, Tag                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                  🎨 设计令牌 (Design Tokens)                                 │  │ │
│   │   │                                                                                             │  │ │
│   │   │   特点：颜色、字体、间距、阴影、动画曲线等设计变量                                              │  │ │
│   │   │   示例：colors, typography, spacing, shadows, animations, breakpoints                       │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.2.2 核心组件详细设计

**组件一：文章卡片组件 (PostCard)**

```tsx
// packages/ui/src/components/PostCard/PostCard.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { format } from 'date-fns';
import { zhCN } from 'date-fns/locale';
import { Clock, Eye, MessageCircle, Calendar } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Badge } from '../Badge';
import { Avatar } from '../Avatar';
import type { Post } from '@aetherblog/types';

/**
 * 文章卡片组件 Props
 */
interface PostCardProps {
  /** 文章数据 */
  post: Post;
  /** 卡片变体：default-默认, featured-精选, compact-紧凑, horizontal-水平 */
  variant?: 'default' | 'featured' | 'compact' | 'horizontal';
  /** 是否显示封面图 */
  showCover?: boolean;
  /** 是否显示标签 */
  showTags?: boolean;
  /** 是否显示摘要 */
  showSummary?: boolean;
  /** 是否显示作者信息 */
  showAuthor?: boolean;
  /** 点击事件 */
  onClick?: (post: Post) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * 文章卡片组件
 * 
 * 设计理念：
 * - 采用 Glassmorphism（毛玻璃）设计风格
 * - 使用 Framer Motion 实现流畅的交互动效
 * - 支持多种展示变体，适应不同场景
 * - 响应式设计，完美适配移动端
 */
export const PostCard: React.FC<PostCardProps> = ({
  post,
  variant = 'default',
  showCover = true,
  showTags = true,
  showSummary = true,
  showAuthor = false,
  onClick,
  className,
}) => {
  // 卡片容器动画变体
  const cardVariants = {
    initial: { opacity: 0, y: 20 },
    animate: { opacity: 1, y: 0 },
    hover: { y: -8, transition: { duration: 0.3, ease: 'easeOut' } },
    tap: { scale: 0.98 },
  };

  // 图片动画变体
  const imageVariants = {
    hover: { scale: 1.08, transition: { duration: 0.4, ease: 'easeOut' } },
  };

  // 光效动画变体
  const glowVariants = {
    initial: { opacity: 0, x: '-100%' },
    hover: { opacity: 1, x: '100%', transition: { duration: 0.6 } },
  };

  // 根据变体返回不同的布局
  if (variant === 'horizontal') {
    return (
      <HorizontalPostCard
        post={post}
        showCover={showCover}
        showTags={showTags}
        showSummary={showSummary}
        onClick={onClick}
        className={className}
      />
    );
  }

  if (variant === 'compact') {
    return (
      <CompactPostCard
        post={post}
        showTags={showTags}
        onClick={onClick}
        className={className}
      />
    );
  }

  return (
    <motion.article
      variants={cardVariants}
      initial="initial"
      animate="animate"
      whileHover="hover"
      whileTap="tap"
      onClick={() => onClick?.(post)}
      className={cn(
        // 基础样式
        'group relative cursor-pointer overflow-hidden rounded-2xl',
        // 毛玻璃效果
        'bg-white/5 backdrop-blur-xl',
        'dark:bg-white/5 dark:backdrop-blur-xl',
        // 边框
        'border border-white/10',
        'dark:border-white/10',
        // 阴影
        'shadow-lg shadow-black/5',
        'dark:shadow-lg dark:shadow-black/20',
        // 悬浮效果
        'hover:bg-white/10 hover:border-white/20',
        'hover:shadow-2xl hover:shadow-black/10',
        'dark:hover:bg-white/10 dark:hover:border-white/20',
        // 过渡
        'transition-all duration-300 ease-out',
        // 精选样式
        variant === 'featured' && [
          'md:col-span-2',
          'ring-2 ring-primary/20',
        ],
        className
      )}
    >
      {/* 悬浮光效层 */}
      <motion.div
        variants={glowVariants}
        className={cn(
          'pointer-events-none absolute inset-0 z-10',
          'bg-gradient-to-r from-transparent via-white/10 to-transparent',
          'opacity-0 group-hover:opacity-100'
        )}
      />

      {/* 封面图区域 */}
      {showCover && post.coverImage && (
        <div className="relative aspect-[16/9] overflow-hidden">
          <motion.img
            src={post.coverImage}
            alt={post.title}
            variants={imageVariants}
            className="h-full w-full object-cover"
            loading="lazy"
          />
          
          {/* 渐变遮罩 */}
          <div 
            className={cn(
              'absolute inset-0',
              'bg-gradient-to-t from-black/60 via-black/20 to-transparent'
            )} 
          />

          {/* 分类标签 - 左上角 */}
          {post.category && (
            <div className="absolute left-4 top-4">
              <Badge 
                variant="glass" 
                size="sm"
                className="backdrop-blur-md"
              >
                {post.category.name}
              </Badge>
            </div>
          )}

          {/* 精选标记 - 右上角 */}
          {variant === 'featured' && (
            <div className="absolute right-4 top-4">
              <Badge 
                variant="primary" 
                size="sm"
                className="animate-pulse"
              >
                ⭐ 精选
              </Badge>
            </div>
          )}

          {/* 阅读时间 - 右下角 */}
          <div className="absolute bottom-4 right-4">
            <Badge variant="glass" size="sm" className="backdrop-blur-md">
              <Clock className="mr-1 h-3 w-3" />
              {post.readingTime} 分钟
            </Badge>
          </div>
        </div>
      )}

      {/* 内容区域 */}
      <div className="relative p-5">
        {/* 标签列表 */}
        {showTags && post.tags && post.tags.length > 0 && (
          <div className="mb-3 flex flex-wrap gap-2">
            {post.tags.slice(0, 3).map((tag) => (
              <Badge
                key={tag.id}
                variant="outline"
                size="xs"
                className={cn(
                  'text-xs font-normal',
                  'text-gray-400 dark:text-gray-500',
                  'border-gray-200/50 dark:border-gray-700/50',
                  'hover:text-primary hover:border-primary/50',
                  'transition-colors duration-200'
                )}
              >
                #{tag.name}
              </Badge>
            ))}
            {post.tags.length > 3 && (
              <Badge variant="outline" size="xs" className="text-xs text-gray-400">
                +{post.tags.length - 3}
              </Badge>
            )}
          </div>
        )}

        {/* 文章标题 */}
        <h3
          className={cn(
            'mb-2 font-bold leading-tight',
            'text-gray-900 dark:text-white',
            'group-hover:text-primary dark:group-hover:text-primary',
            'transition-colors duration-200',
            variant === 'featured' ? 'text-xl md:text-2xl' : 'text-lg',
            'line-clamp-2'
          )}
        >
          {post.title}
        </h3>

        {/* 文章摘要 */}
        {showSummary && post.summary && (
          <p
            className={cn(
              'mb-4 text-sm leading-relaxed',
              'text-gray-600 dark:text-gray-400',
              'line-clamp-2'
            )}
          >
            {post.summary}
          </p>
        )}

        {/* 底部元信息 */}
        <div className="flex items-center justify-between">
          {/* 作者信息 */}
          {showAuthor && post.author ? (
            <div className="flex items-center space-x-2">
              <Avatar
                src={post.author.avatar}
                alt={post.author.name}
                size="sm"
              />
              <span className="text-sm text-gray-600 dark:text-gray-400">
                {post.author.name}
              </span>
            </div>
          ) : (
            <div className="flex items-center text-sm text-gray-500 dark:text-gray-500">
              <Calendar className="mr-1 h-3.5 w-3.5" />
              <time dateTime={post.publishedAt}>
                {format(new Date(post.publishedAt), 'yyyy年MM月dd日', { locale: zhCN })}
              </time>
            </div>
          )}

          {/* 统计数据 */}
          <div className="flex items-center space-x-3 text-sm text-gray-500 dark:text-gray-500">
            <span className="flex items-center">
              <Eye className="mr-1 h-3.5 w-3.5" />
              {formatNumber(post.viewCount)}
            </span>
            <span className="flex items-center">
              <MessageCircle className="mr-1 h-3.5 w-3.5" />
              {post.commentCount}
            </span>
          </div>
        </div>
      </div>
    </motion.article>
  );
};

/**
 * 水平布局文章卡片
 */
const HorizontalPostCard: React.FC<Omit<PostCardProps, 'variant'>> = ({
  post,
  showCover,
  showTags,
  showSummary,
  onClick,
  className,
}) => {
  return (
    <motion.article
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      whileHover={{ x: 4 }}
      onClick={() => onClick?.(post)}
      className={cn(
        'group flex cursor-pointer gap-4 rounded-xl p-4',
        'bg-white/5 backdrop-blur-lg',
        'border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300',
        className
      )}
    >
      {/* 封面图 */}
      {showCover && post.coverImage && (
        <div className="relative h-24 w-36 flex-shrink-0 overflow-hidden rounded-lg">
          <img
            src={post.coverImage}
            alt={post.title}
            className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          />
        </div>
      )}

      {/* 内容 */}
      <div className="flex flex-1 flex-col justify-between">
        <div>
          {/* 标签 */}
          {showTags && post.tags && post.tags.length > 0 && (
            <div className="mb-1 flex gap-1">
              {post.tags.slice(0, 2).map((tag) => (
                <Badge key={tag.id} variant="outline" size="xs">
                  #{tag.name}
                </Badge>
              ))}
            </div>
          )}

          {/* 标题 */}
          <h4 className="line-clamp-2 font-semibold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
            {post.title}
          </h4>

          {/* 摘要 */}
          {showSummary && post.summary && (
            <p className="mt-1 line-clamp-1 text-sm text-gray-500 dark:text-gray-400">
              {post.summary}
            </p>
          )}
        </div>

        {/* 元信息 */}
        <div className="mt-2 flex items-center text-xs text-gray-400">
          <Calendar className="mr-1 h-3 w-3" />
          <time>{format(new Date(post.publishedAt), 'MM-dd')}</time>
          <span className="mx-2">·</span>
          <Eye className="mr-1 h-3 w-3" />
          <span>{formatNumber(post.viewCount)}</span>
        </div>
      </div>
    </motion.article>
  );
};

/**
 * 紧凑布局文章卡片
 */
const CompactPostCard: React.FC<Omit<PostCardProps, 'variant' | 'showCover' | 'showSummary'>> = ({
  post,
  showTags,
  onClick,
  className,
}) => {
  return (
    <motion.article
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      whileHover={{ x: 4 }}
      onClick={() => onClick?.(post)}
      className={cn(
        'group flex cursor-pointer items-center justify-between py-3',
        'border-b border-white/5 last:border-b-0',
        'hover:bg-white/5',
        'transition-all duration-200',
        className
      )}
    >
      <div className="flex-1">
        <h5 className="line-clamp-1 font-medium text-gray-900 dark:text-white group-hover:text-primary transition-colors">
          {post.title}
        </h5>
        {showTags && post.tags && post.tags.length > 0 && (
          <div className="mt-1 flex gap-1">
            {post.tags.slice(0, 2).map((tag) => (
              <span key={tag.id} className="text-xs text-gray-400">
                #{tag.name}
              </span>
            ))}
          </div>
        )}
      </div>
      <time className="ml-4 flex-shrink-0 text-xs text-gray-400">
        {format(new Date(post.publishedAt), 'MM-dd')}
      </time>
    </motion.article>
  );
};

/**
 * 格式化数字显示
 */
function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + 'w';
  }
  if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'k';
  }
  return num.toString();
}

export default PostCard;
```

**组件一补充：PostCard 样式变体配置**

```tsx
// packages/ui/src/components/PostCard/PostCard.styles.ts

import { cva, type VariantProps } from 'class-variance-authority';

/**
 * PostCard 样式变体定义
 * 使用 CVA (Class Variance Authority) 管理组件变体
 */
export const postCardVariants = cva(
  // 基础样式
  [
    'group relative cursor-pointer overflow-hidden',
    'bg-white/5 backdrop-blur-xl',
    'border border-white/10',
    'shadow-lg',
    'transition-all duration-300 ease-out',
  ],
  {
    variants: {
      // 尺寸变体
      size: {
        sm: 'rounded-lg',
        md: 'rounded-xl',
        lg: 'rounded-2xl',
      },
      // 布局变体
      layout: {
        vertical: 'flex-col',
        horizontal: 'flex-row',
        compact: 'flex-row items-center',
      },
      // 状态变体
      state: {
        default: [
          'hover:bg-white/10',
          'hover:border-white/20',
          'hover:shadow-xl',
          'hover:-translate-y-1',
        ],
        featured: [
          'ring-2 ring-primary/30',
          'hover:ring-primary/50',
        ],
        disabled: [
          'opacity-50',
          'cursor-not-allowed',
          'pointer-events-none',
        ],
      },
    },
    defaultVariants: {
      size: 'md',
      layout: 'vertical',
      state: 'default',
    },
  }
);

export type PostCardVariants = VariantProps<typeof postCardVariants>;
```

---

**组件二：时间树组件 (TimeTree)**

```tsx
// apps/blog/src/components/archives/TimeTree.tsx

import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronRight, Calendar, FileText } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import type { Post } from '@aetherblog/types';

/**
 * 时间树数据结构
 */
interface TimeTreeData {
  year: number;
  months: {
    month: number;
    posts: Post[];
  }[];
  totalPosts: number;
}

interface TimeTreeProps {
  /** 按时间分组的文章数据 */
  data: TimeTreeData[];
  /** 点击文章回调 */
  onPostClick?: (post: Post) => void;
  /** 默认展开的年份 */
  defaultExpandedYears?: number[];
  /** 自定义类名 */
  className?: string;
}

/**
 * 时间树组件
 * 
 * 设计理念：
 * - 采用递归树形结构展示文章归档
 * - 年份 -> 月份 -> 文章三级层次
 * - 使用 Framer Motion 实现平滑的展开/收起动画
 * - SVG 绘制连接线，节点带脉冲动画
 */
export const TimeTree: React.FC<TimeTreeProps> = ({
  data,
  onPostClick,
  defaultExpandedYears = [],
  className,
}) => {
  // 展开状态管理
  const [expandedYears, setExpandedYears] = useState<Set<number>>(
    new Set(defaultExpandedYears)
  );
  const [expandedMonths, setExpandedMonths] = useState<Set<string>>(new Set());

  // 切换年份展开状态
  const toggleYear = (year: number) => {
    setExpandedYears((prev) => {
      const next = new Set(prev);
      if (next.has(year)) {
        next.delete(year);
      } else {
        next.add(year);
      }
      return next;
    });
  };

  // 切换月份展开状态
  const toggleMonth = (yearMonth: string) => {
    setExpandedMonths((prev) => {
      const next = new Set(prev);
      if (next.has(yearMonth)) {
        next.delete(yearMonth);
      } else {
        next.add(yearMonth);
      }
      return next;
    });
  };

  // 月份名称映射
  const monthNames = [
    '一月', '二月', '三月', '四月', '五月', '六月',
    '七月', '八月', '九月', '十月', '十一月', '十二月'
  ];

  return (
    <div className={cn('relative', className)}>
      {/* 主时间线 */}
      <div 
        className={cn(
          'absolute left-[19px] top-0 h-full w-[2px]',
          'bg-gradient-to-b from-primary/50 via-primary/20 to-transparent'
        )} 
      />

      {/* 年份列表 */}
      <div className="space-y-6">
        {data.map((yearData, yearIndex) => {
          const isYearExpanded = expandedYears.has(yearData.year);

          return (
            <div key={yearData.year} className="relative">
              {/* 年份节点 */}
              <motion.div
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: yearIndex * 0.1 }}
                className="relative"
              >
                {/* 节点圆点 */}
                <div className="absolute left-0 top-1/2 -translate-y-1/2">
                  <motion.div
                    animate={{
                      scale: isYearExpanded ? [1, 1.2, 1] : 1,
                    }}
                    transition={{
                      duration: 2,
                      repeat: isYearExpanded ? Infinity : 0,
                      ease: 'easeInOut',
                    }}
                    className={cn(
                      'relative h-10 w-10 rounded-full',
                      'flex items-center justify-center',
                      'bg-gradient-to-br from-primary to-primary/60',
                      'shadow-lg shadow-primary/30',
                      'cursor-pointer',
                      'transition-transform duration-300',
                      'hover:scale-110'
                    )}
                    onClick={() => toggleYear(yearData.year)}
                  >
                    {/* 脉冲动画环 */}
                    {isYearExpanded && (
                      <motion.div
                        initial={{ scale: 1, opacity: 0.5 }}
                        animate={{ scale: 1.5, opacity: 0 }}
                        transition={{
                          duration: 1.5,
                          repeat: Infinity,
                          ease: 'easeOut',
                        }}
                        className="absolute inset-0 rounded-full bg-primary"
                      />
                    )}
                    <Calendar className="h-5 w-5 text-white" />
                  </motion.div>
                </div>

                {/* 年份标题 */}
                <div
                  onClick={() => toggleYear(yearData.year)}
                  className={cn(
                    'ml-14 flex cursor-pointer items-center gap-3',
                    'py-2 px-4 rounded-lg',
                    'hover:bg-white/5',
                    'transition-colors duration-200'
                  )}
                >
                  <motion.div
                    animate={{ rotate: isYearExpanded ? 90 : 0 }}
                    transition={{ duration: 0.2 }}
                  >
                    <ChevronRight className="h-5 w-5 text-gray-400" />
                  </motion.div>
                  <h3 className="text-2xl font-bold text-white">
                    {yearData.year}
                  </h3>
                  <span className="text-sm text-gray-400">
                    ({yearData.totalPosts} 篇文章)
                  </span>
                </div>
              </motion.div>

              {/* 月份列表 */}
              <AnimatePresence>
                {isYearExpanded && (
                  <motion.div
                    initial={{ height: 0, opacity: 0 }}
                    animate={{ height: 'auto', opacity: 1 }}
                    exit={{ height: 0, opacity: 0 }}
                    transition={{ duration: 0.3, ease: 'easeInOut' }}
                    className="ml-14 mt-4 space-y-4 overflow-hidden"
                  >
                    {yearData.months.map((monthData, monthIndex) => {
                      const yearMonthKey = `${yearData.year}-${monthData.month}`;
                      const isMonthExpanded = expandedMonths.has(yearMonthKey);

                      return (
                        <div key={monthData.month} className="relative">
                          {/* 月份连接线 */}
                          <div
                            className={cn(
                              'absolute -left-9 top-3 h-[2px] w-8',
                              'bg-gradient-to-r from-primary/30 to-primary/10'
                            )}
                          />

                          {/* 月份节点 */}
                          <motion.div
                            initial={{ opacity: 0, x: -10 }}
                            animate={{ opacity: 1, x: 0 }}
                            transition={{ delay: monthIndex * 0.05 }}
                          >
                            {/* 月份标题 */}
                            <div
                              onClick={() => toggleMonth(yearMonthKey)}
                              className={cn(
                                'flex cursor-pointer items-center gap-2',
                                'py-1.5 px-3 rounded-md',
                                'hover:bg-white/5',
                                'transition-colors duration-200'
                              )}
                            >
                              {/* 月份圆点 */}
                              <div
                                className={cn(
                                  'h-3 w-3 rounded-full',
                                  'bg-primary/60',
                                  'ring-2 ring-primary/20'
                                )}
                              />
                              <motion.div
                                animate={{ rotate: isMonthExpanded ? 90 : 0 }}
                                transition={{ duration: 0.2 }}
                              >
                                <ChevronRight className="h-4 w-4 text-gray-500" />
                              </motion.div>
                              <span className="font-medium text-gray-300">
                                {monthNames[monthData.month - 1]}
                              </span>
                              <span className="text-xs text-gray-500">
                                ({monthData.posts.length})
                              </span>
                            </div>

                            {/* 文章列表 */}
                            <AnimatePresence>
                              {isMonthExpanded && (
                                <motion.ul
                                  initial={{ height: 0, opacity: 0 }}
                                  animate={{ height: 'auto', opacity: 1 }}
                                  exit={{ height: 0, opacity: 0 }}
                                  transition={{ duration: 0.2 }}
                                  className="ml-8 mt-2 space-y-2 overflow-hidden"
                                >
                                  {monthData.posts.map((post, postIndex) => (
                                    <motion.li
                                      key={post.id}
                                      initial={{ opacity: 0, x: -10 }}
                                      animate={{ opacity: 1, x: 0 }}
                                      transition={{ delay: postIndex * 0.03 }}
                                    >
                                      <TimeTreePostItem
                                        post={post}
                                        onClick={() => onPostClick?.(post)}
                                      />
                                    </motion.li>
                                  ))}
                                </motion.ul>
                              )}
                            </AnimatePresence>
                          </motion.div>
                        </div>
                      );
                    })}
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          );
        })}
      </div>
    </div>
  );
};

/**
 * 时间树文章项组件
 */
const TimeTreePostItem: React.FC<{
  post: Post;
  onClick?: () => void;
}> = ({ post, onClick }) => {
  return (
    <motion.div
      whileHover={{ x: 4 }}
      onClick={onClick}
      className={cn(
        'group flex cursor-pointer items-start gap-3',
        'py-2 px-3 rounded-lg',
        'hover:bg-white/5',
        'transition-all duration-200'
      )}
    >
      {/* 文章图标 */}
      <FileText 
        className={cn(
          'mt-0.5 h-4 w-4 flex-shrink-0',
          'text-gray-500 group-hover:text-primary',
          'transition-colors duration-200'
        )} 
      />

      {/* 文章信息 */}
      <div className="flex-1 min-w-0">
        <h4
          className={cn(
            'text-sm font-medium truncate',
            'text-gray-300 group-hover:text-white',
            'transition-colors duration-200'
          )}
        >
          {post.title}
        </h4>
        <div className="mt-1 flex items-center gap-2 text-xs text-gray-500">
          <span>
            {new Date(post.publishedAt).getDate()}日
          </span>
          <span>·</span>
          <span>{post.readingTime} 分钟</span>
          {post.tags && post.tags.length > 0 && (
            <>
              <span>·</span>
              <span className="text-primary/60">
                #{post.tags[0].name}
              </span>
            </>
          )}
        </div>
      </div>
    </motion.div>
  );
};

export default TimeTree;
```

---

**组件三：AI 助手面板组件 (AiAssistant)**

```tsx
// apps/admin/src/pages/posts/components/AiAssistant.tsx

import React, { useState, useCallback, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Sparkles,
  Wand2,
  Tag,
  FileText,
  RefreshCw,
  Settings,
  ChevronDown,
  ChevronUp,
  Copy,
  Check,
  AlertCircle,
  Loader2,
  Trash2,
  RotateCcw,
  Zap,
  BookOpen,
  MessageSquare,
  Palette,
  Search,
  X,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Button, Badge, Textarea, Select, Tooltip } from '@aetherblog/ui';
import { useAiService } from '@/hooks/useAiService';
import { usePromptStore } from '@/stores/promptStore';
import type { AiTask, PromptTemplate } from '@aetherblog/types';

/**
 * AI 助手面板 Props
 */
interface AiAssistantProps {
  /** 当前编辑器内容 */
  content: string;
  /** 选中的文本 */
  selectedText?: string;
  /** 应用AI结果回调 */
  onApplyResult: (result: string, type: 'replace' | 'insert' | 'append') => void;
  /** 应用标签回调 */
  onApplyTags: (tags: string[]) => void;
  /** 应用摘要回调 */
  onApplySummary: (summary: string) => void;
  /** 面板是否展开 */
  isExpanded?: boolean;
  /** 展开状态变更回调 */
  onExpandedChange?: (expanded: boolean) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * AI 任务类型
 */
type TaskType = 
  | 'clean'      // 文本清洗
  | 'rewrite'    // 内容重写
  | 'polish'     // 润色优化
  | 'summarize'  // 生成摘要
  | 'tags'       // 智能标签
  | 'continue'   // 续写内容
  | 'translate'  // 翻译
  | 'custom';    // 自定义

/**
 * 重写风格选项
 */
const REWRITE_STYLES = [
  { value: 'professional', label: '更专业', icon: BookOpen, description: '学术化、严谨的表达' },
  { value: 'casual', label: '更通俗', icon: MessageSquare, description: '口语化、易懂的表达' },
  { value: 'concise', label: '更简洁', icon: Zap, description: '精炼、去除冗余' },
  { value: 'detailed', label: '更详细', icon: FileText, description: '扩展、补充细节' },
  { value: 'creative', label: '更有趣', icon: Palette, description: '生动、有创意的表达' },
];

/**
 * AI 助手面板组件
 * 
 * 功能：
 * - 文本清洗：去除格式问题、统一标点
 * - 内容重写：多种风格转换
 * - 润色优化：提升文章质量
 * - 摘要生成：自动生成文章摘要
 * - 智能标签：AI推荐相关标签
 * - 续写内容：根据上下文续写
 * - Prompt管理：自定义提示词模板
 */
export const AiAssistant: React.FC<AiAssistantProps> = ({
  content,
  selectedText,
  onApplyResult,
  onApplyTags,
  onApplySummary,
  isExpanded = true,
  onExpandedChange,
  className,
}) => {
  // 状态管理
  const [activeTask, setActiveTask] = useState<TaskType | null>(null);
  const [rewriteStyle, setRewriteStyle] = useState<string>('professional');
  const [customPrompt, setCustomPrompt] = useState('');
  const [result, setResult] = useState<string>('');
  const [generatedTags, setGeneratedTags] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [copied, setCopied] = useState(false);
  const [showPromptManager, setShowPromptManager] = useState(false);
  const [streamingText, setStreamingText] = useState('');

  // Refs
  const resultRef = useRef<HTMLDivElement>(null);
  const abortControllerRef = useRef<AbortController | null>(null);

  // Hooks
  const aiService = useAiService();
  const { prompts, activePrompt, setActivePrompt } = usePromptStore();

  // 获取输入文本（优先使用选中文本）
  const inputText = selectedText || content;

  // 检查是否有可用输入
  const hasInput = inputText && inputText.trim().length > 0;

  /**
   * 执行AI任务
   */
  const executeTask = useCallback(async (task: TaskType) => {
    if (!hasInput && task !== 'tags' && task !== 'summarize') {
      setError('请先输入或选择文本内容');
      return;
    }

    // 取消之前的请求
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }
    abortControllerRef.current = new AbortController();

    setActiveTask(task);
    setIsLoading(true);
    setError(null);
    setResult('');
    setStreamingText('');
    setGeneratedTags([]);

    try {
      switch (task) {
        case 'clean':
          await executeCleanTask();
          break;
        case 'rewrite':
          await executeRewriteTask();
          break;
        case 'polish':
          await executePolishTask();
          break;
        case 'summarize':
          await executeSummarizeTask();
          break;
        case 'tags':
          await executeTagsTask();
          break;
        case 'continue':
          await executeContinueTask();
          break;
        case 'custom':
          await executeCustomTask();
          break;
        default:
          throw new Error('未知的任务类型');
      }
    } catch (err: any) {
      if (err.name !== 'AbortError') {
        setError(err.message || 'AI 处理失败，请重试');
      }
    } finally {
      setIsLoading(false);
    }
  }, [hasInput, inputText, rewriteStyle, customPrompt, content]);

  /**
   * 文本清洗任务
   */
  const executeCleanTask = async () => {
    const stream = await aiService.cleanText(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 内容重写任务
   */
  const executeRewriteTask = async () => {
    const stream = await aiService.rewriteText(inputText, rewriteStyle, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 润色优化任务
   */
  const executePolishTask = async () => {
    const stream = await aiService.polishText(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 摘要生成任务
   */
  const executeSummarizeTask = async () => {
    const textToSummarize = content || inputText;
    if (!textToSummarize) {
      throw new Error('请先输入文章内容');
    }

    const stream = await aiService.generateSummary(textToSummarize, {
      maxLength: 150,
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 智能标签任务
   */
  const executeTagsTask = async () => {
    const textForTags = content || inputText;
    if (!textForTags) {
      throw new Error('请先输入文章内容');
    }

    const tags = await aiService.generateTags(textForTags, {
      maxTags: 5,
      signal: abortControllerRef.current?.signal,
    });

    setGeneratedTags(tags);
  };

  /**
   * 续写任务
   */
  const executeContinueTask = async () => {
    const stream = await aiService.continueWriting(inputText, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 自定义Prompt任务
   */
  const executeCustomTask = async () => {
    if (!customPrompt.trim()) {
      throw new Error('请输入自定义提示词');
    }

    const stream = await aiService.customProcess(inputText, customPrompt, {
      signal: abortControllerRef.current?.signal,
    });

    let fullText = '';
    for await (const chunk of stream) {
      fullText += chunk;
      setStreamingText(fullText);
    }
    setResult(fullText);
  };

  /**
   * 取消当前任务
   */
  const cancelTask = () => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
      setIsLoading(false);
      setActiveTask(null);
    }
  };

  /**
   * 复制结果到剪贴板
   */
  const copyResult = async () => {
    const textToCopy = result || streamingText;
    if (textToCopy) {
      await navigator.clipboard.writeText(textToCopy);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  };

  /**
   * 应用结果
   */
  const applyResult = (type: 'replace' | 'insert' | 'append') => {
    const textToApply = result || streamingText;
    if (textToApply) {
      onApplyResult(textToApply, type);
      setResult('');
      setStreamingText('');
      setActiveTask(null);
    }
  };

  /**
   * 应用标签
   */
  const applyTags = () => {
    if (generatedTags.length > 0) {
      onApplyTags(generatedTags);
      setGeneratedTags([]);
      setActiveTask(null);
    }
  };

  /**
   * 应用摘要
   */
  const applySummary = () => {
    const summaryText = result || streamingText;
    if (summaryText) {
      onApplySummary(summaryText);
      setResult('');
      setStreamingText('');
      setActiveTask(null);
    }
  };

  /**
   * 清空结果
   */
  const clearResult = () => {
    setResult('');
    setStreamingText('');
    setGeneratedTags([]);
    setError(null);
    setActiveTask(null);
  };

  // 滚动到结果底部（流式输出时）
  useEffect(() => {
    if (resultRef.current && streamingText) {
      resultRef.current.scrollTop = resultRef.current.scrollHeight;
    }
  }, [streamingText]);

  // 显示的文本（优先流式文本）
  const displayText = streamingText || result;

  return (
    <div
      className={cn(
        'flex flex-col rounded-2xl',
        'bg-gradient-to-br from-gray-900/95 to-gray-800/95',
        'backdrop-blur-xl',
        'border border-white/10',
        'shadow-2xl shadow-black/20',
        'overflow-hidden',
        className
      )}
    >
      {/* 头部 */}
      <div
        className={cn(
          'flex items-center justify-between px-4 py-3',
          'border-b border-white/10',
          'bg-gradient-to-r from-primary/10 to-purple-500/10'
        )}
      >
        <div className="flex items-center gap-2">
          <div className="relative">
            <Sparkles className="h-5 w-5 text-primary" />
            {isLoading && (
              <motion.div
                animate={{ rotate: 360 }}
                transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}
                className="absolute -inset-1 rounded-full border-2 border-primary/30 border-t-primary"
              />
            )}
          </div>
          <h3 className="font-semibold text-white">AI 助手</h3>
          {selectedText && (
            <Badge variant="outline" size="xs" className="text-primary border-primary/30">
              已选中文本
            </Badge>
          )}
        </div>

        <div className="flex items-center gap-2">
          {/* Prompt 管理按钮 */}
          <Tooltip content="Prompt 管理">
            <Button
              variant="ghost"
              size="icon-sm"
              onClick={() => setShowPromptManager(!showPromptManager)}
              className="text-gray-400 hover:text-white"
            >
              <Settings className="h-4 w-4" />
            </Button>
          </Tooltip>

          {/* 展开/收起按钮 */}
          <Button
            variant="ghost"
            size="icon-sm"
            onClick={() => onExpandedChange?.(!isExpanded)}
            className="text-gray-400 hover:text-white"
          >
            {isExpanded ? (
              <ChevronDown className="h-4 w-4" />
            ) : (
              <ChevronUp className="h-4 w-4" />
            )}
          </Button>
        </div>
      </div>

      {/* 主体内容 */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.3 }}
            className="overflow-hidden"
          >
            <div className="p-4 space-y-4">
              {/* 快捷操作按钮组 */}
              <div className="space-y-3">
                <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                  快捷操作
                </div>
                <div className="grid grid-cols-2 gap-2">
                  {/* 文本清洗 */}
                  <TaskButton
                    icon={Trash2}
                    label="文本清洗"
                    description="清理格式、统一标点"
                    isActive={activeTask === 'clean'}
                    isLoading={isLoading && activeTask === 'clean'}
                    onClick={() => executeTask('clean')}
                    disabled={!hasInput || isLoading}
                  />

                  {/* 润色优化 */}
                  <TaskButton
                    icon={Wand2}
                    label="润色优化"
                    description="提升文章质量"
                    isActive={activeTask === 'polish'}
                    isLoading={isLoading && activeTask === 'polish'}
                    onClick={() => executeTask('polish')}
                    disabled={!hasInput || isLoading}
                  />

                  {/* 生成摘要 */}
                  <TaskButton
                    icon={FileText}
                    label="生成摘要"
                    description="自动提取要点"
                    isActive={activeTask === 'summarize'}
                    isLoading={isLoading && activeTask === 'summarize'}
                    onClick={() => executeTask('summarize')}
                    disabled={!content || isLoading}
                  />

                  {/* 智能标签 */}
                  <TaskButton
                    icon={Tag}
                    label="智能标签"
                    description="AI推荐标签"
                    isActive={activeTask === 'tags'}
                    isLoading={isLoading && activeTask === 'tags'}
                    onClick={() => executeTask('tags')}
                    disabled={!content || isLoading}
                  />
                </div>
              </div>

              {/* 内容重写 */}
              <div className="space-y-3">
                <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                  内容重写
                </div>
                
                {/* 风格选择 */}
                <div className="flex flex-wrap gap-2">
                  {REWRITE_STYLES.map((style) => (
                    <Tooltip key={style.value} content={style.description}>
                      <button
                        onClick={() => setRewriteStyle(style.value)}
                        disabled={isLoading}
                        className={cn(
                          'flex items-center gap-1.5 px-3 py-1.5 rounded-lg',
                          'text-sm font-medium',
                          'border transition-all duration-200',
                          rewriteStyle === style.value
                            ? 'bg-primary/20 border-primary/50 text-primary'
                            : 'bg-white/5 border-white/10 text-gray-300 hover:bg-white/10',
                          isLoading && 'opacity-50 cursor-not-allowed'
                        )}
                      >
                        <style.icon className="h-3.5 w-3.5" />
                        {style.label}
                      </button>
                    </Tooltip>
                  ))}
                </div>

                {/* 重写按钮 */}
                <Button
                  onClick={() => executeTask('rewrite')}
                  disabled={!hasInput || isLoading}
                  className="w-full"
                  variant={activeTask === 'rewrite' ? 'primary' : 'secondary'}
                >
                  {isLoading && activeTask === 'rewrite' ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      正在重写...
                    </>
                  ) : (
                    <>
                      <RefreshCw className="mr-2 h-4 w-4" />
                      开始重写
                    </>
                  )}
                </Button>
              </div>

              {/* 自定义 Prompt */}
              <div className="space-y-3">
                <div className="flex items-center justify-between">
                  <div className="text-xs font-medium text-gray-400 uppercase tracking-wider">
                    自定义指令
                  </div>
                  {prompts.length > 0 && (
                    <Select
                      value={activePrompt?.id || ''}
                      onChange={(value) => {
                        const prompt = prompts.find((p) => p.id === value);
                        if (prompt) {
                          setActivePrompt(prompt);
                          setCustomPrompt(prompt.content);
                        }
                      }}
                      placeholder="选择模板"
                      className="w-32"
                      size="sm"
                    >
                      {prompts.map((prompt) => (
                        <Select.Option key={prompt.id} value={prompt.id}>
                          {prompt.name}
                        </Select.Option>
                      ))}
                    </Select>
                  )}
                </div>

                <Textarea
                  value={customPrompt}
                  onChange={(e) => setCustomPrompt(e.target.value)}
                  placeholder="输入自定义指令，例如：将这段技术文档改写成适合初学者的教程..."
                  rows={3}
                  className="resize-none"
                />

                <Button
                  onClick={() => executeTask('custom')}
                  disabled={!hasInput || !customPrompt.trim() || isLoading}
                  className="w-full"
                  variant="outline"
                >
                  {isLoading && activeTask === 'custom' ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      处理中...
                    </>
                  ) : (
                    <>
                      <Sparkles className="mr-2 h-4 w-4" />
                      执行自定义指令
                    </>
                  )}
                </Button>
              </div>

              {/* 错误提示 */}
              <AnimatePresence>
                {error && (
                  <motion.div
                    initial={{ opacity: 0, y: -10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -10 }}
                    className={cn(
                      'flex items-center gap-2 p-3 rounded-lg',
                      'bg-red-500/10 border border-red-500/30',
                      'text-sm text-red-400'
                    )}
                  >
                    <AlertCircle className="h-4 w-4 flex-shrink-0" />
                    <span>{error}</span>
                    <button
                      onClick={() => setError(null)}
                      className="ml-auto hover:text-red-300"
                    >
                      <X className="h-4 w-4" />
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 生成的标签 */}
              <AnimatePresence>
                {generatedTags.length > 0 && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 10 }}
                    className="space-y-3"
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-xs font-medium text-gray-400">
                        AI 推荐标签
                      </div>
                      <Button
                        size="sm"
                        onClick={applyTags}
                        className="text-xs"
                      >
                        应用标签
                      </Button>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {generatedTags.map((tag, index) => (
                        <motion.div
                          key={tag}
                          initial={{ opacity: 0, scale: 0.8 }}
                          animate={{ opacity: 1, scale: 1 }}
                          transition={{ delay: index * 0.1 }}
                        >
                          <Badge
                            variant="secondary"
                            className="cursor-pointer hover:bg-primary/20"
                          >
                            #{tag}
                          </Badge>
                        </motion.div>
                      ))}
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 结果显示区域 */}
              <AnimatePresence>
                {(displayText || isLoading) && activeTask !== 'tags' && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 10 }}
                    className="space-y-3"
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <div className="text-xs font-medium text-gray-400">
                          生成结果
                        </div>
                        {isLoading && (
                          <motion.div
                            animate={{ opacity: [0.5, 1, 0.5] }}
                            transition={{ duration: 1.5, repeat: Infinity }}
                            className="flex items-center gap-1 text-xs text-primary"
                          >
                            <Loader2 className="h-3 w-3 animate-spin" />
                            生成中...
                          </motion.div>
                        )}
                      </div>

                      <div className="flex items-center gap-1">
                        {/* 复制按钮 */}
                        <Tooltip content={copied ? '已复制' : '复制'}>
                          <Button
                            variant="ghost"
                            size="icon-sm"
                            onClick={copyResult}
                            disabled={!displayText}
                            className="text-gray-400 hover:text-white"
                          >
                            {copied ? (
                              <Check className="h-4 w-4 text-green-400" />
                            ) : (
                              <Copy className="h-4 w-4" />
                            )}
                          </Button>
                        </Tooltip>

                        {/* 清空按钮 */}
                        <Tooltip content="清空">
                          <Button
                            variant="ghost"
                            size="icon-sm"
                            onClick={clearResult}
                            className="text-gray-400 hover:text-white"
                          >
                            <RotateCcw className="h-4 w-4" />
                          </Button>
                        </Tooltip>

                        {/* 取消按钮 */}
                        {isLoading && (
                          <Tooltip content="取消">
                            <Button
                              variant="ghost"
                              size="icon-sm"
                              onClick={cancelTask}
                              className="text-red-400 hover:text-red-300"
                            >
                              <X className="h-4 w-4" />
                            </Button>
                          </Tooltip>
                        )}
                      </div>
                    </div>

                    {/* 结果内容 */}
                    <div
                      ref={resultRef}
                      className={cn(
                        'max-h-64 overflow-y-auto rounded-lg p-4',
                        'bg-black/30 border border-white/5',
                        'text-sm text-gray-300 leading-relaxed',
                        'prose prose-invert prose-sm max-w-none'
                      )}
                    >
                      {displayText || (
                        <div className="flex items-center gap-2 text-gray-500">
                          <Loader2 className="h-4 w-4 animate-spin" />
                          正在生成...
                        </div>
                      )}
                      {/* 光标动画 */}
                      {isLoading && displayText && (
                        <motion.span
                          animate={{ opacity: [1, 0] }}
                          transition={{ duration: 0.8, repeat: Infinity }}
                          className="inline-block w-2 h-4 ml-0.5 bg-primary"
                        />
                      )}
                    </div>

                    {/* 应用按钮组 */}
                    {displayText && !isLoading && (
                      <div className="flex gap-2">
                        {activeTask === 'summarize' ? (
                          <Button
                            onClick={applySummary}
                            className="flex-1"
                            variant="primary"
                          >
                            <Check className="mr-2 h-4 w-4" />
                            应用为摘要
                          </Button>
                        ) : (
                          <>
                            {selectedText && (
                              <Button
                                onClick={() => applyResult('replace')}
                                className="flex-1"
                                variant="primary"
                              >
                                替换选中
                              </Button>
                            )}
                            <Button
                              onClick={() => applyResult('insert')}
                              className="flex-1"
                              variant={selectedText ? 'secondary' : 'primary'}
                            >
                              插入光标处
                            </Button>
                            <Button
                              onClick={() => applyResult('append')}
                              className="flex-1"
                              variant="outline"
                            >
                              追加到末尾
                            </Button>
                          </>
                        )}
                      </div>
                    )}
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Prompt 管理弹窗 */}
      <PromptManagerModal
        isOpen={showPromptManager}
        onClose={() => setShowPromptManager(false)}
      />
    </div>
  );
};

/**
 * 任务按钮组件 Props
 */
interface TaskButtonProps {
  /** 图标组件 */
  icon: React.FC<{ className?: string }>;
  /** 按钮标签 */
  label: string;
  /** 描述文字 */
  description: string;
  /** 是否激活状态 */
  isActive: boolean;
  /** 是否加载中 */
  isLoading: boolean;
  /** 点击事件 */
  onClick: () => void;
  /** 是否禁用 */
  disabled?: boolean;
}

/**
 * 任务按钮组件
 */
const TaskButton: React.FC<TaskButtonProps> = ({
  icon: Icon,
  label,
  description,
  isActive,
  isLoading,
  onClick,
  disabled = false,
}) => {
  return (
    <motion.button
      whileHover={{ scale: disabled ? 1 : 1.02 }}
      whileTap={{ scale: disabled ? 1 : 0.98 }}
      onClick={onClick}
      disabled={disabled}
      className={cn(
        'group relative flex flex-col items-start gap-1.5',
        'p-3 rounded-xl text-left',
        'border transition-all duration-200',
        // 默认状态
        'bg-white/5 border-white/10',
        // 激活状态
        isActive && 'bg-primary/10 border-primary/30 ring-1 ring-primary/20',
        // 悬浮状态
        !disabled && 'hover:bg-white/10 hover:border-white/20',
        // 禁用状态
        disabled && 'opacity-50 cursor-not-allowed'
      )}
    >
      {/* 加载指示器 */}
      {isLoading && (
        <div className="absolute inset-0 flex items-center justify-center rounded-xl bg-black/50 backdrop-blur-sm">
          <Loader2 className="h-5 w-5 animate-spin text-primary" />
        </div>
      )}

      {/* 图标和标签 */}
      <div className="flex items-center gap-2">
        <div
          className={cn(
            'p-1.5 rounded-lg transition-colors duration-200',
            isActive
              ? 'bg-primary/20 text-primary'
              : 'bg-white/10 text-gray-400 group-hover:text-white'
          )}
        >
          <Icon className="h-4 w-4" />
        </div>
        <span
          className={cn(
            'font-medium text-sm transition-colors duration-200',
            isActive ? 'text-primary' : 'text-white'
          )}
        >
          {label}
        </span>
      </div>

      {/* 描述 */}
      <span className="text-xs text-gray-500 pl-9">
        {description}
      </span>

      {/* 激活指示条 */}
      {isActive && (
        <motion.div
          layoutId="activeTaskIndicator"
          className="absolute bottom-0 left-3 right-3 h-0.5 bg-primary rounded-full"
          initial={false}
          transition={{ type: 'spring', stiffness: 500, damping: 30 }}
        />
      )}
    </motion.button>
  );
};

/**
 * Prompt 管理弹窗 Props
 */
interface PromptManagerModalProps {
  isOpen: boolean;
  onClose: () => void;
}

/**
 * Prompt 管理弹窗组件
 */
const PromptManagerModal: React.FC<PromptManagerModalProps> = ({
  isOpen,
  onClose,
}) => {
  const { prompts, addPrompt, updatePrompt, deletePrompt } = usePromptStore();
  const [editingPrompt, setEditingPrompt] = useState<PromptTemplate | null>(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    content: '',
    category: 'general',
  });

  // 重置表单
  const resetForm = () => {
    setFormData({
      name: '',
      description: '',
      content: '',
      category: 'general',
    });
    setEditingPrompt(null);
    setIsCreating(false);
  };

  // 打开编辑
  const handleEdit = (prompt: PromptTemplate) => {
    setEditingPrompt(prompt);
    setFormData({
      name: prompt.name,
      description: prompt.description || '',
      content: prompt.content,
      category: prompt.category || 'general',
    });
    setIsCreating(false);
  };

  // 保存 Prompt
  const handleSave = () => {
    if (!formData.name.trim() || !formData.content.trim()) {
      return;
    }

    if (editingPrompt) {
      updatePrompt(editingPrompt.id, formData);
    } else {
      addPrompt({
        id: crypto.randomUUID(),
        ...formData,
        createdAt: new Date().toISOString(),
      });
    }

    resetForm();
  };

  // 删除 Prompt
  const handleDelete = (id: string) => {
    if (confirm('确定要删除这个 Prompt 模板吗？')) {
      deletePrompt(id);
      if (editingPrompt?.id === id) {
        resetForm();
      }
    }
  };

  // Prompt 分类
  const categories = [
    { value: 'general', label: '通用' },
    { value: 'rewrite', label: '重写' },
    { value: 'translate', label: '翻译' },
    { value: 'code', label: '代码' },
    { value: 'seo', label: 'SEO' },
  ];

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* 遮罩层 */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
          />

          {/* 弹窗内容 */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            transition={{ type: 'spring', duration: 0.5 }}
            className={cn(
              'fixed left-1/2 top-1/2 z-50 -translate-x-1/2 -translate-y-1/2',
              'w-full max-w-4xl max-h-[80vh]',
              'bg-gray-900 rounded-2xl',
              'border border-white/10',
              'shadow-2xl shadow-black/50',
              'overflow-hidden'
            )}
          >
            {/* 头部 */}
            <div className="flex items-center justify-between px-6 py-4 border-b border-white/10">
              <div className="flex items-center gap-3">
                <Settings className="h-5 w-5 text-primary" />
                <h2 className="text-lg font-semibold text-white">Prompt 模板管理</h2>
                <Badge variant="outline" size="sm">
                  {prompts.length} 个模板
                </Badge>
              </div>
              <Button
                variant="ghost"
                size="icon-sm"
                onClick={onClose}
                className="text-gray-400 hover:text-white"
              >
                <X className="h-5 w-5" />
              </Button>
            </div>

            {/* 主体 */}
            <div className="flex h-[60vh]">
              {/* 左侧列表 */}
              <div className="w-1/3 border-r border-white/10 overflow-y-auto">
                {/* 新建按钮 */}
                <div className="p-4 border-b border-white/5">
                  <Button
                    onClick={() => {
                      resetForm();
                      setIsCreating(true);
                    }}
                    className="w-full"
                    variant="outline"
                  >
                    <Plus className="mr-2 h-4 w-4" />
                    新建模板
                  </Button>
                </div>

                {/* Prompt 列表 */}
                <div className="p-2 space-y-1">
                  {prompts.length === 0 ? (
                    <div className="py-8 text-center text-gray-500">
                      <FileText className="mx-auto h-8 w-8 mb-2 opacity-50" />
                      <p className="text-sm">暂无 Prompt 模板</p>
                      <p className="text-xs mt-1">点击上方按钮创建</p>
                    </div>
                  ) : (
                    prompts.map((prompt) => (
                      <motion.div
                        key={prompt.id}
                        whileHover={{ x: 4 }}
                        onClick={() => handleEdit(prompt)}
                        className={cn(
                          'flex items-center justify-between p-3 rounded-lg cursor-pointer',
                          'transition-colors duration-200',
                          editingPrompt?.id === prompt.id
                            ? 'bg-primary/10 border border-primary/30'
                            : 'hover:bg-white/5'
                        )}
                      >
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <span className="font-medium text-white truncate">
                              {prompt.name}
                            </span>
                            <Badge variant="outline" size="xs">
                              {categories.find((c) => c.value === prompt.category)?.label || '通用'}
                            </Badge>
                          </div>
                          {prompt.description && (
                            <p className="mt-0.5 text-xs text-gray-500 truncate">
                              {prompt.description}
                            </p>
                          )}
                        </div>
                        <Button
                          variant="ghost"
                          size="icon-xs"
                          onClick={(e) => {
                            e.stopPropagation();
                            handleDelete(prompt.id);
                          }}
                          className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-400"
                        >
                          <Trash2 className="h-3.5 w-3.5" />
                        </Button>
                      </motion.div>
                    ))
                  )}
                </div>
              </div>

              {/* 右侧编辑区 */}
              <div className="flex-1 p-6 overflow-y-auto">
                {editingPrompt || isCreating ? (
                  <div className="space-y-4">
                    <h3 className="text-lg font-medium text-white">
                      {editingPrompt ? '编辑模板' : '新建模板'}
                    </h3>

                    {/* 名称 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        模板名称 <span className="text-red-400">*</span>
                      </label>
                      <Input
                        value={formData.name}
                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                        placeholder="例如：技术文章润色"
                        className="w-full"
                      />
                    </div>

                    {/* 分类 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        分类
                      </label>
                      <Select
                        value={formData.category}
                        onChange={(value) => setFormData({ ...formData, category: value })}
                        className="w-full"
                      >
                        {categories.map((cat) => (
                          <Select.Option key={cat.value} value={cat.value}>
                            {cat.label}
                          </Select.Option>
                        ))}
                      </Select>
                    </div>

                    {/* 描述 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        描述
                      </label>
                      <Input
                        value={formData.description}
                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                        placeholder="简短描述这个模板的用途"
                        className="w-full"
                      />
                    </div>

                    {/* Prompt 内容 */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-gray-300">
                        Prompt 内容 <span className="text-red-400">*</span>
                      </label>
                      <Textarea
                        value={formData.content}
                        onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                        placeholder={`输入 Prompt 模板内容...\n\n可用变量：\n{{content}} - 用户输入的文本\n{{language}} - 目标语言\n{{style}} - 写作风格`}
                        rows={10}
                        className="w-full font-mono text-sm"
                      />
                      <p className="text-xs text-gray-500">
                        支持使用 {'{{content}}'} 等变量，运行时会自动替换
                      </p>
                    </div>

                    {/* 操作按钮 */}
                    <div className="flex gap-3 pt-4">
                      <Button
                        onClick={handleSave}
                        disabled={!formData.name.trim() || !formData.content.trim()}
                        className="flex-1"
                      >
                        <Check className="mr-2 h-4 w-4" />
                        保存模板
                      </Button>
                      <Button
                        variant="outline"
                        onClick={resetForm}
                        className="flex-1"
                      >
                        取消
                      </Button>
                    </div>
                  </div>
                ) : (
                  <div className="h-full flex items-center justify-center text-gray-500">
                    <div className="text-center">
                      <MousePointer className="mx-auto h-12 w-12 mb-3 opacity-30" />
                      <p>选择左侧模板进行编辑</p>
                      <p className="text-sm mt-1">或点击"新建模板"创建</p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

// 补充缺少的图标导入
import { Plus, MousePointer } from 'lucide-react';
import { Input } from '@aetherblog/ui';

export default AiAssistant;
```

---

**组件四：智能搜索组件 (SearchPanel)**

```tsx
// apps/blog/src/components/search/SearchPanel.tsx

import React, { useState, useCallback, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Search,
  X,
  Loader2,
  Clock,
  TrendingUp,
  FileText,
  Sparkles,
  ArrowRight,
  Tag,
  Folder,
  History,
  Trash2,
} from 'lucide-react';
import { useRouter } from 'next/navigation';
import { cn } from '@aetherblog/utils';
import { useDebounce } from '@aetherblog/hooks';
import { Badge } from '@aetherblog/ui';
import { searchService } from '@/services/searchService';
import type { SearchResult, AiSearchAnswer } from '@aetherblog/types';

/**
 * 搜索面板 Props
 */
interface SearchPanelProps {
  /** 是否打开 */
  isOpen: boolean;
  /** 关闭回调 */
  onClose: () => void;
}

/**
 * 智能搜索面板组件
 * 
 * 功能特性：
 * - 全文检索 + 语义搜索混合模式
 * - AI 生成直接回答
 * - 搜索历史记录
 * - 热门搜索推荐
 * - 键盘快捷键支持
 * - 实时搜索建议
 */
export const SearchPanel: React.FC<SearchPanelProps> = ({
  isOpen,
  onClose,
}) => {
  // 状态
  const [query, setQuery] = useState('');
  const [results, setResults] = useState<SearchResult[]>([]);
  const [aiAnswer, setAiAnswer] = useState<AiSearchAnswer | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isAiLoading, setIsAiLoading] = useState(false);
  const [activeIndex, setActiveIndex] = useState(-1);
  const [searchHistory, setSearchHistory] = useState<string[]>([]);
  const [showHistory, setShowHistory] = useState(true);

  // Refs
  const inputRef = useRef<HTMLInputElement>(null);
  const resultsRef = useRef<HTMLDivElement>(null);

  // Hooks
  const router = useRouter();
  const debouncedQuery = useDebounce(query, 300);

  // 热门搜索词
  const trendingSearches = [
    'Spring Boot 3',
    'React 19 新特性',
    'JDK 21 虚拟线程',
    'TypeScript 技巧',
    'Docker 部署',
  ];

  // 加载搜索历史
  useEffect(() => {
    const history = localStorage.getItem('searchHistory');
    if (history) {
      setSearchHistory(JSON.parse(history));
    }
  }, []);

  // 保存搜索历史
  const saveToHistory = useCallback((searchQuery: string) => {
    const trimmed = searchQuery.trim();
    if (!trimmed) return;

    setSearchHistory((prev) => {
      const filtered = prev.filter((item) => item !== trimmed);
      const newHistory = [trimmed, ...filtered].slice(0, 10);
      localStorage.setItem('searchHistory', JSON.stringify(newHistory));
      return newHistory;
    });
  }, []);

  // 清空搜索历史
  const clearHistory = useCallback(() => {
    setSearchHistory([]);
    localStorage.removeItem('searchHistory');
  }, []);

  // 执行搜索
  const performSearch = useCallback(async (searchQuery: string) => {
    if (!searchQuery.trim()) {
      setResults([]);
      setAiAnswer(null);
      setShowHistory(true);
      return;
    }

    setIsLoading(true);
    setShowHistory(false);

    try {
      // 并行执行：普通搜索 + AI 搜索
      const searchPromise = searchService.search(searchQuery);
      
      // 先获取普通搜索结果
      const searchResults = await searchPromise;
      setResults(searchResults);
      setIsLoading(false);

      // 异步获取 AI 回答
      setIsAiLoading(true);
      const aiSearchAnswer = await searchService.getAiAnswer(searchQuery, searchResults);
      setAiAnswer(aiSearchAnswer);
      setIsAiLoading(false);
    } catch (error) {
      console.error('Search error:', error);
      setIsLoading(false);
      setIsAiLoading(false);
    }
  }, []);

  // 防抖搜索
  useEffect(() => {
    performSearch(debouncedQuery);
  }, [debouncedQuery, performSearch]);

  // 处理搜索提交
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (query.trim()) {
      saveToHistory(query);
      if (activeIndex >= 0 && results[activeIndex]) {
        router.push(`/posts/${results[activeIndex].slug}`);
        onClose();
      }
    }
  };

  // 处理结果点击
  const handleResultClick = (result: SearchResult) => {
    saveToHistory(query);
    router.push(`/posts/${result.slug}`);
    onClose();
  };

  // 处理历史/热门词点击
  const handleQuickSearch = (searchTerm: string) => {
    setQuery(searchTerm);
  };

  // 键盘导航
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (!isOpen) return;

      switch (e.key) {
        case 'Escape':
          onClose();
          break;
        case 'ArrowDown':
          e.preventDefault();
          setActiveIndex((prev) => 
            prev < results.length - 1 ? prev + 1 : prev
          );
          break;
        case 'ArrowUp':
          e.preventDefault();
          setActiveIndex((prev) => (prev > 0 ? prev - 1 : -1));
          break;
        case 'Enter':
          if (activeIndex >= 0 && results[activeIndex]) {
            handleResultClick(results[activeIndex]);
          }
          break;
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [isOpen, activeIndex, results, onClose]);

  // 自动聚焦
  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen]);

  // 滚动激活项到视图
  useEffect(() => {
    if (activeIndex >= 0 && resultsRef.current) {
      const activeElement = resultsRef.current.children[activeIndex] as HTMLElement;
      if (activeElement) {
        activeElement.scrollIntoView({ block: 'nearest' });
      }
    }
  }, [activeIndex]);

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* 遮罩层 */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 z-50 bg-black/80 backdrop-blur-md"
          />

          {/* 搜索面板 */}
          <motion.div
            initial={{ opacity: 0, y: -50, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -50, scale: 0.95 }}
            transition={{ type: 'spring', duration: 0.5 }}
            className={cn(
              'fixed left-1/2 top-[10%] z-50 -translate-x-1/2',
              'w-full max-w-2xl',
              'bg-gray-900/95 backdrop-blur-xl',
              'rounded-2xl border border-white/10',
              'shadow-2xl shadow-black/50',
              'overflow-hidden'
            )}
          >
            {/* 搜索输入框 */}
            <form onSubmit={handleSubmit} className="relative">
              <div className="flex items-center px-4 py-4 border-b border-white/10">
                <Search className="h-5 w-5 text-gray-400" />
                <input
                  ref={inputRef}
                  type="text"
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  placeholder="搜索文章、标签、分类... (支持自然语言)"
                  className={cn(
                    'flex-1 mx-3 bg-transparent',
                    'text-white placeholder-gray-500',
                    'outline-none text-lg'
                  )}
                />
                {query && (
                  <button
                    type="button"
                    onClick={() => setQuery('')}
                    className="p-1 text-gray-400 hover:text-white transition-colors"
                  >
                    <X className="h-5 w-5" />
                  </button>
                )}
                {isLoading && (
                  <Loader2 className="h-5 w-5 text-primary animate-spin" />
                )}
              </div>

              {/* 快捷键提示 */}
              <div className="absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2">
                <kbd className="hidden md:inline-flex items-center px-2 py-0.5 rounded bg-white/10 text-xs text-gray-400">
                  ESC
                </kbd>
              </div>
            </form>

            {/* 内容区域 */}
            <div className="max-h-[60vh] overflow-y-auto">
              {/* AI 回答区域 */}
              <AnimatePresence>
                {(aiAnswer || isAiLoading) && !showHistory && (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    exit={{ opacity: 0, height: 0 }}
                    className="border-b border-white/10"
                  >
                    <div className="p-4">
                      <div className="flex items-center gap-2 mb-3">
                        <div className="p-1.5 rounded-lg bg-primary/20">
                          <Sparkles className="h-4 w-4 text-primary" />
                        </div>
                        <span className="text-sm font-medium text-primary">
                          AI 智能回答
                        </span>
                        {isAiLoading && (
                          <Loader2 className="h-4 w-4 text-primary animate-spin" />
                        )}
                      </div>

                      {isAiLoading ? (
                        <div className="space-y-2">
                          <div className="h-4 bg-white/5 rounded animate-pulse" />
                          <div className="h-4 bg-white/5 rounded animate-pulse w-3/4" />
                          <div className="h-4 bg-white/5 rounded animate-pulse w-1/2" />
                        </div>
                      ) : aiAnswer && (
                        <div className="space-y-3">
                          <p className="text-gray-300 text-sm leading-relaxed">
                            {aiAnswer.answer}
                          </p>
                          {aiAnswer.sources && aiAnswer.sources.length > 0 && (
                            <div className="flex flex-wrap gap-2">
                              <span className="text-xs text-gray-500">来源:</span>
                              {aiAnswer.sources.map((source, index) => (
                                <button
                                  key={index}
                                  onClick={() => router.push(`/posts/${source.slug}`)}
                                  className="text-xs text-primary hover:underline"
                                >
                                  {source.title}
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* 搜索历史和热门搜索 */}
              {showHistory && !query && (
                <div className="p-4 space-y-6">
                  {/* 搜索历史 */}
                  {searchHistory.length > 0 && (
                    <div>
                      <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-2 text-sm text-gray-400">
                          <History className="h-4 w-4" />
                          <span>搜索历史</span>
                        </div>
                        <button
                          onClick={clearHistory}
                          className={cn(
                            'flex items-center gap-1 px-2 py-1 rounded',
                            'text-xs text-gray-500',
                            'hover:text-red-400 hover:bg-red-400/10',
                            'transition-colors duration-200'
                          )}
                        >
                          <Trash2 className="h-3 w-3" />
                          清空
                        </button>
                      </div>
                      <div className="flex flex-wrap gap-2">
                        {searchHistory.map((item, index) => (
                          <motion.button
                            key={item}
                            initial={{ opacity: 0, scale: 0.9 }}
                            animate={{ opacity: 1, scale: 1 }}
                            transition={{ delay: index * 0.05 }}
                            onClick={() => handleQuickSearch(item)}
                            className={cn(
                              'flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm',
                              'bg-white/5 text-gray-300 border border-white/5',
                              'hover:bg-white/10 hover:text-white hover:border-white/10',
                              'transition-all duration-200'
                            )}
                          >
                            <Clock className="h-3 w-3 text-gray-500" />
                            {item}
                          </motion.button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* 热门搜索 */}
                  <div>
                    <div className="flex items-center gap-2 text-sm text-gray-400 mb-3">
                      <TrendingUp className="h-4 w-4" />
                      <span>热门搜索</span>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {trendingSearches.map((item, index) => (
                        <motion.button
                          key={item}
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ delay: index * 0.05 + 0.1 }}
                          onClick={() => handleQuickSearch(item)}
                          className={cn(
                            'flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm',
                            'bg-primary/10 text-primary border border-primary/20',
                            'hover:bg-primary/20 hover:border-primary/30',
                            'transition-all duration-200'
                          )}
                        >
                          <span className="text-xs font-bold text-primary/60">
                            {index + 1}
                          </span>
                          {item}
                        </motion.button>
                      ))}
                    </div>
                  </div>

                  {/* 搜索提示 */}
                  <div className="pt-4 border-t border-white/5">
                    <p className="text-xs text-gray-500 text-center">
                      💡 支持自然语言搜索，例如："如何优化 Spring Boot 性能"
                    </p>
                  </div>
                </div>
              )}

              {/* 搜索结果列表 */}
              {!showHistory && results.length > 0 && (
                <div ref={resultsRef} className="divide-y divide-white/5">
                  {results.map((result, index) => (
                    <SearchResultItem
                      key={result.id}
                      result={result}
                      isActive={index === activeIndex}
                      query={query}
                      onClick={() => handleResultClick(result)}
                      onMouseEnter={() => setActiveIndex(index)}
                    />
                  ))}
                </div>
              )}

              {/* 无结果状态 */}
              {!showHistory && !isLoading && query && results.length === 0 && (
                <div className="py-12 text-center">
                  <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/5 mb-4">
                    <Search className="h-8 w-8 text-gray-500" />
                  </div>
                  <p className="text-gray-400 mb-2">
                    未找到与 "<span className="text-white">{query}</span>" 相关的内容
                  </p>
                  <p className="text-sm text-gray-500">
                    试试其他关键词，或使用更具体的描述
                  </p>
                </div>
              )}

              {/* 加载状态 */}
              {isLoading && (
                <div className="py-8 space-y-3">
                  {[1, 2, 3].map((i) => (
                    <div key={i} className="px-4">
                      <div className="animate-pulse space-y-2">
                        <div className="h-5 bg-white/5 rounded w-3/4" />
                        <div className="h-4 bg-white/5 rounded w-full" />
                        <div className="h-4 bg-white/5 rounded w-1/2" />
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* 底部快捷键提示 */}
            <div className="px-4 py-3 border-t border-white/10 bg-black/30">
              <div className="flex items-center justify-between text-xs text-gray-500">
                <div className="flex items-center gap-4">
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">↑</kbd>
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">↓</kbd>
                    <span>导航</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">Enter</kbd>
                    <span>打开</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <kbd className="px-1.5 py-0.5 rounded bg-white/10">ESC</kbd>
                    <span>关闭</span>
                  </span>
                </div>
                <div className="flex items-center gap-1">
                  <Sparkles className="h-3 w-3 text-primary" />
                  <span>AI 语义搜索已启用</span>
                </div>
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

/**
 * 搜索结果项组件 Props
 */
interface SearchResultItemProps {
  result: SearchResult;
  isActive: boolean;
  query: string;
  onClick: () => void;
  onMouseEnter: () => void;
}

/**
 * 搜索结果项组件
 */
const SearchResultItem: React.FC<SearchResultItemProps> = ({
  result,
  isActive,
  query,
  onClick,
  onMouseEnter,
}) => {
  // 高亮匹配文本
  const highlightText = (text: string, query: string) => {
    if (!query.trim()) return text;

    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[]]/g, '\\$&')})`, 'gi');
    const parts = text.split(regex);

    return parts.map((part, index) =>
      regex.test(part) ? (
        <mark key={index} className="bg-primary/30 text-white rounded px-0.5">
          {part}
        </mark>
      ) : (
        part
      )
    );
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: -10 }}
      animate={{ opacity: 1, x: 0 }}
      onClick={onClick}
      onMouseEnter={onMouseEnter}
      className={cn(
        'flex items-start gap-4 px-4 py-4 cursor-pointer',
        'transition-colors duration-150',
        isActive ? 'bg-white/10' : 'hover:bg-white/5'
      )}
    >
      {/* 图标 */}
      <div
        className={cn(
          'flex-shrink-0 p-2 rounded-lg',
          isActive ? 'bg-primary/20' : 'bg-white/5'
        )}
      >
        <FileText
          className={cn('h-5 w-5', isActive ? 'text-primary' : 'text-gray-400')}
        />
      </div>

      {/* 内容 */}
      <div className="flex-1 min-w-0">
        {/* 标题 */}
        <h4
          className={cn(
            'font-medium truncate mb-1',
            isActive ? 'text-white' : 'text-gray-200'
          )}
        >
          {highlightText(result.title, query)}
        </h4>

        {/* 摘要/匹配片段 */}
        {result.highlight && (
          <p className="text-sm text-gray-400 line-clamp-2 mb-2">
            {highlightText(result.highlight, query)}
          </p>
        )}

        {/* 元信息 */}
        <div className="flex items-center gap-3 text-xs text-gray-500">
          {/* 分类 */}
          {result.category && (
            <span className="flex items-center gap-1">
              <Folder className="h-3 w-3" />
              {result.category}
            </span>
          )}

          {/* 标签 */}
          {result.tags && result.tags.length > 0 && (
            <span className="flex items-center gap-1">
              <Tag className="h-3 w-3" />
              {result.tags.slice(0, 2).join(', ')}
            </span>
          )}

          {/* 日期 */}
          <span>{result.publishedAt}</span>

          {/* 相关度分数 */}
          {result.score && (
            <Badge variant="outline" size="xs" className="text-primary border-primary/30">
              匹配度 {Math.round(result.score * 100)}%
            </Badge>
          )}
        </div>
      </div>

      {/* 箭头 */}
      <ArrowRight
        className={cn(
          'flex-shrink-0 h-5 w-5 transition-transform duration-200',
          isActive ? 'text-primary translate-x-1' : 'text-gray-600'
        )}
      />
    </motion.div>
  );
};

export default SearchPanel;
```

---

**组件五：友链卡片组件 (FriendCard)**

```tsx
// apps/blog/src/components/friends/FriendCard.tsx

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { ExternalLink, Globe, Mail, Rss } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { Avatar } from '@aetherblog/ui';
import type { FriendLink } from '@aetherblog/types';

/**
 * 友链卡片 Props
 */
interface FriendCardProps {
  /** 友链数据 */
  friend: FriendLink;
  /** 卡片索引（用于动画延迟） */
  index?: number;
  /** 自定义类名 */
  className?: string;
}

/**
 * 友链卡片组件
 * 
 * 设计特点：
 * - 精美的毛玻璃卡片效果
 * - 支持自定义主题色
 * - 悬浮时的光效和位移动画
 * - 头像加载失败时的优雅降级
 */
export const FriendCard: React.FC<FriendCardProps> = ({
  friend,
  index = 0,
  className,
}) => {
  const [imageError, setImageError] = useState(false);

  // 根据友链设置的颜色生成渐变
  const themeColor = friend.themeColor || '#6366f1';
  
  // 卡片动画变体
  const cardVariants = {
    initial: { opacity: 0, y: 30, scale: 0.95 },
    animate: {
      opacity: 1,
      y: 0,
      scale: 1,
      transition: {
        delay: index * 0.1,
        duration: 0.4,
        ease: [0.25, 0.46, 0.45, 0.94],
      },
    },
    hover: {
      y: -8,
      scale: 1.02,
      transition: { duration: 0.3 },
    },
  };

  // 光效动画变体
  const glowVariants = {
    initial: { opacity: 0 },
    hover: {
      opacity: 1,
      transition: { duration: 0.3 },
    },
  };

  return (
    <motion.a
      href={friend.url}
      target="_blank"
      rel="noopener noreferrer"
      variants={cardVariants}
      initial="initial"
      animate="animate"
      whileHover="hover"
      className={cn(
        'group relative block overflow-hidden rounded-2xl',
        'bg-white/5 backdrop-blur-xl',
        'border border-white/10',
        'shadow-lg shadow-black/10',
        'transition-shadow duration-300',
        'hover:shadow-2xl hover:shadow-black/20',
        className
      )}
    >
      {/* 背景装饰 - 主题色光晕 */}
      <motion.div
        variants={glowVariants}
        className="absolute -top-20 -right-20 h-40 w-40 rounded-full blur-3xl"
        style={{ backgroundColor: `${themeColor}30` }}
      />

      {/* 顶部装饰条 */}
      <div
        className="h-1.5 w-full"
        style={{
          background: `linear-gradient(90deg, ${themeColor}, ${themeColor}80)`,
        }}
      />

      {/* 卡片内容 */}
      <div className="relative p-5">
        <div className="flex items-start gap-4">
          {/* 头像 */}
          <motion.div
            whileHover={{ rotate: [0, -5, 5, 0] }}
            transition={{ duration: 0.5 }}
            className="relative flex-shrink-0"
          >
            {/* 头像光环 */}
            <div
              className="absolute -inset-1 rounded-full opacity-50 blur-sm"
              style={{ backgroundColor: themeColor }}
            />
            
            {/* 头像图片 */}
            <div className="relative h-16 w-16 rounded-full overflow-hidden ring-2 ring-white/20">
              {!imageError ? (
                <img
                  src={friend.avatar}
                  alt={friend.name}
                  onError={() => setImageError(true)}
                  className="h-full w-full object-cover"
                />
              ) : (
                <div
                  className="h-full w-full flex items-center justify-center text-white text-xl font-bold"
                  style={{ backgroundColor: themeColor }}
                >
                  {friend.name.charAt(0).toUpperCase()}
                </div>
              )}
            </div>

            {/* 在线状态指示器（可选） */}
            {friend.isOnline && (
              <div className="absolute bottom-0 right-0 h-4 w-4 rounded-full bg-green-500 ring-2 ring-gray-900" />
            )}
          </motion.div>

          {/* 信息区域 */}
          <div className="flex-1 min-w-0">
            {/* 名称 */}
            <h3 className="flex items-center gap-2 font-bold text-white truncate">
              {friend.name}
              <ExternalLink className="h-4 w-4 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity" />
            </h3>

            {/* 描述 */}
            <p className="mt-1 text-sm text-gray-400 line-clamp-2">
              {friend.description || '这个人很懒，什么都没写~'}
            </p>

            {/* 标签/额外信息 */}
            {friend.tags && friend.tags.length > 0 && (
              <div className="mt-3 flex flex-wrap gap-1.5">
                {friend.tags.slice(0, 3).map((tag) => (
                  <span
                    key={tag}
                    className="px-2 py-0.5 rounded-full text-xs bg-white/5 text-gray-400 border border-white/5"
                  >
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* 底部链接区域 */}
        <div className="mt-4 pt-4 border-t border-white/5 flex items-center justify-between">
          {/* 网站链接 */}
          <div className="flex items-center gap-1 text-xs text-gray-500 truncate">
            <Globe className="h-3.5 w-3.5 flex-shrink-0" />
            <span className="truncate">{new URL(friend.url).hostname}</span>
          </div>

          {/* 社交链接 */}
          <div className="flex items-center gap-2">
            {friend.email && (
              <motion.a
                href={`mailto:${friend.email}`}
                onClick={(e) => e.stopPropagation()}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                className="p-1.5 rounded-full bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 transition-colors"
              >
                <Mail className="h-4 w-4" />
              </motion.a>
            )}
            {friend.rss && (
              <motion.a
                href={friend.rss}
                target="_blank"
                rel="noopener noreferrer"
                onClick={(e) => e.stopPropagation()}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                className="p-1.5 rounded-full bg-white/5 text-gray-400 hover:text-orange-400 hover:bg-orange-400/10 transition-colors"
              >
                <Rss className="h-4 w-4" />
              </motion.a>
            )}
          </div>
        </div>
      </div>

      {/* 悬浮时的边框光效 */}
      <motion.div
        variants={glowVariants}
        className="absolute inset-0 rounded-2xl pointer-events-none"
        style={{
          boxShadow: `inset 0 0 0 1px ${themeColor}40`,
        }}
      />
    </motion.a>
  );
};

/**
 * 友链网格组件
 */
interface FriendGridProps {
  friends: FriendLink[];
  className?: string;
}

export const FriendGrid: React.FC<FriendGridProps> = ({
  friends,
  className,
}) => {
  return (
    <div
      className={cn(
        'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6',
        className
      )}
    >
      {friends.map((friend, index) => (
        <FriendCard key={friend.id} friend={friend} index={index} />
      ))}
    </div>
  );
};

export default FriendCard;
```

---

**组件六：代码块组件 (CodeBlock)**

```tsx
// packages/editor/src/renderers/CodeBlockRenderer.tsx

import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Copy, 
  Check, 
  ChevronDown, 
  ChevronUp, 
  Terminal,
  Maximize2,
  Minimize2,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useCopyToClipboard } from '@aetherblog/hooks';
import { codeToHtml } from 'shiki';

/**
 * 代码块 Props
 */
interface CodeBlockProps {
  /** 代码内容 */
  code: string;
  /** 编程语言 */
  language?: string;
  /** 文件名（可选） */
  filename?: string;
  /** 是否显示行号 */
  showLineNumbers?: boolean;
  /** 高亮行 */
  highlightLines?: number[];
  /** 最大高度（超出可折叠） */
  maxHeight?: number;
  /** 自定义类名 */
  className?: string;
}

/**
 * 语言图标映射
 */
const languageIcons: Record<string, string> = {
  javascript: '🟨',
  typescript: '🔷',
  python: '🐍',
  java: '☕',
  go: '🐹',
  rust: '🦀',
  cpp: '⚙️',
  c: '©️',
  html: '🌐',
  css: '🎨',
  json: '📋',
  yaml: '📄',
  markdown: '📝',
  bash: '💻',
  shell: '💻',
  sql: '🗃️',
  dockerfile: '🐳',
};

/**
 * 语言显示名称映射
 */
const languageNames: Record<string, string> = {
  js: 'JavaScript',
  ts: 'TypeScript',
  javascript: 'JavaScript',
  typescript: 'TypeScript',
  jsx: 'JSX',
  tsx: 'TSX',
  py: 'Python',
  python: 'Python',
  java: 'Java',
  go: 'Go',
  rust: 'Rust',
  cpp: 'C++',
  c: 'C',
  html: 'HTML',
  css: 'CSS',
  scss: 'SCSS',
  json: 'JSON',
  yaml: 'YAML',
  yml: 'YAML',
  md: 'Markdown',
  markdown: 'Markdown',
  bash: 'Bash',
  shell: 'Shell',
  sh: 'Shell',
  zsh: 'Zsh',
  sql: 'SQL',
  dockerfile: 'Dockerfile',
  docker: 'Docker',
  xml: 'XML',
  graphql: 'GraphQL',
  prisma: 'Prisma',
};

/**
 * 代码块组件
 * 
 * 设计特点：
 * - macOS 风格窗口设计
 * - Shiki 语法高亮（VS Code 主题）
 * - 一键复制功能
 * - 长代码自动折叠
 * - 行号显示
 * - 高亮特定行
 * - 全屏模式
 */
export const CodeBlock: React.FC<CodeBlockProps> = ({
  code,
  language = 'text',
  filename,
  showLineNumbers = true,
  highlightLines = [],
  maxHeight = 400,
  className,
}) => {
  // 状态
  const [highlightedHtml, setHighlightedHtml] = useState<string>('');
  const [isLoading, setIsLoading] = useState(true);
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [shouldCollapse, setShouldCollapse] = useState(false);
  
  // Hooks
  const [copied, copy] = useCopyToClipboard();
  const codeRef = useRef<HTMLDivElement>(null);

  // 获取语言显示名称
  const displayLanguage = languageNames[language.toLowerCase()] || language.toUpperCase();
  const languageIcon = languageIcons[language.toLowerCase()] || '📄';

  // 代码行数
  const lineCount = code.split('\n').length;

  // 使用 Shiki 进行语法高亮
  useEffect(() => {
    const highlightCode = async () => {
      setIsLoading(true);
      try {
        const html = await codeToHtml(code, {
          lang: language,
          theme: 'one-dark-pro',
          transformers: [
            {
              line(node, line) {
                // 添加行号
                if (showLineNumbers) {
                  node.properties['data-line'] = line;
                }
                // 高亮特定行
                if (highlightLines.includes(line)) {
                  node.properties['data-highlighted'] = '';
                }
              },
            },
          ],
        });
        setHighlightedHtml(html);
      } catch (error) {
        // 降级：不进行高亮
        setHighlightedHtml(`<pre><code>${escapeHtml(code)}</code></pre>`);
      } finally {
        setIsLoading(false);
      }
    };

    highlightCode();
  }, [code, language, showLineNumbers, highlightLines]);

  // 检查是否需要折叠
  useEffect(() => {
    if (codeRef.current) {
      const height = codeRef.current.scrollHeight;
      setShouldCollapse(height > maxHeight);
      if (height > maxHeight) {
        setIsCollapsed(true);
      }
    }
  }, [highlightedHtml, maxHeight]);

  // 复制代码
  const handleCopy = () => {
    copy(code);
  };

  // 切换折叠状态
  const toggleCollapse = () => {
    setIsCollapsed(!isCollapsed);
  };

  // 切换全屏
  const toggleFullscreen = () => {
    setIsFullscreen(!isFullscreen);
  };

  // HTML 转义
  const escapeHtml = (text: string) => {
    return text
      .replace(/&/g, '&')
      .replace(/</g, '<')
      .replace(/>/g, '>')
      .replace(/"/g, '"')
      .replace(/'/g, ''');
  };

  return (
    <>
      <motion.div
        layout
        className={cn(
          'relative my-6 rounded-xl overflow-hidden',
          'bg-[#282c34] border border-white/10',
          'shadow-xl shadow-black/20',
          isFullscreen && 'fixed inset-4 z-50 m-0',
          className
        )}
      >
        {/* macOS 风格窗口头部 */}
        <div className="flex items-center justify-between px-4 py-3 bg-[#21252b] border-b border-white/5">
          {/* 左侧：窗口控制点 + 语言/文件名 */}
          <div className="flex items-center gap-3">
            {/* macOS 控制点 */}
            <div className="flex items-center gap-1.5">
              <div className="w-3 h-3 rounded-full bg-[#ff5f56]" />
              <div className="w-3 h-3 rounded-full bg-[#ffbd2e]" />
              <div className="w-3 h-3 rounded-full bg-[#27c93f]" />
            </div>

            {/* 分隔线 */}
            <div className="h-4 w-px bg-white/10" />

            {/* 语言/文件名 */}
            <div className="flex items-center gap-2 text-sm">
              <span>{languageIcon}</span>
              <span className="text-gray-400">
                {filename || displayLanguage}
              </span>
              <span className="text-gray-600 text-xs">
                {lineCount} 行
              </span>
            </div>
          </div>
          
          {/* 右侧：操作按钮 */}
          <div className="flex items-center gap-1">
            {/* 全屏按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={toggleFullscreen}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200'
              )}
              title={isFullscreen ? '退出全屏' : '全屏'}
            >
              {isFullscreen ? (
                <Minimize2 className="h-4 w-4" />
              ) : (
                <Maximize2 className="h-4 w-4" />
              )}
            </motion.button>

            {/* 折叠按钮（仅在需要时显示） */}
            {shouldCollapse && (
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={toggleCollapse}
                className={cn(
                  'p-1.5 rounded-md',
                  'text-gray-500 hover:text-white',
                  'hover:bg-white/10',
                  'transition-colors duration-200'
                )}
                title={isCollapsed ? '展开代码' : '折叠代码'}
              >
                {isCollapsed ? (
                  <ChevronDown className="h-4 w-4" />
                ) : (
                  <ChevronUp className="h-4 w-4" />
                )}
              </motion.button>
            )}

            {/* 复制按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleCopy}
              className={cn(
                'flex items-center gap-1.5 px-2.5 py-1.5 rounded-md',
                'text-sm font-medium',
                'transition-all duration-200',
                copied
                  ? 'bg-green-500/20 text-green-400'
                  : 'text-gray-400 hover:text-white hover:bg-white/10'
              )}
            >
              <AnimatePresence mode="wait">
                {copied ? (
                  <motion.div
                    key="check"
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    exit={{ scale: 0 }}
                    className="flex items-center gap-1"
                  >
                    <Check className="h-4 w-4" />
                    <span>已复制</span>
                  </motion.div>
                ) : (
                  <motion.div
                    key="copy"
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    exit={{ scale: 0 }}
                    className="flex items-center gap-1"
                  >
                    <Copy className="h-4 w-4" />
                    <span>复制</span>
                  </motion.div>
                )}
              </AnimatePresence>
            </motion.button>
          </div>
        </div>

        {/* 代码内容区域 */}
        <div className="relative">
          {/* 加载状态 */}
          {isLoading && (
            <div className="absolute inset-0 flex items-center justify-center bg-[#282c34]">
              <div className="flex items-center gap-2 text-gray-400">
                <Terminal className="h-5 w-5 animate-pulse" />
                <span>加载中...</span>
              </div>
            </div>
          )}

          {/* 代码容器 */}
          <motion.div
            ref={codeRef}
            animate={{
              height: isCollapsed ? maxHeight : 'auto',
            }}
            transition={{ duration: 0.3, ease: 'easeInOut' }}
            className={cn(
              'overflow-hidden',
              isCollapsed && 'overflow-y-hidden'
            )}
          >
            {/* 行号 + 代码 */}
            <div className="flex">
              {/* 行号列 */}
              {showLineNumbers && (
                <div
                  className={cn(
                    'flex-shrink-0 py-4 px-3 text-right select-none',
                    'bg-[#21252b] border-r border-white/5',
                    'text-gray-600 text-sm font-mono'
                  )}
                >
                  {Array.from({ length: lineCount }, (_, i) => (
                    <div
                      key={i + 1}
                      className={cn(
                        'leading-6',
                        highlightLines.includes(i + 1) && 'text-primary'
                      )}
                    >
                      {i + 1}
                    </div>
                  ))}
                </div>
              )}

              {/* 代码内容 */}
              <div
                className={cn(
                  'flex-1 overflow-x-auto py-4 px-4',
                  'text-sm font-mono leading-6',
                  '[&_pre]:!bg-transparent [&_pre]:!m-0 [&_pre]:!p-0',
                  '[&_code]:!bg-transparent',
                  // 高亮行样式
                  '[&_[data-highlighted]]:bg-primary/10',
                  '[&_[data-highlighted]]:border-l-2',
                  '[&_[data-highlighted]]:border-primary',
                  '[&_[data-highlighted]]:ml-[-1rem]',
                  '[&_[data-highlighted]]:pl-[calc(1rem-2px)]'
                )}
                dangerouslySetInnerHTML={{ __html: highlightedHtml }}
              />
            </div>
          </motion.div>

          {/* 折叠渐变遮罩 */}
          <AnimatePresence>
            {isCollapsed && shouldCollapse && (
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                className={cn(
                  'absolute bottom-0 left-0 right-0 h-20',
                  'bg-gradient-to-t from-[#282c34] to-transparent',
                  'pointer-events-none'
                )}
              />
            )}
          </AnimatePresence>

          {/* 折叠时的展开提示 */}
          <AnimatePresence>
            {isCollapsed && shouldCollapse && (
              <motion.button
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: 10 }}
                onClick={toggleCollapse}
                className={cn(
                  'absolute bottom-2 left-1/2 -translate-x-1/2',
                  'flex items-center gap-1.5 px-4 py-2 rounded-full',
                  'bg-primary/20 text-primary text-sm font-medium',
                  'border border-primary/30',
                  'hover:bg-primary/30',
                  'transition-colors duration-200'
                )}
              >
                <ChevronDown className="h-4 w-4" />
                展开全部代码（{lineCount} 行）
              </motion.button>
            )}
          </AnimatePresence>
        </div>
      </motion.div>

      {/* 全屏模式遮罩 */}
      <AnimatePresence>
        {isFullscreen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={toggleFullscreen}
            className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm"
          />
        )}
      </AnimatePresence>
    </>
  );
};

export default CodeBlock;
```

---

**组件七：Markdown 渲染器主组件 (MarkdownRenderer)**

```tsx
// packages/editor/src/renderers/MarkdownRenderer.tsx

import React, { useMemo } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';
import rehypeSlug from 'rehype-slug';
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import { cn } from '@aetherblog/utils';

// 自定义渲染器
import { CodeBlock } from './CodeBlockRenderer';
import { MathRenderer } from './MathRenderer';
import { MermaidRenderer } from './MermaidRenderer';
import { ImageRenderer } from './ImageRenderer';
import { TableRenderer } from './TableRenderer';
import { BlockquoteRenderer } from './BlockquoteRenderer';
import { HeadingRenderer } from './HeadingRenderer';
import { LinkRenderer } from './LinkRenderer';

/**
 * Markdown 渲染器 Props
 */
interface MarkdownRendererProps {
  /** Markdown 内容 */
  content: string;
  /** 是否为文章页面（启用更多功能） */
  isArticle?: boolean;
  /** 标题点击回调 */
  onHeadingClick?: (id: string) => void;
  /** 自定义类名 */
  className?: string;
}

/**
 * Markdown 渲染器组件
 * 
 * 功能特性：
 * - GitHub Flavored Markdown (GFM) 支持
 * - 数学公式渲染 (KaTeX)
 * - 代码语法高亮 (Shiki)
 * - Mermaid 图表渲染
 * - 图片增强（居中、缩放、灯箱）
 * - 自动生成标题锚点
 * - 优化的排版样式
 */
export const MarkdownRenderer: React.FC<MarkdownRendererProps> = ({
  content,
  isArticle = false,
  onHeadingClick,
  className,
}) => {
  // 自定义组件映射
  const components = useMemo(() => ({
    // 代码块
    code: ({ node, inline, className: codeClassName, children, ...props }: any) => {
      const match = /language-(\w+)/.exec(codeClassName || '');
      const language = match ? match[1] : '';
      const code = String(children).replace(/\n$/, '');

      // 行内代码
      if (inline) {
        return (
          <code
            className={cn(
              'px-1.5 py-0.5 rounded-md',
              'bg-white/10 text-primary',
              'font-mono text-[0.9em]',
              'border border-white/5'
            )}
            {...props}
          >
            {children}
          </code>
        );
      }

      // Mermaid 图表
      if (language === 'mermaid') {
        return <MermaidRenderer chart={code} />;
      }

      // 代码块
      return (
        <CodeBlock
          code={code}
          language={language}
          showLineNumbers={code.split('\n').length > 1}
        />
      );
    },

    // 标题
    h1: (props: any) => (
      <HeadingRenderer level={1} onHeadingClick={onHeadingClick} {...props} />
    ),
    h2: (props: any) => (
      <HeadingRenderer level={2} onHeadingClick={onHeadingClick} {...props} />
    ),
    h3: (props: any) => (
      <HeadingRenderer level={3} onHeadingClick={onHeadingClick} {...props} />
    ),
    h4: (props: any) => (
      <HeadingRenderer level={4} onHeadingClick={onHeadingClick} {...props} />
    ),
    h5: (props: any) => (
      <HeadingRenderer level={5} onHeadingClick={onHeadingClick} {...props} />
    ),
    h6: (props: any) => (
      <HeadingRenderer level={6} onHeadingClick={onHeadingClick} {...props} />
    ),

    // 图片
    img: (props: any) => (
      <ImageRenderer
        src={props.src}
        alt={props.alt}
        title={props.title}
        enableLightbox={isArticle}
      />
    ),

    // 链接
    a: (props: any) => <LinkRenderer {...props} />,

    // 表格
    table: (props: any) => <TableRenderer {...props} />,

    // 引用块
    blockquote: (props: any) => <BlockquoteRenderer {...props} />,

    // 段落
    p: ({ children, ...props }: any) => (
      <p
        className={cn(
          'my-4 leading-7 text-gray-300',
          '[&:has(img)]:my-8'
        )}
        {...props}
      >
        {children}
      </p>
    ),

    // 列表
    ul: ({ children, ...props }: any) => (
      <ul
        className={cn(
          'my-4 ml-6 list-disc',
          'marker:text-primary/60',
          'space-y-2'
        )}
        {...props}
      >
        {children}
      </ul>
    ),

    ol: ({ children, ...props }: any) => (
      <ol
        className={cn(
          'my-4 ml-6 list-decimal',
          'marker:text-primary/60',
          'space-y-2'
        )}
        {...props}
      >
        {children}
      </ol>
    ),

    li: ({ children, ...props }: any) => (
      <li className="text-gray-300 leading-7" {...props}>
        {children}
      </li>
    ),

    // 分隔线
    hr: () => (
      <hr className="my-8 border-none h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
    ),

    // 粗体
    strong: ({ children, ...props }: any) => (
      <strong className="font-semibold text-white" {...props}>
        {children}
      </strong>
    ),

    // 斜体
    em: ({ children, ...props }: any) => (
      <em className="italic text-gray-200" {...props}>
        {children}
      </em>
    ),

    // 删除线
    del: ({ children, ...props }: any) => (
      <del className="line-through text-gray-500" {...props}>
        {children}
      </del>
    ),
  }), [isArticle, onHeadingClick]);

  return (
    <article
      className={cn(
        'prose prose-invert prose-lg max-w-none',
        // 自定义 Prose 样式覆盖
        'prose-headings:text-white prose-headings:font-bold',
        'prose-p:text-gray-300',
        'prose-a:text-primary prose-a:no-underline hover:prose-a:underline',
        'prose-strong:text-white',
        'prose-code:text-primary prose-code:bg-white/10',
        'prose-pre:bg-transparent prose-pre:p-0',
        'prose-img:rounded-xl prose-img:shadow-xl',
        'prose-hr:border-white/10',
        className
      )}
    >
      <ReactMarkdown
        remarkPlugins={[
          remarkGfm,
          remarkMath,
        ]}
        rehypePlugins={[
          rehypeKatex,
          rehypeSlug,
          [rehypeAutolinkHeadings, { behavior: 'wrap' }],
        ]}
        components={components}
      >
        {content}
      </ReactMarkdown>
    </article>
  );
};

export default MarkdownRenderer;
```

---

**组件八：数学公式渲染器 (MathRenderer)**

```tsx
// packages/editor/src/renderers/MathRenderer.tsx

import React from 'react';
import { InlineMath, BlockMath } from 'react-katex';
import { cn } from '@aetherblog/utils';
import 'katex/dist/katex.min.css';

/**
 * 数学公式渲染器 Props
 */
interface MathRendererProps {
  /** LaTeX 公式 */
  math: string;
  /** 是否为块级公式 */
  block?: boolean;
  /** 自定义类名 */
  className?: string;
}

/**
 * 数学公式渲染器组件
 * 
 * 使用 KaTeX 渲染 LaTeX 数学公式
 * 支持行内公式和块级公式
 */
export const MathRenderer: React.FC<MathRendererProps> = ({
  math,
  block = false,
  className,
}) => {
  // 错误处理
  const handleError = (error: Error) => {
    console.error('KaTeX Error:', error);
  };

  if (block) {
    return (
      <div
        className={cn(
          'my-6 py-4 overflow-x-auto',
          'bg-white/5 rounded-xl',
          'border border-white/10',
          className
        )}
      >
        <BlockMath
          math={math}
          errorColor="#ef4444"
          renderError={handleError}
        />
      </div>
    );
  }

  return (
    <span className={cn('mx-1', className)}>
      <InlineMath
        math={math}
        errorColor="#ef4444"
        renderError={handleError}
      />
    </span>
  );
};

export default MathRenderer;
```

---

**组件九：Mermaid 图表渲染器 (MermaidRenderer)**

```tsx
// packages/editor/src/renderers/MermaidRenderer.tsx

import React, { useEffect, useRef, useState, useId } from 'react';
import mermaid from 'mermaid';
import { motion } from 'framer-motion';
import { Maximize2, Download, RefreshCw, AlertCircle } from 'lucide-react';
import { cn } from '@aetherblog/utils';

/**
 * Mermaid 图表渲染器 Props
 */
interface MermaidRendererProps {
  /** Mermaid 图表代码 */
  chart: string;
  /** 自定义类名 */
  className?: string;
}

// 初始化 Mermaid 配置
mermaid.initialize({
  startOnLoad: false,
  theme: 'dark',
  themeVariables: {
    primaryColor: '#6366f1',
    primaryTextColor: '#ffffff',
    primaryBorderColor: '#6366f1',
    lineColor: '#6b7280',
    secondaryColor: '#374151',
    tertiaryColor: '#1f2937',
    background: '#111827',
    mainBkg: '#1f2937',
    nodeBorder: '#6366f1',
    clusterBkg: '#374151',
    titleColor: '#ffffff',
    edgeLabelBackground: '#374151',
  },
  fontFamily: 'Inter, sans-serif',
  fontSize: 14,
  flowchart: {
    htmlLabels: true,
    curve: 'basis',
    padding: 15,
  },
  sequence: {
    diagramMarginX: 50,
    diagramMarginY: 10,
    actorMargin: 50,
    width: 150,
    height: 65,
    boxMargin: 10,
    boxTextMargin: 5,
    noteMargin: 10,
    messageMargin: 35,
  },
});

/**
 * Mermaid 图表渲染器组件
 * 
 * 功能：
 * - 支持流程图、时序图、甘特图、类图等
 * - 暗色主题适配
 * - 错误处理与提示
 * - 全屏查看
 * - 导出为 SVG
 */
export const MermaidRenderer: React.FC<MermaidRendererProps> = ({
  chart,
  className,
}) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [svg, setSvg] = useState<string>('');
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const uniqueId = useId().replace(/:/g, '');

  // 渲染图表
  useEffect(() => {
    const renderChart = async () => {
      setIsLoading(true);
      setError(null);

      try {
        // 验证语法
        await mermaid.parse(chart);
        
        // 渲染 SVG
        const { svg: renderedSvg } = await mermaid.render(
          `mermaid-${uniqueId}`,
          chart
        );
        
        setSvg(renderedSvg);
      } catch (err: any) {
        console.error('Mermaid error:', err);
        setError(err.message || '图表渲染失败');
      } finally {
        setIsLoading(false);
      }
    };

    if (chart) {
      renderChart();
    }
  }, [chart, uniqueId]);

  // 导出 SVG
  const handleExport = () => {
    if (!svg) return;

    const blob = new Blob([svg], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `diagram-${Date.now()}.svg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  // 重新渲染
  const handleRefresh = () => {
    setSvg('');
    setError(null);
    setIsLoading(true);
    
    setTimeout(async () => {
      try {
        const { svg: renderedSvg } = await mermaid.render(
          `mermaid-refresh-${uniqueId}-${Date.now()}`,
          chart
        );
        setSvg(renderedSvg);
      } catch (err: any) {
        setError(err.message || '图表渲染失败');
      } finally {
        setIsLoading(false);
      }
    }, 100);
  };

  return (
    <>
      <div
        className={cn(
          'my-6 rounded-xl overflow-hidden',
          'bg-gray-900/50 border border-white/10',
          'shadow-lg',
          isFullscreen && 'fixed inset-4 z-50 m-0 flex flex-col',
          className
        )}
      >
        {/* 头部工具栏 */}
        <div className="flex items-center justify-between px-4 py-2 bg-black/30 border-b border-white/5">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <span>📊</span>
            <span>Mermaid 图表</span>
          </div>

          <div className="flex items-center gap-1">
            {/* 刷新按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleRefresh}
              disabled={isLoading}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200',
                'disabled:opacity-50'
              )}
              title="刷新"
            >
              <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />
            </motion.button>

            {/* 导出按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={handleExport}
              disabled={!svg || isLoading}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200',
                'disabled:opacity-50'
              )}
              title="导出 SVG"
            >
              <Download className="h-4 w-4" />
            </motion.button>

            {/* 全屏按钮 */}
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={() => setIsFullscreen(!isFullscreen)}
              className={cn(
                'p-1.5 rounded-md',
                'text-gray-500 hover:text-white',
                'hover:bg-white/10',
                'transition-colors duration-200'
              )}
              title={isFullscreen ? '退出全屏' : '全屏查看'}
            >
              <Maximize2 className="h-4 w-4" />
            </motion.button>
          </div>
        </div>

        {/* 图表内容 */}
        <div
          ref={containerRef}
          className={cn(
            'p-6 overflow-auto',
            'flex items-center justify-center',
            isFullscreen ? 'flex-1' : 'min-h-[200px]'
          )}
        >
          {/* 加载状态 */}
          {isLoading && (
            <div className="flex items-center gap-2 text-gray-400">
              <RefreshCw className="h-5 w-5 animate-spin" />
              <span>渲染中...</span>
            </div>
          )}

          {/* 错误状态 */}
          {error && !isLoading && (
            <div className="flex flex-col items-center gap-3 text-red-400">
              <AlertCircle className="h-8 w-8" />
              <p className="text-sm">图表渲染失败</p>
              <p className="text-xs text-gray-500 max-w-md text-center">{error}</p>
              <button
                onClick={handleRefresh}
                className="mt-2 px-4 py-2 rounded-lg bg-red-500/20 text-red-400 text-sm hover:bg-red-500/30 transition-colors"
              >
                重试
              </button>
            </div>
          )}

          {/* SVG 图表 */}
          {svg && !isLoading && !error && (
            <div
              className="[&_svg]:max-w-full [&_svg]:h-auto"
              dangerouslySetInnerHTML={{ __html: svg }}
            />
          )}
        </div>
      </div>

      {/* 全屏遮罩 */}
      {isFullscreen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          onClick={() => setIsFullscreen(false)}
          className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm"
        />
      )}
    </>
  );
};

export default MermaidRenderer;
```

---

**组件十：图片渲染器 (ImageRenderer)**

```tsx
// packages/editor/src/renderers/ImageRenderer.tsx

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, ZoomIn, Download, ExternalLink } from 'lucide-react';
import { cn } from '@aetherblog/utils';

/**
 * 图片渲染器 Props
 */
interface ImageRendererProps {
  /** 图片地址 */
  src: string;
  /** 替代文本 */
  alt?: string;
  /** 标题 */
  title?: string;
  /** 是否启用灯箱 */
  enableLightbox?: boolean;
  /** 自定义类名 */
  className?: string;
}

/**
 * 图片渲染器组件
 * 
 * 功能：
 * - 图片居中显示
 * - 自适应宽度
 * - 加载状态
 * - 错误处理
 * - 灯箱放大查看
 * - 下载功能
 */
export const ImageRenderer: React.FC<ImageRendererProps> = ({
  src,
  alt = '',
  title,
  enableLightbox = true,
  className,
}) => {
  const [isLoading, setIsLoading] = useState(true);
  const [hasError, setHasError] = useState(false);
  const [isLightboxOpen, setIsLightboxOpen] = useState(false);

  // 处理图片加载完成
  const handleLoad = () => {
    setIsLoading(false);
  };

  // 处理图片加载错误
  const handleError = () => {
    setIsLoading(false);
    setHasError(true);
  };

  // 下载图片
  const handleDownload = async () => {
    try {
      const response = await fetch(src);
      const blob = await response.blob();
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = alt || `image-${Date.now()}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('Download failed:', error);
    }
  };

  // 在新标签页打开
  const handleOpenInNewTab = () => {
    window.open(src, '_blank', 'noopener,noreferrer');
  };

  return (
    <>
      {/* 图片容器 */}
      <figure className={cn('my-8', className)}>
        <div
          className={cn(
            'relative mx-auto overflow-hidden rounded-xl',
            'bg-white/5 border border-white/10',
            'shadow-lg shadow-black/20',
            enableLightbox && 'cursor-zoom-in group'
          )}
          onClick={() => enableLightbox && !hasError && setIsLightboxOpen(true)}
        >
          {/* 加载状态骨架屏 */}
          {isLoading && (
            <div className="absolute inset-0 flex items-center justify-center">
              <div className="animate-pulse flex flex-col items-center gap-2">
                <div className="w-12 h-12 rounded-full bg-white/10" />
                <div className="w-24 h-3 rounded bg-white/10" />
              </div>
            </div>
          )}

          {/* 错误状态 */}
          {hasError && (
            <div className="flex flex-col items-center justify-center py-12 text-gray-500">
              <svg
                className="w-16 h-16 mb-3 opacity-50"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={1.5}
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <p className="text-sm">图片加载失败</p>
              <p className="text-xs mt-1 text-gray-600 max-w-xs truncate">{src}</p>
            </div>
          )}

          {/* 图片 */}
          <motion.img
            src={src}
            alt={alt}
            title={title}
            onLoad={handleLoad}
            onError={handleError}
            initial={{ opacity: 0, scale: 1.02 }}
            animate={{
              opacity: isLoading || hasError ? 0 : 1,
              scale: 1,
            }}
            transition={{ duration: 0.3 }}
            className={cn(
              'w-full h-auto',
              'transition-transform duration-300',
              enableLightbox && 'group-hover:scale-[1.02]'
            )}
          />

          {/* 悬浮放大提示 */}
          {enableLightbox && !hasError && !isLoading && (
            <motion.div
              initial={{ opacity: 0 }}
              whileHover={{ opacity: 1 }}
              className={cn(
                'absolute inset-0 flex items-center justify-center',
                'bg-black/40 opacity-0 group-hover:opacity-100',
                'transition-opacity duration-200'
              )}
            >
              <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-white">
                <ZoomIn className="w-5 h-5" />
                <span className="text-sm font-medium">点击放大</span>
              </div>
            </motion.div>
          )}
        </div>

        {/* 图片说明 */}
        {(alt || title) && (
          <figcaption className="mt-3 text-center text-sm text-gray-500">
            {title || alt}
          </figcaption>
        )}
      </figure>

      {/* 灯箱模态框 */}
      <AnimatePresence>
        {isLightboxOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 z-50 flex items-center justify-center"
            onClick={() => setIsLightboxOpen(false)}
          >
            {/* 背景遮罩 */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="absolute inset-0 bg-black/90 backdrop-blur-md"
            />

            {/* 工具栏 */}
            <div className="absolute top-4 right-4 z-10 flex items-center gap-2">
              {/* 下载按钮 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={(e) => {
                  e.stopPropagation();
                  handleDownload();
                }}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-white/20',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="下载图片"
              >
                <Download className="w-5 h-5" />
              </motion.button>

              {/* 新标签页打开 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={(e) => {
                  e.stopPropagation();
                  handleOpenInNewTab();
                }}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-white/20',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="在新标签页打开"
              >
                <ExternalLink className="w-5 h-5" />
              </motion.button>

              {/* 关闭按钮 */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => setIsLightboxOpen(false)}
                className={cn(
                  'p-3 rounded-full',
                  'bg-white/10 text-white',
                  'hover:bg-red-500/50',
                  'backdrop-blur-sm',
                  'transition-colors duration-200'
                )}
                title="关闭"
              >
                <X className="w-5 h-5" />
              </motion.button>
            </div>

            {/* 大图 */}
            <motion.img
              src={src}
              alt={alt}
              initial={{ scale: 0.9, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.9, opacity: 0 }}
              transition={{ type: 'spring', duration: 0.5 }}
              onClick={(e) => e.stopPropagation()}
              className={cn(
                'relative max-w-[90vw] max-h-[85vh]',
                'object-contain rounded-lg',
                'shadow-2xl shadow-black/50'
              )}
            />

            {/* 图片说明 */}
            {(alt || title) && (
              <motion.div
                initial={{ y: 20, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: 20, opacity: 0 }}
                className="absolute bottom-6 left-1/2 -translate-x-1/2"
              >
                <div className="px-6 py-3 rounded-full bg-black/60 backdrop-blur-sm text-white text-sm">
                  {title || alt}
                </div>
              </motion.div>
            )}

            {/* 键盘提示 */}
            <div className="absolute bottom-6 right-6 text-xs text-gray-500">
              按 ESC 关闭
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
};

export default ImageRenderer;
```

---

### 2.3.3 前端状态管理设计

#### 2.3.3.1 状态管理架构

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        前端状态管理架构                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                      状态分层设计                                                   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              服务端状态 (Server State)                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: TanStack Query (React Query)                                                    │  │ │
│   │   │   特点: 缓存、自动刷新、乐观更新、离线支持                                                    │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ 文章数据    │ │ 分类数据    │ │ 标签数据    │ │ 用户数据    │ │ 统计数据    │          │  │ │
│   │   │   │ posts       │ │ categories  │ │ tags        │ │ user        │ │ analytics   │          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              客户端状态 (Client State)                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: Zustand                                                                          │  │ │
│   │   │   特点: 轻量、简单、无样板代码、支持持久化                                                    │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ UI状态      │ │ 认证状态    │ │ 主题状态    │ │ 编辑器状态  │ │ 设置状态    │          │  │ │
│   │   │   │ uiStore     │ │ authStore   │ │ themeStore  │ │ editorStore │ │ settingsStore│         │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                              │                                                     │ │
│   │                                              ▼                                                     │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              URL状态 (URL State)                                             │  │ │
│   │   │                                                                                             │  │ │
│   │   │   管理工具: Next.js Router / nuqs                                                            │  │ │
│   │   │   特点: 可分享、可书签、浏览器历史支持                                                        │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                                           │  │ │
│   │   │   │ 搜索参数    │ │ 分页参数    │ │ 筛选参数    │                                           │  │ │
│   │   │   │ ?q=xxx      │ │ ?page=1     │ │ ?category=x │                                           │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘                                           │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.3.2 Zustand Store 实现

```tsx
// apps/admin/src/stores/authStore.ts

import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';
import type { User } from '@aetherblog/types';

/**
 * 认证状态接口
 */
interface AuthState {
  // 状态
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;
  isLoading: boolean;

  // 操作
  setUser: (user: User | null) => void;
  setTokens: (accessToken: string, refreshToken: string) => void;
  login: (user: User, accessToken: string, refreshToken: string) => void;
  logout: () => void;
  updateUser: (updates: Partial<User>) => void;
  setLoading: (loading: boolean) => void;
}

/**
 * 认证状态 Store
 */
export const useAuthStore = create<AuthState>()(
  persist(
    immer((set) => ({
      // 初始状态
      user: null,
      accessToken: null,
      refreshToken: null,
      isAuthenticated: false,
      isLoading: true,

      // 设置用户
      setUser: (user) =>
        set((state) => {
          state.user = user;
          state.isAuthenticated = !!user;
        }),

      // 设置令牌
      setTokens: (accessToken, refreshToken) =>
        set((state) => {
          state.accessToken = accessToken;
          state.refreshToken = refreshToken;
        }),

      // 登录
      login: (user, accessToken, refreshToken) =>
        set((state) => {
          state.user = user;
          state.accessToken = accessToken;
          state.refreshToken = refreshToken;
          state.isAuthenticated = true;
          state.isLoading = false;
        }),

      // 登出
      logout: () =>
        set((state) => {
          state.user = null;
          state.accessToken = null;
          state.refreshToken = null;
          state.isAuthenticated = false;
        }),

      // 更新用户信息
      updateUser: (updates) =>
        set((state) => {
          if (state.user) {
            Object.assign(state.user, updates);
          }
        }),

      // 设置加载状态
      setLoading: (loading) =>
        set((state) => {
          state.isLoading = loading;
        }),
    })),
    {
      name: 'auth-storage',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({
        user: state.user,
        accessToken: state.accessToken,
        refreshToken: state.refreshToken,
        isAuthenticated: state.isAuthenticated,
      }),
    }
  )
);
```

```tsx
// apps/admin/src/stores/uiStore.ts

import { create } from 'zustand';
import { immer } from 'zustand/middleware/immer';

/**
 * UI 状态接口
 */
interface UIState {
  // 侧边栏
  sidebarOpen: boolean;
  sidebarCollapsed: boolean;

  // 搜索
  searchOpen: boolean;
  searchQuery: string;

  // 模态框
  activeModal: string | null;
  modalData: any;

  // 通知
  notifications: Notification[];

  // 全局加载
  globalLoading: boolean;
  loadingText: string;

  // 操作
  toggleSidebar: () => void;
  setSidebarOpen: (open: boolean) => void;
  setSidebarCollapsed: (collapsed: boolean) => void;
  toggleSearch: () => void;
  setSearchQuery: (query: string) => void;
  openModal: (modalId: string, data?: any) => void;
  closeModal: () => void;
  addNotification: (notification: Omit<Notification, 'id'>) => void;
  removeNotification: (id: string) => void;
  setGlobalLoading: (loading: boolean, text?: string) => void;
}

interface Notification {
  id: string;
  type: 'success' | 'error' | 'warning' | 'info';
  title: string;
  message?: string;
  duration?: number;
}

/**
 * UI 状态 Store
 */
export const useUIStore = create<UIState>()(
  immer((set) => ({
    // 初始状态
    sidebarOpen: true,
    sidebarCollapsed: false,
    searchOpen: false,
    searchQuery: '',
    activeModal: null,
    modalData: null,
    notifications: [],
    globalLoading: false,
    loadingText: '',

    // 侧边栏操作
    toggleSidebar: () =>
      set((state) => {
        state.sidebarOpen = !state.sidebarOpen;
      }),

    setSidebarOpen: (open) =>
      set((state) => {
        state.sidebarOpen = open;
      }),

    setSidebarCollapsed: (collapsed) =>
      set((state) => {
        state.sidebarCollapsed = collapsed;
      }),

    // 搜索操作
    toggleSearch: () =>
      set((state) => {
        state.searchOpen = !state.searchOpen;
        if (!state.searchOpen) {
          state.searchQuery = '';
        }
      }),

    setSearchQuery: (query) =>
      set((state) => {
        state.searchQuery = query;
      }),

    // 模态框操作
    openModal: (modalId, data) =>
      set((state) => {
        state.activeModal = modalId;
        state.modalData = data;
      }),

    closeModal: () =>
      set((state) => {
        state.activeModal = null;
        state.modalData = null;
      }),

    // 通知操作
    addNotification: (notification) =>
      set((state) => {
        const id = `notification-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        state.notifications.push({ ...notification, id });
      }),

    removeNotification: (id) =>
      set((state) => {
        state.notifications = state.notifications.filter((n) => n.id !== id);
      }),

    // 全局加载
    setGlobalLoading: (loading, text = '') =>
      set((state) => {
        state.globalLoading = loading;
        state.loadingText = text;
      }),
  }))
);
```

```tsx
// apps/admin/src/stores/editorStore.ts

import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

/**
 * 编辑器状态接口
 */
interface EditorState {
  // 内容
  content: string;
  title: string;
  summary: string;
  coverImage: string | null;

  // 元数据
  categoryId: number | null;
  tagIds: number[];
  slug: string;
  status: 'draft' | 'published' | 'scheduled';
  scheduledAt: string | null;

  // 编辑器设置
  previewMode: 'edit' | 'preview' | 'split';
  autoSave: boolean;
  wordWrap: boolean;
  showLineNumbers: boolean;
  fontSize: number;

  // 状态
  isDirty: boolean;
  lastSavedAt: string | null;
  isAiPanelOpen: boolean;

  // 操作
  setContent: (content: string) => void;
  setTitle: (title: string) => void;
  setSummary: (summary: string) => void;
  setCoverImage: (url: string | null) => void;
  setCategory: (categoryId: number | null) => void;
  setTags: (tagIds: number[]) => void;
  addTag: (tagId: number) => void;
  removeTag: (tagId: number) => void;
  setSlug: (slug: string) => void;
  setStatus: (status: 'draft' | 'published' | 'scheduled') => void;
  setScheduledAt: (date: string | null) => void;
  setPreviewMode: (mode: 'edit' | 'preview' | 'split') => void;
  toggleAiPanel: () => void;
  setEditorSettings: (settings: Partial<EditorSettings>) => void;
  markAsSaved: () => void;
  resetEditor: () => void;
  loadPost: (post: PostData) => void;
}

interface EditorSettings {
  autoSave: boolean;
  wordWrap: boolean;
  showLineNumbers: boolean;
  fontSize: number;
}

interface PostData {
  content: string;
  title: string;
  summary?: string;
  coverImage?: string;
  categoryId?: number;
  tagIds?: number[];
  slug?: string;
  status?: 'draft' | 'published' | 'scheduled';
  scheduledAt?: string;
}

/**
 * 编辑器状态 Store
 */
export const useEditorStore = create<EditorState>()(
  persist(
    immer((set, get) => ({
      // 初始状态
      content: '',
      title: '',
      summary: '',
      coverImage: null,
      categoryId: null,
      tagIds: [],
      slug: '',
      status: 'draft',
      scheduledAt: null,
      previewMode: 'split',
      autoSave: true,
      wordWrap: true,
      showLineNumbers: true,
      fontSize: 14,
      isDirty: false,
      lastSavedAt: null,
      isAiPanelOpen: true,

      // 内容操作
      setContent: (content) =>
        set((state) => {
          state.content = content;
          state.isDirty = true;
        }),

      setTitle: (title) =>
        set((state) => {
          state.title = title;
          state.isDirty = true;
          // 自动生成 slug
          if (!state.slug) {
            state.slug = generateSlug(title);
          }
        }),

      setSummary: (summary) =>
        set((state) => {
          state.summary = summary;
          state.isDirty = true;
        }),

      setCoverImage: (url) =>
        set((state) => {
          state.coverImage = url;
          state.isDirty = true;
        }),

      // 分类标签操作
      setCategory: (categoryId) =>
        set((state) => {
          state.categoryId = categoryId;
          state.isDirty = true;
        }),

      setTags: (tagIds) =>
        set((state) => {
          state.tagIds = tagIds;
          state.isDirty = true;
        }),

      addTag: (tagId) =>
        set((state) => {
          if (!state.tagIds.includes(tagId)) {
            state.tagIds.push(tagId);
            state.isDirty = true;
          }
        }),

      removeTag: (tagId) =>
        set((state) => {
          state.tagIds = state.tagIds.filter((id) => id !== tagId);
          state.isDirty = true;
        }),

      // 其他操作
      setSlug: (slug) =>
        set((state) => {
          state.slug = slug;
          state.isDirty = true;
        }),

      setStatus: (status) =>
        set((state) => {
          state.status = status;
          state.isDirty = true;
        }),

      setScheduledAt: (date) =>
        set((state) => {
          state.scheduledAt = date;
          state.isDirty = true;
        }),

      setPreviewMode: (mode) =>
        set((state) => {
          state.previewMode = mode;
        }),

      toggleAiPanel: () =>
        set((state) => {
          state.isAiPanelOpen = !state.isAiPanelOpen;
        }),

      setEditorSettings: (settings) =>
        set((state) => {
          Object.assign(state, settings);
        }),

      markAsSaved: () =>
        set((state) => {
          state.isDirty = false;
          state.lastSavedAt = new Date().toISOString();
        }),

      resetEditor: () =>
        set((state) => {
          state.content = '';
          state.title = '';
          state.summary = '';
          state.coverImage = null;
          state.categoryId = null;
          state.tagIds = [];
          state.slug = '';
          state.status = 'draft';
          state.scheduledAt = null;
          state.isDirty = false;
          state.lastSavedAt = null;
        }),

      loadPost: (post) =>
        set((state) => {
          state.content = post.content;
          state.title = post.title;
          state.summary = post.summary || '';
          state.coverImage = post.coverImage || null;
          state.categoryId = post.categoryId || null;
          state.tagIds = post.tagIds || [];
          state.slug = post.slug || '';
          state.status = post.status || 'draft';
          state.scheduledAt = post.scheduledAt || null;
          state.isDirty = false;
        }),
    })),
    {
      name: 'editor-storage',
      partialize: (state) => ({
        previewMode: state.previewMode,
        autoSave: state.autoSave,
        wordWrap: state.wordWrap,
        showLineNumbers: state.showLineNumbers,
        fontSize: state.fontSize,
        isAiPanelOpen: state.isAiPanelOpen,
      }),
    }
  )
);

/**
 * 生成 URL Slug
 */
function generateSlug(title: string): string {
  return title
    .toLowerCase()
    .replace(/[^\w\s\u4e00-\u9fa5-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
    .trim();
}
```

#### 2.3.3.3 TanStack Query 配置

```tsx
// apps/admin/src/lib/queryClient.ts

import { QueryClient } from '@tanstack/react-query';

/**
 * 创建 Query Client 实例
 */
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // 默认缓存时间：5分钟
      staleTime: 5 * 60 * 1000,
      // 缓存垃圾回收时间：30分钟
      gcTime: 30 * 60 * 1000,
      // 失败重试次数
      retry: (failureCount, error: any) => {
        // 4xx 错误不重试
        if (error?.response?.status >= 400 && error?.response?.status < 500) {
          return false;
        }
        return failureCount < 3;
      },
      // 重试延迟
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
      // 窗口聚焦时重新获取
      refetchOnWindowFocus: false,
      // 重连时重新获取
      refetchOnReconnect: true,
    },
    mutations: {
      // 失败重试
      retry: 1,
      // 全局错误处理
      onError: (error: any) => {
        const message = error?.response?.data?.message || error?.message || '操作失败';
        toast.error(message);
      },
    },
  },
});

/**
 * Query Keys 工厂函数
 * 统一管理所有查询键，确保缓存一致性
 */
export const queryKeys = {
  // 文章相关
  posts: {
    all: ['posts'] as const,
    lists: () => [...queryKeys.posts.all, 'list'] as const,
    list: (filters: PostFilters) => [...queryKeys.posts.lists(), filters] as const,
    details: () => [...queryKeys.posts.all, 'detail'] as const,
    detail: (idOrSlug: string | number) => [...queryKeys.posts.details(), idOrSlug] as const,
  },

  // 分类相关
  categories: {
    all: ['categories'] as const,
    lists: () => [...queryKeys.categories.all, 'list'] as const,
    list: (filters?: CategoryFilters) => [...queryKeys.categories.lists(), filters] as const,
    detail: (id: number) => [...queryKeys.categories.all, 'detail', id] as const,
  },

  // 标签相关
  tags: {
    all: ['tags'] as const,
    lists: () => [...queryKeys.tags.all, 'list'] as const,
    list: (filters?: TagFilters) => [...queryKeys.tags.lists(), filters] as const,
    popular: () => [...queryKeys.tags.all, 'popular'] as const,
  },

  // 媒体相关
  media: {
    all: ['media'] as const,
    lists: () => [...queryKeys.media.all, 'list'] as const,
    list: (filters?: MediaFilters) => [...queryKeys.media.lists(), filters] as const,
    detail: (id: number) => [...queryKeys.media.all, 'detail', id] as const,
  },

  // 统计相关
  analytics: {
    all: ['analytics'] as const,
    overview: (period?: string) => [...queryKeys.analytics.all, 'overview', period] as const,
    visitors: (params?: AnalyticsParams) => [...queryKeys.analytics.all, 'visitors', params] as const,
    posts: (params?: AnalyticsParams) => [...queryKeys.analytics.all, 'posts', params] as const,
    geo: () => [...queryKeys.analytics.all, 'geo'] as const,
  },

  // 友链相关
  friends: {
    all: ['friends'] as const,
    lists: () => [...queryKeys.friends.all, 'list'] as const,
    detail: (id: number) => [...queryKeys.friends.all, 'detail', id] as const,
  },

  // 设置相关
  settings: {
    all: ['settings'] as const,
    site: () => [...queryKeys.settings.all, 'site'] as const,
    storage: () => [...queryKeys.settings.all, 'storage'] as const,
    ai: () => [...queryKeys.settings.all, 'ai'] as const,
  },

  // 用户相关
  user: {
    all: ['user'] as const,
    profile: () => [...queryKeys.user.all, 'profile'] as const,
  },

  // AI 相关
  ai: {
    all: ['ai'] as const,
    prompts: () => [...queryKeys.ai.all, 'prompts'] as const,
  },
};

// 类型定义
interface PostFilters {
  page?: number;
  size?: number;
  status?: string;
  categoryId?: number;
  tagIds?: number[];
  search?: string;
}

interface CategoryFilters {
  includePostCount?: boolean;
}

interface TagFilters {
  includePostCount?: boolean;
}

interface MediaFilters {
  page?: number;
  size?: number;
  type?: string;
}

interface AnalyticsParams {
  startDate?: string;
  endDate?: string;
  granularity?: 'hour' | 'day' | 'week' | 'month';
}
```

```tsx
// apps/admin/src/hooks/usePosts.ts

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';
import { postService } from '@/services/postService';
import type { Post, CreatePostRequest, UpdatePostRequest } from '@aetherblog/types';

/**
 * 文章列表查询 Hook
 */
export function usePostList(filters: PostFilters = {}) {
  return useQuery({
    queryKey: queryKeys.posts.list(filters),
    queryFn: () => postService.getList(filters),
    placeholderData: (previousData) => previousData,
  });
}

/**
 * 文章详情查询 Hook
 */
export function usePostDetail(idOrSlug: string | number) {
  return useQuery({
    queryKey: queryKeys.posts.detail(idOrSlug),
    queryFn: () => postService.getDetail(idOrSlug),
    enabled: !!idOrSlug,
  });
}

/**
 * 创建文章 Mutation Hook
 */
export function useCreatePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: CreatePostRequest) => postService.create(data),
    onSuccess: (newPost) => {
      // 使文章列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
      
      // 预填充新文章详情缓存
      queryClient.setQueryData(queryKeys.posts.detail(newPost.id), newPost);
      queryClient.setQueryData(queryKeys.posts.detail(newPost.slug), newPost);
    },
  });
}

/**
 * 更新文章 Mutation Hook
 */
export function useUpdatePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: number; data: UpdatePostRequest }) =>
      postService.update(id, data),
    onSuccess: (updatedPost, { id }) => {
      // 更新详情缓存
      queryClient.setQueryData(queryKeys.posts.detail(id), updatedPost);
      queryClient.setQueryData(queryKeys.posts.detail(updatedPost.slug), updatedPost);
      
      // 使列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
    },
  });
}

/**
 * 删除文章 Mutation Hook
 */
export function useDeletePost() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: number) => postService.delete(id),
    onSuccess: (_, id) => {
      // 移除详情缓存
      queryClient.removeQueries({ queryKey: queryKeys.posts.detail(id) });
      
      // 使列表缓存失效
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.lists() });
    },
  });
}

/**
 * 批量操作文章 Mutation Hook
 */
export function useBatchPostAction() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ ids, action }: { ids: number[]; action: 'delete' | 'publish' | 'draft' }) =>
      postService.batchAction(ids, action),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.posts.all });
    },
  });
}

interface PostFilters {
  page?: number;
  size?: number;
  status?: string;
  categoryId?: number;
  tagIds?: number[];
  search?: string;
}
```

```tsx
// apps/admin/src/hooks/useAi.ts

import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';
import { aiService } from '@/services/aiService';

/**
 * AI 文本清洗 Mutation Hook
 */
export function useAiClean() {
  return useMutation({
    mutationFn: (text: string) => aiService.cleanText(text),
  });
}

/**
 * AI 内容重写 Mutation Hook
 */
export function useAiRewrite() {
  return useMutation({
    mutationFn: ({ text, style }: { text: string; style: string }) =>
      aiService.rewriteText(text, style),
  });
}

/**
 * AI 生成摘要 Mutation Hook
 */
export function useAiSummarize() {
  return useMutation({
    mutationFn: (content: string) => aiService.generateSummary(content),
  });
}

/**
 * AI 生成标签 Mutation Hook
 */
export function useAiTags() {
  return useMutation({
    mutationFn: (content: string) => aiService.generateTags(content),
  });
}

/**
 * AI 语义搜索 Mutation Hook
 */
export function useAiSearch() {
  return useMutation({
    mutationFn: (query: string) => aiService.semanticSearch(query),
  });
}

/**
 * Prompt 模板列表查询 Hook
 */
export function usePromptList() {
  return useQuery({
    queryKey: queryKeys.ai.prompts(),
    queryFn: () => aiService.getPrompts(),
  });
}

/**
 * 创建 Prompt 模板 Mutation Hook
 */
export function useCreatePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: CreatePromptRequest) => aiService.createPrompt(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

/**
 * 更新 Prompt 模板 Mutation Hook
 */
export function useUpdatePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdatePromptRequest }) =>
      aiService.updatePrompt(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

/**
 * 删除 Prompt 模板 Mutation Hook
 */
export function useDeletePrompt() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: string) => aiService.deletePrompt(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.ai.prompts() });
    },
  });
}

interface CreatePromptRequest {
  name: string;
  description?: string;
  content: string;
  category?: string;
}

interface UpdatePromptRequest extends Partial<CreatePromptRequest> {}
```

### 2.3.4 前端视觉规范设计

#### 2.3.4.1 设计令牌 (Design Tokens)

```tsx
// packages/config/src/tailwind/tokens.ts

/**
 * AetherBlog 设计令牌
 * 
 * 基于 Apple/Microsoft 设计语言定义的设计系统变量
 */

/**
 * 颜色系统
 */
export const colors = {
  // 主色调 - 靛蓝紫
  primary: {
    50: '#eef2ff',
    100: '#e0e7ff',
    200: '#c7d2fe',
    300: '#a5b4fc',
    400: '#818cf8',
    500: '#6366f1',  // 主色
    600: '#4f46e5',
    700: '#4338ca',
    800: '#3730a3',
    900: '#312e81',
    950: '#1e1b4b',
  },

  // 次要色 - 紫色
  secondary: {
    50: '#faf5ff',
    100: '#f3e8ff',
    200: '#e9d5ff',
    300: '#d8b4fe',
    400: '#c084fc',
    500: '#a855f7',
    600: '#9333ea',
    700: '#7e22ce',
    800: '#6b21a8',
    900: '#581c87',
    950: '#3b0764',
  },

  // 强调色 - 青色
  accent: {
    50: '#ecfeff',
    100: '#cffafe',
    200: '#a5f3fc',
    300: '#67e8f9',
    400: '#22d3ee',
    500: '#06b6d4',
    600: '#0891b2',
    700: '#0e7490',
    800: '#155e75',
    900: '#164e63',
    950: '#083344',
  },

  // 灰度 - 暗色主题优化
  gray: {
    50: '#f9fafb',
    100: '#f3f4f6',
    200: '#e5e7eb',
    300: '#d1d5db',
    400: '#9ca3af',
    500: '#6b7280',
    600: '#4b5563',
    700: '#374151',
    800: '#1f2937',
    900: '#111827',
    950: '#030712',
  },

  // 语义色
  success: {
    light: '#22c55e',
    DEFAULT: '#16a34a',
    dark: '#15803d',
  },
  warning: {
    light: '#fbbf24',
    DEFAULT: '#f59e0b',
    dark: '#d97706',
  },
  error: {
    light: '#f87171',
    DEFAULT: '#ef4444',
    dark: '#dc2626',
  },
  info: {
    light: '#60a5fa',
    DEFAULT: '#3b82f6',
    dark: '#2563eb',
  },
};

/**
 * 排版系统
 */
export const typography = {
  // 字体族
  fontFamily: {
    sans: [
      'Inter',
      '-apple-system',
      'BlinkMacSystemFont',
      '"Segoe UI"',
      'Roboto',
      '"Helvetica Neue"',
      'Arial',
      '"Noto Sans SC"',
      'sans-serif',
    ],
    mono: [
      'JetBrains Mono',
      'Fira Code',
      'Monaco',
      'Consolas',
      '"Liberation Mono"',
      '"Courier New"',
      'monospace',
    ],
    serif: [
      '"Noto Serif SC"',
      'Georgia',
      '"Times New Roman"',
      'serif',
    ],
  },

  // 字号
  fontSize: {
    xs: ['0.75rem', { lineHeight: '1rem' }],
    sm: ['0.875rem', { lineHeight: '1.25rem' }],
    base: ['1rem', { lineHeight: '1.5rem' }],
    lg: ['1.125rem', { lineHeight: '1.75rem' }],
    xl: ['1.25rem', { lineHeight: '1.75rem' }],
    '2xl': ['1.5rem', { lineHeight: '2rem' }],
    '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
    '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
    '5xl': ['3rem', { lineHeight: '1' }],
    '6xl': ['3.75rem', { lineHeight: '1' }],
    '7xl': ['4.5rem', { lineHeight: '1' }],
  },

  // 字重
  fontWeight: {
    thin: '100',
    light: '300',
    normal: '400',
    medium: '500',
    semibold: '600',
    bold: '700',
    extrabold: '800',
    black: '900',
  },

  // 行高
  lineHeight: {
    none: '1',
    tight: '1.25',
    snug: '1.375',
    normal: '1.5',
    relaxed: '1.625',
    loose: '2',
  },

  // 字间距
  letterSpacing: {
    tighter: '-0.05em',
    tight: '-0.025em',
    normal: '0em',
    wide: '0.025em',
    wider: '0.05em',
    widest: '0.1em',
  },
};

/**
 * 间距系统
 */
export const spacing = {
  px: '1px',
  0: '0px',
  0.5: '0.125rem',
  1: '0.25rem',
  1.5: '0.375rem',
  2: '0.5rem',
  2.5: '0.625rem',
  3: '0.75rem',
  3.5: '0.875rem',
  4: '1rem',
  5: '1.25rem',
  6: '1.5rem',
  7: '1.75rem',
  8: '2rem',
  9: '2.25rem',
  10: '2.5rem',
  11: '2.75rem',
  12: '3rem',
  14: '3.5rem',
  16: '4rem',
  20: '5rem',
  24: '6rem',
  28: '7rem',
  32: '8rem',
  36: '9rem',
  40: '10rem',
  44: '11rem',
  48: '12rem',
  52: '13rem',
  56: '14rem',
  60: '15rem',
  64: '16rem',
  72: '18rem',
  80: '20rem',
  96: '24rem',
};

/**
 * 阴影系统
 */
export const shadows = {
  sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
  DEFAULT: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
  md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
  lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
  xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',
  '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',
  inner: 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)',
  none: 'none',

  // 彩色阴影
  'primary-sm': '0 2px 8px -2px rgba(99, 102, 241, 0.3)',
  'primary-md': '0 4px 16px -4px rgba(99, 102, 241, 0.4)',
  'primary-lg': '0 8px 24px -6px rgba(99, 102, 241, 0.5)',

  // 毛玻璃阴影
  'glass-sm': '0 2px 8px 0 rgba(0, 0, 0, 0.1)',
  'glass-md': '0 4px 16px 0 rgba(0, 0, 0, 0.15)',
  'glass-lg': '0 8px 32px 0 rgba(0, 0, 0, 0.2)',
};

/**
 * 圆角系统
 */
export const borderRadius = {
  none: '0px',
  sm: '0.125rem',
  DEFAULT: '0.25rem',
  md: '0.375rem',
  lg: '0.5rem',
  xl: '0.75rem',
  '2xl': '1rem',
  '3xl': '1.5rem',
  full: '9999px',
};

/**
 * 动画系统
 */
export const animation = {
  // 动画时长
  duration: {
    75: '75ms',
    100: '100ms',
    150: '150ms',
    200: '200ms',
    300: '300ms',
    500: '500ms',
    700: '700ms',
    1000: '1000ms',
  },

  // 缓动函数
  easing: {
    linear: 'linear',
    in: 'cubic-bezier(0.4, 0, 1, 1)',
    out: 'cubic-bezier(0, 0, 0.2, 1)',
    'in-out': 'cubic-bezier(0.4, 0, 0.2, 1)',
    // Apple 风格缓动
    'apple-ease': 'cubic-bezier(0.25, 0.1, 0.25, 1)',
    'apple-spring': 'cubic-bezier(0.5, 1.5, 0.5, 1)',
    // 弹性缓动
    bounce: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
  },

  // 预设动画
  keyframes: {
    fadeIn: {
      from: { opacity: '0' },
      to: { opacity: '1' },
    },
    fadeOut: {
      from: { opacity: '1' },
      to: { opacity: '0' },
    },
    slideInUp: {
      from: { transform: 'translateY(10px)', opacity: '0' },
      to: { transform: 'translateY(0)', opacity: '1' },
    },
    slideInDown: {
      from: { transform: 'translateY(-10px)', opacity: '0' },
      to: { transform: 'translateY(0)', opacity: '1' },
    },
    scaleIn: {
      from: { transform: 'scale(0.95)', opacity: '0' },
      to: { transform: 'scale(1)', opacity: '1' },
    },
    pulse: {
      '0%, 100%': { opacity: '1' },
      '50%': { opacity: '0.5' },
    },
    shimmer: {
      from: { backgroundPosition: '-200% 0' },
      to: { backgroundPosition: '200% 0' },
    },
  },
};

/**
 * 断点系统
 */
export const breakpoints = {
  sm: '640px',
  md: '768px',
  lg: '1024px',
  xl: '1280px',
  '2xl': '1536px',
};

/**
 * Z-Index 层级系统
 */
export const zIndex = {
  hide: -1,
  auto: 'auto',
  base: 0,
  docked: 10,
  dropdown: 1000,
  sticky: 1100,
  banner: 1200,
  overlay: 1300,
  modal: 1400,
  popover: 1500,
  skipLink: 1600,
  toast: 1700,
  tooltip: 1800,
};
```

#### 2.3.4.2 Tailwind 配置预设

```tsx
// packages/config/src/tailwind/preset.ts

import type { Config } from 'tailwindcss';
import { colors, typography, spacing, shadows, borderRadius, animation, breakpoints, zIndex } from './tokens';

/**
 * AetherBlog Tailwind CSS 预设
 */
export const aetherblogPreset: Partial<Config> = {
  darkMode: 'class',
  theme: {
    extend: {
      // 颜色
      colors: {
        primary: colors.primary,
        secondary: colors.secondary,
        accent: colors.accent,
        gray: colors.gray,
        success: colors.success,
        warning: colors.warning,
        error: colors.error,
        info: colors.info,
      },

      // 字体
      fontFamily: typography.fontFamily,
      fontSize: typography.fontSize,
      fontWeight: typography.fontWeight,
      lineHeight: typography.lineHeight,
      letterSpacing: typography.letterSpacing,

      // 间距
      spacing,

      // 阴影
      boxShadow: shadows,

      // 圆角
      borderRadius,

      // 动画
      transitionDuration: animation.duration,
      transitionTimingFunction: animation.easing,
      keyframes: animation.keyframes,
      animation: {
        'fade-in': 'fadeIn 0.2s ease-out',
        'fade-out': 'fadeOut 0.2s ease-out',
        'slide-in-up': 'slideInUp 0.3s ease-out',
        'slide-in-down': 'slideInDown 0.3s ease-out',
        'scale-in': 'scaleIn 0.2s ease-out',
        pulse: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        shimmer: 'shimmer 2s linear infinite',
      },

      // 断点
      screens: breakpoints,

      // Z-Index
      zIndex,

      // 背景图片（用于毛玻璃效果）
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
        'glass-gradient': 'linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%)',
        'mesh-gradient': `
          radial-gradient(at 40% 20%, hsla(228,100%,74%,0.2) 0px, transparent 50%),
          radial-gradient(at 80% 0%, hsla(189,100%,56%,0.15) 0px, transparent 50%),
          radial-gradient(at 0% 50%, hsla(355,100%,93%,0.1) 0px, transparent 50%),
          radial-gradient(at 80% 50%, hsla(340,100%,76%,0.1) 0px, transparent 50%),
          radial-gradient(at 0% 100%, hsla(22,100%,77%,0.1) 0px, transparent 50%),
          radial-gradient(at 80% 100%, hsla(242,100%,70%,0.15) 0px, transparent 50%)
        `,
      },

      // 背景模糊（毛玻璃效果增强）
      backdropBlur: {
        xs: '2px',
        '3xl': '64px',
      },

      // 边框透明度
      borderOpacity: {
        10: '0.1',
        15: '0.15',
        20: '0.2',
      },
    },
  },
  plugins: [
    // 官方插件
    require('@tailwindcss/typography'),
    require('@tailwindcss/forms'),
    require('@tailwindcss/container-queries'),

    // 自定义插件
    require('./plugins/glass'),
    require('./plugins/animations'),
  ],
};

export default aetherblogPreset;
```

```tsx
// packages/config/src/tailwind/plugins/glass.ts

import plugin from 'tailwindcss/plugin';

/**
 * 毛玻璃效果插件
 */
export default plugin(function ({ addComponents, theme }) {
  addComponents({
    // 毛玻璃卡片
    '.glass': {
      backgroundColor: 'rgba(255, 255, 255, 0.05)',
      backdropFilter: 'blur(16px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
    },
    '.glass-sm': {
      backgroundColor: 'rgba(255, 255, 255, 0.03)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.05)',
    },
    '.glass-lg': {
      backgroundColor: 'rgba(255, 255, 255, 0.08)',
      backdropFilter: 'blur(24px)',
      border: '1px solid rgba(255, 255, 255, 0.15)',
    },
    '.glass-xl': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(32px)',
      border: '1px solid rgba(255, 255, 255, 0.2)',
    },

    // 毛玻璃导航栏
    '.glass-nav': {
      backgroundColor: 'rgba(17, 24, 39, 0.8)',
      backdropFilter: 'blur(12px) saturate(180%)',
      borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
    },

    // 毛玻璃模态框
    '.glass-modal': {
      backgroundColor: 'rgba(17, 24, 39, 0.95)',
      backdropFilter: 'blur(24px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
    },

    // 毛玻璃输入框
    '.glass-input': {
      backgroundColor: 'rgba(255, 255, 255, 0.05)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      '&:focus': {
        backgroundColor: 'rgba(255, 255, 255, 0.08)',
        borderColor: 'rgba(99, 102, 241, 0.5)',
        boxShadow: '0 0 0 3px rgba(99, 102, 241, 0.1)',
      },
    },

    // 毛玻璃按钮
    '.glass-button': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(8px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      transition: 'all 0.2s ease',
      '&:hover': {
        backgroundColor: 'rgba(255, 255, 255, 0.15)',
        borderColor: 'rgba(255, 255, 255, 0.2)',
      },
      '&:active': {
        backgroundColor: 'rgba(255, 255, 255, 0.2)',
      },
    },

    // 毛玻璃徽章
    '.glass-badge': {
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(4px)',
      border: '1px solid rgba(255, 255, 255, 0.1)',
    },

    // 光晕效果
    '.glow': {
      boxShadow: '0 0 20px rgba(99, 102, 241, 0.3)',
    },
    '.glow-sm': {
      boxShadow: '0 0 10px rgba(99, 102, 241, 0.2)',
    },
    '.glow-lg': {
      boxShadow: '0 0 40px rgba(99, 102, 241, 0.4)',
    },

    // 悬浮光效
    '.hover-glow': {
      transition: 'box-shadow 0.3s ease',
      '&:hover': {
        boxShadow: '0 0 30px rgba(99, 102, 241, 0.3)',
      },
    },

    // 渐变边框
    '.gradient-border': {
      position: 'relative',
      '&::before': {
        content: '""',
        position: 'absolute',
        inset: '0',
        padding: '1px',
        borderRadius: 'inherit',
        background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.5), rgba(168, 85, 247, 0.5))',
        mask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)',
        maskComposite: 'xor',
        '-webkit-mask-composite': 'xor',
        pointerEvents: 'none',
      },
    },
  });
});
```

```tsx
// packages/config/src/tailwind/plugins/animations.ts

import plugin from 'tailwindcss/plugin';

/**
 * 动画效果插件
 */
export default plugin(function ({ addUtilities, addComponents, matchUtilities, theme }) {
  // 添加动画工具类
  addUtilities({
    // 动画延迟
    '.animation-delay-100': { animationDelay: '100ms' },
    '.animation-delay-200': { animationDelay: '200ms' },
    '.animation-delay-300': { animationDelay: '300ms' },
    '.animation-delay-500': { animationDelay: '500ms' },
    '.animation-delay-700': { animationDelay: '700ms' },
    '.animation-delay-1000': { animationDelay: '1000ms' },

    // 动画填充模式
    '.animation-fill-forwards': { animationFillMode: 'forwards' },
    '.animation-fill-backwards': { animationFillMode: 'backwards' },
    '.animation-fill-both': { animationFillMode: 'both' },

    // 动画播放状态
    '.animation-paused': { animationPlayState: 'paused' },
    '.animation-running': { animationPlayState: 'running' },

    // 动画方向
    '.animation-reverse': { animationDirection: 'reverse' },
    '.animation-alternate': { animationDirection: 'alternate' },

    // 交互时暂停动画
    '.hover-pause': {
      '&:hover': { animationPlayState: 'paused' },
    },
  });

  // 添加预设动画组件
  addComponents({
    // 淡入上滑
    '.animate-fade-in-up': {
      animation: 'fadeInUp 0.5s ease-out forwards',
    },

    // 淡入下滑
    '.animate-fade-in-down': {
      animation: 'fadeInDown 0.5s ease-out forwards',
    },

    // 缩放淡入
    '.animate-scale-in': {
      animation: 'scaleIn 0.3s ease-out forwards',
    },

    // 弹性进入
    '.animate-bounce-in': {
      animation: 'bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards',
    },

    // 脉冲呼吸
    '.animate-pulse-slow': {
      animation: 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
    },

    // 浮动效果
    '.animate-float': {
      animation: 'float 3s ease-in-out infinite',
    },

    // 闪烁效果
    '.animate-shimmer': {
      animation: 'shimmer 2s linear infinite',
      backgroundImage: 'linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent)',
      backgroundSize: '200% 100%',
    },

    // 打字机效果占位
    '.animate-typing': {
      overflow: 'hidden',
      whiteSpace: 'nowrap',
      borderRight: '2px solid',
      animation: 'typing 3s steps(40, end), blink 0.75s step-end infinite',
    },

    // 骨架屏加载
    '.skeleton': {
      background: 'linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%)',
      backgroundSize: '200% 100%',
      animation: 'shimmer 1.5s infinite',
    },

    // 波纹效果
    '.ripple': {
      position: 'relative',
      overflow: 'hidden',
      '&::after': {
        content: '""',
        position: 'absolute',
        top: '50%',
        left: '50%',
        width: '0',
        height: '0',
        borderRadius: '50%',
        backgroundColor: 'rgba(255, 255, 255, 0.3)',
        transform: 'translate(-50%, -50%)',
        transition: 'width 0.6s ease, height 0.6s ease',
      },
      '&:active::after': {
        width: '200%',
        height: '200%',
      },
    },
  });

  // 添加额外的关键帧
  addUtilities({
    '@keyframes fadeInUp': {
      from: {
        opacity: '0',
        transform: 'translateY(20px)',
      },
      to: {
        opacity: '1',
        transform: 'translateY(0)',
      },
    },
    '@keyframes fadeInDown': {
      from: {
        opacity: '0',
        transform: 'translateY(-20px)',
      },
      to: {
        opacity: '1',
        transform: 'translateY(0)',
      },
    },
    '@keyframes bounceIn': {
      '0%': {
        opacity: '0',
        transform: 'scale(0.3)',
      },
      '50%': {
        transform: 'scale(1.05)',
      },
      '70%': {
        transform: 'scale(0.9)',
      },
      '100%': {
        opacity: '1',
        transform: 'scale(1)',
      },
    },
    '@keyframes float': {
      '0%, 100%': {
        transform: 'translateY(0)',
      },
      '50%': {
        transform: 'translateY(-10px)',
      },
    },
    '@keyframes typing': {
      from: { width: '0' },
      to: { width: '100%' },
    },
    '@keyframes blink': {
      '50%': { borderColor: 'transparent' },
    },
  });

  // 动态动画延迟
  matchUtilities(
    {
      'animate-delay': (value) => ({
        animationDelay: value,
      }),
    },
    { values: theme('transitionDelay') }
  );

  // 动态动画时长
  matchUtilities(
    {
      'animate-duration': (value) => ({
        animationDuration: value,
      }),
    },
    { values: theme('transitionDuration') }
  );
});
```

---

## 2.4 后端技术栈详解

### 2.4.1 后端项目结构

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        后端项目完整目录结构                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   aetherblog-backend/                                                                                    │
│   │                                                                                                      │
│   ├── pom.xml                                          # 父 POM 文件                                     │
│   │                                                                                                      │
│   ├── aetherblog-common/                               # 🔧 公共模块                                     │
│   │   │                                                                                                  │
│   │   ├── common-core/                                 # 核心工具模块                                    │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/common/core/                                                            │
│   │   │   │       ├── constant/                        # 常量定义                                        │
│   │   │   │       │   ├── CacheConstants.java          # 缓存常量                                        │
│   │   │   │       │   ├── SecurityConstants.java       # 安全常量                                        │
│   │   │   │       │   └── CommonConstants.java         # 通用常量                                        │
│   │   │   │       ├── domain/                          # 通用域对象                                      │
│   │   │   │       │   ├── R.java                       # 统一响应                                        │
│   │   │   │       │   ├── PageQuery.java               # 分页查询                                        │
│   │   │   │       │   ├── PageResult.java              # 分页结果                                        │
│   │   │   │       │   └── BaseEntity.java              # 基础实体                                        │
│   │   │   │       ├── enums/                           # 枚举定义                                        │
│   │   │   │       │   ├── ResultCode.java              # 响应码枚举                                      │
│   │   │   │       │   ├── StatusEnum.java              # 状态枚举                                        │
│   │   │   │       │   └── StorageType.java             # 存储类型枚举                                    │
│   │   │   │       ├── exception/                       # 异常定义                                        │
│   │   │   │       │   ├── BusinessException.java       # 业务异常                                        │
│   │   │   │       │   ├── AuthException.java           # 认证异常                                        │
│   │   │   │       │   └── GlobalExceptionHandler.java  # 全局异常处理                                    │
│   │   │   │       ├── utils/                           # 工具类                                          │
│   │   │   │       │   ├── StringUtils.java             # 字符串工具                                      │
│   │   │   │       │   ├── DateUtils.java               # 日期工具                                        │
│   │   │   │       │   ├── JsonUtils.java               # JSON工具                                        │
│   │   │   │       │   ├── ServletUtils.java            # Servlet工具                                     │
│   │   │   │       │   ├── IpUtils.java                 # IP工具                                          │
│   │   │   │       │   └── SlugUtils.java               # Slug生成工具                                    │
│   │   │   │       └── validation/                      # 自定义校验                                      │
│   │   │   │           ├── Phone.java                   # 手机号校验注解                                  │
│   │   │   │           └── PhoneValidator.java          # 手机号校验器                                    │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── common-security/                             # 安全模块                                        │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/common/security/                                                        │
│   │   │   │       ├── config/                          # 安全配置                                        │
│   │   │   │       │   ├── SecurityConfig.java          # Spring Security配置                             │
│   │   │   │       │   ├── CorsConfig.java              # CORS配置                                        │
│   │   │   │       │   └── JwtConfig.java               # JWT配置                                         │
│   │   │   │       ├── filter/                          # 过滤器                                          │
│   │   │   │       │   ├── JwtAuthenticationFilter.java # JWT认证过滤器                                   │
│   │   │   │       │   └── RateLimitFilter.java         # 限流过滤器                                      │
│   │   │   │       ├── handler/                         # 处理器                                          │
│   │   │   │       │   ├── AuthenticationEntryPointImpl.java  # 认证入口点                                │
│   │   │   │       │   ├── AccessDeniedHandlerImpl.java       # 访问拒绝处理                              │
│   │   │   │       │   └── LogoutSuccessHandlerImpl.java      # 登出成功处理                              │
│   │   │   │       ├── service/                         # 安全服务                                        │
│   │   │   │       │   ├── JwtService.java              # JWT服务                                         │
│   │   │   │       │   ├── TokenService.java            # Token服务                                       │
│   │   │   │       │   └── SecurityService.java         # 安全工具服务                                    │
│   │   │   │       ├── domain/                          # 安全域对象                                      │
│   │   │   │       │   ├── LoginUser.java               # 登录用户                                        │
│   │   │   │       │   ├── JwtPayload.java              # JWT载荷                                         │
│   │   │   │       │   └── TokenPair.java               # Token对                                         │
│   │   │   │       └── annotation/                      # 安全注解                                        │
│   │   │   │           ├── RequiresLogin.java           # 需要登录                                        │
│   │   │   │           ├── RequiresRoles.java           # 需要角色                                        │
│   │   │   │           └── RateLimit.java               # 限流注解                                        │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── common-redis/                                # Redis模块                                       │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/common/redis/                                                           │
│   │   │   │       ├── config/                          # Redis配置                                       │
│   │   │   │       │   ├── RedisConfig.java             # Redis配置类                                     │
│   │   │   │       │   └── CacheConfig.java             # 缓存配置类                                      │
│   │   │   │       ├── service/                         # Redis服务                                       │
│   │   │   │       │   ├── RedisService.java            # Redis操作服务                                   │
│   │   │   │       │   └── CacheService.java            # 缓存服务                                        │
│   │   │   │       └── annotation/                      # 缓存注解                                        │
│   │   │   │           └── CacheExpire.java             # 缓存过期注解                                    │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── common-log/                                  # 日志模块                                        │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/common/log/                                                             │
│   │   │   │       ├── annotation/                      # 日志注解                                        │
│   │   │   │       │   └── Log.java                     # 操作日志注解                                    │
│   │   │   │       ├── aspect/                          # 日志切面                                        │
│   │   │   │       │   └── LogAspect.java               # 日志切面实现                                    │
│   │   │   │       ├── domain/                          # 日志域对象                                      │
│   │   │   │       │   └── OperationLog.java            # 操作日志实体                                    │
│   │   │   │       └── service/                         # 日志服务                                        │
│   │   │   │           └── OperationLogService.java     # 操作日志服务                                    │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   └── common-mybatis/                              # MyBatis模块                                     │
│   │       ├── src/main/java/                                                                             │
│   │       │   └── com/aetherblog/common/mybatis/                                                         │
│   │       │       ├── config/                          # MyBatis配置                                     │
│   │       │       │   └── MyBatisConfig.java           # MyBatis配置类                                   │
│   │       │       ├── handler/                         # 类型处理器                                      │
│   │       │       │   ├── JsonTypeHandler.java         # JSON类型处理                                    │
│   │       │       │   └── VectorTypeHandler.java       # 向量类型处理                                    │
│   │       │       └── interceptor/                     # 拦截器                                          │
│   │       │           └── DataPermissionInterceptor.java  # 数据权限拦截器                               │
│   │       └── pom.xml                                                                                    │
│   │                                                                                                      │
│   ├── aetherblog-service/                              # 📦 业务服务模块                                 │
│   │   │                                                                                                  │
│   │   ├── blog-service/                                # 博客核心服务                                    │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/blog/                                                                   │
│   │   │   │       ├── BlogApplication.java             # 启动类                                          │
│   │   │   │       ├── controller/                      # 控制器层                                        │
│   │   │   │       │   ├── PostController.java          # 文章控制器                                      │
│   │   │   │       │   ├── CategoryController.java      # 分类控制器                                      │
│   │   │   │       │   ├── TagController.java           # 标签控制器                                      │
│   │   │   │       │   ├── CommentController.java       # 评论控制器                                      │
│   │   │   │       │   ├── FriendLinkController.java    # 友链控制器                                      │
│   │   │   │       │   ├── ArchiveController.java       # 归档控制器                                      │
│   │   │   │       │   └── SiteController.java          # 站点控制器                                      │
│   │   │   │       ├── service/                         # 服务层                                          │
│   │   │   │       │   ├── PostService.java             # 文章服务接口                                    │
│   │   │   │       │   ├── impl/                        # 服务实现                                        │
│   │   │   │       │   │   ├── PostServiceImpl.java     # 文章服务实现                                    │
│   │   │   │       │   │   ├── CategoryServiceImpl.java # 分类服务实现                                    │
│   │   │   │       │   │   ├── TagServiceImpl.java      # 标签服务实现                                    │
│   │   │   │       │   │   └── ...                      # 其他服务实现                                    │
│   │   │   │       ├── repository/                      # 数据访问层                                      │
│   │   │   │       │   ├── PostRepository.java          # 文章仓库                                        │
│   │   │   │       │   ├── CategoryRepository.java      # 分类仓库                                        │
│   │   │   │       │   ├── TagRepository.java           # 标签仓库                                        │
│   │   │   │       │   └── ...                          # 其他仓库                                        │
│   │   │   │       ├── entity/                          # 实体层                                          │
│   │   │   │       │   ├── Post.java                    # 文章实体                                        │
│   │   │   │       │   ├── Category.java                # 分类实体                                        │
│   │   │   │       │   ├── Tag.java                     # 标签实体                                        │
│   │   │   │       │   ├── Comment.java                 # 评论实体                                        │
│   │   │   │       │   ├── FriendLink.java              # 友链实体                                        │
│   │   │   │       │   └── ...                          # 其他实体                                        │
│   │   │   │       ├── dto/                             # 数据传输对象                                    │
│   │   │   │       │   ├── request/                     # 请求DTO                                         │
│   │   │   │       │   │   ├── CreatePostRequest.java   # 创建文章请求                                    │
│   │   │   │       │   │   ├── UpdatePostRequest.java   # 更新文章请求                                    │
│   │   │   │       │   │   └── ...                      # 其他请求DTO                                     │
│   │   │   │       │   └── response/                    # 响应DTO                                         │
│   │   │   │       │       ├── PostDetailResponse.java  # 文章详情响应                                    │
│   │   │   │       │       ├── PostListResponse.java    # 文章列表响应                                    │
│   │   │   │       │       └── ...                      # 其他响应DTO                                     │
│   │   │   │       ├── converter/                       # 对象转换器                                      │
│   │   │   │       │   ├── PostConverter.java           # 文章转换器                                      │
│   │   │   │       │   └── ...                          # 其他转换器                                      │
│   │   │   │       └── config/                          # 配置类                                          │
│   │   │   │           └── BlogConfig.java              # 博客配置                                        │
│   │   │   ├── src/main/resources/                                                                        │
│   │   │   │   ├── application.yml                      # 应用配置                                        │
│   │   │   │   ├── application-dev.yml                  # 开发环境配置                                    │
│   │   │   │   ├── application-prod.yml                 # 生产环境配置                                    │
│   │   │   │   └── mapper/                              # MyBatis Mapper                                  │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── user-service/                                # 用户服务                                        │
│   │   ├── media-service/                               # 媒体服务                                        │
│   │   ├── search-service/                              # 搜索服务                                        │
│   │   ├── analytics-service/                           # 统计服务                                        │
│   │   └── ai-service/                                  # AI服务                                          │
│   │                                                                                                      │  
│   ├── aetherblog-ai/                                   # 🤖 AI核心模块                                   │
│   │   │                                                                                                  │
│   │   ├── ai-core/                                     # AI核心                                          │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/ai/core/                                                                │
│   │   │   │       ├── config/                          # AI配置                                          │
│   │   │   │       │   ├── SpringAiConfig.java          # Spring AI配置                                   │
│   │   │   │       │   ├── VectorStoreConfig.java       # 向量存储配置                                    │
│   │   │   │       │   └── EmbeddingConfig.java         # Embedding配置                                   │
│   │   │   │       ├── client/                          # AI客户端                                        │
│   │   │   │       │   ├── AiClientFactory.java         # AI客户端工厂                                    │
│   │   │   │       │   └── AiClientProperties.java      # AI客户端属性                                    │
│   │   │   │       └── service/                         # AI服务                                          │
│   │   │   │           ├── ChatService.java             # 聊天服务                                        │
│   │   │   │           ├── EmbeddingService.java        # Embedding服务                                   │
│   │   │   │           └── StreamingService.java        # 流式服务                                        │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── ai-agent/                                    # AI Agent实现                                    │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/ai/agent/                                                               │
│   │   │   │       ├── WritingAgent.java                # 写作Agent                                       │
│   │   │   │       │   ├── TextCleanerAgent.java        # 文本清洗Agent                                   │
│   │   │   │       │   ├── RewriterAgent.java           # 内容重写Agent                                   │
│   │   │   │       │   ├── PolisherAgent.java           # 润色优化Agent                                   │
│   │   │   │       │   └── ContinueWritingAgent.java    # 续写Agent                                       │
│   │   │   │       ├── TaggingAgent.java                # 标签Agent                                       │
│   │   │   │       │   ├── AutoTaggerAgent.java         # 自动标签Agent                                   │
│   │   │   │       │   └── KeywordExtractorAgent.java   # 关键词提取Agent                                 │
│   │   │   │       ├── SummaryAgent.java                # 摘要Agent                                       │
│   │   │   │       │   ├── ContentSummarizerAgent.java  # 内容摘要Agent                                   │
│   │   │   │       │   └── SeoDescriptionAgent.java     # SEO描述Agent                                    │
│   │   │   │       ├── SearchAgent.java                 # 搜索Agent                                       │
│   │   │   │       │   ├── SemanticSearchAgent.java     # 语义搜索Agent                                   │
│   │   │   │       │   ├── RagAgent.java                # RAG检索Agent                                    │
│   │   │   │       │   └── QaAgent.java                 # 问答Agent                                       │
│   │   │   │       └── base/                            # 基础类                                          │
│   │   │   │           ├── BaseAgent.java               # Agent基类                                       │
│   │   │   │           ├── AgentContext.java            # Agent上下文                                     │
│   │   │   │           └── AgentResult.java             # Agent结果                                       │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   ├── ai-prompt/                                   # Prompt管理                                      │
│   │   │   ├── src/main/java/                                                                             │
│   │   │   │   └── com/aetherblog/ai/prompt/                                                              │
│   │   │   │       ├── entity/                          # Prompt实体                                      │
│   │   │   │       │   └── PromptTemplate.java          # Prompt模板实体                                  │
│   │   │   │       ├── repository/                      # Prompt仓库                                      │
│   │   │   │       │   └── PromptRepository.java        # Prompt仓库接口                                  │
│   │   │   │       ├── service/                         # Prompt服务                                      │
│   │   │   │       │   ├── PromptService.java           # Prompt服务接口                                  │
│   │   │   │       │   └── PromptServiceImpl.java       # Prompt服务实现                                  │
│   │   │   │       ├── loader/                          # Prompt加载器                                    │
│   │   │   │       │   ├── PromptLoader.java            # Prompt加载接口                                  │
│   │   │   │       │   ├── DatabasePromptLoader.java    # 数据库加载器                                    │
│   │   │   │       │   └── FilePromptLoader.java        # 文件加载器                                      │
│   │   │   │       └── templates/                       # 内置模板                                        │
│   │   │   │           ├── SystemPrompts.java           # 系统Prompt                                      │
│   │   │   │           └── DefaultPrompts.java          # 默认Prompt                                      │
│   │   │   ├── src/main/resources/                                                                        │
│   │   │   │   └── prompts/                             # Prompt模板文件                                  │
│   │   │   │       ├── text-cleaner.txt                 # 文本清洗Prompt                                  │
│   │   │   │       ├── rewriter-professional.txt        # 专业重写Prompt                                  │
│   │   │   │       ├── rewriter-casual.txt              # 通俗重写Prompt                                  │
│   │   │   │       ├── rewriter-concise.txt             # 精简重写Prompt                                  │
│   │   │   │       ├── summarizer.txt                   # 摘要生成Prompt                                  │
│   │   │   │       ├── tagger.txt                       # 标签生成Prompt                                  │
│   │   │   │       ├── seo-description.txt              # SEO描述Prompt                                   │
│   │   │   │       └── qa-system.txt                    # 问答系统Prompt                                  │
│   │   │   └── pom.xml                                                                                    │
│   │   │                                                                                                  │
│   │   └── ai-rag/                                      # RAG检索增强                                     │
│   │       ├── src/main/java/                                                                             │
│   │       │   └── com/aetherblog/ai/rag/                                                                 │
│   │       │       ├── config/                          # RAG配置                                         │
│   │       │       │   └── RagConfig.java               # RAG配置类                                       │
│   │       │       ├── retriever/                       # 检索器                                          │
│   │       │       │   ├── VectorRetriever.java         # 向量检索器                                      │
│   │       │       │   ├── KeywordRetriever.java        # 关键词检索器                                    │
│   │       │       │   └── HybridRetriever.java         # 混合检索器                                      │
│   │       │       ├── reranker/                        # 重排序器                                        │
│   │       │       │   ├── Reranker.java                # 重排序接口                                      │
│   │       │       │   └── RrfReranker.java             # RRF重排序实现                                   │
│   │       │       ├── splitter/                        # 文本分割器                                      │
│   │       │       │   ├── TextSplitter.java            # 分割接口                                        │
│   │       │       │   ├── SentenceSplitter.java        # 句子分割器                                      │
│   │       │       │   └── ParagraphSplitter.java       # 段落分割器                                      │
│   │       │       ├── indexer/                         # 索引器                                          │
│   │       │       │   ├── PostIndexer.java             # 文章索引器                                      │
│   │       │       │   └── IncrementalIndexer.java      # 增量索引器                                      │
│   │       │       └── service/                         # RAG服务                                         │
│   │       │           ├── RagService.java              # RAG服务接口                                     │
│   │       │           └── RagServiceImpl.java          # RAG服务实现                                     │
│   │       └── pom.xml                                                                                    │
│   │                                                                                                      │
│   ├── aetherblog-gateway/                              # 🚪 API网关（可选）                              │
│   │   └── ...                                                                                            │
│   │                                                                                                      │
│   ├── deploy/                                          # 🐳 部署配置                                     │
│   │   ├── docker/                                      # Docker配置                                      │
│   │   │   ├── Dockerfile                               # 应用Dockerfile                                  │
│   │   │   ├── Dockerfile.dev                           # 开发Dockerfile                                  │
│   │   │   └── docker-compose.yml                       # Docker Compose                                  │
│   │   ├── k8s/                                         # Kubernetes配置                                  │
│   │   │   ├── deployment.yaml                          # 部署配置                                        │
│   │   │   ├── service.yaml                             # 服务配置                                        │
│   │   │   ├── configmap.yaml                           # 配置映射                                        │
│   │   │   ├── secret.yaml                              # 密钥配置                                        │
│   │   │   └── ingress.yaml                             # 入口配置                                        │
│   │   └── nginx/                                       # Nginx配置                                       │
│   │       └── nginx.conf                               # Nginx配置文件                                   │
│   │                                                                                                      │
│   └── docs/                                            # 📚 文档                                         │
│       ├── api/                                         # API文档                                         │
│       ├── architecture/                                # 架构文档                                        │
│       └── deployment/                                  # 部署文档                                        │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4.2 核心代码实现

#### 2.4.2.1 统一响应封装

```java
// aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/domain/R.java

package com.aetherblog.common.core.domain;

import com.aetherblog.common.core.enums.ResultCode;
import com.fasterxml.jackson.annotation.JsonInclude;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.experimental.Accessors;

import java.io.Serializable;
import java.time.Instant;

/**
 * 统一API响应结果封装
 *
 * @param <T> 数据类型
 */
@Data
@Accessors(chain = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
@Schema(description = "统一响应结果")
public class R<T> implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 状态码
     */
    @Schema(description = "状态码", example = "200")
    private int code;

    /**
     * 消息
     */
    @Schema(description = "消息", example = "操作成功")
    private String message;

    /**
     * 数据
     */
    @Schema(description = "响应数据")
    private T data;

    /**
     * 时间戳
     */
    @Schema(description = "时间戳")
    private long timestamp;

    /**
     * 链路追踪ID
     */
    @Schema(description = "链路追踪ID")
    private String traceId;

    /**
     * 分页信息
     */
    @Schema(description = "分页信息")
    private PageInfo page;

    public R() {
        this.timestamp = Instant.now().toEpochMilli();
    }

    // ==================== 成功响应 ====================

    public static <T> R<T> ok() {
        return ok(null);
    }

    public static <T> R<T> ok(T data) {
        return ok(data, ResultCode.SUCCESS.getMessage());
    }

    public static <T> R<T> ok(T data, String message) {
        return new R<T>()
                .setCode(ResultCode.SUCCESS.getCode())
                .setMessage(message)
                .setData(data);
    }

    public static <T> R<T> page(T data, PageInfo pageInfo) {
        return new R<T>()
                .setCode(ResultCode.SUCCESS.getCode())
                .setMessage(ResultCode.SUCCESS.getMessage())
                .setData(data)
                .setPage(pageInfo);
    }

    // ==================== 失败响应 ====================

    public static <T> R<T> fail() {
        return fail(ResultCode.INTERNAL_ERROR);
    }

    public static <T> R<T> fail(String message) {
        return fail(ResultCode.INTERNAL_ERROR.getCode(), message);
    }

    public static <T> R<T> fail(ResultCode resultCode) {
        return fail(resultCode.getCode(), resultCode.getMessage());
    }

    public static <T> R<T> fail(int code, String message) {
        return new R<T>()
                .setCode(code)
                .setMessage(message);
    }

    public static <T> R<T> fail(ResultCode resultCode, String message) {
        return fail(resultCode.getCode(), message);
    }

    // ==================== 判断方法 ====================

    public boolean isSuccess() {
        return this.code == ResultCode.SUCCESS.getCode();
    }

    public boolean isFail() {
        return !isSuccess();
    }

    // ==================== 分页信息内部类 ====================

    @Data
    @Schema(description = "分页信息")
    public static class PageInfo implements Serializable {
        
        @Schema(description = "当前页码", example = "1")
        private int page;
        
        @Schema(description = "每页大小", example = "10")
        private int size;
        
        @Schema(description = "总记录数", example = "100")
        private long total;
        
        @Schema(description = "总页数", example = "10")
        private int totalPages;
        
        @Schema(description = "是否有下一页")
        private boolean hasNext;
        
        @Schema(description = "是否有上一页")
        private boolean hasPrevious;

        public static PageInfo of(int page, int size, long total) {
            PageInfo pageInfo = new PageInfo();
            pageInfo.setPage(page);
            pageInfo.setSize(size);
            pageInfo.setTotal(total);
            pageInfo.setTotalPages((int) Math.ceil((double) total / size));
            pageInfo.setHasNext(page < pageInfo.getTotalPages());
            pageInfo.setHasPrevious(page > 1);
            return pageInfo;
        }
    }
}
```

#### 2.4.2.2 全局异常处理器

```java
// aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/exception/GlobalExceptionHandler.java

package com.aetherblog.common.core.exception;

import com.aetherblog.common.core.domain.R;
import com.aetherblog.common.core.enums.ResultCode;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.validation.ConstraintViolation;
import jakarta.validation.ConstraintViolationException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.converter.HttpMessageNotReadableException;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.core.AuthenticationException;
import org.springframework.validation.BindException;
import org.springframework.validation.FieldError;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.MissingServletRequestParameterException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;
import org.springframework.web.multipart.MaxUploadSizeExceededException;
import org.springframework.web.servlet.NoHandlerFoundException;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

/**
 * 全局异常处理器
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * 业务异常
     */
    @ExceptionHandler(BusinessException.class)
    @ResponseStatus(HttpStatus.OK)
    public R<Void> handleBusinessException(BusinessException e, HttpServletRequest request) {
        log.warn("业务异常: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(e.getCode(), e.getMessage());
    }

    /**
     * 认证异常
     */
    @ExceptionHandler(AuthException.class)
    @ResponseStatus(HttpStatus.UNAUTHORIZED)
    public R<Void> handleAuthException(AuthException e, HttpServletRequest request) {
        log.warn("认证异常: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(ResultCode.UNAUTHORIZED, e.getMessage());
    }

    /**
     * Spring Security 认证异常
     */
    @ExceptionHandler(AuthenticationException.class)
    @ResponseStatus(HttpStatus.UNAUTHORIZED)
    public R<Void> handleAuthenticationException(AuthenticationException e, HttpServletRequest request) {
        log.warn("认证失败: {} - {}", request.getRequestURI(), e.getMessage());
        String message = e instanceof BadCredentialsException ? "用户名或密码错误" : "认证失败";
        return R.fail(ResultCode.UNAUTHORIZED, message);
    }

    /**
     * 访问拒绝异常
     */
    @ExceptionHandler(AccessDeniedException.class)
    @ResponseStatus(HttpStatus.FORBIDDEN)
    public R<Void> handleAccessDeniedException(AccessDeniedException e, HttpServletRequest request) {
        log.warn("访问拒绝: {} - {}", request.getRequestURI(), e.getMessage());
        return R.fail(ResultCode.FORBIDDEN, "没有权限访问该资源");
    }

    /**
     * 参数校验异常 - @Valid
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        List<FieldError> fieldErrors = e.getBindingResult().getFieldErrors();
        String message = fieldErrors.stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining("; "));
        log.warn("参数校验失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 参数校验异常 - @Validated
     */
    @ExceptionHandler(ConstraintViolationException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleConstraintViolationException(ConstraintViolationException e) {
        Set<ConstraintViolation<?>> violations = e.getConstraintViolations();
        String message = violations.stream()
                .map(ConstraintViolation::getMessage)
                .collect(Collectors.joining("; "));
        log.warn("约束校验失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 参数绑定异常
     */
    @ExceptionHandler(BindException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleBindException(BindException e) {
        String message = e.getFieldErrors().stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining("; "));
        log.warn("参数绑定失败: {}", message);
        return R.fail(ResultCode.BAD_REQUEST, message);
    }

    /**
     * 缺少请求参数
     */
    @ExceptionHandler(MissingServletRequestParameterException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMissingServletRequestParameterException(MissingServletRequestParameterException e) {
        log.warn("缺少请求参数: {}", e.getParameterName());
        return R.fail(ResultCode.BAD_REQUEST, "缺少必要参数: " + e.getParameterName());
    }

    /**
     * 参数类型不匹配
     */
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMethodArgumentTypeMismatchException(MethodArgumentTypeMismatchException e) {
        log.warn("参数类型不匹配: {} - {}", e.getName(), e.getValue());
        return R.fail(ResultCode.BAD_REQUEST, "参数类型错误: " + e.getName());
    }

    /**
     * 请求体解析异常
     */
    @ExceptionHandler(HttpMessageNotReadableException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleHttpMessageNotReadableException(HttpMessageNotReadableException e) {
        log.warn("请求体解析失败: {}", e.getMessage());
        return R.fail(ResultCode.BAD_REQUEST, "请求体格式错误");
    }

    /**
     * 不支持的请求方法
     */
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    @ResponseStatus(HttpStatus.METHOD_NOT_ALLOWED)
    public R<Void> handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException e) {
        log.warn("不支持的请求方法: {}", e.getMethod());
        return R.fail(405, "不支持的请求方法: " + e.getMethod());
    }

    /**
     * 不支持的媒体类型
     */
    @ExceptionHandler(HttpMediaTypeNotSupportedException.class)
    @ResponseStatus(HttpStatus.UNSUPPORTED_MEDIA_TYPE)
    public R<Void> handleHttpMediaTypeNotSupportedException(HttpMediaTypeNotSupportedException e) {
        log.warn("不支持的媒体类型: {}", e.getContentType());
        return R.fail(415, "不支持的媒体类型");
    }

    /**
     * 404 异常
     */
    @ExceptionHandler(NoHandlerFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public R<Void> handleNoHandlerFoundException(NoHandlerFoundException e) {
        log.warn("资源不存在: {}", e.getRequestURL());
        return R.fail(ResultCode.NOT_FOUND, "请求的资源不存在");
    }

    /**
     * 文件上传大小超限
     */
    @ExceptionHandler(MaxUploadSizeExceededException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMaxUploadSizeExceededException(MaxUploadSizeExceededException e) {
        log.warn("文件上传超限: {}", e.getMessage());
        return R.fail(ResultCode.FILE_SIZE_EXCEEDED, "上传文件大小超过限制");
    }

    /**
     * 其他未知异常
     */
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public R<Void> handleException(Exception e, HttpServletRequest request) {
        log.error("系统异常: {} - {}", request.getRequestURI(), e.getMessage(), e);
        return R.fail(ResultCode.INTERNAL_ERROR, "系统繁忙，请稍后再试");
    }
}
```

#### 2.4.2.3 JWT 服务实现

```java
// aetherblog-common/common-security/src/main/java/com/aetherblog/common/security/service/JwtService.java

package com.aetherblog.common.security.service;

import com.aetherblog.common.security.config.JwtConfig;
import com.aetherblog.common.security.domain.JwtPayload;
import com.aetherblog.common.security.domain.LoginUser;
import com.aetherblog.common.security.domain.TokenPair;
import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import io.jsonwebtoken.security.SignatureException;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.time.Instant;
import java.util.Date;
import java.util.UUID;

/**
 * JWT 服务
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class JwtService {

    private final JwtConfig jwtConfig;

    /**
     * 获取签名密钥
     */
    private SecretKey getSigningKey() {
        return Keys.hmacShaKeyFor(jwtConfig.getSecret().getBytes(StandardCharsets.UTF_8));
    }

    /**
     * 生成 Token 对（Access Token + Refresh Token）
     */
    public TokenPair generateTokenPair(LoginUser loginUser) {
        Instant now = Instant.now();
        
        // 生成 Access Token
        String accessToken = generateAccessToken(loginUser, now);
        
        // 生成 Refresh Token
        String refreshToken = generateRefreshToken(loginUser.getUserId(), now);
        
        return TokenPair.builder()
                .accessToken(accessToken)
                .refreshToken(refreshToken)
                .accessTokenExpireIn(jwtConfig.getAccessTokenExpiration())
                .refreshTokenExpireIn(jwtConfig.getRefreshTokenExpiration())
                .tokenType("Bearer")
                .build();
    }

    /**
     * 生成 Access Token
     */
    private String generateAccessToken(LoginUser loginUser, Instant now) {
        Instant expiration = now.plusSeconds(jwtConfig.getAccessTokenExpiration());
        
        return Jwts.builder()
                .header()
                    .type("JWT")
                    .and()
                .id(UUID.randomUUID().toString())
                .subject(loginUser.getUserId().toString())
                .claim("username", loginUser.getUsername())
                .claim("roles", loginUser.getRoles())
                .claim("type", "access")
                .issuer(jwtConfig.getIssuer())
                .issuedAt(Date.from(now))
                .expiration(Date.from(expiration))
                .signWith(getSigningKey(), Jwts.SIG.HS256)
                .compact();
    }

    /**
     * 生成 Refresh Token
     */
    private String generateRefreshToken(Long userId, Instant now) {
        Instant expiration = now.plusSeconds(jwtConfig.getRefreshTokenExpiration());
        
        return Jwts.builder()
                .id(UUID.randomUUID().toString())
                .subject(userId.toString())
                .claim("type", "refresh")
                .issuer(jwtConfig.getIssuer())
                .issuedAt(Date.from(now))
                .expiration(Date.from(expiration))
                .signWith(getSigningKey(), Jwts.SIG.HS256)
                .compact();
    }

    /**
     * 解析 Token
     */
    public JwtPayload parseToken(String token) {
        try {
            Claims claims = Jwts.parser()
                    .verifyWith(getSigningKey())
                    .requireIssuer(jwtConfig.getIssuer())
                    .build()
                    .parseSignedClaims(token)
                    .getPayload();

            return JwtPayload.builder()
                    .jti(claims.getId())
                    .userId(Long.parseLong(claims.getSubject()))
                    .username(claims.get("username", String.class))
                    .roles(claims.get("roles", java.util.List.class))
                    .type(claims.get("type", String.class))
                    .issuedAt(claims.getIssuedAt().toInstant())
                    .expiration(claims.getExpiration().toInstant())
                    .build();
        } catch (ExpiredJwtException e) {
            log.warn("Token已过期: {}", e.getMessage());
            throw new TokenExpiredException("Token已过期，请重新登录");
        } catch (SignatureException e) {
            log.warn("Token签名无效: {}", e.getMessage());
            throw new InvalidTokenException("无效的Token");
        } catch (MalformedJwtException e) {
            log.warn("Token格式错误: {}", e.getMessage());
            throw new InvalidTokenException("Token格式错误");
        } catch (Exception e) {
            log.error("Token解析失败: {}", e.getMessage());
            throw new InvalidTokenException("Token解析失败");
        }
    }

    /**
     * 验证 Token 是否有效
     */
    public boolean validateToken(String token) {
        try {
            parseToken(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 判断 Token 是否为 Access Token
     */
    public boolean isAccessToken(String token) {
        try {
            JwtPayload payload = parseToken(token);
            return "access".equals(payload.getType());
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 判断 Token 是否为 Refresh Token
     */
    public boolean isRefreshToken(String token) {
        try {
            JwtPayload payload = parseToken(token);
            return "refresh".equals(payload.getType());
        } catch (Exception e) {
            return false;
        }
    }

    /**
     * 从请求头中提取 Token
     */
    public String extractTokenFromHeader(String authorizationHeader) {
        if (authorizationHeader != null && authorizationHeader.startsWith("Bearer ")) {
            return authorizationHeader.substring(7);
        }
        return null;
    }

    /**
     * 获取 Token 剩余有效时间（秒）
     */
    public long getTokenRemainingTime(String token) {
        try {
            JwtPayload payload = parseToken(token);
            long remaining = payload.getExpiration().getEpochSecond() - Instant.now().getEpochSecond();
            return Math.max(0, remaining);
        } catch (Exception e) {
            return 0;
        }
    }

    /**
     * 刷新 Access Token
     */
    public TokenPair refreshAccessToken(String refreshToken, LoginUser loginUser) {
        // 验证 Refresh Token
        JwtPayload payload = parseToken(refreshToken);
        if (!"refresh".equals(payload.getType())) {
            throw new InvalidTokenException("无效的刷新令牌");
        }
        
        // 验证用户ID是否匹配
        if (!payload.getUserId().equals(loginUser.getUserId())) {
            throw new InvalidTokenException("令牌与用户不匹配");
        }
        
        // 生成新的 Token 对
        return generateTokenPair(loginUser);
    }
}
```

```java
// aetherblog-common/common-security/src/main/java/com/aetherblog/common/security/domain/TokenPair.java

package com.aetherblog.common.security.domain;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Builder;
import lombok.Data;

/**
 * Token 对
 */
@Data
@Builder
@Schema(description = "Token响应")
public class TokenPair {

    @Schema(description = "访问令牌")
    private String accessToken;

    @Schema(description = "刷新令牌")
    private String refreshToken;

    @Schema(description = "访问令牌过期时间（秒）", example = "900")
    private long accessTokenExpireIn;

    @Schema(description = "刷新令牌过期时间（秒）", example = "604800")
    private long refreshTokenExpireIn;

    @Schema(description = "令牌类型", example = "Bearer")
    private String tokenType;
}
```

#### 2.4.2.4 文章服务实现

```java
// aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/entity/Post.java

package com.aetherblog.blog.entity;

import com.aetherblog.common.core.domain.BaseEntity;
import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.hibernate.annotations.SQLDelete;
import org.hibernate.annotations.SQLRestriction;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;

/**
 * 文章实体
 */
@Data
@Entity
@Table(name = "posts")
@EqualsAndHashCode(callSuper = true)
@SQLDelete(sql = "UPDATE posts SET deleted = true WHERE id = ?")
@SQLRestriction("deleted = false")
public class Post extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * 文章标题
     */
    @Column(nullable = false, length = 200)
    private String title;

    /**
     * URL友好的唯一标识
     */
    @Column(nullable = false, unique = true, length = 200)
    private String slug;

    /**
     * Markdown 原始内容
     */
    @Column(columnDefinition = "TEXT")
    private String contentMarkdown;

    /**
     * 渲染后的 HTML 内容
     */
    @Column(columnDefinition = "TEXT")
    private String contentHtml;

    /**
     * 文章摘要
     */
    @Column(length = 500)
    private String summary;

    /**
     * 封面图片 URL
     */
    @Column(length = 500)
    private String coverImage;

    /**
     * 文章状态: DRAFT, PUBLISHED, SCHEDULED, ARCHIVED
     */
    @Enumerated(EnumType.STRING)
    @Column(nullable = false, length = 20)
    private PostStatus status = PostStatus.DRAFT;

    /**
     * 发布时间
     */
    private LocalDateTime publishedAt;

    /**
     * 定时发布时间
     */
    private LocalDateTime scheduledAt;

    /**
     * 字数统计
     */
    private Integer wordCount = 0;

    /**
     * 预估阅读时间（分钟）
     */
    private Integer readingTime = 0;

    /**
     * 浏览量
     */
    private Long viewCount = 0L;

    /**
     * 点赞数
     */
    private Long likeCount = 0L;

    /**
     * 评论数
     */
    private Integer commentCount = 0;

    /**
     * 是否置顶
     */
    private Boolean isPinned = false;

    /**
     * 是否允许评论
     */
    private Boolean allowComment = true;

    /**
     * SEO 标题
     */
    @Column(length = 200)
    private String seoTitle;

    /**
     * SEO 描述
     */
    @Column(length = 300)
    private String seoDescription;

    /**
     * SEO 关键词
     */
    @Column(length = 200)
    private String seoKeywords;

    /**
     * 向量化状态: PENDING, INDEXED, FAILED
     */
    @Enumerated(EnumType.STRING)
    @Column(length = 20)
    private EmbeddingStatus embeddingStatus = EmbeddingStatus.PENDING;

    /**
     * 是否已删除（软删除）
     */
    private Boolean deleted = false;

    /**
     * 分类
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "category_id")
    private Category category;

    /**
     * 作者
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "author_id", nullable = false)
    private User author;

    /**
     * 标签（多对多）
     */
    @ManyToMany(fetch = FetchType.LAZY)
    @JoinTable(
            name = "post_tags",
            joinColumns = @JoinColumn(name = "post_id"),
            inverseJoinColumns = @JoinColumn(name = "tag_id")
    )
    private Set<Tag> tags = new HashSet<>();

    // ==================== 枚举定义 ====================

    public enum PostStatus {
        DRAFT,      // 草稿
        PUBLISHED,  // 已发布
        SCHEDULED,  // 定时发布
        ARCHIVED    // 已归档
    }

    public enum EmbeddingStatus {
        PENDING,    // 待处理
        INDEXED,    // 已索引
        FAILED      // 处理失败
    }

    // ==================== 业务方法 ====================

    /**
     * 发布文章
     */
    public void publish() {
        this.status = PostStatus.PUBLISHED;
        this.publishedAt = LocalDateTime.now();
        this.scheduledAt = null;
    }

    /**
     * 定时发布
     */
    public void schedule(LocalDateTime scheduledAt) {
        this.status = PostStatus.SCHEDULED;
        this.scheduledAt = scheduledAt;
        this.publishedAt = null;
    }

    /**
     * 转为草稿
     */
    public void toDraft() {
        this.status = PostStatus.DRAFT;
        this.publishedAt = null;
        this.scheduledAt = null;
    }

    /**
     * 增加浏览量
     */
    public void incrementViewCount() {
        this.viewCount++;
    }

    /**
     * 添加标签
     */
    public void addTag(Tag tag) {
        this.tags.add(tag);
    }

    /**
     * 移除标签
     */
    public void removeTag(Tag tag) {
        this.tags.remove(tag);
    }
}
```

```java
// aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/impl/PostServiceImpl.java

package com.aetherblog.blog.service.impl;

import com.aetherblog.blog.converter.PostConverter;
import com.aetherblog.blog.dto.request.CreatePostRequest;
import com.aetherblog.blog.dto.request.UpdatePostRequest;
import com.aetherblog.blog.dto.response.PostDetailResponse;
import com.aetherblog.blog.dto.response.PostListResponse;
import com.aetherblog.blog.entity.Category;
import com.aetherblog.blog.entity.Post;
import com.aetherblog.blog.entity.Post.PostStatus;
import com.aetherblog.blog.entity.Tag;
import com.aetherblog.blog.entity.User;
import com.aetherblog.blog.repository.CategoryRepository;
import com.aetherblog.blog.repository.PostRepository;
import com.aetherblog.blog.repository.TagRepository;
import com.aetherblog.blog.service.PostService;
import com.aetherblog.common.core.domain.PageQuery;
import com.aetherblog.common.core.domain.PageResult;
import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.SlugUtils;
import com.aetherblog.common.redis.service.CacheService;
import com.aetherblog.common.security.service.SecurityService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.ApplicationEventPublisher;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.concurrent.TimeUnit;

/**
 * 文章服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class PostServiceImpl implements PostService {

    private final PostRepository postRepository;
    private final CategoryRepository categoryRepository;
    private final TagRepository tagRepository;
    private final PostConverter postConverter;
    private final SecurityService securityService;
    private final CacheService cacheService;
    private final MarkdownService markdownService;
    private final ApplicationEventPublisher eventPublisher;

    private static final String CACHE_KEY_POST = "post:detail:";
    private static final String CACHE_KEY_POST_LIST = "post:list:";
    private static final long CACHE_EXPIRE_HOURS = 2;

    @Override
    @Transactional(readOnly = true)
    public PageResult<PostListResponse> getPostList(PostQueryCriteria criteria, PageQuery pageQuery) {
        // 构建分页参数
        Sort sort = Sort.by(
                pageQuery.getSortDirection().equalsIgnoreCase("asc") ? Sort.Direction.ASC : Sort.Direction.DESC,
                pageQuery.getSortBy()
        );
        Pageable pageable = PageRequest.of(pageQuery.getPage() - 1, pageQuery.getSize(), sort);

        // 查询
        Page<Post> postPage = postRepository.findByConditions(
                criteria.getStatus(),
                criteria.getCategoryId(),
                criteria.getTagIds(),
                criteria.getKeyword(),
                pageable
        );

        // 转换为响应DTO
        List<PostListResponse> list = postPage.getContent().stream()
                .map(postConverter::toListResponse)
                .toList();

        return PageResult.of(list, postPage.getTotalElements(), pageQuery);
    }

    @Override
    @Transactional(readOnly = true)
    public PostDetailResponse getPostDetail(String idOrSlug) {
        // 尝试从缓存获取
        String cacheKey = CACHE_KEY_POST + idOrSlug;
        PostDetailResponse cached = cacheService.get(cacheKey, PostDetailResponse.class);
        if (cached != null) {
            return cached;
        }

        // 查询数据库
        Post post = findPostByIdOrSlug(idOrSlug);
        
        // 转换为响应DTO
        PostDetailResponse response = postConverter.toDetailResponse(post);

        // 获取上一篇/下一篇
        response.setPrev(getAdjacentPost(post, true));
        response.setNext(getAdjacentPost(post, false));

        // 获取相关文章
        response.setRelatedPosts(getRelatedPosts(post, 5));

        // 缓存
        cacheService.set(cacheKey, response, CACHE_EXPIRE_HOURS, TimeUnit.HOURS);

        return response;
    }

    @Override
    @Transactional(readOnly = true)
    public PostDetailResponse getPostBySlug(String slug) {
        return getPostDetail(slug);
    }

    @Override
    @Transactional
    public PostDetailResponse createPost(CreatePostRequest request) {
        User currentUser = securityService.getCurrentUser();

        // 生成 Slug
        String slug = StringUtils.hasText(request.getSlug()) 
                ? request.getSlug() 
                : SlugUtils.generate(request.getTitle());
        
        // 检查 Slug 唯一性
        if (postRepository.existsBySlug(slug)) {
            slug = slug + "-" + System.currentTimeMillis();
        }

        // 创建文章实体
        Post post = new Post();
        post.setTitle(request.getTitle());
        post.setSlug(slug);
        post.setContentMarkdown(request.getContentMarkdown());
        post.setSummary(request.getSummary());
        post.setCoverImage(request.getCoverImage());
        post.setAuthor(currentUser);

        // 渲染 HTML
        String html = markdownService.render(request.getContentMarkdown());
        post.setContentHtml(html);

        // 计算字数和阅读时间
        int wordCount = countWords(request.getContentMarkdown());
        post.setWordCount(wordCount);
        post.setReadingTime(calculateReadingTime(wordCount));

        // 设置分类
        if (request.getCategoryId() != null) {
            Category category = categoryRepository.findById(request.getCategoryId())
                    .orElseThrow(() -> new BusinessException("分类不存在"));
            post.setCategory(category);
        }

        // 设置标签
        if (request.getTagIds() != null && !request.getTagIds().isEmpty()) {
            Set<Tag> tags = new HashSet<>(tagRepository.findAllById(request.getTagIds()));
            post.setTags(tags);
        }

        // 处理发布状态
        handlePublishStatus(post, request.getStatus(), request.getScheduledAt());

        // 保存
        post = postRepository.save(post);
        log.info("创建文章成功: id={}, title={}", post.getId(), post.getTitle());

        // 发布事件（用于触发向量化等异步操作）
        eventPublisher.publishEvent(new PostCreatedEvent(this, post));

        // 清除列表缓存
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");

        return postConverter.toDetailResponse(post);
    }

    @Override
    @Transactional
    public PostDetailResponse updatePost(Long id, UpdatePostRequest request) {
        Post post = postRepository.findById(id)
                .orElseThrow(() -> new BusinessException("文章不存在"));

        // 检查权限
        securityService.checkPostPermission(post);

        // 更新基本信息
        if (StringUtils.hasText(request.getTitle())) {
            post.setTitle(request.getTitle());
        }
        if (StringUtils.hasText(request.getSlug())) {
            // 检查 Slug 唯一性（排除自身）
            if (postRepository.existsBySlugAndIdNot(request.getSlug(), id)) {
                throw new BusinessException("Slug 已被使用");
            }
            post.setSlug(request.getSlug());
        }
        if (request.getContentMarkdown() != null) {
            post.setContentMarkdown(request.getContentMarkdown());
            post.setContentHtml(markdownService.render(request.getContentMarkdown()));
            
            // 重新计算字数
            int wordCount = countWords(request.getContentMarkdown());
            post.setWordCount(wordCount);
            post.setReadingTime(calculateReadingTime(wordCount));
        }
        if (request.getSummary() != null) {
            post.setSummary(request.getSummary());
        }
        if (request.getCoverImage() != null) {
            post.setCoverImage(request.getCoverImage());
        }

        // 更新分类
        if (request.getCategoryId() != null) {
            Category category = categoryRepository.findById(request.getCategoryId())
                    .orElseThrow(() -> new BusinessException("分类不存在"));
            post.setCategory(category);
        }

        // 更新标签
        if (request.getTagIds() != null) {
            Set<Tag> tags = new HashSet<>(tagRepository.findAllById(request.getTagIds()));
            post.setTags(tags);
        }

        // 处理发布状态
        if (request.getStatus() != null) {
            handlePublishStatus(post, request.getStatus(), request.getScheduledAt());
        }

        // 保存
        post = postRepository.save(post);
        log.info("更新文章成功: id={}", id);

        // 发布事件
        eventPublisher.publishEvent(new PostUpdatedEvent(this, post));

        // 清除缓存
        cacheService.delete(CACHE_KEY_POST + id);
        cacheService.delete(CACHE_KEY_POST + post.getSlug());
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");

        return postConverter.toDetailResponse(post);
    }

    @Override
    @Transactional
    public void deletePost(Long id) {
        Post post = postRepository.findById(id)
                .orElseThrow(() -> new BusinessException("文章不存在"));

        // 检查权限
        securityService.checkPostPermission(post);

        // 软删除
        postRepository.delete(post);
        log.info("删除文章成功: id={}", id);

        // 发布事件
        eventPublisher.publishEvent(new PostDeletedEvent(this, post));

        // 清除缓存
        cacheService.delete(CACHE_KEY_POST + id);
        cacheService.delete(CACHE_KEY_POST + post.getSlug());
        cacheService.deleteByPattern(CACHE_KEY_POST_LIST + "*");
    }

    @Override
    @Transactional
    public void incrementViewCount(Long postId) {
        // 使用 Redis 进行计数，定期同步到数据库
        String key = "post:views:" + postId;
        Long views = cacheService.increment(key, 1);
        
        // 每 100 次浏览同步一次到数据库
        if (views != null && views % 100 == 0) {
            postRepository.incrementViewCount(postId, 100);
            cacheService.delete(key);
        }
    }

    // ==================== 私有方法 ====================

    private Post findPostByIdOrSlug(String idOrSlug) {
        // 尝试作为 ID 查询
        try {
            Long id = Long.parseLong(idOrSlug);
            return postRepository.findById(id)
                    .orElseThrow(() -> new BusinessException("文章不存在"));
        } catch (NumberFormatException e) {
            // 作为 Slug 查询
            return postRepository.findBySlug(idOrSlug)
                    .orElseThrow(() -> new BusinessException("文章不存在"));
        }
    }

    private void handlePublishStatus(Post post, String status, LocalDateTime scheduledAt) {
        PostStatus postStatus = PostStatus.valueOf(status.toUpperCase());
        switch (postStatus) {
            case PUBLISHED -> post.publish();
            case SCHEDULED -> {
                if (scheduledAt == null) {
                    throw new BusinessException("定时发布需要指定发布时间");
                }
                post.schedule(scheduledAt);
            }
            case DRAFT -> post.toDraft();
            default -> post.setStatus(postStatus);
        }
    }

    private int countWords(String markdown) {
        if (markdown == null) return 0;
        // 简单的中英文字数统计
        String text = markdown.replaceAll("[\\s\\p{Punct}]", "");
        return text.length();
    }

    private int calculateReadingTime(int wordCount) {
        // 假设平均阅读速度：中文 300字/分钟
        return Math.max(1, wordCount / 300);
    }

    private PostNavigation getAdjacentPost(Post current, boolean isPrevious) {
        Post adjacent = isPrevious
                ? postRepository.findPreviousPost(current.getPublishedAt(), current.getId())
                : postRepository.findNextPost(current.getPublishedAt(), current.getId());
        
        if (adjacent == null) return null;
        
        return new PostNavigation(adjacent.getId(), adjacent.getTitle(), adjacent.getSlug());
    }

    private List<RelatedPost> getRelatedPosts(Post post, int limit) {
        // 基于标签相似度获取相关文章
        List<Long> tagIds = post.getTags().stream().map(Tag::getId).toList();
        if (tagIds.isEmpty()) {
            return List.of();
        }
        
        return postRepository.findRelatedPosts(post.getId(), tagIds, PageRequest.of(0, limit))
                .stream()
                .map(p -> new RelatedPost(p.getId(), p.getTitle(), p.getSlug(), p.getCoverImage()))
                .toList();
    }
}
```

#### 2.4.2.5 AI 服务实现

```java
// aetherblog-ai/ai-core/src/main/java/com/aetherblog/ai/core/config/SpringAiConfig.java

package com.aetherblog.ai.core.config;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.embedding.EmbeddingModel;
import org.springframework.ai.openai.OpenAiChatModel;
import org.springframework.ai.openai.OpenAiEmbeddingModel;
import org.springframework.ai.openai.api.OpenAiApi;
import org.springframework.ai.vectorstore.PgVectorStore;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.core.JdbcTemplate;

/**
 * Spring AI 配置
 */
@Configuration
public class SpringAiConfig {

    @Value("${spring.ai.openai.api-key}")
    private String openAiApiKey;

    @Value("${spring.ai.openai.base-url:https://api.openai.com}")
    private String openAiBaseUrl;

    @Value("${spring.ai.openai.chat.model:gpt-4o}")
    private String chatModel;

    @Value("${spring.ai.openai.embedding.model:text-embedding-3-small}")
    private String embeddingModel;

    /**
     * OpenAI API 客户端
     */
    @Bean
    public OpenAiApi openAiApi() {
        return new OpenAiApi(openAiBaseUrl, openAiApiKey);
    }

    /**
     * Chat 模型
     */
    @Bean
    public OpenAiChatModel openAiChatModel(OpenAiApi openAiApi) {
        return new OpenAiChatModel(openAiApi, 
                org.springframework.ai.openai.OpenAiChatOptions.builder()
                        .withModel(chatModel)
                        .withTemperature(0.7f)
                        .build());
    }

    /**
     * Embedding 模型
     */
    @Bean
    public OpenAiEmbeddingModel openAiEmbeddingModel(OpenAiApi openAiApi) {
        return new OpenAiEmbeddingModel(openAiApi,
                org.springframework.ai.openai.OpenAiEmbeddingOptions.builder()
                        .withModel(embeddingModel)
                        .build());
    }

    /**
     * ChatClient（推荐使用，提供更流畅的 API）
     */
    @Bean
    public ChatClient chatClient(OpenAiChatModel chatModel) {
        return ChatClient.builder(chatModel)
                .defaultSystem("你是一个专业的技术博客写作助手。")
                .build();
    }

    /**
     * 向量存储（使用 PostgreSQL pgvector）
     */
    @Bean
    public VectorStore vectorStore(JdbcTemplate jdbcTemplate, EmbeddingModel embeddingModel) {
        return new PgVectorStore(jdbcTemplate, embeddingModel);
    }
}
```

```java
// aetherblog-ai/ai-agent/src/main/java/com/aetherblog/ai/agent/WritingAgent.java

package com.aetherblog.ai.agent;

import com.aetherblog.ai.prompt.service.PromptService;
import com.aetherblog.ai.agent.base.BaseAgent;
import com.aetherblog.ai.agent.base.AgentResult;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.chat.prompt.PromptTemplate;
import org.springframework.stereotype.Component;
import reactor.core.publisher.Flux;

import java.util.Map;

/**
 * 写作助手 Agent
 * 
 * 提供文本清洗、内容重写、润色优化、续写等功能
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class WritingAgent extends BaseAgent {

    private final ChatClient chatClient;
    private final PromptService promptService;

    /**
     * 文本清洗
     * 
     * 功能：
     * - 去除多余空行和空格
     * - 统一标点符号（中英文）
     * - 修复断句问题
     * - 格式化代码块
     */
    public Flux<String> cleanText(String text) {
        String systemPrompt = promptService.getPrompt("text-cleaner");
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(text)
                .advisors(new SimpleLoggerAdvisor())
                .stream()
                .content();
    }

    /**
     * 同步版本 - 文本清洗
     */
    public String cleanTextSync(String text) {
        String systemPrompt = promptService.getPrompt("text-cleaner");
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(text)
                .call()
                .content();
    }

    /**
     * 内容重写
     * 
     * @param text 原始文本
     * @param style 重写风格: professional, casual, concise, detailed, creative
     */
    public Flux<String> rewriteText(String text, String style) {
        String promptName = "rewriter-" + style.toLowerCase();
        String systemPrompt = promptService.getPromptOrDefault(promptName, getDefaultRewritePrompt(style));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(text)
                .stream()
                .content();
    }

    /**
     * 同步版本 - 内容重写
     */
    public String rewriteTextSync(String text, String style) {
        String promptName = "rewriter-" + style.toLowerCase();
        String systemPrompt = promptService.getPromptOrDefault(promptName, getDefaultRewritePrompt(style));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(text)
                .call()
                .content();
    }

    /**
     * 润色优化
     */
    public Flux<String> polishText(String text) {
        String systemPrompt = promptService.getPrompt("polisher");
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(text)
                .stream()
                .content();
    }

    /**
     * 续写内容
     */
    public Flux<String> continueWriting(String text) {
        String systemPrompt = promptService.getPrompt("continue-writer");
        
        String userPrompt = String.format("""
                请根据以下内容继续写作，保持风格一致，自然衔接：
                
                ---
                %s
                ---
                
                请继续：
                """, text);
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .stream()
                .content();
    }

    /**
     * 自定义 Prompt 处理
     */
    public Flux<String> processWithCustomPrompt(String text, String customPrompt) {
        return chatClient.prompt()
                .system(customPrompt)
                .user(text)
                .stream()
                .content();
    }

    /**
     * 获取默认重写 Prompt
     */
    private String getDefaultRewritePrompt(String style) {
        return switch (style.toLowerCase()) {
            case "professional" -> """
                    你是一位专业的技术写作专家。请将用户提供的文本改写成更加专业、严谨的学术风格。
                    要求：
                    - 使用专业术语，但确保准确性
                    - 语言简洁精炼
                    - 逻辑清晰，结构严谨
                    - 保持客观中立的语气
                    """;
            case "casual" -> """
                    你是一位善于表达的内容创作者。请将用户提供的文本改写成更加通俗易懂的风格。
                    要求：
                    - 使用简单直白的语言
                    - 避免过多专业术语，必要时进行解释
                    - 语气亲切自然
                    - 适当使用比喻帮助理解
                    """;
            case "concise" -> """
                    你是一位精炼表达的编辑。请将用户提供的文本精简到最核心的内容。
                    要求：
                    - 删除冗余词句
                    - 合并相似表达
                    - 保留核心信息
                    - 每个句子都有明确目的
                    """;
            case "detailed" -> """
                    你是一位细致入微的技术作家。请将用户提供的文本扩展，补充更多细节和解释。
                    要求：
                    - 添加具体的例子
                    - 解释技术原理
                    - 补充背景信息
                    - 增加过渡句，使行文更流畅
                    """;
            case "creative" -> """
                    你是一位富有创意的内容创作者。请将用户提供的文本改写得更加生动有趣。
                    要求：
                    - 使用生动的比喻和类比
                    - 加入适当的幽默元素
                    - 讲故事的方式呈现
                    - 增加读者的阅读兴趣
                    """;
            default -> "请帮我改写以下文本，使其更加清晰流畅。";
        };
    }
}
```

```java
// aetherblog-ai/ai-agent/src/main/java/com/aetherblog/ai/agent/TaggingAgent.java

package com.aetherblog.ai.agent;

import com.aetherblog.ai.prompt.service.PromptService;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.ResponseEntity;
import org.springframework.ai.converter.BeanOutputConverter;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;

/**
 * 标签生成 Agent
 * 
 * 功能：
 * - 自动生成文章标签
 * - 提取关键词
 * - 推荐分类
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class TaggingAgent {

    private final ChatClient chatClient;
    private final PromptService promptService;
    private final ObjectMapper objectMapper;

    /**
     * 生成标签响应记录
     */
    public record TaggingResult(
            List<String> tags,
            List<String> keywords,
            String suggestedCategory,
            double confidence
    ) {}

    /**
     * 自动生成标签
     * 
     * @param content 文章内容
     * @param maxTags 最大标签数量
     * @return 标签列表
     */
    public List<String> generateTags(String content, int maxTags) {
        String systemPrompt = promptService.getPromptOrDefault("tagger", getDefaultTaggerPrompt());
        
        String userPrompt = String.format("""
                请为以下文章内容生成最多 %d 个相关标签。
                
                要求：
                1. 标签应该简洁明了，一般为2-4个字
                2. 标签应该能够准确概括文章主题
                3. 优先使用常见的技术术语
                4. 仅返回标签列表，用逗号分隔
                
                文章内容：
                ---
                %s
                ---
                
                标签：
                """, maxTags, truncateContent(content, 3000));
        
        String result = chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
        
        return parseTagsFromResponse(result);
    }

    /**
     * 生成标签（结构化输出）
     */
    public TaggingResult generateTagsStructured(String content) {
        String systemPrompt = """
                你是一个专业的内容分析助手。请分析文章内容，提取标签、关键词，并推荐分类。
                
                请以JSON格式返回结果，包含以下字段：
                - tags: 标签数组（最多5个）
                - keywords: 关键词数组（最多10个）
                - suggestedCategory: 推荐的分类名称
                - confidence: 置信度（0-1之间的小数）
                """;
        
        String userPrompt = String.format("""
                请分析以下文章：
                
                %s
                """, truncateContent(content, 3000));
        
        var outputConverter = new BeanOutputConverter<>(TaggingResult.class);
        
        String result = chatClient.prompt()
                .system(systemPrompt + "\n\n" + outputConverter.getFormat())
                .user(userPrompt)
                .call()
                .content();
        
        return outputConverter.convert(result);
    }

    /**
     * 提取关键词
     */
    public List<String> extractKeywords(String content, int maxKeywords) {
        String systemPrompt = """
                你是一个专业的SEO关键词分析师。
                请从文章中提取最重要的关键词，这些关键词将用于搜索引擎优化。
                """;
        
        String userPrompt = String.format("""
                请从以下文章中提取最多 %d 个SEO关键词。
                仅返回关键词列表，用逗号分隔。
                
                文章：
                %s
                """, maxKeywords, truncateContent(content, 3000));
        
        String result = chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
        
        return parseTagsFromResponse(result);
    }

    /**
     * 截断内容
     */
    private String truncateContent(String content, int maxLength) {
        if (content == null) return "";
        if (content.length() <= maxLength) return content;
        return content.substring(0, maxLength) + "...";
    }

    /**
     * 解析标签响应
     */
    private List<String> parseTagsFromResponse(String response) {
        if (response == null || response.isBlank()) {
            return List.of();
        }
        
        // 清理响应，提取标签
        String cleaned = response
                .replaceAll("[[]\"']", "")
                .replaceAll("\\s+", " ")
                .trim();
        
        return java.util.Arrays.stream(cleaned.split("[,，、;；]"))
                .map(String::trim)
                .filter(s -> !s.isEmpty() && s.length() <= 20)
                .distinct()
                .toList();
    }

    /**
     * 默认标签生成 Prompt
     */
    private String getDefaultTaggerPrompt() {
        return """
                你是一个专业的技术博客标签生成助手。
                你的任务是根据文章内容生成准确、相关的标签。
                
                标签生成原则：
                1. 优先使用广泛认可的技术术语
                2. 标签应该具有搜索价值
                3. 避免过于宽泛或过于具体的标签
                4. 中文内容使用中文标签，英文术语保持原样
                """;
    }
}
```

```java
// aetherblog-ai/ai-agent/src/main/java/com/aetherblog/ai/agent/SummaryAgent.java

package com.aetherblog.ai.agent;

import com.aetherblog.ai.prompt.service.PromptService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.stereotype.Component;
import reactor.core.publisher.Flux;

/**
 * 摘要生成 Agent
 * 
 * 功能：
 * - 生成文章摘要
 * - 生成 SEO 描述
 * - 生成社交分享文案
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class SummaryAgent {

    private final ChatClient chatClient;
    private final PromptService promptService;

    /**
     * 摘要生成结果
     */
    public record SummaryResult(
            String summary,
            String seoDescription,
            String socialShareText
    ) {}

    /**
     * 生成文章摘要（流式）
     * 
     * @param content 文章内容
     * @param maxLength 最大长度
     */
    public Flux<String> generateSummary(String content, int maxLength) {
        String systemPrompt = promptService.getPromptOrDefault("summarizer", getDefaultSummarizerPrompt());
        
        String userPrompt = String.format("""
                请为以下文章生成一段简洁的摘要，不超过 %d 个字符。
                
                要求：
                1. 概括文章的核心观点
                2. 使用第三人称
                3. 语言简洁明了
                4. 不要使用"本文"等开头
                
                文章内容：
                ---
                %s
                ---
                """, maxLength, truncateContent(content, 4000));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .stream()
                .content();
    }

    /**
     * 生成文章摘要（同步）
     */
    public String generateSummarySync(String content, int maxLength) {
        String systemPrompt = promptService.getPromptOrDefault("summarizer", getDefaultSummarizerPrompt());
        
        String userPrompt = String.format("""
                请为以下文章生成一段简洁的摘要，不超过 %d 个字符。
                直接返回摘要内容，不要有任何前缀。
                
                文章内容：
                ---
                %s
                ---
                """, maxLength, truncateContent(content, 4000));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
    }

    /**
     * 生成 SEO 描述
     */
    public String generateSeoDescription(String content, String title) {
        String systemPrompt = """
                你是一个专业的 SEO 专家。
                请根据文章内容生成一段优化的 meta description。
                
                要求：
                1. 长度在 120-160 个字符之间
                2. 包含文章的核心关键词
                3. 具有吸引力，能够提高点击率
                4. 自然流畅，不要堆砌关键词
                """;
        
        String userPrompt = String.format("""
                文章标题：%s
                
                文章内容：
                %s
                
                请生成 SEO meta description：
                """, title, truncateContent(content, 2000));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
    }

    /**
     * 生成社交分享文案
     */
    public String generateSocialShareText(String content, String title, String platform) {
        String systemPrompt = String.format("""
                你是一个社交媒体运营专家。
                请根据文章内容生成适合在 %s 平台分享的文案。
                
                要求：
                1. 简洁有力，吸引眼球
                2. 符合该平台的风格和用户习惯
                3. 适当使用 emoji 增加趣味性
                4. 包含引导用户阅读的 CTA
                """, platform);
        
        String userPrompt = String.format("""
                文章标题：%s
                
                文章摘要：
                %s
                
                请生成分享文案：
                """, title, truncateContent(content, 1000));
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
    }

    /**
     * 生成完整的摘要结果（包含多种格式）
     */
    public SummaryResult generateCompleteSummary(String content, String title) {
        String summary = generateSummarySync(content, 150);
        String seoDescription = generateSeoDescription(content, title);
        String socialShareText = generateSocialShareText(content, title, "微信");
        
        return new SummaryResult(summary, seoDescription, socialShareText);
    }

    /**
     * 截断内容
     */
    private String truncateContent(String content, int maxLength) {
        if (content == null) return "";
        if (content.length() <= maxLength) return content;
        return content.substring(0, maxLength) + "...";
    }

    /**
     * 默认摘要生成 Prompt
     */
    private String getDefaultSummarizerPrompt() {
        return """
                你是一个专业的技术文章摘要生成助手。
                你的任务是从文章中提取最核心的信息，生成简洁准确的摘要。
                
                摘要生成原则：
                1. 抓住文章的核心观点和主要结论
                2. 使用清晰简洁的语言
                3. 保持客观中立的语气
                4. 不要添加原文没有的信息
                """;
    }
}
```

```java
// aetherblog-ai/ai-rag/src/main/java/com/aetherblog/ai/rag/service/RagServiceImpl.java

package com.aetherblog.ai.rag.service;

import com.aetherblog.ai.rag.retriever.HybridRetriever;
import com.aetherblog.ai.rag.reranker.RrfReranker;
import com.aetherblog.ai.prompt.service.PromptService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.document.Document;
import org.springframework.ai.vectorstore.SearchRequest;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.stereotype.Service;
import reactor.core.publisher.Flux;

import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * RAG 检索增强生成服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class RagServiceImpl implements RagService {

    private final VectorStore vectorStore;
    private final ChatClient chatClient;
    private final HybridRetriever hybridRetriever;
    private final RrfReranker reranker;
    private final PromptService promptService;

    private static final int DEFAULT_TOP_K = 5;
    private static final double SIMILARITY_THRESHOLD = 0.7;

    /**
     * 语义搜索
     */
    @Override
    public List<SearchResult> semanticSearch(String query, int topK) {
        log.info("执行语义搜索: query={}, topK={}", query, topK);
        
        // 使用混合检索
        List<Document> vectorResults = vectorStore.similaritySearch(
                SearchRequest.query(query)
                        .withTopK(topK)
                        .withSimilarityThreshold(SIMILARITY_THRESHOLD)
        );
        
        // 转换为搜索结果
        return vectorResults.stream()
                .map(doc -> SearchResult.builder()
                        .postId(Long.parseLong(doc.getMetadata().get("postId").toString()))
                        .title(doc.getMetadata().get("title").toString())
                        .slug(doc.getMetadata().get("slug").toString())
                        .content(doc.getContent())
                        .score(doc.getMetadata().containsKey("score") 
                                ? (Double) doc.getMetadata().get("score") 
                                : 0.0)
                        .build())
                .toList();
    }

    /**
     * 混合搜索（向量 + 关键词）
     */
    @Override
    public List<SearchResult> hybridSearch(String query, int topK) {
        log.info("执行混合搜索: query={}, topK={}", query, topK);
        
        // 1. 向量检索
        List<Document> vectorResults = vectorStore.similaritySearch(
                SearchRequest.query(query)
                        .withTopK(topK * 2)
                        .withSimilarityThreshold(0.5)
        );
        
        // 2. 关键词检索
        List<Document> keywordResults = hybridRetriever.keywordSearch(query, topK * 2);
        
        // 3. RRF 重排序融合
        List<Document> rerankedResults = reranker.rerank(vectorResults, keywordResults, topK);
        
        // 4. 转换为搜索结果
        return rerankedResults.stream()
                .map(this::documentToSearchResult)
                .toList();
    }

    /**
     * 问答搜索（RAG）
     */
    @Override
    public QaResult questionAnswer(String question) {
        log.info("执行问答搜索: question={}", question);
        
        // 1. 检索相关文档
        List<Document> relevantDocs = vectorStore.similaritySearch(
                SearchRequest.query(question)
                        .withTopK(DEFAULT_TOP_K)
                        .withSimilarityThreshold(SIMILARITY_THRESHOLD)
        );
        
        if (relevantDocs.isEmpty()) {
            return QaResult.builder()
                    .answer("抱歉，没有找到与您问题相关的内容。")
                    .sources(List.of())
                    .confidence(0.0)
                    .build();
        }
        
        // 2. 构建上下文
        String context = relevantDocs.stream()
                .map(Document::getContent)
                .collect(Collectors.joining("\n\n---\n\n"));
        
        // 3. 生成回答
        String systemPrompt = promptService.getPromptOrDefault("qa-system", getDefaultQaPrompt());
        
        String userPrompt = String.format("""
                根据以下参考资料回答用户的问题。如果参考资料中没有相关信息，请诚实说明。
                
                参考资料：
                ---
                %s
                ---
                
                用户问题：%s
                """, context, question);
        
        String answer = chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .call()
                .content();
        
        // 4. 构建来源列表
        List<SourceReference> sources = relevantDocs.stream()
                .map(doc -> SourceReference.builder()
                        .postId(Long.parseLong(doc.getMetadata().get("postId").toString()))
                        .title(doc.getMetadata().get("title").toString())
                        .slug(doc.getMetadata().get("slug").toString())
                        .build())
                .distinct()
                .toList();
        
        return QaResult.builder()
                .answer(answer)
                .sources(sources)
                .confidence(calculateConfidence(relevantDocs))
                .build();
    }

    /**
     * 问答搜索（流式输出）
     */
    @Override
    public Flux<String> questionAnswerStream(String question) {
        log.info("执行流式问答搜索: question={}", question);
        
        // 1. 检索相关文档
        List<Document> relevantDocs = vectorStore.similaritySearch(
                SearchRequest.query(question)
                        .withTopK(DEFAULT_TOP_K)
                        .withSimilarityThreshold(SIMILARITY_THRESHOLD)
        );
        
        if (relevantDocs.isEmpty()) {
            return Flux.just("抱歉，没有找到与您问题相关的内容。");
        }
        
        // 2. 构建上下文
        String context = relevantDocs.stream()
                .map(Document::getContent)
                .collect(Collectors.joining("\n\n---\n\n"));
        
        // 3. 流式生成回答
        String systemPrompt = promptService.getPromptOrDefault("qa-system", getDefaultQaPrompt());
        
        String userPrompt = String.format("""
                根据以下参考资料回答用户的问题。
                
                参考资料：
                ---
                %s
                ---
                
                用户问题：%s
                """, context, question);
        
        return chatClient.prompt()
                .system(systemPrompt)
                .user(userPrompt)
                .stream()
                .content();
    }

    /**
     * 获取相关文章推荐
     */
    @Override
    public List<SearchResult> getRelatedPosts(Long postId, int topK) {
        // 获取文章的向量
        List<Document> postDocs = vectorStore.similaritySearch(
                SearchRequest.query("")
                        .withFilterExpression("postId == " + postId)
                        .withTopK(1)
        );
        
        if (postDocs.isEmpty()) {
            return List.of();
        }
        
        // 基于文章内容搜索相似文章
        String content = postDocs.get(0).getContent();
        return semanticSearch(content, topK + 1).stream()
                .filter(r -> !r.getPostId().equals(postId))
                .limit(topK)
                .toList();
    }

    /**
     * 索引文章
     */
    @Override
    public void indexPost(Long postId, String title, String slug, String content) {
        log.info("索引文章: postId={}, title={}", postId, title);
        
        // 分割文本
        List<String> chunks = splitContent(content, 500, 50);
        
        // 创建文档
        List<Document> documents = chunks.stream()
                .map(chunk -> new Document(chunk, Map.of(
                        "postId", postId,
                        "title", title,
                        "slug", slug
                )))
                .toList();
        
        // 删除旧的索引
        deletePostIndex(postId);
        
        // 添加新的索引
        vectorStore.add(documents);
        
        log.info("文章索引完成: postId={}, chunks={}", postId, chunks.size());
    }

    /**
     * 删除文章索引
     */
    @Override
    public void deletePostIndex(Long postId) {
        // 使用过滤条件删除
        vectorStore.delete(List.of("postId == " + postId));
    }

    // ==================== 私有方法 ====================

    private SearchResult documentToSearchResult(Document doc) {
        return SearchResult.builder()
                .postId(Long.parseLong(doc.getMetadata().get("postId").toString()))
                .title(doc.getMetadata().get("title").toString())
                .slug(doc.getMetadata().get("slug").toString())
                .content(doc.getContent())
                .score(doc.getMetadata().containsKey("score") 
                        ? (Double) doc.getMetadata().get("score") 
                        : 0.0)
                .build();
    }

    private double calculateConfidence(List<Document> docs) {
        if (docs.isEmpty()) return 0.0;
        
        return docs.stream()
                .mapToDouble(doc -> doc.getMetadata().containsKey("score") 
                        ? (Double) doc.getMetadata().get("score") 
                        : 0.5)
                .average()
                .orElse(0.0);
    }

    /**
     * 分割内容为多个块
     * 
     * @param content 原始内容
     * @param chunkSize 块大小
     * @param overlap 重叠大小
     */
    private List<String> splitContent(String content, int chunkSize, int overlap) {
        if (content == null || content.isEmpty()) {
            return List.of();
        }
        
        List<String> chunks = new java.util.ArrayList<>();
        
        // 首先按段落分割
        String[] paragraphs = content.split("\n\n+");
        
        StringBuilder currentChunk = new StringBuilder();
        
        for (String paragraph : paragraphs) {
            // 如果当前段落本身超过 chunkSize，进一步分割
            if (paragraph.length() > chunkSize) {
                // 先保存当前累积的内容
                if (!currentChunk.isEmpty()) {
                    chunks.add(currentChunk.toString().trim());
                    currentChunk = new StringBuilder();
                }
                
                // 按句子分割长段落
                String[] sentences = paragraph.split("(?<=[。！？.!?])");
                for (String sentence : sentences) {
                    if (currentChunk.length() + sentence.length() > chunkSize) {
                        if (!currentChunk.isEmpty()) {
                            chunks.add(currentChunk.toString().trim());
                            // 保留重叠部分
                            String overlapText = getOverlapText(currentChunk.toString(), overlap);
                            currentChunk = new StringBuilder(overlapText);
                        }
                    }
                    currentChunk.append(sentence);
                }
            } else {
                // 正常段落处理
                if (currentChunk.length() + paragraph.length() > chunkSize) {
                    chunks.add(currentChunk.toString().trim());
                    // 保留重叠部分
                    String overlapText = getOverlapText(currentChunk.toString(), overlap);
                    currentChunk = new StringBuilder(overlapText);
                }
                currentChunk.append(paragraph).append("\n\n");
            }
        }
        
        // 添加最后一个块
        if (!currentChunk.isEmpty()) {
            chunks.add(currentChunk.toString().trim());
        }
        
        return chunks;
    }

    /**
     * 获取重叠文本
     */
    private String getOverlapText(String text, int overlapSize) {
        if (text.length() <= overlapSize) {
            return text;
        }
        return text.substring(text.length() - overlapSize);
    }

    /**
     * 默认问答系统 Prompt
     */
    private String getDefaultQaPrompt() {
        return """
                你是一个专业的技术博客问答助手。你的任务是根据提供的参考资料，准确回答用户的问题。
                
                回答原则：
                1. 只根据参考资料中的内容回答，不要添加额外信息
                2. 如果参考资料中没有相关信息，请诚实告知用户
                3. 引用具体内容时，尽量使用原文
                4. 回答要简洁明了，重点突出
                5. 如果问题涉及代码，请使用代码块格式展示
                """;
    }
}
```

```java
// aetherblog-ai/ai-rag/src/main/java/com/aetherblog/ai/rag/reranker/RrfReranker.java

package com.aetherblog.ai.rag.reranker;

import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.document.Document;
import org.springframework.stereotype.Component;

import java.util.*;
import java.util.stream.Collectors;

/**
 * RRF (Reciprocal Rank Fusion) 重排序器
 * 
 * 用于融合多路检索结果
 */
@Slf4j
@Component
public class RrfReranker implements Reranker {

    private static final int DEFAULT_K = 60;

    @Override
    public List<Document> rerank(List<Document> vectorResults, List<Document> keywordResults, int topK) {
        return rerank(vectorResults, keywordResults, topK, DEFAULT_K);
    }

    /**
     * RRF 重排序
     * 
     * @param vectorResults 向量检索结果
     * @param keywordResults 关键词检索结果
     * @param topK 返回数量
     * @param k RRF 参数，通常设为 60
     */
    public List<Document> rerank(List<Document> vectorResults, List<Document> keywordResults, int topK, int k) {
        Map<String, RrfScore> scoreMap = new HashMap<>();
        
        // 处理向量检索结果
        for (int i = 0; i < vectorResults.size(); i++) {
            Document doc = vectorResults.get(i);
            String docId = getDocumentId(doc);
            double rrfScore = 1.0 / (k + i + 1);
            
            scoreMap.computeIfAbsent(docId, id -> new RrfScore(doc))
                    .addScore(rrfScore, "vector");
        }
        
        // 处理关键词检索结果
        for (int i = 0; i < keywordResults.size(); i++) {
            Document doc = keywordResults.get(i);
            String docId = getDocumentId(doc);
            double rrfScore = 1.0 / (k + i + 1);
            
            scoreMap.computeIfAbsent(docId, id -> new RrfScore(doc))
                    .addScore(rrfScore, "keyword");
        }
        
        // 排序并返回 topK 结果
        return scoreMap.values().stream()
                .sorted(Comparator.comparingDouble(RrfScore::getTotalScore).reversed())
                .limit(topK)
                .map(RrfScore::getDocument)
                .peek(doc -> log.debug("RRF reranked: {} -> {}", 
                        getDocumentId(doc), 
                        scoreMap.get(getDocumentId(doc)).getTotalScore()))
                .toList();
    }

    /**
     * 获取文档唯一标识
     */
    private String getDocumentId(Document doc) {
        // 优先使用 postId，否则使用内容哈希
        if (doc.getMetadata().containsKey("postId")) {
            return "post_" + doc.getMetadata().get("postId");
        }
        return String.valueOf(doc.getContent().hashCode());
    }

    /**
     * RRF 分数包装类
     */
    private static class RrfScore {
        private final Document document;
        private double vectorScore = 0.0;
        private double keywordScore = 0.0;

        public RrfScore(Document document) {
            this.document = document;
        }

        public void addScore(double score, String source) {
            if ("vector".equals(source)) {
                this.vectorScore += score;
            } else if ("keyword".equals(source)) {
                this.keywordScore += score;
            }
        }

        public double getTotalScore() {
            return vectorScore + keywordScore;
        }

        public Document getDocument() {
            // 将分数添加到文档元数据
            Map<String, Object> metadata = new HashMap<>(document.getMetadata());
            metadata.put("score", getTotalScore());
            metadata.put("vectorScore", vectorScore);
            metadata.put("keywordScore", keywordScore);
            return new Document(document.getContent(), metadata);
        }
    }
}
```

#### 2.4.2.6 存储策略实现

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/StorageService.java

package com.aetherblog.media.storage;

import java.io.InputStream;

/**
 * 存储服务接口
 */
public interface StorageService {

    /**
     * 上传文件
     * 
     * @param inputStream 文件输入流
     * @param filename 文件名
     * @param contentType 内容类型
     * @return 文件访问路径
     */
    String upload(InputStream inputStream, String filename, String contentType);

    /**
     * 上传文件到指定路径
     */
    String upload(InputStream inputStream, String path, String filename, String contentType);

    /**
     * 删除文件
     */
    void delete(String path);

    /**
     * 获取文件访问 URL
     */
    String getUrl(String path);

    /**
     * 获取带签名的临时访问 URL
     */
    String getSignedUrl(String path, long expireSeconds);

    /**
     * 判断文件是否存在
     */
    boolean exists(String path);

    /**
     * 获取存储类型
     */
    StorageType getType();
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/LocalStorageService.java

package com.aetherblog.media.storage;

import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.FileUtils;
import com.aetherblog.media.config.StorageProperties;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;

import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.UUID;

/**
 * 本地存储服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
@ConditionalOnProperty(name = "storage.type", havingValue = "local", matchIfMissing = true)
public class LocalStorageService implements StorageService {

    private final StorageProperties properties;

    @Override
    public String upload(InputStream inputStream, String filename, String contentType) {
        // 生成日期目录
        String datePath = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd"));
        return upload(inputStream, datePath, filename, contentType);
    }

    @Override
    public String upload(InputStream inputStream, String path, String filename, String contentType) {
        try {
            // 生成唯一文件名
            String extension = FileUtils.getExtension(filename);
            String newFilename = UUID.randomUUID().toString().replace("-", "") + "." + extension;
            
            // 构建完整路径
            Path uploadPath = Paths.get(properties.getLocal().getUploadPath(), path);
            Files.createDirectories(uploadPath);
            
            Path filePath = uploadPath.resolve(newFilename);
            
            // 复制文件
            Files.copy(inputStream, filePath, StandardCopyOption.REPLACE_EXISTING);
            
            log.info("文件上传成功: {}", filePath);
            
            // 返回相对路径
            return path + "/" + newFilename;
            
        } catch (IOException e) {
            log.error("文件上传失败", e);
            throw new BusinessException("文件上传失败: " + e.getMessage());
        }
    }

    @Override
    public void delete(String path) {
        try {
            Path filePath = Paths.get(properties.getLocal().getUploadPath(), path);
            Files.deleteIfExists(filePath);
            log.info("文件删除成功: {}", path);
        } catch (IOException e) {
            log.error("文件删除失败: {}", path, e);
        }
    }

    @Override
    public String getUrl(String path) {
        if (!StringUtils.hasText(path)) {
            return null;
        }
        // 返回访问 URL
        String baseUrl = properties.getLocal().getAccessUrl();
        return baseUrl.endsWith("/") ? baseUrl + path : baseUrl + "/" + path;
    }

    @Override
    public String getSignedUrl(String path, long expireSeconds) {
        // 本地存储暂不支持签名 URL，直接返回普通 URL
        return getUrl(path);
    }

    @Override
    public boolean exists(String path) {
        Path filePath = Paths.get(properties.getLocal().getUploadPath(), path);
        return Files.exists(filePath);
    }

    @Override
    public StorageType getType() {
        return StorageType.LOCAL;
    }
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/TencentCosStorageService.java

package com.aetherblog.media.storage;

import com.aetherblog.common.core.exception.BusinessException;
import com.aetherblog.common.core.utils.FileUtils;
import com.aetherblog.media.config.StorageProperties;
import com.qcloud.cos.COSClient;
import com.qcloud.cos.ClientConfig;
import com.qcloud.cos.auth.BasicCOSCredentials;
import com.qcloud.cos.auth.COSCredentials;
import com.qcloud.cos.http.HttpProtocol;
import com.qcloud.cos.model.ObjectMetadata;
import com.qcloud.cos.model.PutObjectRequest;
import com.qcloud.cos.region.Region;
import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.stereotype.Service;

import java.io.InputStream;
import java.net.URL;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import java.util.UUID;

/**
 * 腾讯云 COS 存储服务实现
 */
@Slf4j
@Service
@RequiredArgsConstructor
@ConditionalOnProperty(name = "storage.type", havingValue = "tencent-cos")
public class TencentCosStorageService implements StorageService {

    private final StorageProperties properties;
    private COSClient cosClient;

    @PostConstruct
    public void init() {
        StorageProperties.TencentCos cos = properties.getTencentCos();
        
        COSCredentials credentials = new BasicCOSCredentials(cos.getSecretId(), cos.getSecretKey());
        
        ClientConfig clientConfig = new ClientConfig(new Region(cos.getRegion()));
        clientConfig.setHttpProtocol(HttpProtocol.https);
        
        this.cosClient = new COSClient(credentials, clientConfig);
        
        log.info("腾讯云 COS 客户端初始化成功, region={}, bucket={}", cos.getRegion(), cos.getBucket());
    }

    @PreDestroy
    public void destroy() {
        if (cosClient != null) {
            cosClient.shutdown();
        }
    }

    @Override
    public String upload(InputStream inputStream, String filename, String contentType) {
        String datePath = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd"));
        return upload(inputStream, datePath, filename, contentType);
    }

    @Override
    public String upload(InputStream inputStream, String path, String filename, String contentType) {
        try {
            String extension = FileUtils.getExtension(filename);
            String newFilename = UUID.randomUUID().toString().replace("-", "") + "." + extension;
            String key = path + "/" + newFilename;
            
            ObjectMetadata metadata = new ObjectMetadata();
            metadata.setContentType(contentType);
            
            PutObjectRequest putRequest = new PutObjectRequest(
                    properties.getTencentCos().getBucket(),
                    key,
                    inputStream,
                    metadata
            );
            
            cosClient.putObject(putRequest);
            
            log.info("文件上传到 COS 成功: {}", key);
            
            return key;
            
        } catch (Exception e) {
            log.error("文件上传到 COS 失败", e);
            throw new BusinessException("文件上传失败: " + e.getMessage());
        }
    }

    @Override
    public void delete(String path) {
        try {
            cosClient.deleteObject(properties.getTencentCos().getBucket(), path);
            log.info("COS 文件删除成功: {}", path);
        } catch (Exception e) {
            log.error("COS 文件删除失败: {}", path, e);
        }
    }

    @Override
    public String getUrl(String path) {
        if (path == null || path.isEmpty()) {
            return null;
        }
        
        StorageProperties.TencentCos cos = properties.getTencentCos();
        
        // 如果配置了自定义域名
        if (cos.getCustomDomain() != null && !cos.getCustomDomain().isEmpty()) {
            String domain = cos.getCustomDomain();
            return domain.endsWith("/") ? domain + path : domain + "/" + path;
        }
        
        // 使用默认域名
        return String.format("https://%s.cos.%s.myqcloud.com/%s",
                cos.getBucket(), cos.getRegion(), path);
    }

    @Override
    public String getSignedUrl(String path, long expireSeconds) {
        Date expiration = new Date(System.currentTimeMillis() + expireSeconds * 1000);
        
        URL url = cosClient.generatePresignedUrl(
                properties.getTencentCos().getBucket(),
                path,
                expiration
        );
        
        return url.toString();
    }

    @Override
    public boolean exists(String path) {
        return cosClient.doesObjectExist(properties.getTencentCos().getBucket(), path);
    }

    @Override
    public StorageType getType() {
        return StorageType.TENCENT_COS;
    }
}
```

```java
// aetherblog-service/media-service/src/main/java/com/aetherblog/media/storage/StorageServiceFactory.java

package com.aetherblog.media.storage;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * 存储服务工厂
 * 
 * 用于动态获取不同类型的存储服务
 */
@Component
@RequiredArgsConstructor
public class StorageServiceFactory {

    private final List<StorageService> storageServices;
    private Map<StorageType, StorageService> serviceMap;

    /**
     * 获取存储服务
     */
    public StorageService getService(StorageType type) {
        if (serviceMap == null) {
            serviceMap = storageServices.stream()
                    .collect(Collectors.toMap(
                            StorageService::getType,
                            Function.identity()
                    ));
        }
        
        StorageService service = serviceMap.get(type);
        if (service == null) {
            throw new IllegalArgumentException("不支持的存储类型: " + type);
        }
        return service;
    }

    /**
     * 获取默认存储服务（第一个可用的）
     */
    public StorageService getDefaultService() {
        if (storageServices.isEmpty()) {
            throw new IllegalStateException("没有可用的存储服务");
        }
        return storageServices.get(0);
    }
}
```

---

## 2.5 数据库详细设计

### 2.5.1 数据模型概述

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        数据库 ER 图                                                       │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐                           │
│   │     users       │         │    categories   │         │      tags       │                           │
│   ├─────────────────┤         ├─────────────────┤         ├─────────────────┤                           │
│   │ id (PK)         │         │ id (PK)         │         │ id (PK)         │                           │
│   │ username        │         │ name            │         │ name            │                           │
│   │ email           │         │ slug            │         │ slug            │                           │
│   │ password_hash   │         │ description     │         │ description     │                           │
│   │ nickname        │         │ cover_image     │         │ color           │                           │
│   │ avatar          │         │ parent_id (FK)  │         │ post_count      │                           │
│   │ bio             │         │ sort_order      │         │ created_at      │                           │
│   │ role            │         │ post_count      │         │ updated_at      │                           │
│   │ ...             │         │ created_at      │         └────────┬────────┘                           │
│   └────────┬────────┘         │ updated_at      │                  │                                    │
│            │                  └────────┬────────┘                  │                                    │
│            │                           │                           │                                    │
│            │ 1                         │ 1                         │ M                                  │
│            │                           │                           │                                    │
│            ▼ M                         ▼ M                         ▼                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────┐                       │
│   │                                    posts                                     │                       │
│   ├─────────────────────────────────────────────────────────────────────────────┤                       │
│   │ id (PK)              │ slug              │ status            │ deleted      │                       │
│   │ title                │ content_markdown  │ published_at      │ created_at   │                       │
│   │ author_id (FK)       │ content_html      │ scheduled_at      │ updated_at   │                       │
│   │ category_id (FK)     │ summary           │ word_count        │              │                       │
│   │ cover_image          │ seo_title         │ reading_time      │              │                       │
│   │ is_pinned            │ seo_description   │ view_count        │              │                       │
│   │ allow_comment        │ seo_keywords      │ like_count        │              │                       │
│   │ embedding_status     │                   │ comment_count     │              │                       │
│   └─────────────────────────────────────────────────────────────────────────────┘                       │
│            │                                              │                                              │
│            │ 1                                            │ 1                                            │
│            │                                              │                                              │
│            ▼ M                                            ▼ M                                            │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│   │   post_tags     │    │    comments     │    │ post_embeddings │    │   attachments   │              │
│   ├─────────────────┤    ├─────────────────┤    ├─────────────────┤    ├─────────────────┤              │
│   │ post_id (FK)    │    │ id (PK)         │    │ id (PK)         │    │ id (PK)         │              │
│   │ tag_id (FK)     │    │ post_id (FK)    │    │ post_id (FK)    │    │ post_id (FK)    │              │
│   │                 │    │ parent_id (FK)  │    │ content_segment │    │ filename        │              │
│   │                 │    │ author_name     │    │ embedding       │    │ original_name   │              │
│   │                 │    │ author_email    │    │ created_at      │    │ storage_type    │              │
│   │                 │    │ content         │    │                 │    │ storage_path    │              │
│   │                 │    │ status          │    │                 │    │ file_size       │              │
│   │                 │    │ ...             │    │                 │    │ mime_type       │              │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘    │ download_count  │              │
│                                                                         │ encryption_key  │              │
│                                                                         │ created_at      │              │
│                                                                         └─────────────────┘              │
│                                                                                                          │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│   │  friend_links   │    │  site_settings  │    │  prompt_templates│   │  operation_logs │              │
│   ├─────────────────┤    ├─────────────────┤    ├─────────────────┤    ├─────────────────┤              │
│   │ id (PK)         │    │ id (PK)         │    │ id (PK)         │    │ id (PK)         │              │
│   │ name            │    │ key             │    │ name            │    │ user_id (FK)    │              │
│   │ url             │    │ value           │    │ description     │    │ module          │              │
│   │ avatar          │    │ type            │    │ content         │    │ action          │              │
│   │ description     │    │ description     │    │ category        │    │ method          │              │
│   │ email           │    │ created_at      │    │ is_system       │    │ request_url     │              │
│   │ rss_url         │    │ updated_at      │    │ created_at      │    │ request_params  │              │
│   │ theme_color     │    │                 │    │ updated_at      │    │ response_data   │              │
│   │ sort_order      │    │                 │    │                 │    │ ip_address      │              │
│   │ status          │    │                 │    │                 │    │ user_agent      │              │
│   │ created_at      │    │                 │    │                 │    │ execution_time  │              │
│   │ updated_at      │    │                 │    │                 │    │ status          │              │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘    │ error_message   │              │
│                                                                         │ created_at      │              │
│   ┌─────────────────┐    ┌─────────────────┐                           └─────────────────┘              │
│   │  visit_records  │    │  visit_stats    │                                                            │
│   ├─────────────────┤    ├─────────────────┤                                                            │
│   │ id (PK)         │    │ id (PK)         │                                                            │
│   │ post_id (FK)    │    │ date            │                                                            │
│   │ visitor_hash    │    │ pv              │                                                            │
│   │ ip_address      │    │ uv              │                                                            │
│   │ user_agent      │    │ new_visitors    │                                                            │
│   │ referer         │    │ post_views      │                                                            │
│   │ country         │    │ avg_duration    │                                                            │
│   │ city            │    │                 │                                                            │
│   │ device_type     │    │                 │                                                            │
│   │ browser         │    │                 │                                                            │
│   │ os              │    │                 │                                                            │
│   │ duration        │    │                 │                                                            │
│   │ created_at      │    │                 │                                                            │
│   └─────────────────┘    └─────────────────┘                                                            │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.5.2 核心表结构设计

```sql
-- ============================================================
-- AetherBlog 数据库表结构设计
-- 数据库: PostgreSQL 17
-- ============================================================

-- 启用扩展
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
CREATE EXTENSION IF NOT EXISTS "vector";  -- pgvector 向量扩展

-- ============================================================
-- 1. 用户表
-- ============================================================
CREATE TABLE users (
    id                  BIGSERIAL PRIMARY KEY,
    username            VARCHAR(50) NOT NULL UNIQUE,
    email               VARCHAR(100) NOT NULL UNIQUE,
    password_hash       VARCHAR(255) NOT NULL,
    nickname            VARCHAR(50),
    avatar              VARCHAR(500),
    bio                 TEXT,
    role                VARCHAR(20) NOT NULL DEFAULT 'USER',
    status              VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    last_login_at       TIMESTAMP,
    last_login_ip       VARCHAR(50),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_users_role CHECK (role IN ('ADMIN', 'AUTHOR', 'USER')),
    CONSTRAINT chk_users_status CHECK (status IN ('ACTIVE', 'INACTIVE', 'BANNED'))
);

-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);

-- 用户表注释
COMMENT ON TABLE users IS '用户表';
COMMENT ON COLUMN users.id IS '用户ID';
COMMENT ON COLUMN users.username IS '用户名';
COMMENT ON COLUMN users.email IS '邮箱';
COMMENT ON COLUMN users.password_hash IS '密码哈希';
COMMENT ON COLUMN users.nickname IS '昵称';
COMMENT ON COLUMN users.avatar IS '头像URL';
COMMENT ON COLUMN users.bio IS '个人简介';
COMMENT ON COLUMN users.role IS '角色: ADMIN-管理员, AUTHOR-作者, USER-普通用户';
COMMENT ON COLUMN users.status IS '状态: ACTIVE-正常, INACTIVE-未激活, BANNED-封禁';

-- ============================================================
-- 2. 分类表
-- ============================================================
CREATE TABLE categories (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(50) NOT NULL,
    slug                VARCHAR(100) NOT NULL UNIQUE,
    description         TEXT,
    cover_image         VARCHAR(500),
    parent_id           BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    sort_order          INT NOT NULL DEFAULT 0,
    post_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 分类表索引
CREATE INDEX idx_categories_slug ON categories(slug);
CREATE INDEX idx_categories_parent_id ON categories(parent_id);
CREATE INDEX idx_categories_sort_order ON categories(sort_order);

-- 分类表注释
COMMENT ON TABLE categories IS '文章分类表';
COMMENT ON COLUMN categories.slug IS 'URL友好的唯一标识';
COMMENT ON COLUMN categories.parent_id IS '父分类ID，支持多级分类';
COMMENT ON COLUMN categories.sort_order IS '排序序号，越小越靠前';
COMMENT ON COLUMN categories.post_count IS '文章数量（冗余字段，定期更新）';

-- ============================================================
-- 3. 标签表
-- ============================================================
CREATE TABLE tags (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(50) NOT NULL,
    slug                VARCHAR(100) NOT NULL UNIQUE,
    description         TEXT,
    color               VARCHAR(20) DEFAULT '#6366f1',
    post_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 标签表索引
CREATE INDEX idx_tags_slug ON tags(slug);
CREATE INDEX idx_tags_post_count ON tags(post_count DESC);

-- 标签表注释
COMMENT ON TABLE tags IS '文章标签表';
COMMENT ON COLUMN tags.color IS '标签颜色（十六进制）';
COMMENT ON COLUMN tags.post_count IS '文章数量';

-- ============================================================
-- 4. 文章表（核心表）
-- ============================================================
CREATE TABLE posts (
    id                  BIGSERIAL PRIMARY KEY,
    title               VARCHAR(200) NOT NULL,
    slug                VARCHAR(200) NOT NULL UNIQUE,
    content_markdown    TEXT,
    content_html        TEXT,
    summary             VARCHAR(500),
    cover_image         VARCHAR(500),
    author_id           BIGINT NOT NULL REFERENCES users(id),
    category_id         BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    status              VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    is_pinned           BOOLEAN NOT NULL DEFAULT FALSE,
    allow_comment       BOOLEAN NOT NULL DEFAULT TRUE,
    published_at        TIMESTAMP,
    scheduled_at        TIMESTAMP,
    word_count          INT NOT NULL DEFAULT 0,
    reading_time        INT NOT NULL DEFAULT 1,
    view_count          BIGINT NOT NULL DEFAULT 0,
    like_count          BIGINT NOT NULL DEFAULT 0,
    comment_count       INT NOT NULL DEFAULT 0,
    seo_title           VARCHAR(200),
    seo_description     VARCHAR(300),
    seo_keywords        VARCHAR(200),
    embedding_status    VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    deleted             BOOLEAN NOT NULL DEFAULT FALSE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_posts_status CHECK (status IN ('DRAFT', 'PUBLISHED', 'SCHEDULED', 'ARCHIVED')),
    CONSTRAINT chk_posts_embedding_status CHECK (embedding_status IN ('PENDING', 'INDEXED', 'FAILED'))
);

-- 文章表索引
CREATE INDEX idx_posts_slug ON posts(slug);
CREATE INDEX idx_posts_author_id ON posts(author_id);
CREATE INDEX idx_posts_category_id ON posts(category_id);
CREATE INDEX idx_posts_status ON posts(status);
CREATE INDEX idx_posts_published_at ON posts(published_at DESC);
CREATE INDEX idx_posts_scheduled_at ON posts(scheduled_at) WHERE scheduled_at IS NOT NULL;
CREATE INDEX idx_posts_is_pinned ON posts(is_pinned DESC, published_at DESC);
CREATE INDEX idx_posts_view_count ON posts(view_count DESC);
CREATE INDEX idx_posts_deleted ON posts(deleted);
-- 复合索引：已发布文章按时间排序
CREATE INDEX idx_posts_published ON posts(status, published_at DESC) WHERE deleted = FALSE;
-- 全文搜索索引
CREATE INDEX idx_posts_fulltext ON posts USING gin(to_tsvector('simple', title || ' ' || COALESCE(summary, '') || ' ' || COALESCE(content_markdown, '')));

-- 文章表注释
COMMENT ON TABLE posts IS '博客文章表';
COMMENT ON COLUMN posts.slug IS 'URL友好的唯一标识';
COMMENT ON COLUMN posts.content_markdown IS 'Markdown原始内容';
COMMENT ON COLUMN posts.content_html IS '渲染后的HTML内容';
COMMENT ON COLUMN posts.status IS '状态: DRAFT-草稿, PUBLISHED-已发布, SCHEDULED-定时发布, ARCHIVED-已归档';
COMMENT ON COLUMN posts.is_pinned IS '是否置顶';
COMMENT ON COLUMN posts.word_count IS '字数统计';
COMMENT ON COLUMN posts.reading_time IS '预估阅读时间（分钟）';
COMMENT ON COLUMN posts.embedding_status IS '向量化状态: PENDING-待处理, INDEXED-已索引, FAILED-失败';
COMMENT ON COLUMN posts.deleted IS '软删除标记';

-- ============================================================
-- 5. 文章标签关联表
-- ============================================================
CREATE TABLE post_tags (
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    tag_id              BIGINT NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (post_id, tag_id)
);

-- 关联表索引
CREATE INDEX idx_post_tags_tag_id ON post_tags(tag_id);

-- ============================================================
-- 6. 评论表
-- ============================================================
CREATE TABLE comments (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    parent_id           BIGINT REFERENCES comments(id) ON DELETE CASCADE,
    author_name         VARCHAR(50) NOT NULL,
    author_email        VARCHAR(100) NOT NULL,
    author_url          VARCHAR(200),
    author_avatar       VARCHAR(500),
    content             TEXT NOT NULL,
    status              VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    like_count          INT NOT NULL DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_comments_status CHECK (status IN ('PENDING', 'APPROVED', 'SPAM', 'TRASH'))
);

-- 评论表索引
CREATE INDEX idx_comments_post_id ON comments(post_id);
CREATE INDEX idx_comments_parent_id ON comments(parent_id);
CREATE INDEX idx_comments_status ON comments(status);
CREATE INDEX idx_comments_created_at ON comments(created_at DESC);

-- 评论表注释
COMMENT ON TABLE comments IS '文章评论表';
COMMENT ON COLUMN comments.parent_id IS '父评论ID，支持嵌套评论';
COMMENT ON COLUMN comments.status IS '状态: PENDING-待审核, APPROVED-已通过, SPAM-垃圾评论, TRASH-已删除';

-- ============================================================
-- 7. 向量嵌入表（用于RAG检索）
-- ============================================================
CREATE TABLE post_embeddings (
    id                  UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    post_id             BIGINT NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    content_segment     TEXT NOT NULL,
    segment_index       INT NOT NULL DEFAULT 0,
    embedding           vector(1536) NOT NULL,  -- OpenAI text-embedding-3-small 维度
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 向量索引（HNSW算法，余弦相似度）
CREATE INDEX idx_post_embeddings_vector ON post_embeddings 
    USING hnsw (embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);

-- 普通索引
CREATE INDEX idx_post_embeddings_post_id ON post_embeddings(post_id);

-- 向量表注释
COMMENT ON TABLE post_embeddings IS '文章向量嵌入表，用于语义搜索';
COMMENT ON COLUMN post_embeddings.content_segment IS '文章内容片段';
COMMENT ON COLUMN post_embeddings.segment_index IS '片段在原文中的顺序';
COMMENT ON COLUMN post_embeddings.embedding IS '1536维向量嵌入';

-- ============================================================
-- 8. 附件表
-- ============================================================
CREATE TABLE attachments (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT REFERENCES posts(id) ON DELETE SET NULL,
    filename            VARCHAR(255) NOT NULL,
    original_name       VARCHAR(255) NOT NULL,
    storage_type        VARCHAR(20) NOT NULL DEFAULT 'LOCAL',
    storage_path        VARCHAR(500) NOT NULL,
    file_size           BIGINT NOT NULL,
    mime_type           VARCHAR(100) NOT NULL,
    download_count      INT NOT NULL DEFAULT 0,
    encryption_key      VARCHAR(100),
    uploader_id         BIGINT REFERENCES users(id),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_attachments_storage_type CHECK (storage_type IN ('LOCAL', 'TENCENT_COS', 'ALIYUN_OSS', 'AWS_S3'))
);

-- 附件表索引
CREATE INDEX idx_attachments_post_id ON attachments(post_id);
CREATE INDEX idx_attachments_storage_type ON attachments(storage_type);
CREATE INDEX idx_attachments_uploader_id ON attachments(uploader_id);

-- 附件表注释
COMMENT ON TABLE attachments IS '附件文件表';
COMMENT ON COLUMN attachments.storage_type IS '存储类型: LOCAL-本地, TENCENT_COS-腾讯云, ALIYUN_OSS-阿里云, AWS_S3-亚马逊';
COMMENT ON COLUMN attachments.encryption_key IS '下载链接加密密钥';

-- ============================================================
-- 9. 友链表
-- ============================================================
CREATE TABLE friend_links (
    id                  BIGSERIAL PRIMARY KEY,
    name                VARCHAR(100) NOT NULL,
    url                 VARCHAR(500) NOT NULL,
    avatar              VARCHAR(500),
    description         VARCHAR(500),
    email               VARCHAR(100),
    rss_url             VARCHAR(500),
    theme_color         VARCHAR(20) DEFAULT '#6366f1',
    sort_order          INT NOT NULL DEFAULT 0,
    status              VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    is_online           BOOLEAN DEFAULT TRUE,
    last_check_at       TIMESTAMP,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_friend_links_status CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED', 'HIDDEN'))
);

-- 友链表索引
CREATE INDEX idx_friend_links_status ON friend_links(status);
CREATE INDEX idx_friend_links_sort_order ON friend_links(sort_order);

-- 友链表注释
COMMENT ON TABLE friend_links IS '友情链接表';
COMMENT ON COLUMN friend_links.theme_color IS '主题颜色';
COMMENT ON COLUMN friend_links.is_online IS '是否在线（定期检测）';
COMMENT ON COLUMN friend_links.status IS '状态: PENDING-待审核, APPROVED-已通过, REJECTED-已拒绝, HIDDEN-已隐藏';

-- ============================================================
-- 10. 站点设置表
-- ============================================================
CREATE TABLE site_settings (
    id                  BIGSERIAL PRIMARY KEY,
    key                 VARCHAR(100) NOT NULL UNIQUE,
    value               TEXT,
    type                VARCHAR(20) NOT NULL DEFAULT 'STRING',
    group_name          VARCHAR(50) NOT NULL DEFAULT 'general',
    description         VARCHAR(500),
    is_public           BOOLEAN NOT NULL DEFAULT FALSE,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_site_settings_type CHECK (type IN ('STRING', 'NUMBER', 'BOOLEAN', 'JSON', 'TEXT'))
);

-- 设置表索引
CREATE INDEX idx_site_settings_group ON site_settings(group_name);
CREATE INDEX idx_site_settings_public ON site_settings(is_public);

-- 初始化站点设置
INSERT INTO site_settings (key, value, type, group_name, description, is_public) VALUES
    ('site_name', 'AetherBlog', 'STRING', 'general', '站点名称', TRUE),
    ('site_description', '一个优雅的技术博客', 'STRING', 'general', '站点描述', TRUE),
    ('site_keywords', '技术博客,编程,开发', 'STRING', 'general', '站点关键词', TRUE),
    ('site_logo', '', 'STRING', 'general', '站点Logo', TRUE),
    ('site_favicon', '', 'STRING', 'general', '站点Favicon', TRUE),
    ('author_name', '', 'STRING', 'author', '博主名称', TRUE),
    ('author_avatar', '', 'STRING', 'author', '博主头像', TRUE),
    ('author_bio', '', 'TEXT', 'author', '博主简介', TRUE),
    ('author_github', '', 'STRING', 'author', 'GitHub地址', TRUE),
    ('author_twitter', '', 'STRING', 'author', 'Twitter地址', TRUE),
    ('author_email', '', 'STRING', 'author', '联系邮箱', TRUE),
    ('footer_text', '', 'TEXT', 'general', '页脚文字', TRUE),
    ('footer_signature', '', 'STRING', 'general', '个性签名', TRUE),
    ('icp_number', '', 'STRING', 'general', 'ICP备案号', TRUE),
    ('welcome_enabled', 'true', 'BOOLEAN', 'general', '是否启用欢迎页', TRUE),
    ('welcome_title', '欢迎来到我的博客', 'STRING', 'general', '欢迎页标题', TRUE),
    ('welcome_subtitle', '记录技术，分享生活', 'STRING', 'general', '欢迎页副标题', TRUE),
    ('comment_enabled', 'true', 'BOOLEAN', 'comment', '是否启用评论', FALSE),
    ('comment_audit', 'true', 'BOOLEAN', 'comment', '评论是否需要审核', FALSE),
    ('storage_type', 'LOCAL', 'STRING', 'storage', '存储类型', FALSE),
    ('ai_enabled', 'true', 'BOOLEAN', 'ai', '是否启用AI功能', FALSE),
    ('ai_provider', 'openai', 'STRING', 'ai', 'AI服务提供商', FALSE);

-- ============================================================
-- 11. Prompt模板表
-- ============================================================
CREATE TABLE prompt_templates (
    id                  UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name                VARCHAR(100) NOT NULL,
    description         VARCHAR(500),
    content             TEXT NOT NULL,
    category            VARCHAR(50) NOT NULL DEFAULT 'general',
    is_system           BOOLEAN NOT NULL DEFAULT FALSE,
    is_active           BOOLEAN NOT NULL DEFAULT TRUE,
    usage_count         INT NOT NULL DEFAULT 0,
    created_by          BIGINT REFERENCES users(id),
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Prompt模板索引
CREATE INDEX idx_prompt_templates_category ON prompt_templates(category);
CREATE INDEX idx_prompt_templates_is_active ON prompt_templates(is_active);

-- 初始化系统Prompt
INSERT INTO prompt_templates (name, description, content, category, is_system) VALUES
    ('text-cleaner', '文本清洗', '你是一个专业的文本编辑助手。请清理用户提供的文本：
1. 去除多余的空行和空格
2. 统一中英文标点符号
3. 修复明显的断句问题
4. 保持代码块格式不变
5. 直接返回清理后的文本，不要有任何解释', 'writing', TRUE),
    
    ('summarizer', '摘要生成', '你是一个专业的技术文章摘要生成助手。
请根据文章内容生成简洁的摘要，要求：
1. 概括文章的核心观点
2. 使用第三人称
3. 语言简洁明了
4. 不要使用"本文"等开头
5. 控制在150字以内', 'writing', TRUE),
    
    ('tagger', '标签生成', '你是一个专业的技术博客标签生成助手。
根据文章内容生成准确、相关的标签：
1. 优先使用广泛认可的技术术语
2. 标签应该具有搜索价值
3. 避免过于宽泛或过于具体的标签
4. 最多生成5个标签
5. 用逗号分隔，直接返回标签列表', 'tagging', TRUE),
    
    ('qa-system', '问答系统', '你是一个专业的技术博客问答助手。
根据提供的参考资料回答用户问题：
1. 只根据参考资料中的内容回答
2. 如果没有相关信息，诚实告知用户
3. 引用具体内容时使用原文
4. 回答简洁明了，重点突出
5. 代码使用代码块格式展示', 'qa', TRUE);

-- ============================================================
-- 12. 操作日志表
-- ============================================================
CREATE TABLE operation_logs (
    id                  BIGSERIAL PRIMARY KEY,
    user_id             BIGINT REFERENCES users(id) ON DELETE SET NULL,
    username            VARCHAR(50),
    module              VARCHAR(50) NOT NULL,
    action              VARCHAR(50) NOT NULL,
    method              VARCHAR(10),
    request_url         VARCHAR(500),
    request_params      TEXT,
    response_data       TEXT,
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    execution_time      INT,
    status              VARCHAR(20) NOT NULL DEFAULT 'SUCCESS',
    error_message       TEXT,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_operation_logs_status CHECK (status IN ('SUCCESS', 'FAILED'))
);

-- 操作日志索引
CREATE INDEX idx_operation_logs_user_id ON operation_logs(user_id);
CREATE INDEX idx_operation_logs_module ON operation_logs(module);
CREATE INDEX idx_operation_logs_action ON operation_logs(action);
CREATE INDEX idx_operation_logs_created_at ON operation_logs(created_at DESC);
CREATE INDEX idx_operation_logs_status ON operation_logs(status);

-- 操作日志表分区（按月分区，提高查询性能）
-- 注：实际使用时可根据需要创建分区表

-- ============================================================
-- 13. 访问记录表
-- ============================================================
CREATE TABLE visit_records (
    id                  BIGSERIAL PRIMARY KEY,
    post_id             BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    visitor_hash        VARCHAR(64) NOT NULL,
    ip_address          VARCHAR(50),
    user_agent          VARCHAR(500),
    referer             VARCHAR(500),
    country             VARCHAR(50),
    city                VARCHAR(100),
    device_type         VARCHAR(20),
    browser             VARCHAR(50),
    os                  VARCHAR(50),
    duration            INT DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 访问记录索引
CREATE INDEX idx_visit_records_post_id ON visit_records(post_id);
CREATE INDEX idx_visit_records_visitor_hash ON visit_records(visitor_hash);
CREATE INDEX idx_visit_records_created_at ON visit_records(created_at DESC);
CREATE INDEX idx_visit_records_date ON visit_records(DATE(created_at));

-- 访问记录表分区（可选，按日期分区）

-- ============================================================
-- 14. 访问统计表（日统计汇总）
-- ============================================================
CREATE TABLE visit_stats (
    id                  BIGSERIAL PRIMARY KEY,
    date                DATE NOT NULL UNIQUE,
    pv                  BIGINT NOT NULL DEFAULT 0,
    uv                  BIGINT NOT NULL DEFAULT 0,
    new_visitors        BIGINT NOT NULL DEFAULT 0,
    post_views          JSONB,
    country_stats       JSONB,
    device_stats        JSONB,
    browser_stats       JSONB,
    referer_stats       JSONB,
    avg_duration        INT DEFAULT 0,
    created_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- 统计表索引
CREATE INDEX idx_visit_stats_date ON visit_stats(date DESC);

-- 统计表注释
COMMENT ON TABLE visit_stats IS '每日访问统计汇总表';
COMMENT ON COLUMN visit_stats.pv IS '页面浏览量';
COMMENT ON COLUMN visit_stats.uv IS '独立访客数';
COMMENT ON COLUMN visit_stats.post_views IS '文章访问量统计（JSON格式）';

-- ============================================================
-- 15. 触发器：自动更新 updated_at
-- ============================================================
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 为需要的表创建触发器
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_posts_updated_at BEFORE UPDATE ON posts
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_categories_updated_at BEFORE UPDATE ON categories
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_tags_updated_at BEFORE UPDATE ON tags
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_comments_updated_at BEFORE UPDATE ON comments
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_friend_links_updated_at BEFORE UPDATE ON friend_links
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_site_settings_updated_at BEFORE UPDATE ON site_settings
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_prompt_templates_updated_at BEFORE UPDATE ON prompt_templates
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ============================================================
-- 16. 触发器：文章发布时更新分类/标签计数
-- ============================================================
CREATE OR REPLACE FUNCTION update_post_counts()
RETURNS TRIGGER AS $$
BEGIN
    -- 更新分类文章数
    IF TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN
        IF NEW.status = 'PUBLISHED' AND NEW.deleted = FALSE THEN
            IF NEW.category_id IS NOT NULL THEN
                UPDATE categories SET post_count = (
                    SELECT COUNT(*) FROM posts 
                    WHERE category_id = NEW.category_id 
                    AND status = 'PUBLISHED' 
                    AND deleted = FALSE
                ) WHERE id = NEW.category_id;
            END IF;
        END IF;
    END IF;
    
    IF TG_OP = 'DELETE' OR (TG_OP = 'UPDATE' AND (OLD.status != NEW.status OR OLD.deleted != NEW.deleted)) THEN
        IF OLD.category_id IS NOT NULL THEN
            UPDATE categories SET post_count = (
                SELECT COUNT(*) FROM posts 
                WHERE category_id = OLD.category_id 
                AND status = 'PUBLISHED' 
                AND deleted = FALSE
            ) WHERE id = OLD.category_id;
        END IF;
    END IF;
    
    RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_post_counts
AFTER INSERT OR UPDATE OR DELETE ON posts
FOR EACH ROW EXECUTE FUNCTION update_post_counts();

-- ============================================================
-- 17. 常用查询视图
-- ============================================================

-- 已发布文章视图
CREATE VIEW v_published_posts AS
SELECT 
    p.*,
    u.username as author_username,
    u.nickname as author_nickname,
    u.avatar as author_avatar,
    c.name as category_name,
    c.slug as category_slug,
    ARRAY_AGG(DISTINCT t.name) FILTER (WHERE t.name IS NOT NULL) as tag_names,
    ARRAY_AGG(DISTINCT t.slug) FILTER (WHERE t.slug IS NOT NULL) as tag_slugs
FROM posts p
LEFT JOIN users u ON p.author_id = u.id
LEFT JOIN categories c ON p.category_id = c.id
LEFT JOIN post_tags pt ON p.id = pt.post_id
LEFT JOIN tags t ON pt.tag_id = t.id
WHERE p.status = 'PUBLISHED' AND p.deleted = FALSE
GROUP BY p.id, u.id, c.id;

-- 文章归档视图（时间树）
CREATE VIEW v_post_archives AS
SELECT 
    EXTRACT(YEAR FROM published_at)::INT as year,
    EXTRACT(MONTH FROM published_at)::INT as month,
    COUNT(*) as post_count,
    JSON_AGG(
        JSON_BUILD_OBJECT(
            'id', id,
            'title', title,
            'slug', slug,
            'published_at', published_at
        ) ORDER BY published_at DESC
    ) as posts
FROM posts
WHERE status = 'PUBLISHED' AND deleted = FALSE
GROUP BY year, month
ORDER BY year DESC, month DESC;

-- ============================================================
-- 18. 初始化管理员账户
-- ============================================================
INSERT INTO users (username, email, password_hash, nickname, role, status) VALUES
    ('admin', 'admin@aetherblog.com', 
     -- 默认密码: admin123 (使用 bcrypt 加密)
     '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iKcWQYhbdSBhT6V9GHXzLPRXxEKy', 
     '管理员', 'ADMIN', 'ACTIVE');

-- ============================================================
-- 结束
-- ============================================================
```

---

# 第三部分：功能模块详细设计

## 3.1 博客前台功能模块

### 3.1.1 功能模块总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        博客前台功能模块架构                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                                         博客前台                                                   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    展示层模块                                                │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐              │  │ │
│   │   │   │  🏠 首页   │  │  📄 文章   │  │  📁 归档   │  │  🔍 搜索   │  │  🔗 友链   │              │  │ │
│   │   │   │  Home     │  │  Posts    │  │  Archives │  │  Search   │  │  Friends  │              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘              │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐                              │  │ │
│   │   │   │  🏷️ 分类   │  │  🏷️ 标签   │  │  👤 关于   │  │  📋 站点   │                              │  │ │
│   │   │   │ Categories│  │   Tags    │  │   About   │  │  SiteInfo │                              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘                              │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    交互层模块                                                │  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐              │  │ │
│   │   │   │  💬 评论   │  │  ❤️ 点赞   │  │  📤 分享   │  │  🌙 主题   │  │  📖 目录   │              │  │ │
│   │   │   │  Comment  │  │   Like    │  │   Share   │  │   Theme   │  │    TOC    │              │  │ │
│   │   │   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘              │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.2 欢迎页模块

#### 3.1.2.1 功能描述

欢迎页是用户首次访问博客时的"数字化名片"，以电影级的视觉效果展示博主的个人品牌。

#### 3.1.2.2 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        欢迎页功能规格                                                     │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-WELCOME-001                                                                              │
│   【模块名称】欢迎页                                                                                       │
│   【优先级】P1 - 高                                                                                        │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  功能点清单                                                                                         │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-01  首次访问检测                                                                    │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：检测用户是否首次访问站点，决定是否展示欢迎页                                                    │ │
│   │  规则：                                                                                             │ │
│   │    • 使用 localStorage 存储访问标记 'aetherblog_visited'                                            │ │
│   │    • 标记有效期：24小时（可配置）                                                                     │ │
│   │    • 可通过后台设置永久关闭欢迎页                                                                     │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-02  背景效果                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：全屏沉浸式背景效果                                                                            │ │
│   │  选项：                                                                                             │ │
│   │    • Mesh Gradient：动态网格渐变（默认）                                                             │ │
│   │    • 高斯模糊图片：博主自定义背景图 + 模糊效果                                                        │ │
│   │    • 粒子动画：科技感粒子流动效果                                                                    │ │
│   │    • 视频背景：循环播放视频（性能考虑，默认关闭）                                                      │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-03  核心内容展示                                                                    │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：居中展示博主核心信息                                                                          │ │
│   │  内容：                                                                                             │ │
│   │    • 博主头像（圆形，带光环动效）                                                                     │ │
│   │    • 博客名称（大标题，渐入动画）                                                                     │ │
│   │    • 个性签名（打字机效果）                                                                          │ │
│   │    • 社交链接图标（GitHub、Twitter、邮箱等）                                                          │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-04  进入按钮                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：引导用户进入博客主页                                                                          │ │
│   │  交互：                                                                                             │ │
│   │    • 按钮文案可配置（默认："探索更多"）                                                               │ │
│   │    • 悬浮发光效果                                                                                   │ │
│   │    • 点击后页面向上滑出，露出首页                                                                     │ │
│   │    • 支持向下滚动或按下箭头键进入                                                                     │ │
│   │                                                                                                    │ │
│   │  FE-WELCOME-001-05  跳过功能                                                                        │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  描述：允许用户快速跳过欢迎页                                                                        │ │
│   │  交互：                                                                                             │ │
│   │    • 右上角"跳过"链接（淡入显示，2秒后出现）                                                          │ │
│   │    • 3秒后自动淡出（可配置自动进入时间）                                                              │ │
│   │    • ESC 键快速跳过                                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  动效规范                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  进入动画序列：                                                                                      │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  0ms     → 背景渐入 (opacity: 0 → 1, duration: 800ms)                                              │ │
│   │  400ms   → 头像缩放进入 (scale: 0.8 → 1, duration: 600ms, easing: spring)                          │ │
│   │  600ms   → 标题淡入上滑 (translateY: 20px → 0, duration: 500ms)                                    │ │
│   │  900ms   → 签名打字机效果开始 (每字符 50ms)                                                          │ │
│   │  1500ms  → 社交链接依次弹入 (每个间隔 100ms, scale: 0 → 1)                                          │ │
│   │  2000ms  → 进入按钮淡入 (opacity: 0 → 1, duration: 400ms)                                          │ │
│   │                                                                                                    │ │
│   │  退出动画：                                                                                         │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  整体向上滑出 (translateY: 0 → -100vh, duration: 800ms, easing: easeInOut)                         │ │
│   │  同时首页从下方滑入                                                                                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  验收标准                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  □ 首次访问正确展示欢迎页                                                                            │ │
│   │  □ 再次访问（24小时内）不展示欢迎页                                                                   │ │
│   │  □ 所有动画流畅运行，无卡顿（FPS >= 55）                                                             │ │
│   │  □ 打字机效果正确显示完整签名                                                                        │ │
│   │  □ 点击进入按钮正确过渡到首页                                                                        │ │
│   │  □ 跳过功能正常工作                                                                                  │ │
│   │  □ 移动端正确响应式适配                                                                              │ │
│   │  □ 后台可配置欢迎页内容和开关                                                                        │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.3 首页模块

#### 3.1.3.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          首页功能规格                                                     │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-HOME-001                                                                                 │
│   【模块名称】博客首页                                                                                     │
│   【优先级】P0 - 核心                                                                                      │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  页面布局                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              顶部导航栏 (固定)                                              │  │ │
│   │   │   Logo  │  首页  │  归档  │  分类  │  标签  │  友链  │  关于  │        🔍  │  🌙            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              Hero 区域 (可选)                                               │  │ │
│   │   │                                                                                            │  │ │
│   │   │                         博客名称 / 简介 / 快速入口                                          │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────┐  ┌────────────────────────────────────┐    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │              文章列表区域 (主内容)                │  │          侧边栏                    │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │  📌 置顶文章卡片 (精选样式)                │  │  │  │  👤 博主信息卡片           │   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  头像 / 名称 / 简介         │   │    │ │
│   │   │                                                  │  │  │  社交链接                   │   │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  📄 普通文章卡片                          │  │  │                                    │    │ │
│   │   │   │  封面图 / 标题 / 摘要 / 标签 / 日期       │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  🔥 热门文章                │   │    │ │
│   │   │                                                  │  │  │  Top 5 列表                │   │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  📄 普通文章卡片                          │  │  │                                    │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  ┌────────────────────────────┐   │    │ │
│   │   │                                                  │  │  │  🏷️ 标签云                  │   │    │ │
│   │   │   ... 更多文章                                  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │  📄 分页器                                │  │  │  │  📊 站点统计               │   │    │ │
│   │   │   │  « 1 2 3 ... 10 »                        │  │  │  │  文章数 / 字数 / 访问量    │   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   └──────────────────────────────────────────────────┘  └────────────────────────────────────┘    │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              页脚区域                                                       │  │ │
│   │   │   版权信息 │ ICP备案 │ 运行时间 │ 主题信息 │ 返回顶部                                       │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  功能点详细规格                                                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-01  导航栏                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 固定在页面顶部 (position: sticky)                                                               │ │
│   │  • 滚动时背景变为毛玻璃效果 (backdrop-blur)                                                         │ │
│   │  • 当前页面导航项高亮                                                                               │ │
│   │  • 移动端折叠为汉堡菜单                                                                             │ │
│   │  • 搜索按钮点击打开全屏搜索面板                                                                      │ │
│   │  • 主题切换按钮 (亮色/暗色/跟随系统)                                                                 │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-02  文章列表                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 默认每页显示 10 篇文章                                                                           │ │
│   │  • 置顶文章始终显示在最前                                                                           │ │
│   │  • 支持无限滚动加载（可选）或分页器                                                                  │ │
│   │  • 文章卡片包含：封面图、标题、摘要、分类、标签、发布日期、阅读时间、浏览量                            │ │
│   │  • 卡片悬浮效果：上浮 + 阴影增强 + 光效                                                             │ │
│   │  • 列表加载动画：依次淡入上滑                                                                        │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-03  侧边栏                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 桌面端显示，平板/移动端隐藏或折叠                                                                 │ │
│   │  • 滚动时跟随（sticky），但不超过页脚                                                                │ │
│   │  • 模块可配置显示/隐藏                                                                              │ │
│   │  • 各模块采用统一的毛玻璃卡片样式                                                                    │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-04  博主信息卡片                                                                      │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 头像（圆形，悬浮旋转效果）                                                                        │ │
│   │  • 昵称 + 一句话简介                                                                                │ │
│   │  • 社交链接图标（GitHub、Twitter、Email、RSS等）                                                     │ │
│   │  • 统计数据：文章数、标签数、分类数                                                                  │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-05  热门文章                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 显示浏览量 Top 5 的文章                                                                          │ │
│   │  • 紧凑列表样式：序号 + 标题 + 浏览量                                                               │ │
│   │  • 序号采用渐变色标识 (1-金, 2-银, 3-铜, 其他-灰)                                                    │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-06  标签云                                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 显示使用频率最高的标签                                                                           │ │
│   │  • 标签大小根据使用次数动态调整                                                                      │ │
│   │  • 支持展开/收起更多标签                                                                            │ │
│   │  • 点击标签跳转到标签详情页                                                                         │ │
│   │                                                                                                    │ │
│   │  FE-HOME-001-07  站点统计                                                                          │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │  • 文章总数                                                                                        │ │
│   │  • 总字数（带单位：万字）                                                                           │ │
│   │  • 总访问量                                                                                        │ │
│   │  • 站点运行天数                                                                                    │ │
│   │  • 数字使用动态计数动画                                                                             │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.4 文章详情模块

#### 3.1.4.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       文章详情页功能规格                                                   │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-POST-001                                                                                 │
│   【模块名称】文章详情页                                                                                   │
│   【优先级】P0 - 核心                                                                                      │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  页面布局                                                                                           │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                    顶部导航栏                                               │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              阅读进度条 (顶部细线)                                          │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              文章头部区域                                                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  封面图 (全宽，带视差滚动效果)                                                       │  │  │ │
│   │   │   │  渐变遮罩覆盖                                                                       │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │   分类标签  •  发布日期  •  更新日期  •  阅读时间  •  字数统计  •  浏览量                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ████████████████████████████████████████████████████████████████████████████████████    │  │ │
│   │   │                              文 章 标 题                                                   │  │ │
│   │   │   ████████████████████████████████████████████████████████████████████████████████████    │  │ │
│   │   │                                                                                            │  │ │
│   │   │   标签列表: #标签1  #标签2  #标签3                                                         │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────┐  ┌────────────────────────────────────┐    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   │              文章正文区域                         │  │     目录导航 (TOC)                 │    │ │
│   │   │                                                  │  │     (Sticky 定位)                  │    │ │
│   │   │   ┌──────────────────────────────────────────┐  │  │                                    │    │ │
│   │   │   │  Markdown 渲染内容                        │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   │                                          │  │  │  │  📑 目录                    │   │    │ │
│   │   │   │  • 标题层级 (H1-H6)                      │  │  │  │  ├─ 一级标题               │   │    │ │
│   │   │   │  • 段落文本                              │  │  │  │  │  ├─ 二级标题            │   │    │ │
│   │   │   │  • 代码块 (语法高亮+折叠+复制)           │  │  │  │  │  │  └─ 三级标题         │   │    │ │
│   │   │   │  • 数学公式 (KaTeX)                      │  │  │  │  │  └─ 二级标题            │   │    │ │
│   │   │   │  • 图表 (Mermaid)                        │  │  │  │  └─ 一级标题               │   │    │ │
│   │   │   │  • 图片 (居中+灯箱)                      │  │  │  │                              │   │    │ │
│   │   │   │  • 表格                                  │  │  │  │  当前阅读位置高亮            │   │    │ │
│   │   │   │  • 引用块                                │  │  │  │  点击跳转到对应章节          │   │    │ │
│   │   │   │  • 列表                                  │  │  │  └────────────────────────────┘   │    │ │
│   │   │   │  • 链接                                  │  │  │                                    │    │ │
│   │   │   │                                          │  │  │  ┌────────────────────────────┐   │    │ │
│   │   │   └──────────────────────────────────────────┘  │  │  │  🔧 工具栏                  │   │    │ │
│   │   │                                                  │  │  │  ❤️ 点赞 (123)              │   │    │ │
│   │   │                                                  │  │  │  💬 评论 (45)               │   │    │ │
│   │   │                                                  │  │  │  📤 分享                    │   │    │ │
│   │   │                                                  │  │  │  ⬆️ 返回顶部                │   │    │ │
│   │   │                                                  │  │  └────────────────────────────┘   │    │ │
│   │   │                                                  │  │                                    │    │ │
│   │   └──────────────────────────────────────────────────┘  └────────────────────────────────────┘    │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                              文章底部区域                                                   │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌──────────────────────────────────┐  ┌──────────────────────────────────┐              │  │ │
│   │   │   │  ⬅️ 上一篇                        │  │  下一篇 ➡️                        │              │  │ │
│   │   │   │  《上一篇文章标题》               │  │  《下一篇文章标题》               │              │  │ │
│   │   │   └──────────────────────────────────┘  └──────────────────────────────────┘              │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  🔗 相关文章推荐                                                                    │  │  │ │
│   │   │   │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐                   │  │  │ │
│   │   │   │  │ 相关文章1  │  │ 相关文章2  │  │ 相关文章3  │  │ 相关文章4  │                   │  │  │ │
│   │   │   │  └────────────┘  └────────────┘  └────────────┘  └────────────┘                   │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │   ┌────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │   │  💬 评论区域                                                                        │  │  │ │
│   │   │   │  评论输入框 + 评论列表                                                              │  │  │ │
│   │   │   └────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.4.2 Markdown 渲染规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       Markdown 渲染功能规格                                               │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【模块编号】FE-POST-001-MD                                                                              │
│   【功能名称】Markdown 渲染引擎                                                                            │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  基础语法支持                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  ┌─────────────────┬───────────────────────────────────────────────────────────────────────────┐  │ │
│   │  │  语法类型        │  渲染规格                                                                  │  │ │
│   │  ├─────────────────┼───────────────────────────────────────────────────────────────────────────┤  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  标题 (H1-H6)   │  • 自动生成锚点 ID (用于目录导航)                                          │  │ │
│   │  │                 │  • 悬浮显示锚点链接图标                                                    │  │ │
│   │  │                 │  • 字号递减：H1=2rem, H2=1.75rem, H3=1.5rem...                            │  │ │
│   │  │                 │  • H1/H2 下方添加渐变分隔线                                                │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  段落           │  • 行高 1.75，字间距适中                                                   │  │ │
│   │  │                 │  • 段落间距 1.5rem                                                        │  │ │
│   │  │                 │  • 首行不缩进（西式排版）                                                  │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  粗体/斜体      │  • 粗体：font-weight: 600, 颜色加深                                       │  │ │
│   │  │                 │  • 斜体：font-style: italic                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  删除线         │  • text-decoration: line-through                                          │  │ │
│   │  │                 │  • 颜色变灰                                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  行内代码       │  • 背景色：rgba(primary, 0.1)                                              │  │ │
│   │  │                 │  • 圆角：4px                                                              │  │ │
│   │  │                 │  • 等宽字体                                                               │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  链接           │  • 主色调下划线                                                            │  │ │
│   │  │                 │  • 悬浮变色 + 下划线加粗                                                   │  │ │
│   │  │                 │  • 外部链接添加图标标识                                                    │  │ │
│   │  │                 │  • 新窗口打开外部链接                                                      │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  列表           │  • 无序列表：自定义圆点样式                                                 │  │ │
│   │  │                 │  • 有序列表：主色调数字                                                    │  │ │
│   │  │                 │  • 支持多级嵌套                                                           │  │ │
│   │  │                 │  • 任务列表：自定义复选框样式                                              │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  引用块         │  • 左侧主色调竖线                                                          │  │ │
│   │  │                 │  • 背景色半透明                                                            │  │ │
│   │  │                 │  • 支持嵌套引用                                                            │  │ │
│   │  │                 │  • 特殊提示块：> [!NOTE], > [!WARNING], > [!TIP]                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  分隔线         │  • 渐变线条，中间亮两端暗                                                  │  │ │
│   │  │                 │  • 上下间距 2rem                                                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  │  表格           │  • 表头背景加深                                                            │  │ │
│   │  │                 │  • 斑马纹行                                                               │  │ │
│   │  │                 │  • 悬浮行高亮                                                             │  │ │
│   │  │                 │  • 响应式横向滚动                                                          │  │ │
│   │  │                 │                                                                           │  │ │
│   │  └─────────────────┴───────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  代码块增强规格                                                                                     │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-CODE  代码块渲染                                                                   │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  外观设计：                                                                                         │ │
│   │  • macOS 风格窗口：红黄绿三个圆点 + 语言标签                                                        │ │
│   │  • 深色主题背景：#282c34 (One Dark Pro)                                                            │ │
│   │  • 圆角边框：12px                                                                                  │ │
│   │  • 阴影效果：大阴影营造悬浮感                                                                       │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 语法高亮：支持 100+ 种语言 (Shiki 引擎)                                                         │ │
│   │  • 行号显示：可配置开关                                                                             │ │
│   │  • 行高亮：支持高亮指定行 (```js {1,3-5})                                                          │ │
│   │  • 一键复制：悬浮显示复制按钮，点击后显示"已复制"反馈                                                │ │
│   │  • 代码折叠：超过 20 行自动折叠，显示"展开全部代码"按钮                                              │ │
│   │  • 全屏查看：点击全屏按钮放大查看                                                                   │ │
│   │  • 差异显示：支持 diff 语法高亮 (+/- 行)                                                           │ │
│   │                                                                                                    │ │
│   │  支持语言（部分）：                                                                                 │ │
│   │  javascript, typescript, python, java, go, rust, c, cpp, csharp,                                  │ │
│   │  html, css, scss, json, yaml, xml, markdown, sql, bash, shell,                                    │ │
│   │  dockerfile, nginx, graphql, prisma, solidity, kotlin, swift...                                   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  数学公式规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-MATH  数学公式渲染                                                                 │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  渲染引擎：KaTeX (性能优于 MathJax)                                                                 │ │
│   │                                                                                                    │ │
│   │  语法支持：                                                                                         │ │
│   │  • 行内公式：$E = mc^2$                                                                            │ │
│   │  • 块级公式：$$...$$                                                                               │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 支持完整 LaTeX 数学语法                                                                         │ │
│   │  • 矩阵、分数、积分、求和、极限等                                                                   │ │
│   │  • 块级公式居中显示，带序号（可选）                                                                  │ │
│   │  • 公式渲染错误时显示原始代码 + 错误提示                                                            │ │
│   │  • 点击公式可放大查看                                                                               │ │
│   │                                                                                                    │ │
│   │  示例支持：                                                                                         │ │
│   │  • 分数：\frac{a}{b}                                                                               │ │
│   │  • 求和：\sum_{i=1}^{n} x_i                                                                        │ │
│   │  • 积分：\int_{a}^{b} f(x) dx                                                                      │ │
│   │  • 矩阵：\begin{bmatrix} a & b \\ c & d \end{bmatrix}                                              │ │
│   │  • 希腊字母：\alpha, \beta, \gamma, \theta, \lambda...                                             │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  图表渲染规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-CHART  Mermaid 图表渲染                                                            │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  支持图表类型：                                                                                     │ │
│   │  • 流程图 (Flowchart)                                                                              │ │
│   │  • 时序图 (Sequence Diagram)                                                                       │ │
│   │  • 类图 (Class Diagram)                                                                            │ │
│   │  • 状态图 (State Diagram)                                                                          │ │
│   │  • 甘特图 (Gantt Chart)                                                                            │ │
│   │  • 饼图 (Pie Chart)                                                                                │ │
│   │  • ER图 (Entity Relationship Diagram)                                                              │ │
│   │  • Git图 (Git Graph)                                                                               │ │
│   │  • 思维导图 (Mind Map)                                                                             │ │
│   │                                                                                                    │ │
│   │  功能特性：                                                                                         │ │
│   │  • 暗色主题适配                                                                                    │ │
│   │  • 主色调配色                                                                                      │ │
│   │  • 导出为 SVG                                                                                      │ │
│   │  • 全屏查看                                                                                        │ │
│   │  • 渲染失败时显示错误信息                                                                          │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │  图片渲染规格                                                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  FE-POST-001-MD-IMAGE  图片增强渲染                                                                │ │
│   │  ──────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │  基础功能：                                                                                         │ │
│   │  • 默认居中显示                                                                                    │ │
│   │  • 圆角边框 + 阴影                                                                                 │ │
│   │  • 懒加载 (Lazy Loading)                                                                           │ │
│   │  • 加载骨架屏                                                                                      │ │
│   │  • 加载失败占位图                                                                                  │ │
│   │                                                                                                    │ │
│   │  灯箱功能：                                                                                         │ │
│   │  • 点击图片放大查看                                                                                 │ │
│   │  • 支持缩放和拖拽                                                                                  │ │
│   │  • 多图时支持左右切换                                                                               │ │
│   │  • 键盘快捷键：ESC关闭, ←→切换                                                                     │ │
│   │  • 下载原图按钮                                                                                    │ │
│   │                                                                                                    │ │
│   │  扩展语法：                                                                                         │ │
│   │  • 指定宽度：![alt](url){width=500}                                                                │ │
│   │  • 指定比例：![alt](url){width=50%}                                                                │ │
│   │  • 左对齐：![alt](url){align=left}                                                                 │ │
│   │  • 右对齐：![alt](url){align=right}                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.5 时间树归档模块

#### 3.1.5.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        时间树归档模块功能规格                                              │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   时间树是一个以时间轴为核心的文章归档可视化组件，采用树形层级结构展示博客历史。                          │ │
│   │   它不仅是功能性的归档工具，更是博客历史的艺术化呈现，让读者能够以非线性方式探索内容。                     │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         层级结构                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   第一层级：年份节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示年份数字（如 2025）                                                                    │  │ │
│   │   │  • 显示该年文章总数                                                                           │  │ │
│   │   │  • 圆形节点，带脉冲动画效果                                                                    │  │ │
│   │   │  • 点击可展开/收起月份列表                                                                     │  │ │
│   │   │  • 最新年份默认展开                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   第二层级：月份节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示月份名称（一月、二月...）                                                               │  │ │
│   │   │  • 显示该月文章数量                                                                           │  │ │
│   │   │  • 较小的圆形节点                                                                             │  │ │
│   │   │  • 点击可展开/收起文章列表                                                                     │  │ │
│   │   │  • 与年份节点通过连接线关联                                                                    │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   第三层级：文章节点                                                                                │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 显示文章标题                                                                               │  │ │
│   │   │  • 显示发布日期（几号）                                                                        │  │ │
│   │   │  • 显示阅读时间                                                                               │  │ │
│   │   │  • 显示首个标签                                                                               │  │ │
│   │   │  • 悬浮时显示更多信息                                                                          │  │ │
│   │   │  • 点击跳转至文章详情                                                                          │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.5.2 交互设计规范

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        时间树交互设计规范                                                  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   【展开/收起动画】                                                                                       │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   年份节点展开：                                                                                 │   │
│   │   • 箭头图标旋转 90°（0° → 90°，时长 200ms）                                                      │   │
│   │   • 子节点区域高度从 0 过渡到 auto                                                                │   │
│   │   • 使用 Framer Motion 的 layout 属性实现平滑过渡                                                 │   │
│   │   • 弹簧动画参数: stiffness: 300, damping: 30                                                    │   │
│   │                                                                                                 │   │
│   │   月份节点展开：                                                                                 │   │
│   │   • 与年份节点类似，但动画时长稍短（150ms）                                                        │   │
│   │   • 文章列表以瀑布流方式依次出现                                                                  │   │
│   │   • 每个文章项延迟 30ms 出现                                                                     │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【连接线动画】                                                                                          │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   主时间线：                                                                                     │   │
│   │   • 垂直渐变线（从主色到透明）                                                                    │   │
│   │   • 位于左侧，贯穿整个时间树                                                                      │   │
│   │   • 宽度 2px                                                                                    │   │
│   │                                                                                                 │   │
│   │   分支连接线：                                                                                   │   │
│   │   • 水平线连接父节点和子节点                                                                      │   │
│   │   • 展开时从左向右延伸动画                                                                        │   │
│   │   • 使用 SVG path 绘制，支持曲线效果                                                              │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【节点状态】                                                                                            │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   默认状态：                                                                                     │   │
│   │   • 年份节点: 主色背景，白色图标，带微弱光晕                                                       │   │
│   │   • 月份节点: 次要色背景，较小尺寸                                                                │   │
│   │   • 文章项: 透明背景，灰色文字                                                                    │   │
│   │                                                                                                 │   │
│   │   悬浮状态：                                                                                     │   │
│   │   • 年份节点: 放大 1.1 倍，光晕增强                                                               │   │
│   │   • 月份节点: 背景变亮                                                                           │   │
│   │   • 文章项: 背景出现，向右位移 4px，文字变白                                                       │   │
│   │                                                                                                 │   │
│   │   展开状态：                                                                                     │   │
│   │   • 节点添加脉冲动画（无限循环）                                                                  │   │
│   │   • 脉冲环从节点向外扩散渐隐                                                                      │   │
│   │                                                                                                 │   │
│   │   当前阅读状态：                                                                                 │   │
│   │   • 如果时间树在文章详情页侧边栏展示                                                               │   │
│   │   • 当前阅读文章高亮显示                                                                          │   │
│   │   • 添加特殊标记图标                                                                             │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
│   【响应式适配】                                                                                          │
│   ────────────────────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                                 │   │
│   │   桌面端 (≥1024px)：                                                                            │   │
│   │   • 完整的三层结构展示                                                                           │   │
│   │   • 可作为侧边栏或独立页面                                                                        │   │
│   │                                                                                                 │   │
│   │   平板端 (768px - 1023px)：                                                                     │   │
│   │   • 保持三层结构                                                                                 │   │
│   │   • 节点尺寸适当缩小                                                                             │   │
│   │                                                                                                 │   │
│   │   移动端 (<768px)：                                                                             │   │
│   │   • 全屏展示                                                                                    │   │
│   │   • 增大触摸目标区域                                                                             │   │
│   │   • 简化连接线效果                                                                               │   │
│   │                                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.5.3 数据结构设计

```typescript
// 时间树数据类型定义

/**
 * 时间树年份数据
 */
interface TimeTreeYear {
  year: number;                    // 年份
  months: TimeTreeMonth[];         // 月份列表
  totalPosts: number;              // 该年文章总数
  isExpanded?: boolean;            // 是否展开
}

/**
 * 时间树月份数据
 */
interface TimeTreeMonth {
  month: number;                   // 月份 (1-12)
  monthName: string;               // 月份名称 (一月, 二月...)
  posts: TimeTreePost[];           // 文章列表
  postCount: number;               // 文章数量
  isExpanded?: boolean;            // 是否展开
}

/**
 * 时间树文章数据
 */
interface TimeTreePost {
  id: number;                      // 文章ID
  title: string;                   // 文章标题
  slug: string;                    // URL Slug
  publishedAt: string;             // 发布时间 ISO 格式
  day: number;                     // 发布日期 (1-31)
  readingTime: number;             // 阅读时间（分钟）
  tags?: Array<{                   // 标签列表
    id: number;
    name: string;
  }>;
}

/**
 * 时间树完整数据
 */
interface TimeTreeData {
  years: TimeTreeYear[];           // 年份列表（按年份降序）
  totalPosts: number;              // 总文章数
  dateRange: {                     // 日期范围
    start: string;                 // 最早文章日期
    end: string;                   // 最新文章日期
  };
}
```

#### 3.1.5.4 API 接口设计

```yaml
# 时间树归档接口

GET /api/v1/archives/time-tree:
  summary: 获取时间树归档数据
  description: |
    返回按年份-月份-文章层级组织的归档数据，
    用于前端渲染时间树组件
  parameters:
    - name: includeDetails
      in: query
      description: 是否包含文章详细信息（标签等）
      schema:
        type: boolean
        default: false
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 200
              data:
                type: object
                properties:
                  years:
                    type: array
                    items:
                      $ref: '#/components/schemas/TimeTreeYear'
                  totalPosts:
                    type: integer
                    example: 156
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2022-03-15"
                      end:
                        type: string
                        example: "2025-01-20"

GET /api/v1/archives/calendar:
  summary: 获取日历热力图数据
  description: |
    返回每日发文数量统计，用于渲染类似 GitHub 贡献图的热力图
  parameters:
    - name: year
      in: query
      description: 年份，默认当前年
      schema:
        type: integer
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  type: object
                  properties:
                    date:
                      type: string
                      example: "2025-01-15"
                    count:
                      type: integer
                      example: 2

GET /api/v1/archives/stats:
  summary: 获取归档统计数据
  description: 返回博客的整体统计信息
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              totalPosts:
                type: integer
                example: 156
              totalWords:
                type: integer
                example: 523000
              totalCategories:
                type: integer
                example: 12
              totalTags:
                type: integer
                example: 87
              firstPostDate:
                type: string
                example: "2022-03-15"
              lastPostDate:
                type: string
                example: "2025-01-20"
              avgPostsPerMonth:
                type: number
                example: 4.5
```

### 3.1.6 全文搜索模块

#### 3.1.6.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        全文搜索模块功能规格                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   AetherBlog 的搜索功能采用混合搜索策略，结合传统关键词搜索与 AI 语义搜索，                           │ │
│   │   为用户提供精准且智能的内容发现体验。                                                               │ │
│   │                                                                                                    │ │
│   │   核心特性：                                                                                        │ │
│   │   • 全文检索：基于 Elasticsearch 的高性能全文搜索                                                    │ │
│   │   • 语义搜索：基于向量相似度的 AI 语义理解                                                           │ │
│   │   • 混合排序：RRF 算法融合两路结果                                                                  │ │
│   │   • AI 回答：基于 RAG 的智能问答                                                                    │ │
│   │   • 搜索建议：实时搜索提示与历史记录                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         搜索模式                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   模式一：快速搜索（Command+K 唤起）                                                                 │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 全局快捷键唤起搜索面板                                                                     │  │ │
│   │   │  • 支持模糊匹配文章标题                                                                       │  │ │
│   │   │  • 实时显示搜索结果（防抖 300ms）                                                             │  │ │
│   │   │  • 键盘导航：↑↓ 选择，Enter 打开，Esc 关闭                                                    │  │ │
│   │   │  • 显示最近搜索历史                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   模式二：高级搜索（搜索页面）                                                                      │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 完整的搜索结果页面                                                                         │  │ │
│   │   │  • 支持筛选：分类、标签、时间范围                                                              │  │ │
│   │   │  • 支持排序：相关度、时间、热度                                                                │  │ │
│   │   │  • 高亮匹配关键词                                                                             │  │ │
│   │   │  • 分页加载更多结果                                                                           │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   模式三：AI 问答搜索                                                                              │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │  • 支持自然语言提问                                                                           │  │ │
│   │   │  • AI 基于博客内容生成回答                                                                    │  │ │
│   │   │  • 显示回答来源（引用文章）                                                                    │  │ │
│   │   │  • 流式输出回答内容                                                                           │  │ │
│   │   │  • 可展开查看相关文章列表                                                                      │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         搜索算法                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   混合搜索流程：                                                                                   │ │
│   │                                                                                                    │ │
│   │   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐               │ │
│   │   │  用户查询    │ ──▶ │  查询预处理   │ ──▶ │   并行检索   │ ──▶ │   RRF 融合   │               │ │
│   │   └──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘               │ │
│   │                              │                     │                     │                        │ │
│   │                              ▼                     ▼                     ▼                        │ │
│   │                        • 分词处理            • 向量检索            • 结果合并                     │ │
│   │                        • 同义词扩展          • 关键词检索          • 去重排序                     │ │
│   │                        • 意图识别            • BM25 评分           • 返回 TopK                    │ │
│   │                                                                                                    │ │
│   │   RRF (Reciprocal Rank Fusion) 公式：                                                              │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   RRFscore(d) = Σ 1 / (k + rank_i(d))                                                       │  │ │
│   │   │                                                                                             │  │ │
│   │   │   其中：k = 60（常用值），rank_i(d) 为文档 d 在第 i 路检索中的排名                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.6.2 搜索界面设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        搜索面板 UI 设计                                                   │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                              搜索面板布局（全屏遮罩模式）                                            │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                   🔍 搜索框区域                                              │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │ 🔍 │ 搜索文章、标签、分类... (支持自然语言)                           │ ✕ │ 加载中 │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   │                                                                                            │  │ │
│   │   │  提示: 支持自然语言搜索，例如 "如何优化 Spring Boot 性能"                                    │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 ✨ AI 智能回答区域                                          │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │  ✨ AI 智能回答                                                              加载中... │  │  │ │
│   │   │  │  ────────────────────────────────────────────────────────────────────────────────────  │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  根据您的问题，Spring Boot 性能优化主要可以从以下几个方面入手：                          │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  1. **JVM 参数调优** - 合理配置堆内存、GC 策略...                                       │  │  │ │
│   │   │  │  2. **数据库连接池优化** - 使用 HikariCP，调整连接数...                                 │  │  │ │
│   │   │  │  3. **缓存策略** - 引入 Redis 缓存热点数据...                                          │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  来源: Spring Boot 性能调优实战、JVM 内存管理详解                                       │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│                                                                                                          │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 📄 搜索结果列表区域                                         │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ Spring Boot 3 性能调优完全指南                                    → │ │  │  │ │
│   │   │  │  │    │ 本文详细介绍了 <mark>Spring Boot</mark> 应用的<mark>性能</mark>优化...    │ │  │  │ │
│   │   │  │  │    │ 📁 后端开发  🏷️ Spring Boot, 性能优化  📅 2025-01-15  匹配度 95%         │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ JVM 内存管理与 GC 调优实战                                         → │ │  │  │ │
│   │   │  │  │    │ 深入分析 JVM 内存结构，探讨如何通过 GC 调优提升<mark>性能</mark>...       │ │  │  │ │
│   │   │  │  │    │ 📁 Java 核心  🏷️ JVM, GC  📅 2025-01-10  匹配度 87%                      │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │  │  │ │
│   │   │  │  │ 📄 │ 微服务架构下的性能监控体系                                          → │ │  │  │ │
│   │   │  │  │    │ 介绍如何构建完善的<mark>性能</mark>监控体系，实时发现性能瓶颈...          │ │  │  │ │
│   │   │  │  │    │ 📁 架构设计  🏷️ 微服务, 监控  📅 2024-12-20  匹配度 82%                  │ │  │  │ │
│   │   │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │  │  │ │
│   │   │  │                                                                                       │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                 ⌨️ 快捷键提示区域                                           │  │ │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │ │
│   │   │  │  ↑↓ 导航  │  Enter 打开  │  Esc 关闭  │  ✨ AI 语义搜索已启用                        │  │  │ │
│   │   │  └──────────────────────────────────────────────────────────────────────────────────────┘  │  │ │
│   │   └────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                              无结果状态 / 初始状态设计                                              │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【初始状态 - 未输入】                                                                            │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   🕒 搜索历史                                              [清空]                           │  │ │
│   │   │   ────────────────────────────────────────────────────────────────                          │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                          │  │ │
│   │   │   │ 🕒 Spring   │ │ 🕒 React 19 │ │ 🕒 Docker   │ │ 🕒 性能优化  │                          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘                          │  │ │
│   │   │                                                                                             │  │ │
│   │   │   🔥 热门搜索                                                                               │  │ │
│   │   │   ────────────────────────────────────────────────────────────────                          │  │ │
│   │   │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │ │
│   │   │   │ 1 JDK 21   │ │ 2 微服务    │ │ 3 AI 开发   │ │ 4 K8s 部署  │ │ 5 前端框架  │          │  │ │
│   │   │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │  │ │
│   │   │                                                                                             │  │ │
│   │   │   💡 支持自然语言搜索，例如："如何优化 Spring Boot 性能"                                     │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   【无结果状态】                                                                                   │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │                              🔍                                                             │  │ │
│   │   │                         (搜索图标)                                                          │  │ │
│   │   │                                                                                             │  │ │
│   │   │              未找到与 "xxxxxx" 相关的内容                                                   │  │ │
│   │   │                                                                                             │  │ │
│   │   │              试试其他关键词，或使用更具体的描述                                              │  │ │
│   │   │                                                                                             │  │ │
│   │   │              ────────────────────────────────────                                           │  │ │
│   │   │              建议：                                                                         │  │ │
│   │   │              • 检查关键词拼写                                                               │  │ │
│   │   │              • 使用更通用的词汇                                                             │  │ │
│   │   │              • 尝试浏览分类页面                                                             │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.6.3 搜索 API 接口设计

```yaml
# 搜索相关接口定义

# 1. 基础搜索接口
POST /api/v1/search:
  summary: 混合搜索
  description: |
    执行混合搜索，同时使用关键词搜索和语义搜索，
    通过 RRF 算法融合结果返回最相关的文章
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - query
          properties:
            query:
              type: string
              description: 搜索关键词或自然语言问题
              example: "如何优化 Spring Boot 性能"
            page:
              type: integer
              default: 1
            size:
              type: integer
              default: 10
              maximum: 50
            filters:
              type: object
              properties:
                categoryId:
                  type: integer
                tagIds:
                  type: array
                  items:
                    type: integer
                dateFrom:
                  type: string
                  format: date
                dateTo:
                  type: string
                  format: date
            sortBy:
              type: string
              enum: [relevance, date, views]
              default: relevance
  responses:
    200:
      description: 搜索成功
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 200
              data:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/SearchResult'
                  total:
                    type: integer
                  page:
                    type: integer
                  hasMore:
                    type: boolean
                  queryTime:
                    type: integer
                    description: 查询耗时(毫秒)

# 2. AI 问答搜索接口
POST /api/v1/search/ai-answer:
  summary: AI 问答搜索
  description: |
    基于 RAG 的智能问答搜索，
    AI 会根据博客内容生成针对性回答
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - question
          properties:
            question:
              type: string
              description: 用户问题
              example: "Spring Boot 3 有哪些新特性？"
            stream:
              type: boolean
              default: true
              description: 是否流式输出
  responses:
    200:
      description: 成功（非流式）
      content:
        application/json:
          schema:
            type: object
            properties:
              answer:
                type: string
              sources:
                type: array
                items:
                  type: object
                  properties:
                    postId:
                      type: integer
                    title:
                      type: string
                    slug:
                      type: string
              confidence:
                type: number
                format: float
    # 流式响应
    200-stream:
      description: 成功（流式）
      content:
        text/event-stream:
          schema:
            type: string

# 3. 搜索建议接口
GET /api/v1/search/suggestions:
  summary: 获取搜索建议
  description: 根据输入前缀返回搜索建议
  parameters:
    - name: q
      in: query
      required: true
      schema:
        type: string
        minLength: 1
    - name: limit
      in: query
      schema:
        type: integer
        default: 5
        maximum: 10
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              suggestions:
                type: array
                items:
                  type: object
                  properties:
                    text:
                      type: string
                    type:
                      type: string
                      enum: [post, tag, category]
                    highlight:
                      type: string

# 4. 热门搜索接口
GET /api/v1/search/trending:
  summary: 获取热门搜索词
  parameters:
    - name: limit
      in: query
      schema:
        type: integer
        default: 10
  responses:
    200:
      description: 成功
      content:
        application/json:
          schema:
            type: object
            properties:
              trending:
                type: array
                items:
                  type: object
                  properties:
                    keyword:
                      type: string
                    count:
                      type: integer

# 组件定义
components:
  schemas:
    SearchResult:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        slug:
          type: string
        highlight:
          type: string
          description: 高亮匹配片段
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        publishedAt:
          type: string
          format: date
        score:
          type: number
          format: float
          description: 相关度分数 0-1
```

### 3.1.7 友链展示模块

#### 3.1.7.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        友链展示模块功能规格                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         功能概述                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   友链模块不仅是链接交换的功能页面，更是博主社交圈的优雅展示。                                        │ │
│   │   每个友链都以精美的卡片形式呈现，展现独特的视觉风格。                                                │ │
│   │                                                                                                    │ │
│   │   核心设计理念：                                                                                    │ │
│   │   • 卡片化设计：每个友链独立成卡，信息层次清晰                                                       │ │
│   │   • 个性化主题：支持自定义主题色，体现友链特色                                                       │ │
│   │   • 动效增强：悬浮光效、位移动画提升交互体验                                                         │ │
│   │   • 状态检测：自动检测友链可访问性                                                                  │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         卡片信息结构                                                │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │ │
│   │   │                                                                                             │  │ │
│   │   │   ┌─────────────────────────────────────────────────────────────────────────────────────┐   │  │ │
│   │   │   │ ═══════════════════════════════════ (主题色装饰条)                                  │   │  │ │
│   │   │   ├─────────────────────────────────────────────────────────────────────────────────────┤   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   │   ┌───────────┐                                                                    │   │  │ │
│   │   │   │   │           │   博主昵称                                    ↗                    │   │  │ │
│   │   │   │   │  头像/图标 │   ────────────────────────────────────────                        │   │  │ │
│   │   │   │   │           │   博客简介或个性签名，简要描述博客内容...                           │   │  │ │
│   │   │   │   └───────────┘                                                                    │   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   │   ┌─────────┐ ┌─────────┐ ┌─────────┐                                              │   │  │ │
│   │   │   │   │ 标签1   │ │ 标签2   │ │ 标签3   │  (可选标签)                                  │   │  │ │
│   │   │   │   └─────────┘ └─────────┘ └─────────┘                                              │   │  │ │
│   │   │   │                                                                                     │   │  │ │
│   │   │   ├─────────────────────────────────────────────────────────────────────────────────────┤   │  │ │
│   │   │   │   🌐 example.com                                           📧  📡               │   │  │ │
│   │   │   └─────────────────────────────────────────────────────────────────────────────────────┘   │  │ │
│   │   │                                                                                             │  │ │
│   │   └─────────────────────────────────────────────────────────────────────────────────────────────┘  │ │
│   │                                                                                                    │ │
│   │   卡片元素说明：                                                                                   │ │
│   │   • 主题色装饰条：顶部渐变色条，使用友链配置的主题色                                                 │ │
│   │   • 头像：圆形头像，支持图片加载失败时显示首字母                                                     │ │
│   │   • 博主昵称：友链名称，悬浮变色                                                                    │ │
│   │   • 简介：博客描述，最多显示两行                                                                    │ │
│   │   • 标签：可选的分类标签                                                                           │ │
│   │   • 域名：显示友链域名                                                                             │ │
│   │   • 社交图标：邮箱、RSS 订阅链接                                                                   │ │
│   │   • 外链图标：右上角的外链指示                                                                      │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         交互效果                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   默认状态：                                                                                        │ │
│   │   • 毛玻璃背景（bg-white/5 backdrop-blur-xl）                                                       │ │
│   │   • 微弱边框（border-white/10）                                                                     │ │
│   │   • 柔和阴影                                                                                        │ │
│   │                                                                                                    │ │
│   │   悬浮状态：                                                                                        │ │
│   │   • 卡片整体上移 8px                                                                                │ │
│   │   • 背景亮度增加                                                                                    │ │
│   │   • 主题色光晕出现                                                                                  │ │
│   │   • 边框颜色加深                                                                                    │ │
│   │   • 头像轻微晃动动画                                                                                │ │
│   │                                                                                                    │ │
│   │   点击效果：                                                                                        │ │
│   │   • 轻微缩放反馈                                                                                    │ │
│   │   • 新标签页打开友链                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                         页面布局                                                    │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   响应式网格布局：                                                                                  │ │
│   │   • 桌面端 (≥1024px): 3 列                                                                         │ │
│   │   • 平板端 (768-1023px): 2 列                                                                      │ │
│   │   • 移动端 (<768px): 1 列                                                                          │ │
│   │                                                                                                    │ │
│   │   加载动画：                                                                                        │ │
│   │   • 卡片按索引顺序依次出现                                                                          │ │
│   │   • 每张卡片延迟 100ms                                                                             │ │
│   │   • 使用淡入上滑动画                                                                                │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.8 关于页面模块

#### 3.1.8.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        关于页面功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能概述                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   关于页面是博主的数字化名片，展示博主个人信息、技能专长、职业经历、                                    │ │
│   │   社交媒体链接以及站点介绍等内容。该页面需要体现"高级感"和"格调"，                                     │ │
│   │   通过精心设计的视觉元素和交互动效，给访客留下深刻印象。                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能清单                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【博主信息展示】                                                                                  │ │
│   │   ├── 头像展示（支持动态头像/静态头像）                                                              │ │
│   │   ├── 昵称/姓名                                                                                    │ │
│   │   ├── 职业头衔/标签                                                                                │ │
│   │   ├── 个性签名                                                                                     │ │
│   │   ├── 个人简介（支持 Markdown 格式）                                                                │ │
│   │   └── 所在地/时区                                                                                  │ │
│   │                                                                                                    │ │
│   │   【社交媒体链接】                                                                                  │ │
│   │   ├── GitHub                                                                                       │ │
│   │   ├── Twitter/X                                                                                    │ │
│   │   ├── LinkedIn                                                                                     │ │
│   │   ├── 微信公众号                                                                                   │ │
│   │   ├── 知乎                                                                                         │ │
│   │   ├── 掘金                                                                                         │ │
│   │   ├── Email                                                                                        │ │
│   │   └── 自定义链接                                                                                   │ │
│   │                                                                                                    │ │
│   │   【技能展示】                                                                                      │ │
│   │   ├── 技能标签云                                                                                   │ │
│   │   ├── 技能熟练度进度条                                                                              │ │
│   │   └── 技术栈图标展示                                                                               │ │
│   │                                                                                                    │ │
│   │   【职业经历】（可选）                                                                               │ │
│   │   ├── 时间线形式展示                                                                               │ │
│   │   ├── 公司/项目名称                                                                                │ │
│   │   ├── 职位                                                                                         │ │
│   │   └── 工作描述                                                                                     │ │
│   │                                                                                                    │ │
│   │   【站点信息】                                                                                      │ │
│   │   ├── 站点创建时间                                                                                 │ │
│   │   ├── 运行天数统计                                                                                 │ │
│   │   ├── 文章总数                                                                                     │ │
│   │   ├── 总字数统计                                                                                   │ │
│   │   ├── 总访问量                                                                                     │ │
│   │   └── 站点介绍/愿景                                                                                │ │
│   │                                                                                                    │ │
│   │   【版权声明】                                                                                      │ │
│   │   ├── 版权信息                                                                                     │ │
│   │   ├── CC协议选择                                                                                   │ │
│   │   └── 转载说明                                                                                     │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.8.2 页面布局设计

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        关于页面布局设计                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                    顶部导航栏 (毛玻璃效果)                                           │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │                              ┌──────────────────────────────┐                                      │ │
│   │                              │                              │                                      │ │
│   │                              │       [博主头像]              │                                      │ │
│   │                              │        (120px)               │                                      │ │
│   │                              │     带光晕动效               │                                      │ │
│   │                              │                              │                                      │ │
│   │                              └──────────────────────────────┘                                      │ │
│   │                                                                                                    │ │
│   │                                       昵称 / 姓名                                                   │ │
│   │                                  ──────────────────────                                            │ │
│   │                              「 高级后端工程师 | 开源爱好者 」                                       │ │
│   │                                                                                                    │ │
│   │                                      个性签名区域                                                   │ │
│   │                              "Stay hungry, Stay foolish."                                          │ │
│   │                                                                                                    │ │
│   │                              ┌────┐ ┌────┐ ┌────┐ ┌────┐                                          │ │
│   │                              │ GH │ │ TW │ │ LI │ │ EM │  ← 社交媒体图标                           │ │
│   │                              └────┘ └────┘ └────┘ └────┘                                          │ │
│   │                                                                                                    │ │
│   │   Hero 区域                                                                                        │ │
│   │   (全屏背景 + 毛玻璃卡片)                                                                           │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   关于我                                                                                           │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   👋 Hi，我是 [昵称]，一名热爱技术的后端工程师。                                                    │ │
│   │                                                                                                    │ │
│   │   我专注于 Java 生态系统，对分布式系统、高并发架构有深入研究。                                       │ │
│   │   工作之余，我喜欢探索新技术，并通过博客分享学习心得。                                                │ │
│   │                                                                                                    │ │
│   │   目前正在研究：                                                                                   │ │
│   │   • JDK 21 虚拟线程与 Spring AI 的结合应用                                                         │ │
│   │   • 大语言模型在代码生成领域的实践                                                                  │ │
│   │   • 云原生架构设计模式                                                                              │ │
│   │                                                                                                    │ │
│   │   (支持 Markdown 渲染，包括代码块、列表、链接等)                                                    │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   技能专长                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────────────────────────────┐  ┌─────────────────────────────────────────┐        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [Java Icon]  Java                      │  │  [Spring Icon]  Spring Boot            │        │ │
│   │   │  ████████████████████████░░░  95%       │  │  ███████████████████████░░░░  90%       │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [PG Icon]    PostgreSQL                │  │  [K8s Icon]    Kubernetes              │        │ │
│   │   │  ██████████████████████░░░░░  85%       │  │  ████████████████████░░░░░░  80%        │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   │  [React Icon] React                     │  │  [Docker Icon] Docker                  │        │ │
│   │   │  ██████████████████░░░░░░░░  75%        │  │  ███████████████████████░░░░  90%       │        │ │
│   │   │                                         │  │                                         │        │ │
│   │   └─────────────────────────────────────────┘  └─────────────────────────────────────────┘        │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│   │   │                                     技术标签云                                               │ │ │
│   │   │                                                                                              │ │ │
│   │   │    微服务    Spring Cloud    Redis    Kafka    MySQL    MongoDB    Elasticsearch            │ │ │
│   │   │         RabbitMQ    gRPC    GraphQL    Nginx    Linux    Git    CI/CD    AWS               │ │ │
│   │   │    TypeScript    Vue    Node.js    Python    Go    Rust    WebSocket    OAuth2             │ │ │
│   │   │                                                                                              │ │ │
│   │   └──────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   关于本站                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          │ │
│   │   │   📅              │  │   📝              │  │   📖              │  │   👁️              │          │ │
│   │   │  运行天数          │  │  文章总数          │  │  总字数           │  │  总访问量          │          │ │
│   │   │    365+           │  │    128            │  │   25万+           │  │   10万+           │          │ │
│   │   └──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘          │ │
│   │                                                                                                    │ │
│   │   ────────────────────────────────────────────────────────────────────────────────────────────    │ │
│   │                                                                                                    │ │
│   │   本站创建于 2024 年 1 月，基于 AetherBlog 构建。                                                  │ │
│   │                                                                                                    │ │
│   │   「让每一篇博客都成为艺术品，让每一次创作都有 AI 相伴」                                             │ │
│   │                                                                                                    │ │
│   │   技术栈：React 19 + Spring Boot 3.4 + PostgreSQL 17 + Spring AI                                  │ │
│   │   托管于：[云服务商]                                                                               │ │
│   │   CDN：Cloudflare                                                                                 │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   版权声明                                                                                         │ │
│   │   ══════════════════════════════════════════════════════════════════════════════════════════════   │ │
│   │                                                                                                    │ │
│   │   [CC BY-NC-SA 4.0 图标]                                                                          │ │
│   │                                                                                                    │ │
│   │   本站所有原创内容均采用 CC BY-NC-SA 4.0 协议进行许可。                                             │ │
│   │                                                                                                    │ │
│   │   转载请注明出处并保留原文链接。                                                                    │ │
│   │   禁止用于商业用途。                                                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      页面底部 (Footer)                                             │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.8.3 组件实现

```tsx
// apps/blog/src/app/about/page.tsx

import React from 'react';
import { Metadata } from 'next';
import { AboutHero } from '@/components/about/AboutHero';
import { AboutContent } from '@/components/about/AboutContent';
import { SkillSection } from '@/components/about/SkillSection';
import { SiteStats } from '@/components/about/SiteStats';
import { CopyrightSection } from '@/components/about/CopyrightSection';
import { getSiteSettings, getAuthorProfile, getSiteStats } from '@/lib/api';

export const metadata: Metadata = {
  title: '关于 - AetherBlog',
  description: '了解博主和本站的更多信息',
};

export default async function AboutPage() {
  // 获取数据
  const [settings, author, stats] = await Promise.all([
    getSiteSettings(),
    getAuthorProfile(),
    getSiteStats(),
  ]);

  return (
    <main className="min-h-screen">
      {/* Hero 区域 */}
      <AboutHero author={author} />

      {/* 主要内容区域 */}
      <div className="container mx-auto px-4 py-16 space-y-24">
        {/* 关于我 */}
        <AboutContent content={author.bio} />

        {/* 技能专长 */}
        <SkillSection skills={author.skills} techStack={author.techStack} />

        {/* 关于本站 */}
        <SiteStats stats={stats} siteInfo={settings} />

        {/* 版权声明 */}
        <CopyrightSection copyright={settings.copyright} />
      </div>
    </main>
  );
}
```

```tsx
// apps/blog/src/components/about/AboutHero.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { 
  Github, 
  Twitter, 
  Linkedin, 
  Mail, 
  MapPin,
  ExternalLink 
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import type { AuthorProfile } from '@aetherblog/types';

interface AboutHeroProps {
  author: AuthorProfile;
}

/**
 * 社交媒体图标映射
 */
const socialIcons: Record<string, React.FC<{ className?: string }>> = {
  github: Github,
  twitter: Twitter,
  linkedin: Linkedin,
  email: Mail,
};

/**
 * 关于页面 Hero 区域
 */
export const AboutHero: React.FC<AboutHeroProps> = ({ author }) => {
  return (
    <section className="relative min-h-[70vh] flex items-center justify-center overflow-hidden">
      {/* 背景 */}
      <div className="absolute inset-0">
        {/* 渐变背景 */}
        <div className="absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900" />
        
        {/* 网格渐变装饰 */}
        <div 
          className="absolute inset-0 opacity-20"
          style={{
            backgroundImage: `
              radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.3) 0px, transparent 50%),
              radial-gradient(at 80% 0%, rgba(168, 85, 247, 0.2) 0px, transparent 50%),
              radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.2) 0px, transparent 50%)
            `,
          }}
        />
        
        {/* 网格线 */}
        <div 
          className="absolute inset-0 opacity-5"
          style={{
            backgroundImage: `
              linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px)
            `,
            backgroundSize: '50px 50px',
          }}
        />
      </div>

      {/* 内容 */}
      <div className="relative z-10 text-center px-4">
        {/* 头像 */}
        <motion.div
          initial={{ scale: 0, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', duration: 0.8 }}
          className="relative inline-block mb-8"
        >
          {/* 光晕效果 */}
          <motion.div
            animate={{
              scale: [1, 1.1, 1],
              opacity: [0.5, 0.8, 0.5],
            }}
            transition={{
              duration: 3,
              repeat: Infinity,
              ease: 'easeInOut',
            }}
            className="absolute -inset-4 bg-gradient-to-br from-primary/40 to-purple-500/40 rounded-full blur-xl"
          />
          
          {/* 头像图片 */}
          <div className="relative w-32 h-32 md:w-40 md:h-40 rounded-full overflow-hidden ring-4 ring-white/20">
            <img
              src={author.avatar}
              alt={author.name}
              className="w-full h-full object-cover"
            />
          </div>
          
          {/* 在线状态指示器 */}
          <div className="absolute bottom-2 right-2 w-5 h-5 bg-green-500 rounded-full ring-4 ring-gray-900" />
        </motion.div>

        {/* 姓名 */}
        <motion.h1
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.2 }}
          className="text-4xl md:text-5xl font-bold text-white mb-4"
        >
          {author.name}
        </motion.h1>

        {/* 职业头衔 */}
        <motion.div
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.3 }}
          className="flex items-center justify-center gap-3 mb-6"
        >
          {author.titles?.map((title, index) => (
            <React.Fragment key={title}>
              {index > 0 && <span className="text-gray-500">|</span>}
              <span className="text-lg text-primary font-medium">{title}</span>
            </React.Fragment>
          ))}
        </motion.div>

        {/* 个性签名 */}
        <motion.p
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.4 }}
          className="text-xl text-gray-400 italic mb-6 max-w-2xl mx-auto"
        >
          "{author.signature}"
        </motion.p>

        {/* 位置 */}
        {author.location && (
          <motion.div
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="flex items-center justify-center gap-2 text-gray-500 mb-8"
          >
            <MapPin className="w-4 h-4" />
            <span>{author.location}</span>
          </motion.div>
        )}

        {/* 社交媒体链接 */}
        <motion.div
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.6 }}
          className="flex items-center justify-center gap-4"
        >
          {author.socialLinks?.map((link, index) => {
            const Icon = socialIcons[link.platform.toLowerCase()] || ExternalLink;
            
            return (
              <motion.a
                key={link.platform}
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ delay: 0.7 + index * 0.1 }}
                whileHover={{ scale: 1.1, y: -2 }}
                whileTap={{ scale: 0.95 }}
                className={cn(
                  'w-12 h-12 rounded-full flex items-center justify-center',
                  'bg-white/5 backdrop-blur-sm border border-white/10',
                  'text-gray-400 hover:text-white',
                  'hover:bg-white/10 hover:border-white/20',
                  'transition-all duration-300'
                )}
                title={link.platform}
              >
                <Icon className="w-5 h-5" />
              </motion.a>
            );
          })}
        </motion.div>
      </div>

      {/* 向下滚动提示 */}
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 1.5 }}
        className="absolute bottom-8 left-1/2 -translate-x-1/2"
      >
        <motion.div
          animate={{ y: [0, 8, 0] }}
          transition={{ duration: 1.5, repeat: Infinity }}
          className="w-6 h-10 rounded-full border-2 border-white/30 flex justify-center pt-2"
        >
          <motion.div className="w-1.5 h-3 bg-white/50 rounded-full" />
        </motion.div>
      </motion.div>
    </section>
  );
};
```

```tsx
// apps/blog/src/components/about/SkillSection.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@aetherblog/utils';

interface Skill {
  name: string;
  level: number; // 0-100
  icon?: string;
  color?: string;
}

interface SkillSectionProps {
  skills: Skill[];
  techStack: string[];
}

/**
 * 技能展示区域
 */
export const SkillSection: React.FC<SkillSectionProps> = ({
  skills,
  techStack,
}) => {
  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">技能专长</h2>
        <p className="text-gray-400 max-w-2xl mx-auto">
          持续学习，不断精进。以下是我的主要技术栈和熟练程度。
        </p>
      </motion.div>

      {/* 技能进度条 */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
        {skills.map((skill, index) => (
          <motion.div
            key={skill.name}
            initial={{ opacity: 0, x: index % 2 === 0 ? -20 : 20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: index * 0.1 }}
            className={cn(
              'p-6 rounded-xl',
              'bg-white/5 backdrop-blur-sm border border-white/10',
              'hover:bg-white/10 transition-colors duration-300'
            )}
          >
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                {skill.icon && (
                  <img src={skill.icon} alt={skill.name} className="w-8 h-8" />
                )}
                <span className="font-medium text-white">{skill.name}</span>
              </div>
              <span className="text-sm text-primary font-medium">
                {skill.level}%
              </span>
            </div>
            
            {/* 进度条 */}
            <div className="h-2 bg-gray-800 rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                whileInView={{ width: `${skill.level}%` }}
                viewport={{ once: true }}
                transition={{ duration: 1, delay: index * 0.1, ease: 'easeOut' }}
                className="h-full rounded-full"
                style={{
                  background: skill.color || 
                    `linear-gradient(90deg, #6366f1, #a855f7)`,
                }}
              />
            </div>
          </motion.div>
        ))}
      </div>

      {/* 技术标签云 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <h3 className="text-xl font-semibold text-white mb-6 text-center">
          技术标签云
        </h3>
        <div className="flex flex-wrap justify-center gap-3">
          {techStack.map((tech, index) => (
            <motion.span
              key={tech}
              initial={{ opacity: 0, scale: 0.8 }}
              whileInView={{ opacity: 1, scale: 1 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.03 }}
              whileHover={{ 
                scale: 1.1, 
                backgroundColor: 'rgba(99, 102, 241, 0.2)',
                borderColor: 'rgba(99, 102, 241, 0.5)',
              }}
              className={cn(
                'px-4 py-2 rounded-full',
                'text-sm font-medium',
                'bg-white/5 border border-white/10',
                'text-gray-300 hover:text-white',
                'cursor-default transition-all duration-200'
              )}
            >
              {tech}
            </motion.span>
          ))}
        </div>
      </motion.div>
    </section>
  );
};

export default SkillSection;
```

```tsx
// apps/blog/src/components/about/SiteStats.tsx

'use client';

import React, { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { Calendar, FileText, BookOpen, Eye, Clock, Server } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface SiteStatsProps {
  stats: {
    createdAt: string;
    postCount: number;
    totalWords: number;
    totalViews: number;
  };
  siteInfo: {
    name: string;
    description: string;
    techStack?: string;
    hosting?: string;
    cdn?: string;
  };
}

/**
 * 统计数据项组件
 */
const StatItem: React.FC<{
  icon: React.ReactNode;
  label: string;
  value: string | number;
  suffix?: string;
  index: number;
}> = ({ icon, label, value, suffix, index }) => {
  const [displayValue, setDisplayValue] = useState(0);
  const numericValue = typeof value === 'number' ? value : parseInt(value) || 0;

  // 数字动画效果
  useEffect(() => {
    const duration = 2000;
    const steps = 60;
    const stepDuration = duration / steps;
    const increment = numericValue / steps;
    
    let current = 0;
    const timer = setInterval(() => {
      current += increment;
      if (current >= numericValue) {
        setDisplayValue(numericValue);
        clearInterval(timer);
      } else {
        setDisplayValue(Math.floor(current));
      }
    }, stepDuration);

    return () => clearInterval(timer);
  }, [numericValue]);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true }}
      transition={{ delay: index * 0.1 }}
      whileHover={{ scale: 1.05, y: -5 }}
      className={cn(
        'flex flex-col items-center p-6 rounded-xl',
        'bg-white/5 backdrop-blur-sm border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300'
      )}
    >
      <div className="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center mb-4">
        {icon}
      </div>
      <div className="text-3xl font-bold text-white mb-1">
        {typeof value === 'number' ? displayValue.toLocaleString() : value}
        {suffix && <span className="text-lg text-gray-400">{suffix}</span>}
      </div>
      <div className="text-sm text-gray-400">{label}</div>
    </motion.div>
  );
};

/**
 * 站点统计与信息区域
 */
export const SiteStats: React.FC<SiteStatsProps> = ({ stats, siteInfo }) => {
  // 计算运行天数
  const calculateRunningDays = () => {
    const created = new Date(stats.createdAt);
    const now = new Date();
    const diff = now.getTime() - created.getTime();
    return Math.floor(diff / (1000 * 60 * 60 * 24));
  };

  const runningDays = calculateRunningDays();

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">关于本站</h2>
        <p className="text-gray-400 max-w-2xl mx-auto">
          {siteInfo.description}
        </p>
      </motion.div>

      {/* 统计数据卡片 */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
        <StatItem
          icon={<Calendar className="w-6 h-6 text-primary" />}
          label="运行天数"
          value={runningDays}
          suffix="+"
          index={0}
        />
        <StatItem
          icon={<FileText className="w-6 h-6 text-primary" />}
          label="文章总数"
          value={stats.postCount}
          index={1}
        />
        <StatItem
          icon={<BookOpen className="w-6 h-6 text-primary" />}
          label="总字数"
          value={Math.floor(stats.totalWords / 10000)}
          suffix="万+"
          index={2}
        />
        <StatItem
          icon={<Eye className="w-6 h-6 text-primary" />}
          label="总访问量"
          value={Math.floor(stats.totalViews / 10000)}
          suffix="万+"
          index={3}
        />
      </div>

      {/* 站点信息详情 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 站点愿景 */}
        <div className="text-center mb-8">
          <motion.p
            initial={{ opacity: 0 }}
            whileInView={{ opacity: 1 }}
            viewport={{ once: true }}
            transition={{ delay: 0.3 }}
            className="text-xl text-gray-300 italic"
          >
            「让每一篇博客都成为艺术品，让每一次创作都有 AI 相伴」
          </motion.p>
        </div>

        {/* 技术信息 */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {/* 技术栈 */}
          {siteInfo.techStack && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.4 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                <Server className="w-5 h-5 text-blue-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">技术栈</div>
                <div className="text-white text-sm">{siteInfo.techStack}</div>
              </div>
            </motion.div>
          )}

          {/* 托管 */}
          {siteInfo.hosting && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.5 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
                <Server className="w-5 h-5 text-green-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">托管于</div>
                <div className="text-white text-sm">{siteInfo.hosting}</div>
              </div>
            </motion.div>
          )}

          {/* CDN */}
          {siteInfo.cdn && (
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.6 }}
              className="flex items-start gap-3"
            >
              <div className="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center flex-shrink-0">
                <Clock className="w-5 h-5 text-orange-400" />
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-1">CDN</div>
                <div className="text-white text-sm">{siteInfo.cdn}</div>
              </div>
            </motion.div>
          )}
        </div>

        {/* 创建时间 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.7 }}
          className="mt-8 pt-6 border-t border-white/10 text-center"
        >
          <p className="text-sm text-gray-500">
            本站创建于{' '}
            <span className="text-gray-300">
              {new Date(stats.createdAt).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </span>
            ，基于{' '}
            <span className="text-primary font-medium">AetherBlog</span> 构建
          </p>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default SiteStats;
```

```tsx
// apps/blog/src/components/about/CopyrightSection.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@aetherblog/utils';

interface CopyrightSectionProps {
  copyright: {
    type: 'CC-BY-NC-SA' | 'CC-BY-NC-ND' | 'CC-BY-SA' | 'CC-BY' | 'CUSTOM';
    customText?: string;
  };
}

/**
 * CC 协议信息
 */
const ccLicenses: Record<string, { name: string; description: string; url: string; badges: string[] }> = {
  'CC-BY-NC-SA': {
    name: 'CC BY-NC-SA 4.0',
    description: '署名-非商业性使用-相同方式共享 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh',
    badges: ['BY', 'NC', 'SA'],
  },
  'CC-BY-NC-ND': {
    name: 'CC BY-NC-ND 4.0',
    description: '署名-非商业性使用-禁止演绎 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh',
    badges: ['BY', 'NC', 'ND'],
  },
  'CC-BY-SA': {
    name: 'CC BY-SA 4.0',
    description: '署名-相同方式共享 4.0 国际',
    url: 'https://creativecommons.org/licenses/by-sa/4.0/deed.zh',
    badges: ['BY', 'SA'],
  },
  'CC-BY': {
    name: 'CC BY 4.0',
    description: '署名 4.0 国际',
    url: 'https://creativecommons.org/licenses/by/4.0/deed.zh',
    badges: ['BY'],
  },
};

/**
 * CC 徽章 SVG 图标
 */
const CCBadge: React.FC<{ type: string }> = ({ type }) => {
  const badges: Record<string, JSX.Element> = {
    BY: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 6a3 3 0 100 6 3 3 0 000-6zM7 17c0-2.5 2.5-4 5-4s5 1.5 5 4" fill="none" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    NC: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <text x="12" y="16" textAnchor="middle" fontSize="10" fill="currentColor">$</text>
        <line x1="6" y1="18" x2="18" y2="6" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    SA: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 7c-3 0-5 2-5 5s2 5 5 5 5-2 5-5" fill="none" stroke="currentColor" strokeWidth="2" />
        <path d="M12 10l2.5 2.5L12 15" fill="none" stroke="currentColor" strokeWidth="2" />
      </svg>
    ),
    ND: (
      <svg viewBox="0 0 24 24" className="w-6 h-6">
        <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
        <text x="12" y="16" textAnchor="middle" fontSize="10" fill="currentColor">=</text>
      </svg>
    ),
  };

  return badges[type] || null;
};

/**
 * 版权声明区域
 */
export const CopyrightSection: React.FC<CopyrightSectionProps> = ({ copyright }) => {
  const license = ccLicenses[copyright.type];

  if (copyright.type === 'CUSTOM' && copyright.customText) {
    return (
      <section>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          className="text-center mb-8"
        >
          <h2 className="text-3xl font-bold text-white mb-4">版权声明</h2>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ delay: 0.2 }}
          className={cn(
            'p-8 rounded-2xl text-center',
            'bg-white/5 backdrop-blur-sm border border-white/10'
          )}
        >
          <p className="text-gray-300 leading-relaxed">{copyright.customText}</p>
        </motion.div>
      </section>
    );
  }

  if (!license) return null;

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-8"
      >
        <h2 className="text-3xl font-bold text-white mb-4">版权声明</h2>
      </motion.div>

      {/* 版权卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <div className="flex flex-col md:flex-row items-center gap-8">
          {/* CC 图标 */}
          <motion.a
            href={license.url}
            target="_blank"
            rel="noopener noreferrer"
            whileHover={{ scale: 1.05 }}
            className="flex items-center gap-3 text-gray-400 hover:text-white transition-colors"
          >
            {/* CC Logo */}
            <svg viewBox="0 0 24 24" className="w-10 h-10">
              <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" strokeWidth="2" />
              <text x="12" y="16" textAnchor="middle" fontSize="12" fontWeight="bold" fill="currentColor">CC</text>
            </svg>
            
            {/* License Badges */}
            {license.badges.map((badge) => (
              <CCBadge key={badge} type={badge} />
            ))}
          </motion.a>

          {/* 说明文字 */}
          <div className="flex-1 text-center md:text-left">
            <h3 className="text-lg font-semibold text-white mb-2">
              {license.name}
            </h3>
            <p className="text-gray-400 text-sm mb-4">
              {license.description}
            </p>
            <div className="space-y-2 text-sm text-gray-500">
              <p>本站所有原创内容均采用此协议进行许可。</p>
              <p>• 转载请注明出处并保留原文链接</p>
              {copyright.type.includes('NC') && <p>• 禁止用于商业用途</p>}
              {copyright.type.includes('ND') && <p>• 禁止演绎（修改）作品</p>}
              {copyright.type.includes('SA') && <p>• 演绎作品需采用相同协议</p>}
            </div>
          </div>
        </div>

        {/* 查看协议链接 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.4 }}
          className="mt-6 pt-6 border-t border-white/10 text-center"
        >
          <a
            href={license.url}
            target="_blank"
            rel="noopener noreferrer"
            className="inline-flex items-center gap-2 text-primary hover:text-primary/80 text-sm transition-colors"
          >
            查看协议详情
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default CopyrightSection;
```

```tsx
// apps/blog/src/components/about/AboutContent.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { MarkdownRenderer } from '@aetherblog/editor';
import { cn } from '@aetherblog/utils';

interface AboutContentProps {
  content: string;
}

/**
 * 关于我内容区域
 */
export const AboutContent: React.FC<AboutContentProps> = ({ content }) => {
  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">关于我</h2>
        <div className="w-24 h-1 bg-gradient-to-r from-primary to-purple-500 mx-auto rounded-full" />
      </motion.div>

      {/* 内容区域 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        <MarkdownRenderer content={content} />
      </motion.div>
    </section>
  );
};

export default AboutContent;
```

---

### 3.1.9 友链页面模块

#### 3.1.9.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        友链页面功能规格                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能概述                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   友链页面用于展示与本站互换链接的友情站点，通过精美的卡片设计展示                                     │ │
│   │   友站信息，促进博客圈的交流互动。支持自定义主题色、分组展示等功能。                                   │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      功能清单                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   【友链展示】                                                                                      │ │
│   │   ├── 精美卡片式布局                                                                               │ │
│   │   ├── 站点名称                                                                                     │ │
│   │   ├── 站点头像/Logo                                                                                │ │
│   │   ├── 站点描述                                                                                     │ │
│   │   ├── 站点链接                                                                                     │ │
│   │   ├── 自定义主题色                                                                                 │ │
│   │   ├── RSS 订阅链接（可选）                                                                          │ │
│   │   └── 邮箱联系（可选）                                                                              │ │
│   │                                                                                                    │ │
│   │   【友链分组】                                                                                      │ │
│   │   ├── 按分类分组展示（如：技术博客、生活博客等）                                                     │ │
│   │   └── 分组折叠/展开                                                                                │ │
│   │                                                                                                    │ │
│   │   【友链申请】                                                                                      │ │
│   │   ├── 申请表单（站点名称、地址、描述、头像等）                                                       │ │
│   │   ├── 本站信息展示（方便对方添加）                                                                  │ │
│   │   └── 申请须知说明                                                                                 │ │
│   │                                                                                                    │ │
│   │   【交互效果】                                                                                      │ │
│   │   ├── 卡片悬浮动效                                                                                 │ │
│   │   ├── 主题色光晕效果                                                                               │ │
│   │   ├── 加载动画                                                                                     │ │
│   │   └── 随机排序/固定排序                                                                            │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.1.9.2 页面组件实现

```tsx
// apps/blog/src/app/friends/page.tsx (续)

import React from 'react';
import { Metadata } from 'next';
import { FriendsHero } from '@/components/friends/FriendsHero';
import { FriendGrid } from '@/components/friends/FriendCard';
import { FriendApplySection } from '@/components/friends/FriendApplySection';
import { MySiteInfo } from '@/components/friends/MySiteInfo';
import { getFriendLinks, getSiteSettings } from '@/lib/api';
import type { FriendLink } from '@aetherblog/types';

export const metadata: Metadata = {
  title: '友链 - AetherBlog',
  description: '友情链接，一起交流学习',
};

/**
 * 友链分组类型
 */
interface FriendGroup {
  name: string;
  description?: string;
  friends: FriendLink[];
}

export default async function FriendsPage() {
  const [friends, siteSettings] = await Promise.all([
    getFriendLinks(),
    getSiteSettings(),
  ]);

  // 按分组组织友链
  const groupedFriends = groupFriendsByCategory(friends);

  // 本站信息（用于友链申请展示）
  const mySiteInfo = {
    name: siteSettings.siteName,
    url: siteSettings.siteUrl,
    avatar: siteSettings.logo,
    description: siteSettings.description,
    email: siteSettings.email,
  };

  return (
    <main className="min-h-screen bg-gray-950">
      {/* 友链页面 Hero */}
      <FriendsHero 
        title="友情链接"
        subtitle="海内存知己，天涯若比邻"
        description="这里是我欣赏的博主们，感谢你们的精彩内容"
        totalCount={friends.length}
      />

      {/* 友链内容区域 */}
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        {/* 分组展示友链 */}
        <div className="space-y-16">
          {groupedFriends.map((group, index) => (
            <FriendGroupSection 
              key={group.name} 
              group={group} 
              index={index}
            />
          ))}
        </div>

        {/* 分隔线 */}
        <div className="my-20">
          <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
        </div>

        {/* 本站信息 */}
        <MySiteInfo siteInfo={mySiteInfo} />

        {/* 分隔线 */}
        <div className="my-20">
          <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent" />
        </div>

        {/* 友链申请区域 */}
        <FriendApplySection 
          requirements={siteSettings.friendLinkRequirements}
          email={siteSettings.email}
        />
      </div>
    </main>
  );
}

/**
 * 友链分组组件
 */
const FriendGroupSection: React.FC<{
  group: FriendGroup;
  index: number;
}> = ({ group, index }) => {
  return (
    <section>
      {/* 分组标题 */}
      <div className="mb-8">
        <h2 className="text-2xl font-bold text-white mb-2">
          {group.name}
          <span className="ml-3 text-sm font-normal text-gray-500">
            ({group.friends.length})
          </span>
        </h2>
        {group.description && (
          <p className="text-gray-400">{group.description}</p>
        )}
      </div>

      {/* 友链卡片网格 */}
      <FriendGrid friends={group.friends} />
    </section>
  );
};

/**
 * 将友链按分类分组
 */
function groupFriendsByCategory(friends: FriendLink[]): FriendGroup[] {
  const groupMap = new Map<string, FriendLink[]>();
  
  // 分组
  friends.forEach(friend => {
    const category = friend.category || '友情链接';
    if (!groupMap.has(category)) {
      groupMap.set(category, []);
    }
    groupMap.get(category)!.push(friend);
  });

  // 转换为数组并排序
  const groups: FriendGroup[] = [];
  
  // 预定义分组顺序
  const categoryOrder = ['推荐博客', '技术博客', '生活博客', '友情链接', '其他'];
  
  categoryOrder.forEach(category => {
    if (groupMap.has(category)) {
      groups.push({
        name: category,
        friends: groupMap.get(category)!,
      });
      groupMap.delete(category);
    }
  });

  // 添加剩余分组
  groupMap.forEach((friends, name) => {
    groups.push({ name, friends });
  });

  return groups;
}
```

```tsx
// apps/blog/src/components/friends/FriendsHero.tsx

'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { Link2, Users, Heart, Sparkles } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface FriendsHeroProps {
  title: string;
  subtitle?: string;
  description?: string;
  totalCount: number;
}

/**
 * 友链页面 Hero 区域
 */
export const FriendsHero: React.FC<FriendsHeroProps> = ({
  title,
  subtitle,
  description,
  totalCount,
}) => {
  return (
    <section className="relative overflow-hidden">
      {/* 背景装饰 */}
      <div className="absolute inset-0">
        {/* 渐变背景 */}
        <div className="absolute inset-0 bg-gradient-to-b from-primary/10 via-gray-950 to-gray-950" />
        
        {/* 网格背景 */}
        <div 
          className="absolute inset-0 opacity-20"
          style={{
            backgroundImage: `
              linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px)
            `,
            backgroundSize: '50px 50px',
          }}
        />

        {/* 浮动装饰元素 */}
        <motion.div
          animate={{
            y: [0, -20, 0],
            rotate: [0, 5, 0],
          }}
          transition={{
            duration: 6,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute top-20 left-[15%] w-16 h-16 rounded-full bg-primary/20 blur-xl"
        />
        <motion.div
          animate={{
            y: [0, 20, 0],
            rotate: [0, -5, 0],
          }}
          transition={{
            duration: 8,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute top-40 right-[20%] w-24 h-24 rounded-full bg-purple-500/20 blur-xl"
        />
        <motion.div
          animate={{
            y: [0, 15, 0],
          }}
          transition={{
            duration: 5,
            repeat: Infinity,
            ease: 'easeInOut',
          }}
          className="absolute bottom-20 left-[30%] w-20 h-20 rounded-full bg-cyan-500/20 blur-xl"
        />
      </div>

      {/* 内容 */}
      <div className="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-24 text-center">
        {/* 图标 */}
        <motion.div
          initial={{ opacity: 0, scale: 0.5 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.5 }}
          className="mb-8"
        >
          <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/20 ring-1 ring-primary/30">
            <Link2 className="w-10 h-10 text-primary" />
          </div>
        </motion.div>

        {/* 标题 */}
        <motion.h1
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
          className="text-4xl md:text-5xl font-bold text-white mb-4"
        >
          {title}
        </motion.h1>

        {/* 副标题 */}
        {subtitle && (
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="text-xl text-primary italic mb-4"
          >
            「{subtitle}」
          </motion.p>
        )}

        {/* 描述 */}
        {description && (
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="text-gray-400 max-w-2xl mx-auto mb-8"
          >
            {description}
          </motion.p>
        )}

        {/* 统计信息 */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="flex items-center justify-center gap-8"
        >
          <div className="flex items-center gap-2 text-gray-400">
            <Users className="w-5 h-5" />
            <span>
              已收录 <span className="text-white font-semibold">{totalCount}</span> 位小伙伴
            </span>
          </div>
          <div className="flex items-center gap-2 text-gray-400">
            <Heart className="w-5 h-5 text-red-400" />
            <span>互相学习，共同成长</span>
          </div>
        </motion.div>

        {/* 滚动提示 */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 1 }}
          className="absolute bottom-8 left-1/2 -translate-x-1/2"
        >
          <motion.div
            animate={{ y: [0, 8, 0] }}
            transition={{ duration: 1.5, repeat: Infinity }}
            className="flex flex-col items-center gap-2 text-gray-500"
          >
            <Sparkles className="w-4 h-4" />
            <div className="w-px h-8 bg-gradient-to-b from-gray-500 to-transparent" />
          </motion.div>
        </motion.div>
      </div>
    </section>
  );
};

export default FriendsHero;
```

```tsx
// apps/blog/src/components/friends/MySiteInfo.tsx

'use client';

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { Copy, Check, Globe, Mail, Rss, ExternalLink } from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useCopyToClipboard } from '@aetherblog/hooks';

interface MySiteInfoProps {
  siteInfo: {
    name: string;
    url: string;
    avatar: string;
    description: string;
    email?: string;
    rss?: string;
  };
}

/**
 * 本站信息组件
 * 
 * 用于展示本站信息，方便对方添加友链
 */
export const MySiteInfo: React.FC<MySiteInfoProps> = ({ siteInfo }) => {
  const [copiedField, setCopiedField] = useState<string | null>(null);
  const [, copy] = useCopyToClipboard();

  const handleCopy = async (field: string, value: string) => {
    await copy(value);
    setCopiedField(field);
    setTimeout(() => setCopiedField(null), 2000);
  };

  // 信息项
  const infoItems = [
    { key: 'name', label: '站点名称', value: siteInfo.name },
    { key: 'url', label: '站点地址', value: siteInfo.url },
    { key: 'avatar', label: '站点头像', value: siteInfo.avatar },
    { key: 'description', label: '站点描述', value: siteInfo.description },
  ];

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">本站信息</h2>
        <p className="text-gray-400">欢迎添加本站为友链，以下是本站信息</p>
      </motion.div>

      {/* 信息卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto p-8 rounded-2xl',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 站点预览卡片 */}
        <div className="flex items-center gap-6 mb-8 p-6 rounded-xl bg-black/30 border border-white/5">
          {/* 头像 */}
          <div className="relative flex-shrink-0">
            <div className="absolute -inset-1 rounded-full bg-primary/30 blur-sm" />
            <img
              src={siteInfo.avatar}
              alt={siteInfo.name}
              className="relative w-20 h-20 rounded-full object-cover ring-2 ring-white/20"
            />
          </div>

          {/* 信息 */}
          <div className="flex-1 min-w-0">
            <h3 className="text-xl font-bold text-white mb-1">{siteInfo.name}</h3>
            <p className="text-gray-400 text-sm mb-3 line-clamp-2">
              {siteInfo.description}
            </p>
            <div className="flex items-center gap-4">
              <a
                href={siteInfo.url}
                target="_blank"
                rel="noopener noreferrer"
                className="flex items-center gap-1.5 text-sm text-primary hover:text-primary/80 transition-colors"
              >
                <Globe className="w-4 h-4" />
                <span className="truncate">{new URL(siteInfo.url).hostname}</span>
                <ExternalLink className="w-3 h-3" />
              </a>
              {siteInfo.email && (
                <a
                  href={`mailto:${siteInfo.email}`}
                  className="flex items-center gap-1.5 text-sm text-gray-400 hover:text-white transition-colors"
                >
                  <Mail className="w-4 h-4" />
                  <span>联系我</span>
                </a>
              )}
            </div>
          </div>
        </div>

        {/* 信息列表 */}
        <div className="space-y-4">
          {infoItems.map((item, index) => (
            <motion.div
              key={item.key}
              initial={{ opacity: 0, x: -20 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.1 }}
              className="flex items-center gap-4"
            >
              {/* 标签 */}
              <div className="w-24 flex-shrink-0">
                <span className="text-sm text-gray-500">{item.label}</span>
              </div>

              {/* 值 */}
              <div className="flex-1 min-w-0">
                <code
                  className={cn(
                    'block px-4 py-2 rounded-lg',
                    'bg-black/30 border border-white/5',
                    'text-sm text-gray-300 truncate',
                    'font-mono'
                  )}
                >
                  {item.value}
                </code>
              </div>

              {/* 复制按钮 */}
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => handleCopy(item.key, item.value)}
                className={cn(
                  'flex-shrink-0 p-2 rounded-lg',
                  'transition-colors duration-200',
                  copiedField === item.key
                    ? 'bg-green-500/20 text-green-400'
                    : 'bg-white/5 text-gray-400 hover:text-white hover:bg-white/10'
                )}
              >
                {copiedField === item.key ? (
                  <Check className="w-4 h-4" />
                ) : (
                  <Copy className="w-4 h-4" />
                )}
              </motion.button>
            </motion.div>
          ))}
        </div>

        {/* 一键复制全部 */}
        <motion.div
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.5 }}
          className="mt-8 pt-6 border-t border-white/10"
        >
          <button
            onClick={() => {
              const allInfo = `站点名称：${siteInfo.name}\n站点地址：${siteInfo.url}\n站点头像：${siteInfo.avatar}\n站点描述：${siteInfo.description}`;
              handleCopy('all', allInfo);
            }}
            className={cn(
              'w-full py-3 rounded-xl font-medium',
              'transition-all duration-200',
              copiedField === 'all'
                ? 'bg-green-500/20 text-green-400 border border-green-500/30'
                : 'bg-primary/20 text-primary border border-primary/30 hover:bg-primary/30'
            )}
          >
            {copiedField === 'all' ? '已复制全部信息 ✓' : '一键复制全部信息'}
          </button>
        </motion.div>
      </motion.div>
    </section>
  );
};

export default MySiteInfo;
```

```tsx
// apps/blog/src/components/friends/FriendApplySection.tsx

'use client';

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Send, 
  CheckCircle, 
  AlertCircle, 
  Loader2,
  ChevronDown,
  ChevronUp,
  Globe,
  Image,
  FileText,
  Mail,
  User,
} from 'lucide-react';
import { cn } from '@aetherblog/utils';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

interface FriendApplyProps {
  requirements?: string[];
  email?: string;
}

/**
 * 友链申请表单 Schema
 */
const applySchema = z.object({
  name: z.string().min(1, '请输入站点名称').max(50, '站点名称不能超过50个字符'),
  url: z.string().url('请输入有效的网址'),
  avatar: z.string().url('请输入有效的头像地址'),
  description: z.string().min(1, '请输入站点描述').max(200, '站点描述不能超过200个字符'),
  email: z.string().email('请输入有效的邮箱地址'),
  remark: z.string().max(500, '备注不能超过500个字符').optional(),
});

type ApplyFormData = z.infer<typeof applySchema>;

/**
 * 友链申请区域
 */
export const FriendApplySection: React.FC<FriendApplyProps> = ({
  requirements = [],
  email,
}) => {
  const [isExpanded, setIsExpanded] = useState(false);
  const [submitStatus, setSubmitStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');
  const [errorMessage, setErrorMessage] = useState('');

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<ApplyFormData>({
    resolver: zodResolver(applySchema),
  });

  // 默认申请须知
  const defaultRequirements = [
    '您的站点需要有一定的原创内容',
    '站点需要稳定运行，能够正常访问',
    '站点内容健康，无违法违规信息',
    '请先添加本站链接后再申请',
    '审核通过后会通过邮件通知',
  ];

  const displayRequirements = requirements.length > 0 ? requirements : defaultRequirements;

  // 提交表单
  const onSubmit = async (data: ApplyFormData) => {
    setSubmitStatus('loading');
    setErrorMessage('');

    try {
      const response = await fetch('/api/friend-link/apply', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || '提交失败');
      }

      setSubmitStatus('success');
      reset();
      
      // 5秒后重置状态
      setTimeout(() => {
        setSubmitStatus('idle');
      }, 5000);
    } catch (error: any) {
      setSubmitStatus('error');
      setErrorMessage(error.message || '提交失败，请稍后重试');
    }
  };

  return (
    <section>
      {/* 标题 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="text-center mb-12"
      >
        <h2 className="text-3xl font-bold text-white mb-4">友链申请</h2>
        <p className="text-gray-400">欢迎与本站交换友链，互相学习</p>
      </motion.div>

      {/* 申请须知 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.1 }}
        className={cn(
          'max-w-3xl mx-auto mb-8 p-6 rounded-xl',
          'bg-amber-500/10 border border-amber-500/20'
        )}
      >
        <h3 className="text-lg font-semibold text-amber-400 mb-4 flex items-center gap-2">
          <AlertCircle className="w-5 h-5" />
          申请须知
        </h3>
        <ul className="space-y-2">
          {displayRequirements.map((req, index) => (
            <motion.li
              key={index}
              initial={{ opacity: 0, x: -10 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.05 }}
              className="flex items-start gap-2 text-gray-300"
            >
              <span className="w-5 h-5 flex-shrink-0 flex items-center justify-center rounded-full bg-amber-500/20 text-amber-400 text-xs">
                {index + 1}
              </span>
              <span>{req}</span>
            </motion.li>
          ))}
        </ul>
      </motion.div>

      {/* 申请表单卡片 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ delay: 0.2 }}
        className={cn(
          'max-w-3xl mx-auto rounded-2xl overflow-hidden',
          'bg-white/5 backdrop-blur-sm border border-white/10'
        )}
      >
        {/* 折叠头部 */}
        <button
          onClick={() => setIsExpanded(!isExpanded)}
          className="w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors"
        >
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
              <Send className="w-5 h-5 text-primary" />
            </div>
            <div className="text-left">
              <h3 className="text-lg font-semibold text-white">提交友链申请</h3>
              <p className="text-sm text-gray-400">点击展开申请表单</p>
            </div>
          </div>
          <motion.div
            animate={{ rotate: isExpanded ? 180 : 0 }}
            transition={{ duration: 0.2 }}
          >
            <ChevronDown className="w-5 h-5 text-gray-400" />
          </motion.div>
        </button>

        {/* 表单内容 */}
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: 'auto', opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              transition={{ duration: 0.3 }}
              className="overflow-hidden"
            >
              <form onSubmit={handleSubmit(onSubmit)} className="p-6 pt-0 space-y-6">
                {/* 站点名称 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <User className="w-4 h-4" />
                    站点名称 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('name')}
                    placeholder="例如：AetherBlog"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.name ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.name && (
                    <p className="mt-1 text-sm text-red-400">{errors.name.message}</p>
                  )}
                </div>

                {/* 站点地址 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Globe className="w-4 h-4" />
                    站点地址 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('url')}
                    placeholder="https://example.com"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.url ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.url && (
                    <p className="mt-1 text-sm text-red-400">{errors.url.message}</p>
                  )}
                </div>

                {/* 站点头像 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Image className="w-4 h-4" />
                    站点头像 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('avatar')}
                    placeholder="https://example.com/avatar.png"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.avatar ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.avatar && (
                    <p className="mt-1 text-sm text-red-400">{errors.avatar.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    建议使用正方形图片，推荐尺寸 200x200 像素
                  </p>
                </div>

                {/* 站点描述 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <FileText className="w-4 h-4" />
                    站点描述 <span className="text-red-400">*</span>
                  </label>
                  <textarea
                    {...register('description')}
                    placeholder="简单介绍一下您的站点..."
                    rows={3}
                    className={cn(
                      'w-full px-4 py-3 rounded-xl resize-none',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.description ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.description && (
                    <p className="mt-1 text-sm text-red-400">{errors.description.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    不超过 200 个字符
                  </p>
                </div>

                {/* 联系邮箱 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <Mail className="w-4 h-4" />
                    联系邮箱 <span className="text-red-400">*</span>
                  </label>
                  <input
                    {...register('email')}
                    type="email"
                    placeholder="your@email.com"
                    className={cn(
                      'w-full px-4 py-3 rounded-xl',
                      'bg-black/30 border',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50',
                      'transition-all duration-200',
                      errors.email ? 'border-red-500/50' : 'border-white/10 focus:border-primary/50'
                    )}
                  />
                  {errors.email && (
                    <p className="mt-1 text-sm text-red-400">{errors.email.message}</p>
                  )}
                  <p className="mt-1 text-xs text-gray-500">
                    用于接收审核结果通知
                  </p>
                </div>

                {/* 备注 */}
                <div>
                  <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                    <FileText className="w-4 h-4" />
                    备注（可选）
                  </label>
                  <textarea
                    {...register('remark')}
                    placeholder="有什么想说的可以写在这里..."
                    rows={2}
                    className={cn(
                      'w-full px-4 py-3 rounded-xl resize-none',
                      'bg-black/30 border border-white/10',
                      'text-white placeholder-gray-500',
                      'focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50',
                      'transition-all duration-200'
                    )}
                  />
                </div>

                {/* 提交按钮 */}
                <div className="pt-4">
                  <motion.button
                    type="submit"
                    disabled={submitStatus === 'loading' || submitStatus === 'success'}
                    whileHover={{ scale: submitStatus === 'idle' ? 1.02 : 1 }}
                    whileTap={{ scale: submitStatus === 'idle' ? 0.98 : 1 }}
                    className={cn(
                      'w-full py-4 rounded-xl font-semibold',
                      'flex items-center justify-center gap-2',
                      'transition-all duration-200',
                      submitStatus === 'idle' && 'bg-primary text-white hover:bg-primary/90',
                      submitStatus === 'loading' && 'bg-primary/50 text-white/70 cursor-not-allowed',
                      submitStatus === 'success' && 'bg-green-500 text-white cursor-not-allowed',
                      submitStatus === 'error' && 'bg-red-500 text-white'
                    )}
                  >
                    {submitStatus === 'idle' && (
                      <>
                        <Send className="w-5 h-5" />
                        提交申请
                      </>
                    )}
                    {submitStatus === 'loading' && (
                      <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        提交中...
                      </>
                    )}
                    {submitStatus === 'success' && (
                      <>
                        <CheckCircle className="w-5 h-5" />
                        提交成功！我们会尽快审核
                      </>
                    )}
                    {submitStatus === 'error' && (
                      <>
                        <AlertCircle className="w-5 h-5" />
                        {errorMessage || '提交失败，请重试'}
                      </>
                    )}
                  </motion.button>
                </div>
                {/* 提交按钮 */}
                <div className="pt-4">
                  <motion.button
                    type="submit"
                    disabled={submitStatus === 'loading' || submitStatus === 'success'}
                    whileHover={{ scale: submitStatus === 'idle' ? 1.02 : 1 }}
                    whileTap={{ scale: submitStatus === 'idle' ? 0.98 : 1 }}
                    className={cn(
                      'w-full py-4 rounded-xl font-semibold',
                      'flex items-center justify-center gap-2',
                      'transition-all duration-200',
                      submitStatus === 'idle' && 'bg-primary text-white hover:bg-primary/90',
                      submitStatus === 'loading' && 'bg-primary/50 text-white/70 cursor-not-allowed',
                      submitStatus === 'success' && 'bg-green-500 text-white cursor-not-allowed',
                      submitStatus === 'error' && 'bg-red-500 text-white'
                    )}
                  >
                    {submitStatus === 'idle' && (
                      <>
                        <Send className="w-5 h-5" />
                        提交申请
                      </>
                    )}
                    {submitStatus === 'loading' && (
                      <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        提交中...
                      </>
                    )}
                    {submitStatus === 'success' && (
                      <>
                        <CheckCircle className="w-5 h-5" />
                        提交成功！我们会尽快审核
                      </>
                    )}
                    {submitStatus === 'error' && (
                      <>
                        <AlertCircle className="w-5 h-5" />
                        {errorMessage || '提交失败，请重试'}
                      </>
                    )}
                  </motion.button>

                  {/* 错误重试提示 */}
                  {submitStatus === 'error' && (
                    <motion.p
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="mt-3 text-center text-sm text-gray-400"
                    >
                      遇到问题？您也可以直接
                      <a
                        href={`mailto:${email}?subject=友链申请`}
                        className="text-primary hover:underline mx-1"
                      >
                        发送邮件
                      </a>
                      申请
                    </motion.p>
                  )}
                </div>
              </form>
            </motion.div>
          )}
        </AnimatePresence>
      </motion.div>

      {/* 邮件申请备选方案 */}
      {email && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ delay: 0.3 }}
          className="max-w-3xl mx-auto mt-8 text-center"
        >
          <p className="text-gray-500 text-sm">
            不想填表单？也可以直接
            <a
              href={`mailto:${email}?subject=友链申请&body=站点名称：%0A站点地址：%0A站点头像：%0A站点描述：%0A`}
              className="text-primary hover:underline mx-1"
            >
              发送邮件
            </a>
            申请友链
          </p>
        </motion.div>
      )}
    </section>
  );
};

export default FriendApplySection;
```

---

## 3.2 内容管理后台模块

### 3.2.1 后台模块总览

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        管理后台功能模块总览                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   📊 仪表盘      │  │   📝 文章管理    │  │   🖼️ 媒体管理   │  │   📁 分类标签    │              │ │
│   │   │   Dashboard     │  │   Posts         │  │   Media         │  │   Categories    │              │ │
│   │   ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤              │ │
│   │   │ • 数据概览      │  │ • 文章列表      │  │ • 图片管理      │  │ • 分类管理      │              │ │
│   │   │ • 访问趋势      │  │ • 创建文章      │  │ • 附件管理      │  │ • 标签管理      │              │ │
│   │   │ • 热门文章      │  │ • 编辑文章      │  │ • 图床设置      │  │ • 批量操作      │              │ │
│   │   │ • 系统状态      │  │ • 批量操作      │  │ • 存储统计      │  │                 │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   📈 统计分析    │  │   🔗 友链管理    │  │   🤖 AI 工具    │  │   ⚙️ 系统设置   │              │ │
│   │   │   Analytics     │  │   Friends       │  │   AI Tools      │  │   Settings      │              │ │
│   │   ├─────────────────┤  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤              │ │
│   │   │ • 访客分析      │  │ • 友链列表      │  │ • 文本清洗      │  │ • 站点设置      │              │ │
│   │   │ • 内容分析      │  │ • 申请审核      │  │ • 内容重写      │  │ • 个人资料      │              │ │
│   │   │ • 设备分析      │  │ • 状态检测      │  │ • Prompt管理    │  │ • 存储配置      │              │ │
│   │   │ • 地域分布      │  │ • 批量管理      │  │ • 批量处理      │  │ • AI 配置       │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐                                                        │ │
│   │   │   📋 日志监控    │  │   💬 评论管理    │                                                        │ │
│   │   │   Logs          │  │   Comments      │                                                        │ │
│   │   ├─────────────────┤  ├─────────────────┤                                                        │ │
│   │   │ • 系统日志      │  │ • 评论列表      │                                                        │ │
│   │   │ • 操作日志      │  │ • 评论审核      │                                                        │ │
│   │   │ • 错误日志      │  │ • 回复管理      │                                                        │ │
│   │   │ • 性能监控      │  │ • 批量操作      │                                                        │ │
│   │   └─────────────────┘  └─────────────────┘                                                        │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.2.2 仪表盘模块

#### 3.2.2.1 功能规格

```text
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        仪表盘功能规格                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      数据概览卡片                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│   │   │   今日访问量     │  │   文章总数       │  │   总字数        │  │   评论数        │              │ │
│   │   │   1,234         │  │   128           │  │   32.5万        │  │   567           │              │ │
│   │   │   ↑ 12.5%       │  │   本周 +3       │  │   平均 2500/篇  │  │   待审核 5      │              │ │
│   │   └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      访问趋势图表                                                   │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │   • 折线图展示近7天/30天访问趋势                                                                    │ │
│   │   • 支持 PV/UV 切换显示                                                                            │ │
│   │   • 鼠标悬浮显示详细数据                                                                           │ │
│   │   • 支持时间范围选择                                                                               │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
│   ┌─────────────────────────────────────────────┐  ┌─────────────────────────────────────────────────┐   │
│   │              热门文章排行                    │  │              访客地域分布                        │   │
│   ├─────────────────────────────────────────────┤  ├─────────────────────────────────────────────────┤   │
│   │                                             │  │                                                 │   │
│   │  1. 深入理解JVM虚拟线程     1,234 views    │  │  中国地图热力图                                  │   │
│   │  2. Spring Boot 3新特性      987 views    │  │  • 省份访问量分布                                 │   │
│   │  3. React 19深度解析         856 views    │  │  • Top 10 城市列表                               │   │
│   │  4. PostgreSQL优化指南       743 views    │  │  • 海外访问占比                                   │   │
│   │  5. Docker最佳实践           654 views    │  │                                                 │   │
│   │                                             │  │                                                 │   │
│   └─────────────────────────────────────────────┘  └─────────────────────────────────────────────────┘   │
│                                                                                                          │
│   ┌─────────────────────────────────────────────┐  ┌─────────────────────────────────────────────────┐   │
│   │              设备类型占比                    │  │              系统状态监控                        │   │
│   ├─────────────────────────────────────────────┤  ├─────────────────────────────────────────────────┤   │
│   │                                             │  │                                                 │   │
│   │  饼图显示：                                  │  │  CPU 使用率: ████████░░ 78%                     │   │
│   │  • 桌面端: 65%                              │  │  内存使用: ██████░░░░ 56%                       │   │
│   │  • 移动端: 30%                              │  │  磁盘空间: ████░░░░░░ 35%                       │   │
│   │  • 平板: 5%                                 │  │  JVM 堆: ███████░░░ 67%                         │   │
│   │                                             │  │  虚拟线程: 1,234 活跃                           │   │
│   │                                             │  │  响应时间: 45ms 平均                            │   │
│   └─────────────────────────────────────────────┘  └─────────────────────────────────────────────────┘   │
│                                                                                                          │
│   ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│   │                                      最近动态                                                       │ │
│   ├────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│   │                                                                                                    │ │
│   │  时间线展示：                                                                                       │ │
│   │  • 10:30 发布文章《深入理解JVM虚拟线程》                                                            │ │
│   │  • 09:15 收到友链申请                                                                              │ │
│   │  • 08:45 新评论等待审核                                                                            │ │
│   │  • 昨天 系统自动备份完成                                                                           │ │
│   │                                                                                                    │ │
│   └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.2.2 页面组件实现

```tsx
// apps/admin/src/pages/dashboard/index.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { 
  Eye, 
  FileText, 
  BookOpen, 
  MessageSquare,
  TrendingUp,
  TrendingDown,
  Clock,
  AlertCircle,
} from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { analyticsService } from '@/services/analyticsService';

import { StatsCard } from './StatsCards';
import { VisitorChart } from './VisitorChart';
import { TopPosts } from './TopPosts';
import { GeoDistribution } from './GeoDistribution';
import { DeviceChart } from './DeviceChart';
import { SystemStatus } from './SystemStatus';
import { RecentActivity } from './RecentActivity';

/**
 * 仪表盘首页
 */
export default function DashboardPage() {
  // 获取统计数据
  const { data: overview, isLoading } = useQuery({
    queryKey: queryKeys.analytics.overview('today'),
    queryFn: () => analyticsService.getOverview('today'),
    refetchInterval: 60000, // 每分钟刷新
  });

  // 统计卡片数据
  const statsCards = [
    {
      title: '今日访问',
      value: overview?.todayViews || 0,
      change: overview?.viewsChange || 0,
      changeLabel: '较昨日',
      icon: Eye,
      color: 'primary',
    },
    {
      title: '文章总数',
      value: overview?.totalPosts || 0,
      change: overview?.newPostsThisWeek || 0,
      changeLabel: '本周新增',
      icon: FileText,
      color: 'green',
    },
    {
      title: '总字数',
      value: formatNumber(overview?.totalWords || 0),
      suffix: '字',
      subValue: `平均 ${overview?.avgWordsPerPost || 0} 字/篇`,
      icon: BookOpen,
      color: 'blue',
    },
    {
      title: '评论数',
      value: overview?.totalComments || 0,
      badge: overview?.pendingComments > 0 ? `${overview.pendingComments} 待审核` : undefined,
      icon: MessageSquare,
      color: 'orange',
    },
  ];

  return (
    <div className="p-6 space-y-6">
      {/* 页面标题 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">仪表盘</h1>
          <p className="text-gray-400 mt-1">欢迎回来，查看您的博客数据概览</p>
        </div>
        <div className="flex items-center gap-2 text-sm text-gray-500">
          <Clock className="w-4 h-4" />
          <span>数据更新于 {new Date().toLocaleTimeString()}</span>
        </div>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {statsCards.map((card, index) => (
          <motion.div
            key={card.title}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
          >
            <StatsCard {...card} isLoading={isLoading} />
          </motion.div>
        ))}
      </div>

      {/* 访问趋势图表 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.4 }}
      >
        <VisitorChart />
      </motion.div>

      {/* 双列布局：热门文章 + 地域分布 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
        >
          <TopPosts />
        </motion.div>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
        >
          <GeoDistribution />
        </motion.div>
      </div>

      {/* 双列布局：设备占比 + 系统状态 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.7 }}
        >
          <DeviceChart />
        </motion.div>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.8 }}
        >
          <SystemStatus />
        </motion.div>
      </div>

      {/* 最近动态 */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.9 }}
      >
        <RecentActivity />
      </motion.div>
    </div>
  );
}

/**
 * 格式化数字
 */
function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + '万';
  }
  return num.toLocaleString();
}
```

```tsx
// apps/admin/src/pages/dashboard/StatsCards.tsx

import React from 'react';
import { motion } from 'framer-motion';
import { TrendingUp, TrendingDown, LucideIcon } from 'lucide-react';
import { cn } from '@aetherblog/utils';

interface StatsCardProps {
  title: string;
  value: number | string;
  suffix?: string;
  change?: number;
  changeLabel?: string;
  subValue?: string;
  badge?: string;
  icon: LucideIcon;
  color: 'primary' | 'green' | 'blue' | 'orange' | 'red';
  isLoading?: boolean;
}

const colorMap = {
  primary: {
    bg: 'bg-primary/20',
    text: 'text-primary',
    border: 'border-primary/30',
  },
  green: {
    bg: 'bg-green-500/20',
    text: 'text-green-400',
    border: 'border-green-500/30',
  },
  blue: {
    bg: 'bg-blue-500/20',
    text: 'text-blue-400',
    border: 'border-blue-500/30',
  },
  orange: {
    bg: 'bg-orange-500/20',
    text: 'text-orange-400',
    border: 'border-orange-500/30',
  },
  red: {
    bg: 'bg-red-500/20',
    text: 'text-red-400',
    border: 'border-red-500/30',
  },
};

/**
 * 统计卡片组件
 */
export const StatsCard: React.FC<StatsCardProps> = ({
  title,
  value,
  suffix,
  change,
  changeLabel,
  subValue,
  badge,
  icon: Icon,
  color,
  isLoading,
}) => {
  const colors = colorMap[color];
  const isPositiveChange = change !== undefined && change >= 0;

  return (
    <div
      className={cn(
        'relative p-6 rounded-2xl overflow-hidden',
        'bg-white/5 backdrop-blur-sm',
        'border border-white/10',
        'hover:bg-white/10 hover:border-white/20',
        'transition-all duration-300'
      )}
    >
      {/* 背景装饰 */}
      <div
        className={cn(
          'absolute -top-10 -right-10 w-32 h-32 rounded-full blur-3xl opacity-20',
          colors.bg
        )}
      />

      {/* 内容 */}
      <div className="relative">
        {/* 头部：标题 + 图标 */}
        <div className="flex items-center justify-between mb-4">
          <span className="text-gray-400 text-sm font-medium">{title}</span>
          <div className={cn('p-2 rounded-lg', colors.bg)}>
            <Icon className={cn('w-5 h-5', colors.text)} />
          </div>
        </div>

        {/* 数值 */}
        {isLoading ? (
          <div className="h-9 w-24 bg-white/10 rounded animate-pulse" />
        ) : (
          <div className="flex items-baseline gap-1">
            <span className="text-3xl font-bold text-white">{value}</span>
            {suffix && <span className="text-lg text-gray-400">{suffix}</span>}
          </div>
        )}

        {/* 变化趋势 / 子信息 / 徽章 */}
        <div className="mt-3 flex items-center justify-between">
          {change !== undefined && (
            <div
              className={cn(
                'flex items-center gap-1 text-sm',
                isPositiveChange ? 'text-green-400' : 'text-red-400'
              )}
            >
              {isPositiveChange ? (
                <TrendingUp className="w-4 h-4" />
              ) : (
                <TrendingDown className="w-4 h-4" />
              )}
              <span>
                {isPositiveChange ? '+' : ''}
                {change}%
              </span>
              {changeLabel && (
                <span className="text-gray-500 ml-1">{changeLabel}</span>
              )}
            </div>
          )}

          {subValue && (
            <span className="text-sm text-gray-500">{subValue}</span>
          )}

          {badge && (
            <span
              className={cn(
                'px-2 py-0.5 rounded-full text-xs font-medium',
                'bg-orange-500/20 text-orange-400'
              )}
            >
              {badge}
            </span>
          )}
        </div>
      </div>
    </div>
  );
};
```

```tsx
// apps/admin/src/pages/dashboard/VisitorChart.tsx

import React, { useState } from 'react';
import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from 'recharts';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@aetherblog/utils';
import { queryKeys } from '@/lib/queryClient';
import { analyticsService } from '@/services/analyticsService';

type TimeRange = '7d' | '30d' | '90d';
type MetricType = 'pv' | 'uv';

/**
 * 访问趋势图表
 */
export const VisitorChart: React.FC = () => {
  const [timeRange, setTimeRange] = useState<TimeRange>('7d');
  const [metricType, setMetricType] = useState<MetricType>('pv');

  // 获取访问数据
  const { data, isLoading } = useQuery({
    queryKey: queryKeys.analytics.visitors({ range: timeRange }),
    queryFn: () => analyticsService.getVisitorTrend(timeRange),
  });

  const timeRangeOptions: { value: TimeRange; label: string }[] = [
    { value: '7d', label: '近7天' },
    { value: '30d', label: '近30天' },
    { value: '90d', label: '近90天' },
  ];

  const metricOptions: { value: MetricType; label: string }[] = [
    { value: 'pv', label: '访问量 (PV)' },
    { value: 'uv', label: '访客数 (UV)' },
  ];

  return (
    <div
      className={cn(
        'p-6 rounded-2xl',
        'bg-white/5 backdrop-blur-sm border border-white/10'
      )}
    >
      {/* 头部 */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <h3 className="text-lg font-semibold text-white">访问趋势</h3>

        <div className="flex items-center gap-4">
          {/* 指标类型切换 */
```