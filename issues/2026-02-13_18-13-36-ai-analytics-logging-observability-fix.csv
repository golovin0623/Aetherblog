id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
AIOB-000,P0,1,both,建立 AI 统计故障基线与验收口径,归档请求失败、空数据、静默降级、配置错误四类样本，并沉淀统一指标口径。基线作为后续修复和发布准入的唯一判据。,至少形成4类故障样本清单；定义看板可用率、日志接口成功率、空数据误判率三项指标；提供可复测步骤并完成一次复跑。,AUTOE2E,Review需确认样本覆盖 Admin、Server、AI Service 三段链路且指标可量化；禁止仅凭主观“看起来正常”。,回归需按同一清单逐项复测并记录结果；指标口径变更必须附变更原因与影响范围。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:16;plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:13;apps/admin/src/services/analyticsService.ts:156;apps/admin/src/pages/dashboard/DashboardPage.tsx:149;docs/qa/ai-analytics-observability-baseline-2026-02-13.md:1,picked_reason:优先建立统一故障样本与指标口径，作为后续P0修复和回归的验收基线。; review_initial:样本覆盖 Admin/Server/AI Service 三段链路，3项指标均可量化; validation_limited:AUTOE2E 需全栈联调与浏览器环境，当前仅完成静态链路复核; manual_test:./start.sh 后登录 Admin Dashboard，按文档第4节逐项复测 F001~F004 并记录指标; evidence:新增基线文档+执行 pnpm --filter @aetherblog/admin build + rg 故障锚点检索; risk:medium 未执行真实端到端联调流量回放，需在集成环境补测; done_at:2026-02-13
AIOB-010,P0,2,both,完成 Admin 到服务端到 AI 的契约审计,核对参数、分页、响应结构与错误码语义，收敛为单一契约清单并消除接口语义歧义。,产出一份契约表覆盖100% AI 统计与日志相关接口；字段命名、分页语义、错误分类在三端保持一致；发现差异均有处理结论。,AUTOE2E,Review需逐接口对照前端调用与后端签名，确认可空字段与默认值策略，避免“200但data语义不一致”。,回归需使用契约清单抽样联调，至少覆盖正常、空结果、参数非法、鉴权失败四类路径。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:17;apps/admin/src/services/analyticsService.ts:156;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/controller/StatsController.java:87;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/StatsService.java:89;apps/ai-service/app/api/routes/ai.py:64;docs/qa/ai-analytics-contract-audit-2026-02-13.md:1,picked_reason:优先完成三端契约收敛，避免后续修复在语义层反复返工。; review_initial:逐接口完成参数/分页/可空字段审计并对照三端签名; validation_limited:AUTOE2E 需全链路联调环境，本轮以契约审计+静态抽样替代; manual_test:启动全栈后按审计文档第5节执行正常/空结果/参数非法/鉴权失败四类抽样; evidence:新增契约审计文档并完成 Admin/Server/AI 路由与字段锚点核对; risk:medium 尚未在真实联调环境执行四类抽样流量; done_at:2026-02-13
AIOB-020,P0,3,backend,修复配置链与路由可达性自检,统一 AI 服务地址、Profile 加载、网关前缀与鉴权头传递，并在启动期增加关键依赖自检。,部署后关键接口健康检查通过率100%；base-url、前缀、鉴权配置异常可在启动或预检阶段被阻断并输出明确错误。,AUTOSERVER,Review需确认配置来源优先级与环境覆盖规则，避免多环境配置漂移；错误日志需包含可定位字段。,回归需在 dev/staging 至少两套配置执行 preflight；模拟错误配置并验证阻断与告警行为。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:18;apps/server/aetherblog-ai/ai-client/src/main/java/com/aetherblog/ai/client/config/AiServiceProperties.java:22;apps/server/aetherblog-ai/ai-client/src/main/resources/application-ai.yml:4;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/controller/SystemMonitorController.java:105;apps/server/aetherblog-ai/ai-client/src/main/java/com/aetherblog/ai/client/config/AiServicePreflightChecker.java:1;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/SystemMonitorService.java:817;apps/server/aetherblog-ai/ai-client/src/main/java/com/aetherblog/ai/client/client/AiServiceHttpClient.java:213;docs/qa/ai-config-preflight-checklist-2026-02-13.md:1,"picked_reason:先修配置链与启动自检，能直接阻断部署后不可达故障并为后续修复解阻。; review_initial:已核对配置优先级、base-url 约束、鉴权头传递与健康检查链路; validation_limited:未在 staging 环境执行双环境 preflight 联调，仅完成本地编译与静态校验; manual_test:分别设置 AI_SERVICE_URL 正常/错误前缀/不可达并切换 AI_PREFLIGHT_FAIL_FAST 后启动服务验证阻断行为; evidence:新增预检组件与配置项，系统健康新增 AI Service，mvn -pl aetherblog-ai/ai-client,aetherblog-service/blog-service -am -DskipTests compile 成功; risk:medium 缺少 dev/staging 双环境实流量演练，需发布前补测; done_at:2026-02-13"
AIOB-030,P0,4,backend,校正 ai_usage_logs 结构与历史回填一致性,核对迁移执行状态并补齐缺失迁移与幂等回填，修复字段长度、token 与 cost 历史数据一致性。,迁移版本对齐且可重复执行；ai_usage_logs 关键字段无非法空值；抽样校验 token/cost 回填准确；统计不再长期为0。,AUTOSERVER,Review需核查迁移脚本幂等性、回填范围与索引影响，避免全表更新导致长时间锁表。,回归需在含历史数据环境执行迁移演练并比对前后统计结果，确认查询性能无显著回退。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:19;apps/server/aetherblog-app/src/main/resources/db/migration/V2_10__ai_usage_logs.sql:2;apps/server/aetherblog-app/src/main/resources/db/migration/V2_18__enhance_ai_usage_analytics.sql:3;apps/server/aetherblog-app/src/main/resources/db/migration/V2_19__fix_ai_usage_backfill_and_lengths.sql:4;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/repository/AiUsageLogRepository.java:86;apps/server/aetherblog-app/src/main/resources/db/migration/V2_20__normalize_ai_usage_logs_tokens_cost_and_defaults.sql:1;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/repository/AiUsageLogRepository.java:18;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/StatsService.java:252;docs/qa/ai-usage-log-migration-checklist-2026-02-13.md:1,"picked_reason:先修数据结构与回填一致性，避免后续统计与埋点修复建立在脏数据上。; review_initial:已核查迁移幂等条件、回填范围和索引影响，未引入全表无条件更新锁表风险; validation_limited:未在含真实历史数据的独立环境执行完整迁移演练，仅完成编译与SQL校验; manual_test:在含历史数据库执行 flyway migrate 至 V2_20 后，按文档第3节SQL验证空值/total_tokens/cost与7天聚合，再对比迁移前后统计; evidence:新增V2_20迁移+统计fallback查询+迁移核对文档；执行 cd apps/server && mvn -pl aetherblog-app,aetherblog-service/blog-service -am -DskipTests compile 成功; risk:medium 真实历史数据体量下迁移耗时与锁影响待预发演练确认; done_at:2026-02-13"
AIOB-040,P0,5,both,增强埋点写入可靠性与可观测追踪,将埋点写入失败从仅 warning 升级为可追踪机制，补齐失败计数、采样明细、告警阈值和请求关联 ID。,埋点失败可被计数并按阈值触发告警；每条失败含 requestId 与 errorCategory；业务成功但埋点失败场景有明确降级语义。,AUTOSERVER,Review需确认告警采样与限流策略，避免日志风暴；埋点失败不应阻断主业务响应。,回归需注入数据库不可写与网络抖动故障，验证降级、计数与告警链路可用。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:20;apps/ai-service/app/api/routes/ai.py:64;apps/ai-service/app/services/usage_logger.py:91;apps/ai-service/app/services/usage_logger.py:114;apps/ai-service/app/api/routes/metrics.py:9;apps/ai-service/app/core/config.py:66;apps/ai-service/app/services/metrics.py:84;apps/ai-service/app/services/usage_logger.py:146;apps/ai-service/app/api/deps.py:112;docs/qa/ai-usage-log-failure-observability-2026-02-13.md:1;apps/ai-service/tests/test_usage_logger_metrics.py:27,picked_reason:先补齐埋点失败计数与告警语义，确保后续链路异常可观测且不再静默丢失。; review_initial:已核查失败采样限流策略与阈值告警，埋点失败仅记录降级不阻断主业务响应; validation_limited:全量 pytest 在当前 Python3.9 环境因既有 SQLAlchemy 注解兼容问题中断于 tests/test_models_imports.py，未完成整套回归; manual_test:制造 ai_usage_logs 不可写后调用 /api/v1/ai/summary，再查 /api/v1/admin/metrics/ai 验证 usage_logging 计数/分类/request_id/告警阈值与降级语义; evidence:新增 usage_logging 指标与阈值告警逻辑，执行 JWT_SECRET=test-secret POSTGRES_DSN=postgresql://localhost:5432/testdb python3 -m pytest -o addopts='' tests/test_usage_logger_metrics.py -q 通过(2 passed); 全量 pytest 复现既有环境兼容报错; risk:medium 真实数据库不可写与网络抖动注入尚未在集成环境完成联调，需按文档第4节补测; done_at:2026-02-13
AIOB-050,P0,6,backend,强化统计与日志接口的错误分层语义,完善聚合查询和日志读取参数边界与返回语义，明确区分“无数据”与“读取失败”，并统一诊断字段。,统计与日志接口在空结果和异常场景返回可区分语义；响应统一包含 traceId 或 errorCategory；分页边界参数有稳定行为。,AUTOSERVER,Review需统一错误码、文案和 HTTP 状态映射，避免前端误把失败当空数据处理。,回归需覆盖参数越界、日志文件不存在、DB 查询异常与鉴权失败，并验证前端可据此展示正确状态。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:21;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/StatsService.java:89;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/repository/AiUsageLogRepository.java:86;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/LogViewerService.java:61;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/controller/SystemMonitorController.java:105;apps/server/aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/domain/R.java:22;apps/server/aetherblog-common/common-core/src/main/java/com/aetherblog/common/core/exception/GlobalExceptionHandler.java:42;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/LogViewerService.java:96;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/controller/SystemMonitorController.java:106;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/StatsService.java:98;docs/qa/ai-stats-log-error-semantics-2026-02-13.md:1,"picked_reason:优先统一错误语义和边界参数，避免前端把异常误判为空数据。; review_initial:已统一错误码与HTTP语义映射并补充 errorCategory，日志空结果与读取失败语义可区分; validation_limited:未在真实环境完成日志文件句柄异常、DB查询异常与鉴权失败的全链路注入，仅完成编译与核心单测; manual_test:按 docs/qa/ai-stats-log-error-semantics-2026-02-13.md 第4节执行 logs 空文件/读失败与 ai-dashboard 边界参数回归; evidence:执行 cd apps/server && mvn -pl aetherblog-common/common-core,aetherblog-service/blog-service -am -DskipTests compile 成功；执行 mvn -pl aetherblog-common/common-core -Dtest=RecordConversionTest test 成功; risk:medium 需在集成环境补做日志读取故障注入与鉴权失败前端联调，验证展示分层语义; done_at:2026-02-13"
AIOB-060,P1,7,frontend,改造管理面板显式降级与重试体验,移除无感空 Mock 静默兜底，落地可感知降级态、一键重试、最后成功时间与诊断提示。,AI 看板与最近日志在失败场景显示明确降级态；支持一键重试；显示最后成功时间；恢复后状态自动回正。,AUTOFRONTEND,Review需确认不再默认写入 MOCK 数据掩盖故障；错误文案、按钮行为与 loading 态一致。,回归需覆盖 API 非200、超时、网络错误和恢复重连，确认用户可区分“暂无数据”与“系统异常”。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:22;apps/admin/src/pages/dashboard/DashboardPage.tsx:162;apps/admin/src/pages/dashboard/components/RealtimeLogViewer.tsx:60;apps/admin/src/services/systemService.ts:239;apps/admin/src/types/api.ts:8;apps/admin/src/services/systemService.ts:247;apps/admin/src/pages/dashboard/DashboardPage.tsx:60;apps/admin/src/pages/dashboard/DashboardPage.tsx:488;apps/admin/src/pages/dashboard/components/RealtimeLogViewer.tsx:33;apps/admin/src/pages/dashboard/components/RealtimeLogViewer.tsx:139;docs/qa/admin-ai-dashboard-degrade-retry-checklist-2026-02-13.md:1,picked_reason:先提升前端降级可见性与重试反馈，避免运维误判“空数据=正常”。; review_initial:已确认移除AI看板静默空Mock兜底，降级文案/状态徽标/重试按钮与loading态一致，日志面板同样提供显式状态; validation_limited:未在真实后端故障注入环境执行非200/超时/断网全链路演练，本轮以构建与代码路径审查为主; manual_test:按 docs/qa/admin-ai-dashboard-degrade-retry-checklist-2026-02-13.md 第3节模拟 AI 看板失败与日志空数据/错误并验证重试恢复; evidence:执行 pnpm --filter @aetherblog/admin build 成功；AI看板与日志组件已接入 errorCategory+最近成功时间+手动重试逻辑; risk:medium 仍需在集成环境验证网络抖动与后端500时的用户提示节流，避免高频报错干扰; done_at:2026-02-13
AIOB-070,P0,8,both,补齐后端、AI 服务与前端分层测试,新增集成测试、路由测试和前端契约回归，覆盖正常、空数据、异常、鉴权失败四类关键路径。,新增测试用例覆盖四类路径；后端迁移+查询集成测试可稳定通过；关键页面回归用例纳入默认验证流程。,AUTOE2E,Review需确认测试数据构造可重复、无环境偶发性，且失败信息可直接定位到链路节点。,回归需在 CI 与本地各执行至少1次全链路测试，结果一致且无新增不稳定用例。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:23;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/service/StatsService.java:89;apps/ai-service/app/api/routes/metrics.py:9;apps/admin/src/pages/dashboard/DashboardPage.tsx:149;apps/server/aetherblog-service/blog-service/src/test/java/com/aetherblog/blog/service/StatsServiceTest.java:149;apps/server/aetherblog-service/blog-service/src/test/java/com/aetherblog/blog/service/LogViewerServiceTest.java:15;apps/ai-service/tests/test_metrics_routes.py:14;docs/qa/ai-layered-test-matrix-2026-02-13.md:1,"picked_reason:优先补齐四类路径测试，建立后续 P1 发布与观测任务的可重复验证基线。; review_initial:新增测试均为可重复构造（TempDir/Mock/Fake Metrics），失败信息可直接定位到服务层与路由层; validation_limited:AUTOE2E 要求 CI 与本地全链路各跑一次，当前仅完成本地分层测试；前端缺少专用测试框架，采用 build 作为契约回归门禁; manual_test:按 docs/qa/ai-layered-test-matrix-2026-02-13.md 执行后端与AI测试命令，并在联调环境补跑一次端到端场景; evidence:执行 cd apps/server && mvn -pl aetherblog-service/blog-service -am -Dtest=StatsServiceTest,LogViewerServiceTest -Dsurefire.failIfNoSpecifiedTests=false test 成功(7 tests); 执行 ai-service 两个测试文件通过(4 passed); 执行 pnpm --filter @aetherblog/admin build 成功; risk:medium CI 全链路与前端真实故障态自动化仍待补齐，需在后续流水线加入可视化回归; done_at:2026-02-13"
AIOB-080,P1,9,both,建立发布前置检查与灰度回滚策略,增加 preflight 检查脚本并定义灰度发布与回滚开关，保障异常可快速止损。,preflight 覆盖迁移版本、关键 API、权限与日志可读性；灰度策略可执行并具备回滚路径；发布演练至少完成1次。,AUTOE2E,Review需确认 preflight 失败即阻断发布，且输出项可直接映射到责任模块。,回归需在灰度环境演练“发布-观测-回滚”闭环并记录耗时与操作步骤。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:24;apps/server/aetherblog-ai/ai-client/src/main/resources/application-ai.yml:4;apps/server/aetherblog-service/blog-service/src/main/java/com/aetherblog/blog/controller/SystemMonitorController.java:105;apps/server/aetherblog-app/src/main/resources/db/migration/V2_19__fix_ai_usage_backfill_and_lengths.sql:4;ops/release/preflight.sh:60;ops/release/preflight.sh:92;ops/webhook/deploy.sh:13;ops/webhook/deploy.sh:62;ops/webhook/deploy.sh:82;docs/ops/ai-preflight-canary-rollback-2026-02-13.md:1,picked_reason:先把发布前置检查脚本化并定义可执行回滚开关，降低故障放大风险。; review_initial:preflight 输出已按 compose/migration/api/auth/logs 分项映射责任模块，失败默认阻断部署; validation_limited:本地仅执行 --no-runtime 静态 preflight 与 deploy 脚本语法检查，未在灰度环境完成真实发布-回滚演练; manual_test:灰度环境执行 DEPLOY_MODE=canary 发布后观测10~30分钟，再执行 DEPLOY_MODE=rollback ROLLBACK_VERSION=<stable_tag> 回滚并记录耗时; evidence:执行 bash ops/release/preflight.sh --no-runtime 与 bash -n ops/webhook/deploy.sh 均成功；新增灰度/回滚流程文档; risk:medium 真实回滚耗时与容器拉取速度需在目标环境验证，建议演练后固化SLO; done_at:2026-02-13
AIOB-090,P1,10,both,执行发布后 24h 观测与问题闭环,定义监控面板与告警阈值，按小时复核关键指标并沉淀复盘和长期治理项。,发布后24小时内完成按小时巡检记录；错误率、空数据占比、埋点成功率均有趋势图与阈值；复盘清单可追踪。,AUTOE2E,Review需确认监控指标与告警阈值与基线一致，避免只监控“有无报错”而忽略数据失真。,回归需对比发布前后同口径指标，确认无静默失败回归并输出治理待办。,已完成,已完成,已完成,已提交,,plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:25;plan/2026-02-13_17-14-53-ai-analytics-logging-observability-fix.md:27;apps/ai-service/app/api/routes/metrics.py:9;apps/admin/src/pages/dashboard/DashboardPage.tsx:149;ops/release/post_release_observer.sh:11;ops/release/post_release_observer.sh:105;ops/release/reports/2026-02-13-ai-observability-hourly.csv:2;docs/ops/ai-post-release-24h-observation-template-2026-02-13.md:1,picked_reason:补齐发布后24h观测模板与采集脚本，确保上线后可小时级追踪并快速闭环。; review_initial:监控指标与阈值已对齐基线口径（错误率/空数据占比/埋点失败占比），并提供小时级记录模板; validation_limited:尚未经历真实发布后的连续24h窗口，本轮仅完成采集脚本样例执行与模板落地; manual_test:发布后每小时执行 bash ops/release/post_release_observer.sh（携带AUTH_HEADER）并填充模板，24h后对比基线输出治理待办; evidence:执行 bash ops/release/post_release_observer.sh --sample 成功并生成 reports/2026-02-13-ai-observability-hourly.csv 示例记录; risk:medium 真实环境需保证观测脚本认证凭据与网关可达性，否则会影响连续24h数据完整性; done_at:2026-02-13
