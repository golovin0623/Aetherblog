"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"ETSA-000","P0","1","both","建立编辑器与目录体验基线","建立可复现的首屏、长文、重复标题、代码块场景基线，并定义统一验收阈值与记录模板，作为后续变更唯一判据。","至少覆盖5类场景并形成可复测清单；TOC点击成功率100%；split同步误差≤3行；自动保存状态可见；每项含复现步骤与预期结果。","AUTOE2E","Review基线样本需覆盖三种viewMode、明暗主题、AI浮层开关与失败路径；阈值必须量化且可重复执行。","回归时按清单逐项复测并保留截图或录屏；若阈值调整需同步更新依据与影响说明。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:16;plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:26;apps/admin/src/pages/posts/CreatePostPage.tsx:75;packages/editor/src/EditorWithPreview.tsx:92;apps/blog/app/components/TableOfContents.tsx:17;docs/qa/editor-toc-sync-autosave-baseline.md:1","picked_reason:P0基线先行可统一后续验收口径并减少返工;done_at:2026-02-13;evidence:新增5类场景基线与统一阈值及记录模板文档;review_initial:覆盖viewMode/主题/AI浮层/失败路径要求并量化阈值;review_regression:定义逐项复测与证据留存规则"
"ETSA-010","P0","2","frontend","修复 CodeMirror 选区可见性","在编辑器主题层补齐 selection 与 focus/blur 样式链，确保 AI 浮层显示或失焦恢复时选区持续可见。","在 light/dark + focus/blur + 键鼠选区场景下选区均清晰可见；AI浮层开关后1秒内无选区丢失；输入光标行为正常。","AUTOFRONTEND","Review覆盖 ::selection、.cm-selectionLayer、.cm-selectionBackground 与焦点态优先级；不得破坏行号与活动行对比度。","回归检查亮暗主题、全屏/分屏切换、AI面板开关与拖拽选区；无可访问性对比度回退。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:17;packages/editor/src/MarkdownEditor.tsx:79;packages/editor/src/MarkdownEditor.tsx:125;apps/admin/src/pages/posts/CreatePostPage.tsx:1931;packages/editor/src/MarkdownEditor.tsx:82","picked_reason:P0且与编辑器核心交互直接相关需优先收敛;done_at:2026-02-13;evidence:补齐cm-selectionLayer与::selection在focus/blur下的统一样式变量;review_initial:覆盖::selection/.cm-selectionLayer/.cm-selectionBackground与焦点态优先级;review_regression:人工回归点包含亮暗主题+viewMode切换+AI面板开关+拖拽选区;validation_limited:缺少可自动化的CodeMirror可视选区断言且当前workspace类型检查存在既有依赖解析错误;manual_test:pnpm dev:admin 后在CreatePostPage执行light/dark+focus/blur+键鼠选区+AI浮层开关并观察1秒内选区可见;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);pnpm --filter @aetherblog/admin build失败于既有TS2307与隐式any非本次改动引入;risk:low 仅调整编辑器选区样式层级未触及业务数据或接口"
"ETSA-020","P0","3","frontend","重构预览行号锚点映射策略","将 data-source-line 生成从文本包含匹配升级为稳定位置映射并处理重复文本去歧义，降低目录定位漂移。","重复标题或重复段落文档中 heading 与 paragraph 的 data-source-line 准确率≥99%；连续10次TOC跳转无累计漂移>3行。","AUTOFRONTEND","Review映射算法需包含首匹配缓存与重复计数去歧义；热路径复杂度可控且避免 O(n²) 退化。","回归覆盖重复标题、相似前缀段落、代码块密集文档；锚点稳定且无错位跳转。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:18;packages/editor/src/MarkdownPreview.tsx:226;packages/editor/src/MarkdownPreview.tsx:236;packages/editor/src/MarkdownPreview.tsx:247;packages/editor/src/MarkdownPreview.tsx:235;packages/editor/src/MarkdownPreview.tsx:289;packages/editor/src/MarkdownPreview.tsx:352","picked_reason:P0且是TOC定位与同步滚动稳定性的前置能力;done_at:2026-02-13;evidence:将data-source-line定位从首个includes匹配升级为预索引+顺序游标+重复文本去歧义;review_initial:映射包含首匹配缓存(lineIndexMap)+重复计数游标(keyCursorMap)+前向优先策略;review_regression:覆盖重复标题/相似前缀/代码块密集文档场景并保留手工复测路径;validation_limited:缺少独立预览映射自动化测试基建且工作区存在既有TS依赖解析失败;manual_test:pnpm dev:admin 后在CreatePostPage加载重复标题文档执行10次TOC跳转并核对data-source-line命中与漂移<=3行;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);pnpm --filter @aetherblog/admin build失败为既有TS2307与隐式any错误;risk:medium 映射算法变更影响heading/paragraph锚点需在长文与重复段落场景重点回归"
"ETSA-030","P0","4","frontend","统一 TOC 导航执行器","抽象编辑、预览、分屏统一导航管线，按 viewMode 选择目标容器；纯预览模式直接命中预览锚点。","edit/split/preview 三模式目录点击定位成功率100%；preview 模式不依赖编辑器 DOM；导航后 active heading 在1秒内更新。","AUTOE2E","Review确认导航入口唯一且移除分支散落；切换 viewMode 与同步开关时无竞态与回弹。","回归验证目录点击、键盘导航、返回顶部与历史滚动恢复；无匹配标题时有可观测日志。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:19;apps/admin/src/pages/posts/CreatePostPage.tsx:418;apps/admin/src/pages/posts/CreatePostPage.tsx:75;apps/admin/src/pages/posts/CreatePostPage.tsx:2080;apps/admin/src/pages/posts/CreatePostPage.tsx:79;apps/admin/src/pages/posts/CreatePostPage.tsx:562;apps/admin/src/pages/posts/CreatePostPage.tsx:2099","picked_reason:P0且统一导航入口可降低viewMode分支竞态风险;done_at:2026-02-13;evidence:抽象单一TOC导航执行器并按viewMode选择editor/preview/both目标容器;review_initial:确认导航入口统一且移除散落分支并补充无匹配标题日志;review_regression:覆盖viewMode切换+同步开关+目录点击与返回顶部共存路径;validation_limited:缺少E2E用例与当前workspace构建存在既有TS依赖错误无法完成端到端自动回归;manual_test:pnpm dev:admin 后在CreatePostPage分别切换edit/split/preview点击目录验证命中与active heading 1秒内更新;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);risk:medium 导航逻辑重构涉及滚动与同步切换需关注边界场景回弹"
"ETSA-040","P0","5","frontend","升级分屏同步滚动算法","以锚点分段插值替代行高估算，加入惯性抑制与双向节流，并完善 TOC 跳转后的同步恢复策略。","长文 split 模式连续滚动3分钟累计误差≤3行；滚动处理帧耗时 P95 < 8ms；TOC 跳转后无明显回弹。","AUTOE2E","Review节流参数与 observer 生命周期，避免重复绑定与泄漏；同步关闭时不得驱动对端滚动。","回归不同字体大小、窗口尺寸、代码块密集与快速滚轮场景；性能 profile 无主线程长任务。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:20;packages/editor/src/EditorWithPreview.tsx:92;packages/editor/src/EditorWithPreview.tsx:126;apps/admin/src/pages/posts/CreatePostPage.tsx:2080;packages/editor/src/EditorWithPreview.tsx:76;packages/editor/src/EditorWithPreview.tsx:95;packages/editor/src/EditorWithPreview.tsx:154;packages/editor/src/EditorWithPreview.tsx:231","picked_reason:P0且直接影响split核心体验与TOC跳转稳定性;done_at:2026-02-13;evidence:split同步改为锚点分段插值并加入双向节流与惯性抑制;review_initial:检查节流参数与事件绑定清理防止重复绑定/泄漏且同步关闭时直接退出;review_regression:覆盖长文滚动/字体变化/窗口变化/代码块密集场景并验证TOC跳转后无明显回弹;validation_limited:未执行真实3分钟性能profile与E2E自动回归因当前仓库构建存在既有TS依赖错误;manual_test:pnpm dev:admin 后在split模式执行连续滚动与TOC跳转并观察累计误差<=3行与无回弹;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);risk:medium 滚动映射算法变更需在极端长文与低性能设备持续观察"
"ETSA-050","P1","6","frontend","重做目录侧栏动画时间线","合并侧栏展开与条目入场动画为单时间线，优先使用 transform/opacity，并提供 reduced-motion 降级。","目录开合动画总时长稳定在180到320毫秒；无二段式卡顿；prefers-reduced-motion 启用时关闭非必要位移与模糊效果。","AUTOFRONTEND","Review动画仅使用可合成层属性并避免高成本 blur/stagger；交互中断后状态保持一致。","回归桌面与低性能设备，连续开关目录20次无明显掉帧尖峰；reduced-motion 路径视觉正确。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:21;apps/admin/src/pages/posts/CreatePostPage.tsx:1942;apps/admin/src/pages/posts/CreatePostPage.tsx:1964;apps/blog/app/components/TableOfContents.tsx:85;apps/admin/src/pages/posts/CreatePostPage.tsx:1;apps/admin/src/pages/posts/CreatePostPage.tsx:416;apps/admin/src/pages/posts/CreatePostPage.tsx:2049","picked_reason:P1且可独立交付并改善目录操作感知稳定性;done_at:2026-02-13;evidence:TOC面板与条目动画收敛为单时间线并移除blur/stagger重负担路径;review_initial:仅使用transform/opacity并在prefers-reduced-motion下关闭非必要位移;review_regression:覆盖连续开合与交互打断后状态一致性检查;validation_limited:未在低性能真机完成20次开合帧率采样仅完成静态检查与代码路径校验;manual_test:pnpm dev:admin 后连续开关目录20次并切换系统reduced-motion观察时长与无二段卡顿;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);risk:low 仅调整目录动画参数与变体不影响数据与接口"
"ETSA-060","P1","7","both","落地自动保存状态条与统一状态机","在页脚字数与行数区域右侧增加低干扰保存状态组件，并与手动保存和自动保存共用状态机。","状态至少覆盖保存中、已保存、失败、关闭；最近成功时间与相对时长可持续更新；失败后可手动刷新并反馈结果。","AUTOE2E","Review状态来源需与 postService 结果一致；禁止出现 UI 显示成功但请求失败的不一致。","回归断网、慢网、冲突保存与自动保存关闭场景；确认文案、颜色和可访问性语义一致。","已完成","已完成","已完成","已提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:22;apps/admin/src/pages/posts/CreatePostPage.tsx:2061;apps/admin/src/pages/posts/CreatePostPage.tsx:84;apps/admin/src/pages/posts/CreatePostPage.tsx:1629;apps/admin/src/pages/posts/CreatePostPage.tsx:59;apps/admin/src/pages/posts/CreatePostPage.tsx:105;apps/admin/src/pages/posts/CreatePostPage.tsx:990;apps/admin/src/pages/posts/CreatePostPage.tsx:2167","picked_reason:P1且能统一手动保存与自动保存反馈状态机;done_at:2026-02-13;evidence:新增统一保存状态机并在页脚展示保存中/已保存/失败/关闭及相对时间与刷新动作;review_initial:状态来源绑定autoSave/handleSave/handlePublish结果避免UI成功但请求失败不一致;review_regression:覆盖自动保存开关/失败恢复/手动保存与发布并发状态切换;validation_limited:未在真实断网慢网环境执行E2E仅完成静态检查与逻辑路径验证;manual_test:pnpm dev:admin 后在编辑页验证自动保存四态展示并通过刷新按钮重试失败状态;evidence:pnpm --filter @aetherblog/admin lint(0 errors,174 warnings-existing);risk:medium 状态机接入保存链路需在网络异常与发布跳转场景继续观察"
"ETSA-070","P1","8","frontend","增强博客详情页现代目录体验","在文章详情页引入桌面侧栏与移动端目录入口，复用 Markdown 标题 ID 规则并支持 active heading 跟踪与平滑滚动。","桌面与移动端均可打开目录并定位标题；active heading 跟踪延迟低于300毫秒；目录 ID 与 MarkdownRenderer 规则保持100%一致。","AUTOE2E","Review目录组件与渲染器需共享同一 heading-id 规则；布局不得破坏沉浸式阅读宽度与内容回流稳定性。","回归长文、重复标题、锚点直达与浏览器返回；移动端抽屉开合与滚动锁定行为正确。","未开始","未开始","未开始","未提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:23;apps/blog/app/posts/(article)/[slug]/page.tsx:112;apps/blog/app/components/TableOfContents.tsx:17;apps/blog/app/components/MarkdownRenderer.tsx:147",""
"ETSA-080","P0","9","both","执行分层回归与发布保护","按组件、页面与手工场景执行全量回归，并准备灰度开关与快速回滚点以降低上线风险。","输出覆盖核心场景的回归记录；灰度开关与回滚点在一次发布演练中可用；阻断级缺陷清零后方可发布。","AUTOE2E","Review测试矩阵需覆盖主题、长文、重复标题、代码块和三种 viewMode；明确 blocker 分级标准。","发布前执行完整复测与故障注入（同步开关、动画降级、保存失败）；发布后观察关键指标24小时无异常。","未开始","未开始","未开始","未提交","","plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:24;plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:34;plan/2026-02-13_08-12-59-editor-toc-sync-autosave-ux.md:41",""
