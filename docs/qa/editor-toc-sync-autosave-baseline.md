# 编辑器/目录/自动保存体验基线（ETSA-000）

## 目标

- 作为 ETSA 系列改动的唯一验收判据。
- 在相同数据集、相同操作路径下重复执行并得到可比较结果。

## 统一阈值

- TOC 点击定位成功率：`100%`
- Split 同步误差：`<= 3 行`
- TOC 跳转后 active heading 更新时间：`<= 1s`
- 自动保存状态可见性：`保存中/已保存/失败/关闭` 四态必须可见
- 动画感知：目录开合总时长 `180ms-320ms`

## 基线数据集

- `Dataset-A`：短文（3-5 个标题，含 1 个代码块）
- `Dataset-B`：长文（>= 2000 行，>= 30 个标题）
- `Dataset-C`：重复标题（同名 H2/H3 各 >= 3 次）
- `Dataset-D`：代码块密集（代码块占比 >= 35%）
- `Dataset-E`：网络扰动（慢网/断网，验证自动保存失败恢复）

## 可复测清单（5 类场景）

### 场景 1：首屏基础链路（Dataset-A）

1. 在 `edit`、`split`、`preview` 三种 `viewMode` 分别点击目录前 3 个标题。
2. 观察定位是否命中目标标题，active heading 是否在 1 秒内更新。
3. 检查底部状态条能否显示自动保存状态。

预期：点击成功率 `100%`，状态条可见且语义正确。

### 场景 2：长文滚动同步（Dataset-B）

1. 进入 `split` 模式，连续滚动 3 分钟（上下往返）。
2. 每 30 秒记录一次编辑器可视段与预览可视段误差行数。
3. 插入一次 TOC 跳转，继续滚动并观察是否回弹。

预期：累计误差 `<= 3 行`，无明显回弹。

### 场景 3：重复标题去歧义（Dataset-C）

1. 在目录中依次点击所有重名标题（重复 2 轮）。
2. 比对目标文本上下文，确认每次命中对应实例。
3. 记录是否出现错位、回跳或漂移。

预期：目标命中准确率 `>= 99%`，连续 10 次跳转无累计漂移 `> 3 行`。

### 场景 4：代码块密集文档（Dataset-D）

1. 在 `split` 模式快速滚轮滚动并穿插目录点击。
2. 检查目录 active heading 是否稳定切换。
3. 观察主线程卡顿（若可用 devtools 记录长任务）。

预期：定位稳定，滚动无明显掉帧尖峰。

### 场景 5：自动保存异常恢复（Dataset-E）

1. 打开自动保存后编辑内容，观察 `保存中 -> 已保存`。
2. 切换断网或注入失败，观察 `失败` 状态与重试反馈。
3. 关闭自动保存，确认显示 `关闭`；重新开启后恢复正常。

预期：四态可见，失败后可恢复并可观测。

## 执行矩阵

- 主题：`light` / `dark`
- 视图：`edit` / `split` / `preview`
- AI 浮层：开 / 关
- 焦点：focus / blur

执行要求：每次回归至少覆盖一组完整笛卡尔组合（推荐先 `split + dark + AI 开 + focus`）。

## 记录模板

| 日期 | 执行人 | 数据集 | 主题 | viewMode | AI 浮层 | 结果 | 证据 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| YYYY-MM-DD | name | Dataset-A/B/C/D/E | light/dark | edit/split/preview | on/off | pass/fail | screenshot/video/log |

## 失败分级

- `Blocker`：TOC 无法定位、保存状态误导（UI 成功但请求失败）、崩溃。
- `Major`：同步误差持续 `> 3 行`、active heading 长时间不更新。
- `Minor`：动画轻微不稳、偶发闪烁但不影响主要链路。

仅当 `Blocker=0` 时允许进入发布环节。
